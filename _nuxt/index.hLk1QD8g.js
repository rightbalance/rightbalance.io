import{f as ci,v as Ot,m as li,x as di,E as hn,o as bt,c as St,a as ce,b as kt,w as lr,G as fi,t as Xe,h as $e,n as ln,A as Br,_ as pi,l as fn,g as Fr,B as un,s as cn,F as Lr,q as Dr,p as dn,e as pn}from"./entry.sQivFXyD.js";import{u as vn}from"./vue.f36acd1f.sj9-9j71.js";import{u as Pr,q as Rr}from"./query.Rnk1sSMC.js";import{C as mn}from"./cta.WK7I18YA.js";import{_ as gn}from"./client-only.k-3-YRUv.js";import{s as yn}from"./interval.DMMf7yZq.js";import{C as xn}from"./constants.iugtEiT4.js";import{u as ui}from"./assets.3cWO4G_J.js";import"./preview.8CcEUiaZ.js";import"./logo.WVeLc6qh.js";const _n=[9.9280694,-84.0907246,.025,-8.0577401,-34.8829629,.075,19.4326077,-99.133208,.075,20.9673702,-89.5925857,.025,23.634501,-102.552784,.025,34.0522342,-118.2436849,.075,56.3268684,44.0058793,.025,-37.4586139,-61.9328019,.025,-32.9587022,-60.6930416,.025,55.755826,37.6173,.025,20.6596988,-103.3496092,.025,42.8257618,75.2901807,.025,40.4092617,49.8670924,.025,54.9832693,82.8963831,.025,-25.4323659,-49.1933233,.025,-25.4372382,-49.2699727,.075,-23.5557714,-46.6395571,.1,-17.930178,-43.7908453,.025,-34.9011127,-56.1645314,.075,-26.9165792,-49.0717331,.025,-18.9127749,-48.2755227,.025,-3.1190275,-60.0217314,.1,-14.4459041799269,-41.4522974339447,.025,-24.3182917,-46.99406,.025,-34.6036844,-58.3815591,.025,-16.6868912,-49.2647943,.025,-34.8643645,-55.2716278,.025,-17.4139766,-66.1653224,.025,-30.0368176,-51.2089887,.05,-21.1694018,-47.8110855,.025,-34.799728,-55.8998909,.025,-27.5948036,-48.5569286,.05,19.2662338,-103.7390574,.025,-26.3043758,-48.8463744,.05,-23.6059252,-46.926502,.025,-31.4207828,-64.4992141,.025,-20.1279874,-40.3081052,.025,-12.0463731,-77.042754,.025,9.748917,-83.753428,.025,6.2476376,-75.5658153,.025,-21.4739591,-47.0008778,.025,-25.5898125,-49.3997714,.025,-20.8126993,-49.3765372,.025,-27.6411215,-48.6789533,.025],wn={key:0,class:"vcenter"},Mn={class:"big-symbols"},bn={class:"medium-symbols"},Sn={class:"small-symbols"},Tn={key:1},Cn={class:"speedometer"},An={class:"medium-symbols"},En={class:"small-symbols"},Fn=ci({__name:"tracker-item",props:{value:{default:void 0},medium:{default:""},text:{default:""},speedometer:{type:Boolean,default:!1}},setup(be){const Le=be,Re=Ot(!0),t=Ot(!0),e=Ot(0),r=li(()=>({callback:o=>{Re.value=o},once:!0})),n=li(()=>({callback:()=>{if(Re){const o=yn(()=>{Le.value&&e.value<Le.value?++e.value:clearInterval(o)},25)}},once:!0}));di(()=>{e.value=0,Re.value=!1,t.value=!1});function a(){t.value=!0}return(o,s)=>{const l=gn,h=hn("observe-visibility");return bt(),St("li",null,[Le.speedometer?(bt(),St("span",Tn,[ce("div",Cn,[kt(l,null,{default:lr(()=>[Br(ce("div",null,null,512),[[h,$e(r)]])]),_:1}),ce("div",{class:ln({needle:!0,animate:$e(Re),tickle:$e(t)}),onAnimationend:a},null,34)]),ce("div",An,Xe(Le.medium),1),ce("div",En,Xe(Le.text),1)])):(bt(),St("div",wn,[ce("div",Mn,[kt(l,null,{default:lr(()=>[Br(ce("div",null,null,512),[[h,$e(n)]])]),_:1}),fi(o.$slots,"prefix",{},void 0,!0),ce("span",null,Xe($e(e)),1),fi(o.$slots,"suffix",{},void 0,!0)]),ce("div",bn,Xe(Le.medium),1),ce("div",Sn,Xe(Le.text),1)]))])}}}),Ur=pi(Fn,[["__scopeId","data-v-298e43e2"]]);var zr={exports:{}};(function(be,Le){var Re=Re||{},t={REVISION:"69"};be.exports=t,Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:e>0?1:0}),t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},t.CullFaceNone=0,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.FrontFaceDirectionCW=0,t.FrontFaceDirectionCCW=1,t.BasicShadowMap=0,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.FrontSide=0,t.BackSide=1,t.DoubleSide=2,t.NoShading=0,t.FlatShading=1,t.SmoothShading=2,t.NoColors=0,t.FaceColors=1,t.VertexColors=2,t.NoBlending=0,t.NormalBlending=1,t.AdditiveBlending=2,t.SubtractiveBlending=3,t.MultiplyBlending=4,t.CustomBlending=5,t.AddEquation=100,t.SubtractEquation=101,t.ReverseSubtractEquation=102,t.MinEquation=103,t.MaxEquation=104,t.ZeroFactor=200,t.OneFactor=201,t.SrcColorFactor=202,t.OneMinusSrcColorFactor=203,t.SrcAlphaFactor=204,t.OneMinusSrcAlphaFactor=205,t.DstAlphaFactor=206,t.OneMinusDstAlphaFactor=207,t.DstColorFactor=208,t.OneMinusDstColorFactor=209,t.SrcAlphaSaturateFactor=210,t.MultiplyOperation=0,t.MixOperation=1,t.AddOperation=2,t.UVMapping=function(){},t.CubeReflectionMapping=function(){},t.CubeRefractionMapping=function(){},t.SphericalReflectionMapping=function(){},t.SphericalRefractionMapping=function(){},t.RepeatWrapping=1e3,t.ClampToEdgeWrapping=1001,t.MirroredRepeatWrapping=1002,t.NearestFilter=1003,t.NearestMipMapNearestFilter=1004,t.NearestMipMapLinearFilter=1005,t.LinearFilter=1006,t.LinearMipMapNearestFilter=1007,t.LinearMipMapLinearFilter=1008,t.UnsignedByteType=1009,t.ByteType=1010,t.ShortType=1011,t.UnsignedShortType=1012,t.IntType=1013,t.UnsignedIntType=1014,t.FloatType=1015,t.UnsignedShort4444Type=1016,t.UnsignedShort5551Type=1017,t.UnsignedShort565Type=1018,t.AlphaFormat=1019,t.RGBFormat=1020,t.RGBAFormat=1021,t.LuminanceFormat=1022,t.LuminanceAlphaFormat=1023,t.RGB_S3TC_DXT1_Format=2001,t.RGBA_S3TC_DXT1_Format=2002,t.RGBA_S3TC_DXT3_Format=2003,t.RGBA_S3TC_DXT5_Format=2004,t.RGB_PVRTC_4BPPV1_Format=2100,t.RGB_PVRTC_2BPPV1_Format=2101,t.RGBA_PVRTC_4BPPV1_Format=2102,t.RGBA_PVRTC_2BPPV1_Format=2103,t.Color=function(e){return arguments.length===3?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},t.Color.prototype={constructor:t.Color,r:1,g:1,b:1,set:function(e){return e instanceof t.Color?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,r,n){return this.r=e,this.g=r,this.b=n,this},setHSL:function(e,r,n){if(r===0)this.r=this.g=this.b=n;else{var a=function(l,h,c){return c<0&&(c+=1),c>1&&(c-=1),c<.16666666666666666?l+(h-l)*6*c:c<.5?h:c<.6666666666666666?l+(h-l)*6*(.6666666666666666-c):l},o=n<=.5?n*(1+r):n+r-n*r,s=2*n-o;this.r=a(s,o,e+1/3),this.g=a(s,o,e),this.b=a(s,o,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var r=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var r=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var r=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(r[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var r=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(r[1]+r[1]+r[2]+r[2]+r[3]+r[3],16)),this}if(/^(\w+)$/i.test(e))return this.setHex(t.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,r=this.g,n=this.b;return this.r=e*e,this.g=r*r,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var r=e||{h:0,s:0,l:0},n=this.r,a=this.g,o=this.b,s=Math.max(n,a,o),l=Math.min(n,a,o),h,c,d=(l+s)/2;if(l===s)h=0,c=0;else{var p=s-l;switch(c=d<=.5?p/(s+l):p/(2-s-l),s){case n:h=(a-o)/p+(a<o?6:0);break;case a:h=(o-n)/p+2;break;case o:h=(n-a)/p+4;break}h/=6}return r.h=h,r.s=c,r.l=d,r},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,r,n){var a=this.getHSL();return a.h+=e,a.s+=r,a.l+=n,this.setHSL(a.h,a.s,a.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,r){return this.r=e.r+r.r,this.g=e.g+r.g,this.b=e.b+r.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,r){return this.r+=(e.r-this.r)*r,this.g+=(e.g-this.g)*r,this.b+=(e.b-this.b)*r,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return new t.Color().setRGB(this.r,this.g,this.b)}},t.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},t.Quaternion=function(e,r,n,a){this._x=e||0,this._y=r||0,this._z=n||0,this._w=a!==void 0?a:1},t.Quaternion.prototype={constructor:t.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,r,n,a){return this._x=e,this._y=r,this._z=n,this._w=a,this.onChangeCallback(),this},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,r){if(!(e instanceof t.Euler))throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var n=Math.cos(e._x/2),a=Math.cos(e._y/2),o=Math.cos(e._z/2),s=Math.sin(e._x/2),l=Math.sin(e._y/2),h=Math.sin(e._z/2);return e.order==="XYZ"?(this._x=s*a*o+n*l*h,this._y=n*l*o-s*a*h,this._z=n*a*h+s*l*o,this._w=n*a*o-s*l*h):e.order==="YXZ"?(this._x=s*a*o+n*l*h,this._y=n*l*o-s*a*h,this._z=n*a*h-s*l*o,this._w=n*a*o+s*l*h):e.order==="ZXY"?(this._x=s*a*o-n*l*h,this._y=n*l*o+s*a*h,this._z=n*a*h+s*l*o,this._w=n*a*o-s*l*h):e.order==="ZYX"?(this._x=s*a*o-n*l*h,this._y=n*l*o+s*a*h,this._z=n*a*h-s*l*o,this._w=n*a*o+s*l*h):e.order==="YZX"?(this._x=s*a*o+n*l*h,this._y=n*l*o+s*a*h,this._z=n*a*h-s*l*o,this._w=n*a*o-s*l*h):e.order==="XZY"&&(this._x=s*a*o-n*l*h,this._y=n*l*o-s*a*h,this._z=n*a*h+s*l*o,this._w=n*a*o+s*l*h),r!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,r){var n=r/2,a=Math.sin(n);return this._x=e.x*a,this._y=e.y*a,this._z=e.z*a,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var r=e.elements,n=r[0],a=r[4],o=r[8],s=r[1],l=r[5],h=r[9],c=r[2],d=r[6],p=r[10],v=n+l+p,m;return v>0?(m=.5/Math.sqrt(v+1),this._w=.25/m,this._x=(d-h)*m,this._y=(o-c)*m,this._z=(s-a)*m):n>l&&n>p?(m=2*Math.sqrt(1+n-l-p),this._w=(d-h)/m,this._x=.25*m,this._y=(a+s)/m,this._z=(o+c)/m):l>p?(m=2*Math.sqrt(1+l-n-p),this._w=(o-c)/m,this._x=(a+s)/m,this._y=.25*m,this._z=(h+d)/m):(m=2*Math.sqrt(1+p-n-l),this._w=(s-a)/m,this._x=(o+c)/m,this._y=(h+d)/m,this._z=.25*m),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,r,n=1e-6;return function(a,o){return e===void 0&&(e=new t.Vector3),r=a.dot(o)+1,r<n?(r=0,Math.abs(a.x)>Math.abs(a.z)?e.set(-a.y,a.x,0):e.set(0,-a.z,a.y)):e.crossVectors(a,o),this._x=e.x,this._y=e.y,this._z=e.z,this._w=r,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,r){return r!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,r)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,r){var n=e._x,a=e._y,o=e._z,s=e._w,l=r._x,h=r._y,c=r._z,d=r._w;return this._x=n*d+s*l+a*c-o*h,this._y=a*d+s*h+o*l-n*c,this._z=o*d+s*c+n*h-a*l,this._w=s*d-n*l-a*h-o*c,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,r){if(r===0)return this;if(r===1)return this.copy(e);var n=this._x,a=this._y,o=this._z,s=this._w,l=s*e._w+n*e._x+a*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=s,this._x=n,this._y=a,this._z=o,this;var h=Math.acos(l),c=Math.sqrt(1-l*l);if(Math.abs(c)<.001)return this._w=.5*(s+this._w),this._x=.5*(n+this._x),this._y=.5*(a+this._y),this._z=.5*(o+this._z),this;var d=Math.sin((1-r)*h)/c,p=Math.sin(r*h)/c;return this._w=s*d+this._w*p,this._x=n*d+this._x*p,this._y=a*d+this._y*p,this._z=o*d+this._z*p,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,r){return r===void 0&&(r=0),this._x=e[r],this._y=e[r+1],this._z=e[r+2],this._w=e[r+3],this.onChangeCallback(),this},toArray:function(e,r){return e===void 0&&(e=[]),r===void 0&&(r=0),e[r]=this._x,e[r+1]=this._y,e[r+2]=this._z,e[r+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new t.Quaternion(this._x,this._y,this._z,this._w)}},t.Quaternion.slerp=function(e,r,n,a){return n.copy(e).slerp(r,a)},t.Vector2=function(e,r){this.x=e||0,this.y=r||0},t.Vector2.prototype={constructor:t.Vector2,set:function(e,r){return this.x=e,this.y=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,r){switch(e){case 0:this.x=r;break;case 1:this.y=r;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,r){return r!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,r)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,r){return r!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,r)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){if(e!==0){var r=1/e;this.x*=r,this.y*=r}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,r){return this.x<e.x?this.x=e.x:this.x>r.x&&(this.x=r.x),this.y<e.y?this.y=e.y:this.y>r.y&&(this.y=r.y),this},clampScalar:function(){var e,r;return function(n,a){return e===void 0&&(e=new t.Vector2,r=new t.Vector2),e.set(n,n),r.set(a,a),this.clamp(e,r)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var r=this.x-e.x,n=this.y-e.y;return r*r+n*n},setLength:function(e){var r=this.length();return r!==0&&e!==r&&this.multiplyScalar(e/r),this},lerp:function(e,r){return this.x+=(e.x-this.x)*r,this.y+=(e.y-this.y)*r,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,r){return r===void 0&&(r=0),this.x=e[r],this.y=e[r+1],this},toArray:function(e,r){return e===void 0&&(e=[]),r===void 0&&(r=0),e[r]=this.x,e[r+1]=this.y,e},clone:function(){return new t.Vector2(this.x,this.y)}},t.Vector3=function(e,r,n){this.x=e||0,this.y=r||0,this.z=n||0},t.Vector3.prototype={constructor:t.Vector3,set:function(e,r,n){return this.x=e,this.y=r,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,r){switch(e){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,r){return r!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,r)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this.z=e.z+r.z,this},sub:function(e,r){return r!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,r)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this.z=e.z-r.z,this},multiply:function(e,r){return r!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,r)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,r){return this.x=e.x*r.x,this.y=e.y*r.y,this.z=e.z*r.z,this},applyEuler:function(){var e;return function(r){return r instanceof t.Euler||console.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order."),e===void 0&&(e=new t.Quaternion),this.applyQuaternion(e.setFromEuler(r)),this}}(),applyAxisAngle:function(){var e;return function(r,n){return e===void 0&&(e=new t.Quaternion),this.applyQuaternion(e.setFromAxisAngle(r,n)),this}}(),applyMatrix3:function(e){var r=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*r+o[3]*n+o[6]*a,this.y=o[1]*r+o[4]*n+o[7]*a,this.z=o[2]*r+o[5]*n+o[8]*a,this},applyMatrix4:function(e){var r=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*r+o[4]*n+o[8]*a+o[12],this.y=o[1]*r+o[5]*n+o[9]*a+o[13],this.z=o[2]*r+o[6]*n+o[10]*a+o[14],this},applyProjection:function(e){var r=this.x,n=this.y,a=this.z,o=e.elements,s=1/(o[3]*r+o[7]*n+o[11]*a+o[15]);return this.x=(o[0]*r+o[4]*n+o[8]*a+o[12])*s,this.y=(o[1]*r+o[5]*n+o[9]*a+o[13])*s,this.z=(o[2]*r+o[6]*n+o[10]*a+o[14])*s,this},applyQuaternion:function(e){var r=this.x,n=this.y,a=this.z,o=e.x,s=e.y,l=e.z,h=e.w,c=h*r+s*a-l*n,d=h*n+l*r-o*a,p=h*a+o*n-s*r,v=-o*r-s*n-l*a;return this.x=c*h+v*-o+d*-l-p*-s,this.y=d*h+v*-s+p*-o-c*-l,this.z=p*h+v*-l+c*-s-d*-o,this},project:function(){var e;return function(r){return e===void 0&&(e=new t.Matrix4),e.multiplyMatrices(r.projectionMatrix,e.getInverse(r.matrixWorld)),this.applyProjection(e)}}(),unproject:function(){var e;return function(r){return e===void 0&&(e=new t.Matrix4),e.multiplyMatrices(r.matrixWorld,e.getInverse(r.projectionMatrix)),this.applyProjection(e)}}(),transformDirection:function(e){var r=this.x,n=this.y,a=this.z,o=e.elements;return this.x=o[0]*r+o[4]*n+o[8]*a,this.y=o[1]*r+o[5]*n+o[9]*a,this.z=o[2]*r+o[6]*n+o[10]*a,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(e!==0){var r=1/e;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,r){return this.x<e.x?this.x=e.x:this.x>r.x&&(this.x=r.x),this.y<e.y?this.y=e.y:this.y>r.y&&(this.y=r.y),this.z<e.z?this.z=e.z:this.z>r.z&&(this.z=r.z),this},clampScalar:function(){var e,r;return function(n,a){return e===void 0&&(e=new t.Vector3,r=new t.Vector3),e.set(n,n,n),r.set(a,a,a),this.clamp(e,r)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var r=this.length();return r!==0&&e!==r&&this.multiplyScalar(e/r),this},lerp:function(e,r){return this.x+=(e.x-this.x)*r,this.y+=(e.y-this.y)*r,this.z+=(e.z-this.z)*r,this},cross:function(e,r){if(r!==void 0)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,r);var n=this.x,a=this.y,o=this.z;return this.x=a*e.z-o*e.y,this.y=o*e.x-n*e.z,this.z=n*e.y-a*e.x,this},crossVectors:function(e,r){var n=e.x,a=e.y,o=e.z,s=r.x,l=r.y,h=r.z;return this.x=a*h-o*l,this.y=o*s-n*h,this.z=n*l-a*s,this},projectOnVector:function(){var e,r;return function(n){return e===void 0&&(e=new t.Vector3),e.copy(n).normalize(),r=this.dot(e),this.copy(e).multiplyScalar(r)}}(),projectOnPlane:function(){var e;return function(r){return e===void 0&&(e=new t.Vector3),e.copy(this).projectOnVector(r),this.sub(e)}}(),reflect:function(){var e;return function(r){return e===void 0&&(e=new t.Vector3),this.sub(e.copy(r).multiplyScalar(2*this.dot(r)))}}(),angleTo:function(e){var r=this.dot(e)/(this.length()*e.length());return Math.acos(t.Math.clamp(r,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var r=this.x-e.x,n=this.y-e.y,a=this.z-e.z;return r*r+n*n+a*a},setEulerFromRotationMatrix:function(e,r){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(e,r){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,r){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,r)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var r=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),a=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=r,this.y=n,this.z=a,this},setFromMatrixColumn:function(e,r){var n=e*4,a=r.elements;return this.x=a[n],this.y=a[n+1],this.z=a[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,r){return r===void 0&&(r=0),this.x=e[r],this.y=e[r+1],this.z=e[r+2],this},toArray:function(e,r){return e===void 0&&(e=[]),r===void 0&&(r=0),e[r]=this.x,e[r+1]=this.y,e[r+2]=this.z,e},clone:function(){return new t.Vector3(this.x,this.y,this.z)}},t.Vector4=function(e,r,n,a){this.x=e||0,this.y=r||0,this.z=n||0,this.w=a!==void 0?a:1},t.Vector4.prototype={constructor:t.Vector4,set:function(e,r,n,a){return this.x=e,this.y=r,this.z=n,this.w=a,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,r){switch(e){case 0:this.x=r;break;case 1:this.y=r;break;case 2:this.z=r;break;case 3:this.w=r;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,r){return r!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,r)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,r){return this.x=e.x+r.x,this.y=e.y+r.y,this.z=e.z+r.z,this.w=e.w+r.w,this},sub:function(e,r){return r!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,r)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,r){return this.x=e.x-r.x,this.y=e.y-r.y,this.z=e.z-r.z,this.w=e.w-r.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var r=this.x,n=this.y,a=this.z,o=this.w,s=e.elements;return this.x=s[0]*r+s[4]*n+s[8]*a+s[12]*o,this.y=s[1]*r+s[5]*n+s[9]*a+s[13]*o,this.z=s[2]*r+s[6]*n+s[10]*a+s[14]*o,this.w=s[3]*r+s[7]*n+s[11]*a+s[15]*o,this},divideScalar:function(e){if(e!==0){var r=1/e;this.x*=r,this.y*=r,this.z*=r,this.w*=r}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var r=Math.sqrt(1-e.w*e.w);return r<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/r,this.y=e.y/r,this.z=e.z/r),this},setAxisAngleFromRotationMatrix:function(e){var r,n,a,o,s=.01,l=.1,h=e.elements,c=h[0],d=h[4],p=h[8],v=h[1],m=h[5],g=h[9],x=h[2],w=h[6],_=h[10];if(Math.abs(d-v)<s&&Math.abs(p-x)<s&&Math.abs(g-w)<s){if(Math.abs(d+v)<l&&Math.abs(p+x)<l&&Math.abs(g+w)<l&&Math.abs(c+m+_-3)<l)return this.set(1,0,0,0),this;r=Math.PI;var b=(c+1)/2,A=(m+1)/2,E=(_+1)/2,M=(d+v)/4,F=(p+x)/4,D=(g+w)/4;return b>A&&b>E?b<s?(n=0,a=.707106781,o=.707106781):(n=Math.sqrt(b),a=M/n,o=F/n):A>E?A<s?(n=.707106781,a=0,o=.707106781):(a=Math.sqrt(A),n=M/a,o=D/a):E<s?(n=.707106781,a=.707106781,o=0):(o=Math.sqrt(E),n=F/o,a=D/o),this.set(n,a,o,r),this}var R=Math.sqrt((w-g)*(w-g)+(p-x)*(p-x)+(v-d)*(v-d));return Math.abs(R)<.001&&(R=1),this.x=(w-g)/R,this.y=(p-x)/R,this.z=(v-d)/R,this.w=Math.acos((c+m+_-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,r){return this.x<e.x?this.x=e.x:this.x>r.x&&(this.x=r.x),this.y<e.y?this.y=e.y:this.y>r.y&&(this.y=r.y),this.z<e.z?this.z=e.z:this.z>r.z&&(this.z=r.z),this.w<e.w?this.w=e.w:this.w>r.w&&(this.w=r.w),this},clampScalar:function(){var e,r;return function(n,a){return e===void 0&&(e=new t.Vector4,r=new t.Vector4),e.set(n,n,n,n),r.set(a,a,a,a),this.clamp(e,r)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var r=this.length();return r!==0&&e!==r&&this.multiplyScalar(e/r),this},lerp:function(e,r){return this.x+=(e.x-this.x)*r,this.y+=(e.y-this.y)*r,this.z+=(e.z-this.z)*r,this.w+=(e.w-this.w)*r,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,r){return r===void 0&&(r=0),this.x=e[r],this.y=e[r+1],this.z=e[r+2],this.w=e[r+3],this},toArray:function(e,r){return e===void 0&&(e=[]),r===void 0&&(r=0),e[r]=this.x,e[r+1]=this.y,e[r+2]=this.z,e[r+3]=this.w,e},clone:function(){return new t.Vector4(this.x,this.y,this.z,this.w)}},t.Euler=function(e,r,n,a){this._x=e||0,this._y=r||0,this._z=n||0,this._order=a||t.Euler.DefaultOrder},t.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],t.Euler.DefaultOrder="XYZ",t.Euler.prototype={constructor:t.Euler,_x:0,_y:0,_z:0,_order:t.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,r,n,a){return this._x=e,this._y=r,this._z=n,this._order=a||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,r){var n=t.Math.clamp,a=e.elements,o=a[0],s=a[4],l=a[8],h=a[1],c=a[5],d=a[9],p=a[2],v=a[6],m=a[10];return r=r||this._order,r==="XYZ"?(this._y=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-d,m),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(v,c),this._z=0)):r==="YXZ"?(this._x=Math.asin(-n(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(l,m),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-p,o),this._z=0)):r==="ZXY"?(this._x=Math.asin(n(v,-1,1)),Math.abs(v)<.99999?(this._y=Math.atan2(-p,m),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(h,o))):r==="ZYX"?(this._y=Math.asin(-n(p,-1,1)),Math.abs(p)<.99999?(this._x=Math.atan2(v,m),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-s,c))):r==="YZX"?(this._z=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-d,c),this._y=Math.atan2(-p,o)):(this._x=0,this._y=Math.atan2(l,m))):r==="XZY"?(this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(v,c),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-d,m),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+r),this._order=r,this.onChangeCallback(),this},setFromQuaternion:function(e,r,n){var a=t.Math.clamp,o=e.x*e.x,s=e.y*e.y,l=e.z*e.z,h=e.w*e.w;return r=r||this._order,r==="XYZ"?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),h-o-s+l),this._y=Math.asin(a(2*(e.x*e.z+e.y*e.w),-1,1)),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),h+o-s-l)):r==="YXZ"?(this._x=Math.asin(a(2*(e.x*e.w-e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),h-o-s+l),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),h-o+s-l)):r==="ZXY"?(this._x=Math.asin(a(2*(e.x*e.w+e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),h-o-s+l),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),h-o+s-l)):r==="ZYX"?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),h-o-s+l),this._y=Math.asin(a(2*(e.y*e.w-e.x*e.z),-1,1)),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),h+o-s-l)):r==="YZX"?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),h-o+s-l),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),h+o-s-l),this._z=Math.asin(a(2*(e.x*e.y+e.z*e.w),-1,1))):r==="XZY"?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),h-o+s-l),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),h+o-s-l),this._z=Math.asin(a(2*(e.z*e.w-e.x*e.y),-1,1))):console.warn("THREE.Euler: .setFromQuaternion() given unsupported order: "+r),this._order=r,n!==!1&&this.onChangeCallback(),this},reorder:function(){var e=new t.Quaternion;return function(r){e.setFromEuler(this),this.setFromQuaternion(e,r)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new t.Euler(this._x,this._y,this._z,this._order)}},t.Line3=function(e,r){this.start=e!==void 0?e:new t.Vector3,this.end=r!==void 0?r:new t.Vector3},t.Line3.prototype={constructor:t.Line3,set:function(e,r){return this.start.copy(e),this.end.copy(r),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var r=e||new t.Vector3;return r.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var r=e||new t.Vector3;return r.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,r){var n=r||new t.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new t.Vector3,r=new t.Vector3;return function(n,a){e.subVectors(n,this.start),r.subVectors(this.end,this.start);var o=r.dot(r),s=r.dot(e),l=s/o;return a&&(l=t.Math.clamp(l,0,1)),l}}(),closestPointToPoint:function(e,r,n){var a=this.closestPointToPointParameter(e,r),o=n||new t.Vector3;return this.delta(o).multiplyScalar(a).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return new t.Line3().copy(this)}},t.Box2=function(e,r){this.min=e!==void 0?e:new t.Vector2(1/0,1/0),this.max=r!==void 0?r:new t.Vector2(-1/0,-1/0)},t.Box2.prototype={constructor:t.Box2,set:function(e,r){return this.min.copy(e),this.max.copy(r),this},setFromPoints:function(e){this.makeEmpty();for(var r=0,n=e.length;r<n;r++)this.expandByPoint(e[r]);return this},setFromCenterAndSize:function(){var e=new t.Vector2;return function(r,n){var a=e.copy(n).multiplyScalar(.5);return this.min.copy(r).sub(a),this.max.copy(r).add(a),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var r=e||new t.Vector2;return r.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var r=e||new t.Vector2;return r.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,r){var n=r||new t.Vector2;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,r){var n=r||new t.Vector2;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new t.Vector2;return function(r){var n=e.copy(r).clamp(this.min,this.max);return n.sub(r).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return new t.Box2().copy(this)}},t.Box3=function(e,r){this.min=e!==void 0?e:new t.Vector3(1/0,1/0,1/0),this.max=r!==void 0?r:new t.Vector3(-1/0,-1/0,-1/0)},t.Box3.prototype={constructor:t.Box3,set:function(e,r){return this.min.copy(e),this.max.copy(r),this},setFromPoints:function(e){this.makeEmpty();for(var r=0,n=e.length;r<n;r++)this.expandByPoint(e[r]);return this},setFromCenterAndSize:function(){var e=new t.Vector3;return function(r,n){var a=e.copy(n).multiplyScalar(.5);return this.min.copy(r).sub(a),this.max.copy(r).add(a),this}}(),setFromObject:function(){var e=new t.Vector3;return function(r){var n=this;return r.updateMatrixWorld(!0),this.makeEmpty(),r.traverse(function(a){var o=a.geometry;if(o!==void 0){if(o instanceof t.Geometry)for(var s=o.vertices,l=0,h=s.length;l<h;l++)e.copy(s[l]),e.applyMatrix4(a.matrixWorld),n.expandByPoint(e);else if(o instanceof t.BufferGeometry&&o.attributes.position!==void 0)for(var c=o.attributes.position.array,l=0,h=c.length;l<h;l+=3)e.set(c[l],c[l+1],c[l+2]),e.applyMatrix4(a.matrixWorld),n.expandByPoint(e)}}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var r=e||new t.Vector3;return r.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var r=e||new t.Vector3;return r.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,r){var n=r||new t.Vector3;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,r){var n=r||new t.Vector3;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new t.Vector3;return function(r){var n=e.copy(r).clamp(this.min,this.max);return n.sub(r).length()}}(),getBoundingSphere:function(){var e=new t.Vector3;return function(r){var n=r||new t.Sphere;return n.center=this.center(),n.radius=this.size(e).length()*.5,n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3];return function(r){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(r),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(r),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(r),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(r),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(r),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(r),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(r),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(r),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return new t.Box3().copy(this)}},t.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},t.Matrix3.prototype={constructor:t.Matrix3,set:function(e,r,n,a,o,s,l,h,c){var d=this.elements;return d[0]=e,d[3]=r,d[6]=n,d[1]=a,d[4]=o,d[7]=s,d[2]=l,d[5]=h,d[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var r=e.elements;return this.set(r[0],r[3],r[6],r[1],r[4],r[7],r[2],r[5],r[8]),this},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new t.Vector3;return function(r,n,a){n===void 0&&(n=0),a===void 0&&(a=r.length);for(var o=0,s=n,l;o<a;o+=3,s+=3)e.x=r[s],e.y=r[s+1],e.z=r[s+2],e.applyMatrix3(this),r[s]=e.x,r[s+1]=e.y,r[s+2]=e.z;return r}}(),multiplyScalar:function(e){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=e,r[4]*=e,r[7]*=e,r[2]*=e,r[5]*=e,r[8]*=e,this},determinant:function(){var e=this.elements,r=e[0],n=e[1],a=e[2],o=e[3],s=e[4],l=e[5],h=e[6],c=e[7],d=e[8];return r*s*d-r*l*c-n*o*d+n*l*h+a*o*c-a*s*h},getInverse:function(e,r){var n=e.elements,a=this.elements;a[0]=n[10]*n[5]-n[6]*n[9],a[1]=-n[10]*n[1]+n[2]*n[9],a[2]=n[6]*n[1]-n[2]*n[5],a[3]=-n[10]*n[4]+n[6]*n[8],a[4]=n[10]*n[0]-n[2]*n[8],a[5]=-n[6]*n[0]+n[2]*n[4],a[6]=n[9]*n[4]-n[5]*n[8],a[7]=-n[9]*n[0]+n[1]*n[8],a[8]=n[5]*n[0]-n[1]*n[4];var o=n[0]*a[0]+n[1]*a[3]+n[2]*a[6];if(o===0){var s="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(r)throw new Error(s);return console.warn(s),this.identity(),this}return this.multiplyScalar(1/o),this},transpose:function(){var e,r=this.elements;return e=r[1],r[1]=r[3],r[3]=e,e=r[2],r[2]=r[6],r[6]=e,e=r[5],r[5]=r[7],r[7]=e,this},flattenToArrayOffset:function(e,r){var n=this.elements;return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],e[r+4]=n[4],e[r+5]=n[5],e[r+6]=n[6],e[r+7]=n[7],e[r+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var r=this.elements;return e[0]=r[0],e[1]=r[3],e[2]=r[6],e[3]=r[1],e[4]=r[4],e[5]=r[7],e[6]=r[2],e[7]=r[5],e[8]=r[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){return new t.Matrix3().fromArray(this.elements)}},t.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},t.Matrix4.prototype={constructor:t.Matrix4,set:function(e,r,n,a,o,s,l,h,c,d,p,v,m,g,x,w){var _=this.elements;return _[0]=e,_[4]=r,_[8]=n,_[12]=a,_[1]=o,_[5]=s,_[9]=l,_[13]=h,_[2]=c,_[6]=d,_[10]=p,_[14]=v,_[3]=m,_[7]=g,_[11]=x,_[15]=w,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var r=this.elements,n=e.elements;return r[12]=n[12],r[13]=n[13],r[14]=n[14],this},extractRotation:function(){var e=new t.Vector3;return function(r){var n=this.elements,a=r.elements,o=1/e.set(a[0],a[1],a[2]).length(),s=1/e.set(a[4],a[5],a[6]).length(),l=1/e.set(a[8],a[9],a[10]).length();return n[0]=a[0]*o,n[1]=a[1]*o,n[2]=a[2]*o,n[4]=a[4]*s,n[5]=a[5]*s,n[6]=a[6]*s,n[8]=a[8]*l,n[9]=a[9]*l,n[10]=a[10]*l,this}}(),makeRotationFromEuler:function(e){e instanceof t.Euler||console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var r=this.elements,n=e.x,a=e.y,o=e.z,s=Math.cos(n),l=Math.sin(n),h=Math.cos(a),c=Math.sin(a),d=Math.cos(o),p=Math.sin(o);if(e.order==="XYZ"){var v=s*d,m=s*p,g=l*d,x=l*p;r[0]=h*d,r[4]=-h*p,r[8]=c,r[1]=m+g*c,r[5]=v-x*c,r[9]=-l*h,r[2]=x-v*c,r[6]=g+m*c,r[10]=s*h}else if(e.order==="YXZ"){var w=h*d,_=h*p,b=c*d,A=c*p;r[0]=w+A*l,r[4]=b*l-_,r[8]=s*c,r[1]=s*p,r[5]=s*d,r[9]=-l,r[2]=_*l-b,r[6]=A+w*l,r[10]=s*h}else if(e.order==="ZXY"){var w=h*d,_=h*p,b=c*d,A=c*p;r[0]=w-A*l,r[4]=-s*p,r[8]=b+_*l,r[1]=_+b*l,r[5]=s*d,r[9]=A-w*l,r[2]=-s*c,r[6]=l,r[10]=s*h}else if(e.order==="ZYX"){var v=s*d,m=s*p,g=l*d,x=l*p;r[0]=h*d,r[4]=g*c-m,r[8]=v*c+x,r[1]=h*p,r[5]=x*c+v,r[9]=m*c-g,r[2]=-c,r[6]=l*h,r[10]=s*h}else if(e.order==="YZX"){var E=s*h,M=s*c,F=l*h,D=l*c;r[0]=h*d,r[4]=D-E*p,r[8]=F*p+M,r[1]=p,r[5]=s*d,r[9]=-l*d,r[2]=-c*d,r[6]=M*p+F,r[10]=E-D*p}else if(e.order==="XZY"){var E=s*h,M=s*c,F=l*h,D=l*c;r[0]=h*d,r[4]=-p,r[8]=c*d,r[1]=E*p+D,r[5]=s*d,r[9]=M*p-F,r[2]=F*p-M,r[6]=l*d,r[10]=D*p+E}return r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var r=this.elements,n=e.x,a=e.y,o=e.z,s=e.w,l=n+n,h=a+a,c=o+o,d=n*l,p=n*h,v=n*c,m=a*h,g=a*c,x=o*c,w=s*l,_=s*h,b=s*c;return r[0]=1-(m+x),r[4]=p-b,r[8]=v+_,r[1]=p+b,r[5]=1-(d+x),r[9]=g-w,r[2]=v-_,r[6]=g+w,r[10]=1-(d+m),r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,this},lookAt:function(){var e=new t.Vector3,r=new t.Vector3,n=new t.Vector3;return function(a,o,s){var l=this.elements;return n.subVectors(a,o).normalize(),n.length()===0&&(n.z=1),e.crossVectors(s,n).normalize(),e.length()===0&&(n.x+=1e-4,e.crossVectors(s,n).normalize()),r.crossVectors(n,e),l[0]=e.x,l[4]=r.x,l[8]=n.x,l[1]=e.y,l[5]=r.y,l[9]=n.y,l[2]=e.z,l[6]=r.z,l[10]=n.z,this}}(),multiply:function(e,r){return r!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,r)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,r){var n=e.elements,a=r.elements,o=this.elements,s=n[0],l=n[4],h=n[8],c=n[12],d=n[1],p=n[5],v=n[9],m=n[13],g=n[2],x=n[6],w=n[10],_=n[14],b=n[3],A=n[7],E=n[11],M=n[15],F=a[0],D=a[4],R=a[8],B=a[12],V=a[1],U=a[5],z=a[9],I=a[13],Y=a[2],H=a[6],q=a[10],ee=a[14],G=a[3],$=a[7],J=a[11],X=a[15];return o[0]=s*F+l*V+h*Y+c*G,o[4]=s*D+l*U+h*H+c*$,o[8]=s*R+l*z+h*q+c*J,o[12]=s*B+l*I+h*ee+c*X,o[1]=d*F+p*V+v*Y+m*G,o[5]=d*D+p*U+v*H+m*$,o[9]=d*R+p*z+v*q+m*J,o[13]=d*B+p*I+v*ee+m*X,o[2]=g*F+x*V+w*Y+_*G,o[6]=g*D+x*U+w*H+_*$,o[10]=g*R+x*z+w*q+_*J,o[14]=g*B+x*I+w*ee+_*X,o[3]=b*F+A*V+E*Y+M*G,o[7]=b*D+A*U+E*H+M*$,o[11]=b*R+A*z+E*q+M*J,o[15]=b*B+A*I+E*ee+M*X,this},multiplyToArray:function(e,r,n){var a=this.elements;return this.multiplyMatrices(e,r),n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=a[3],n[4]=a[4],n[5]=a[5],n[6]=a[6],n[7]=a[7],n[8]=a[8],n[9]=a[9],n[10]=a[10],n[11]=a[11],n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],this},multiplyScalar:function(e){var r=this.elements;return r[0]*=e,r[4]*=e,r[8]*=e,r[12]*=e,r[1]*=e,r[5]*=e,r[9]*=e,r[13]*=e,r[2]*=e,r[6]*=e,r[10]*=e,r[14]*=e,r[3]*=e,r[7]*=e,r[11]*=e,r[15]*=e,this},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new t.Vector3;return function(r,n,a){n===void 0&&(n=0),a===void 0&&(a=r.length);for(var o=0,s=n,l;o<a;o+=3,s+=3)e.x=r[s],e.y=r[s+1],e.z=r[s+2],e.applyMatrix4(this),r[s]=e.x,r[s+1]=e.y,r[s+2]=e.z;return r}}(),rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,r=e[0],n=e[4],a=e[8],o=e[12],s=e[1],l=e[5],h=e[9],c=e[13],d=e[2],p=e[6],v=e[10],m=e[14],g=e[3],x=e[7],w=e[11],_=e[15];return g*(+o*h*p-a*c*p-o*l*v+n*c*v+a*l*m-n*h*m)+x*(+r*h*m-r*c*v+o*s*v-a*s*m+a*c*d-o*h*d)+w*(+r*c*p-r*l*m-o*s*p+n*s*m+o*l*d-n*c*d)+_*(-a*l*d-r*h*p+r*l*v+a*s*p-n*s*v+n*h*d)},transpose:function(){var e=this.elements,r;return r=e[1],e[1]=e[4],e[4]=r,r=e[2],e[2]=e[8],e[8]=r,r=e[6],e[6]=e[9],e[9]=r,r=e[3],e[3]=e[12],e[12]=r,r=e[7],e[7]=e[13],e[13]=r,r=e[11],e[11]=e[14],e[14]=r,this},flattenToArrayOffset:function(e,r){var n=this.elements;return e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2],e[r+3]=n[3],e[r+4]=n[4],e[r+5]=n[5],e[r+6]=n[6],e[r+7]=n[7],e[r+8]=n[8],e[r+9]=n[9],e[r+10]=n[10],e[r+11]=n[11],e[r+12]=n[12],e[r+13]=n[13],e[r+14]=n[14],e[r+15]=n[15],e},getPosition:function(){var e=new t.Vector3;return function(){console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var r=this.elements;return e.set(r[12],r[13],r[14])}}(),setPosition:function(e){var r=this.elements;return r[12]=e.x,r[13]=e.y,r[14]=e.z,this},getInverse:function(e,r){var n=this.elements,a=e.elements,o=a[0],s=a[4],l=a[8],h=a[12],c=a[1],d=a[5],p=a[9],v=a[13],m=a[2],g=a[6],x=a[10],w=a[14],_=a[3],b=a[7],A=a[11],E=a[15];n[0]=p*w*b-v*x*b+v*g*A-d*w*A-p*g*E+d*x*E,n[4]=h*x*b-l*w*b-h*g*A+s*w*A+l*g*E-s*x*E,n[8]=l*v*b-h*p*b+h*d*A-s*v*A-l*d*E+s*p*E,n[12]=h*p*g-l*v*g-h*d*x+s*v*x+l*d*w-s*p*w,n[1]=v*x*_-p*w*_-v*m*A+c*w*A+p*m*E-c*x*E,n[5]=l*w*_-h*x*_+h*m*A-o*w*A-l*m*E+o*x*E,n[9]=h*p*_-l*v*_-h*c*A+o*v*A+l*c*E-o*p*E,n[13]=l*v*m-h*p*m+h*c*x-o*v*x-l*c*w+o*p*w,n[2]=d*w*_-v*g*_+v*m*b-c*w*b-d*m*E+c*g*E,n[6]=h*g*_-s*w*_-h*m*b+o*w*b+s*m*E-o*g*E,n[10]=s*v*_-h*d*_+h*c*b-o*v*b-s*c*E+o*d*E,n[14]=h*d*m-s*v*m-h*c*g+o*v*g+s*c*w-o*d*w,n[3]=p*g*_-d*x*_-p*m*b+c*x*b+d*m*A-c*g*A,n[7]=s*x*_-l*g*_+l*m*b-o*x*b-s*m*A+o*g*A,n[11]=l*d*_-s*p*_-l*c*b+o*p*b+s*c*A-o*d*A,n[15]=s*p*m-l*d*m+l*c*g-o*p*g-s*c*x+o*d*x;var M=o*n[0]+c*n[4]+m*n[8]+_*n[12];if(M==0){var F="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(r)throw new Error(F);return console.warn(F),this.identity(),this}return this.multiplyScalar(1/M),this},translate:function(e){console.warn("THREE.Matrix4: .translate() has been removed.")},rotateX:function(e){console.warn("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(e){console.warn("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(e){console.warn("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(e,r){console.warn("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(e){var r=this.elements,n=e.x,a=e.y,o=e.z;return r[0]*=n,r[4]*=a,r[8]*=o,r[1]*=n,r[5]*=a,r[9]*=o,r[2]*=n,r[6]*=a,r[10]*=o,r[3]*=n,r[7]*=a,r[11]*=o,this},getMaxScaleOnAxis:function(){var e=this.elements,r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],a=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(r,Math.max(n,a)))},makeTranslation:function(e,r,n){return this.set(1,0,0,e,0,1,0,r,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var r=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,r,-n,0,0,n,r,0,0,0,0,1),this},makeRotationY:function(e){var r=Math.cos(e),n=Math.sin(e);return this.set(r,0,n,0,0,1,0,0,-n,0,r,0,0,0,0,1),this},makeRotationZ:function(e){var r=Math.cos(e),n=Math.sin(e);return this.set(r,-n,0,0,n,r,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,r){var n=Math.cos(r),a=Math.sin(r),o=1-n,s=e.x,l=e.y,h=e.z,c=o*s,d=o*l;return this.set(c*s+n,c*l-a*h,c*h+a*l,0,c*l+a*h,d*l+n,d*h-a*s,0,c*h-a*l,d*h+a*s,o*h*h+n,0,0,0,0,1),this},makeScale:function(e,r,n){return this.set(e,0,0,0,0,r,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,r,n){return this.makeRotationFromQuaternion(r),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new t.Vector3,r=new t.Matrix4;return function(n,a,o){var s=this.elements,l=e.set(s[0],s[1],s[2]).length(),h=e.set(s[4],s[5],s[6]).length(),c=e.set(s[8],s[9],s[10]).length(),d=this.determinant();d<0&&(l=-l),n.x=s[12],n.y=s[13],n.z=s[14],r.elements.set(this.elements);var p=1/l,v=1/h,m=1/c;return r.elements[0]*=p,r.elements[1]*=p,r.elements[2]*=p,r.elements[4]*=v,r.elements[5]*=v,r.elements[6]*=v,r.elements[8]*=m,r.elements[9]*=m,r.elements[10]*=m,a.setFromRotationMatrix(r),o.x=l,o.y=h,o.z=c,this}}(),makeFrustum:function(e,r,n,a,o,s){var l=this.elements,h=2*o/(r-e),c=2*o/(a-n),d=(r+e)/(r-e),p=(a+n)/(a-n),v=-(s+o)/(s-o),m=-2*s*o/(s-o);return l[0]=h,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=c,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=v,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this},makePerspective:function(e,r,n,a){var o=n*Math.tan(t.Math.degToRad(e*.5)),s=-o,l=s*r,h=o*r;return this.makeFrustum(l,h,s,o,n,a)},makeOrthographic:function(e,r,n,a,o,s){var l=this.elements,h=r-e,c=n-a,d=s-o,p=(r+e)/h,v=(n+a)/c,m=(s+o)/d;return l[0]=2/h,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2/c,l[9]=0,l[13]=-v,l[2]=0,l[6]=0,l[10]=-2/d,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){return new t.Matrix4().fromArray(this.elements)}},t.Ray=function(e,r){this.origin=e!==void 0?e:new t.Vector3,this.direction=r!==void 0?r:new t.Vector3},t.Ray.prototype={constructor:t.Ray,set:function(e,r){return this.origin.copy(e),this.direction.copy(r),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,r){var n=r||new t.Vector3;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new t.Vector3;return function(r){return this.origin.copy(this.at(r,e)),this}}(),closestPointToPoint:function(e,r){var n=r||new t.Vector3;n.subVectors(e,this.origin);var a=n.dot(this.direction);return a<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(){var e=new t.Vector3;return function(r){var n=e.subVectors(r,this.origin).dot(this.direction);return n<0?this.origin.distanceTo(r):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(r))}}(),distanceSqToSegment:function(e,r,n,a){var o=e.clone().add(r).multiplyScalar(.5),s=r.clone().sub(e).normalize(),l=e.distanceTo(r)*.5,h=this.origin.clone().sub(o),c=-this.direction.dot(s),d=h.dot(this.direction),p=-h.dot(s),v=h.lengthSq(),m=Math.abs(1-c*c),g,x,w,_;if(m>=0)if(g=c*p-d,x=c*d-p,_=l*m,g>=0)if(x>=-_)if(x<=_){var b=1/m;g*=b,x*=b,w=g*(g+c*x+2*d)+x*(c*g+x+2*p)+v}else x=l,g=Math.max(0,-(c*x+d)),w=-g*g+x*(x+2*p)+v;else x=-l,g=Math.max(0,-(c*x+d)),w=-g*g+x*(x+2*p)+v;else x<=-_?(g=Math.max(0,-(-c*l+d)),x=g>0?-l:Math.min(Math.max(-l,-p),l),w=-g*g+x*(x+2*p)+v):x<=_?(g=0,x=Math.min(Math.max(-l,-p),l),w=x*(x+2*p)+v):(g=Math.max(0,-(c*l+d)),x=g>0?l:Math.min(Math.max(-l,-p),l),w=-g*g+x*(x+2*p)+v);else x=c>0?-l:l,g=Math.max(0,-(c*x+d)),w=-g*g+x*(x+2*p)+v;return n&&n.copy(this.direction.clone().multiplyScalar(g).add(this.origin)),a&&a.copy(s.clone().multiplyScalar(x).add(o)),w},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},intersectSphere:function(){var e=new t.Vector3;return function(r,n){e.subVectors(r.center,this.origin);var a=e.dot(this.direction),o=e.dot(e)-a*a,s=r.radius*r.radius;if(o>s)return null;var l=Math.sqrt(s-o),h=a-l,c=a+l;return h<0&&c<0?null:h<0?this.at(c,n):this.at(h,n)}}(),isIntersectionPlane:function(e){var r=e.distanceToPoint(this.origin);if(r===0)return!0;var n=e.normal.dot(this.direction);return n*r<0},distanceToPlane:function(e){var r=e.normal.dot(this.direction);if(r==0)return e.distanceToPoint(this.origin)==0?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/r;return n>=0?n:null},intersectPlane:function(e,r){var n=this.distanceToPlane(e);return n===null?null:this.at(n,r)},isIntersectionBox:function(){var e=new t.Vector3;return function(r){return this.intersectBox(r,e)!==null}}(),intersectBox:function(e,r){var n,a,o,s,l,h,c=1/this.direction.x,d=1/this.direction.y,p=1/this.direction.z,v=this.origin;return c>=0?(n=(e.min.x-v.x)*c,a=(e.max.x-v.x)*c):(n=(e.max.x-v.x)*c,a=(e.min.x-v.x)*c),d>=0?(o=(e.min.y-v.y)*d,s=(e.max.y-v.y)*d):(o=(e.max.y-v.y)*d,s=(e.min.y-v.y)*d),n>s||o>a||((o>n||n!==n)&&(n=o),(s<a||a!==a)&&(a=s),p>=0?(l=(e.min.z-v.z)*p,h=(e.max.z-v.z)*p):(l=(e.max.z-v.z)*p,h=(e.min.z-v.z)*p),n>h||l>a)||((l>n||n!==n)&&(n=l),(h<a||a!==a)&&(a=h),a<0)?null:this.at(n>=0?n:a,r)},intersectTriangle:function(){var e=new t.Vector3,r=new t.Vector3,n=new t.Vector3,a=new t.Vector3;return function(o,s,l,h,c){r.subVectors(s,o),n.subVectors(l,o),a.crossVectors(r,n);var d=this.direction.dot(a),p;if(d>0){if(h)return null;p=1}else if(d<0)p=-1,d=-d;else return null;e.subVectors(this.origin,o);var v=p*this.direction.dot(n.crossVectors(e,n));if(v<0)return null;var m=p*this.direction.dot(r.cross(e));if(m<0||v+m>d)return null;var g=-p*e.dot(a);return g<0?null:this.at(g/d,c)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return new t.Ray().copy(this)}},t.Sphere=function(e,r){this.center=e!==void 0?e:new t.Vector3,this.radius=r!==void 0?r:0},t.Sphere.prototype={constructor:t.Sphere,set:function(e,r){return this.center.copy(e),this.radius=r,this},setFromPoints:function(){var e=new t.Box3;return function(r,n){var a=this.center;n!==void 0?a.copy(n):e.setFromPoints(r).center(a);for(var o=0,s=0,l=r.length;s<l;s++)o=Math.max(o,a.distanceToSquared(r[s]));return this.radius=Math.sqrt(o),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var r=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=r*r},clampPoint:function(e,r){var n=this.center.distanceToSquared(e),a=r||new t.Vector3;return a.copy(e),n>this.radius*this.radius&&(a.sub(this.center).normalize(),a.multiplyScalar(this.radius).add(this.center)),a},getBoundingBox:function(e){var r=e||new t.Box3;return r.set(this.center,this.center),r.expandByScalar(this.radius),r},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return new t.Sphere().copy(this)}},t.Frustum=function(e,r,n,a,o,s){this.planes=[e!==void 0?e:new t.Plane,r!==void 0?r:new t.Plane,n!==void 0?n:new t.Plane,a!==void 0?a:new t.Plane,o!==void 0?o:new t.Plane,s!==void 0?s:new t.Plane]},t.Frustum.prototype={constructor:t.Frustum,set:function(e,r,n,a,o,s){var l=this.planes;return l[0].copy(e),l[1].copy(r),l[2].copy(n),l[3].copy(a),l[4].copy(o),l[5].copy(s),this},copy:function(e){for(var r=this.planes,n=0;n<6;n++)r[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var r=this.planes,n=e.elements,a=n[0],o=n[1],s=n[2],l=n[3],h=n[4],c=n[5],d=n[6],p=n[7],v=n[8],m=n[9],g=n[10],x=n[11],w=n[12],_=n[13],b=n[14],A=n[15];return r[0].setComponents(l-a,p-h,x-v,A-w).normalize(),r[1].setComponents(l+a,p+h,x+v,A+w).normalize(),r[2].setComponents(l+o,p+c,x+m,A+_).normalize(),r[3].setComponents(l-o,p-c,x-m,A-_).normalize(),r[4].setComponents(l-s,p-d,x-g,A-b).normalize(),r[5].setComponents(l+s,p+d,x+g,A+b).normalize(),this},intersectsObject:function(){var e=new t.Sphere;return function(r){var n=r.geometry;return n.boundingSphere===null&&n.computeBoundingSphere(),e.copy(n.boundingSphere),e.applyMatrix4(r.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var r=this.planes,n=e.center,a=-e.radius,o=0;o<6;o++){var s=r[o].distanceToPoint(n);if(s<a)return!1}return!0},intersectsBox:function(){var e=new t.Vector3,r=new t.Vector3;return function(n){for(var a=this.planes,o=0;o<6;o++){var s=a[o];e.x=s.normal.x>0?n.min.x:n.max.x,r.x=s.normal.x>0?n.max.x:n.min.x,e.y=s.normal.y>0?n.min.y:n.max.y,r.y=s.normal.y>0?n.max.y:n.min.y,e.z=s.normal.z>0?n.min.z:n.max.z,r.z=s.normal.z>0?n.max.z:n.min.z;var l=s.distanceToPoint(e),h=s.distanceToPoint(r);if(l<0&&h<0)return!1}return!0}}(),containsPoint:function(e){for(var r=this.planes,n=0;n<6;n++)if(r[n].distanceToPoint(e)<0)return!1;return!0},clone:function(){return new t.Frustum().copy(this)}},t.Plane=function(e,r){this.normal=e!==void 0?e:new t.Vector3(1,0,0),this.constant=r!==void 0?r:0},t.Plane.prototype={constructor:t.Plane,set:function(e,r){return this.normal.copy(e),this.constant=r,this},setComponents:function(e,r,n,a){return this.normal.set(e,r,n),this.constant=a,this},setFromNormalAndCoplanarPoint:function(e,r){return this.normal.copy(e),this.constant=-r.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new t.Vector3,r=new t.Vector3;return function(n,a,o){var s=e.subVectors(o,a).cross(r.subVectors(n,a)).normalize();return this.setFromNormalAndCoplanarPoint(s,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,r){return this.orthoPoint(e,r).sub(e).negate()},orthoPoint:function(e,r){var n=this.distanceToPoint(e),a=r||new t.Vector3;return a.copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var r=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return r<0&&n>0||n<0&&r>0},intersectLine:function(){var e=new t.Vector3;return function(r,n){var a=n||new t.Vector3,o=r.delta(e),s=this.normal.dot(o);if(s==0)return this.distanceToPoint(r.start)==0?a.copy(r.start):void 0;var l=-(r.start.dot(this.normal)+this.constant)/s;if(!(l<0||l>1))return a.copy(o).multiplyScalar(l).add(r.start)}}(),coplanarPoint:function(e){var r=e||new t.Vector3;return r.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new t.Vector3,r=new t.Vector3,n=new t.Matrix3;return function(a,o){var s=o||n.getNormalMatrix(a),l=e.copy(this.normal).applyMatrix3(s),h=this.coplanarPoint(r);return h.applyMatrix4(a),this.setFromNormalAndCoplanarPoint(l,h),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return new t.Plane().copy(this)}},t.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),n=0,a;return function(){for(var o=0;o<36;o++)o==8||o==13||o==18||o==23?r[o]="-":o==14?r[o]="4":(n<=2&&(n=33554432+Math.random()*16777216|0),a=n&15,n=n>>4,r[o]=e[o==19?a&3|8:a]);return r.join("")}}(),clamp:function(e,r,n){return e<r?r:e>n?n:e},clampBottom:function(e,r){return e<r?r:e},mapLinear:function(e,r,n,a,o){return a+(e-r)*(o-a)/(n-r)},smoothstep:function(e,r,n){return e<=r?0:e>=n?1:(e=(e-r)/(n-r),e*e*(3-2*e))},smootherstep:function(e,r,n){return e<=r?0:e>=n?1:(e=(e-r)/(n-r),e*e*e*(e*(e*6-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,r){return e+Math.floor(Math.random()*(r-e+1))},randFloat:function(e,r){return e+Math.random()*(r-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(){var e=Math.PI/180;return function(r){return r*e}}(),radToDeg:function(){var e=180/Math.PI;return function(r){return r*e}}(),isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0}},t.Spline=function(e){this.points=e;var r=[],n={x:0,y:0,z:0},a,o,s,l,h,c,d,p,v;this.initFromArray=function(g){this.points=[];for(var x=0;x<g.length;x++)this.points[x]={x:g[x][0],y:g[x][1],z:g[x][2]}},this.getPoint=function(g){return a=(this.points.length-1)*g,o=Math.floor(a),s=a-o,r[0]=o===0?o:o-1,r[1]=o,r[2]=o>this.points.length-2?this.points.length-1:o+1,r[3]=o>this.points.length-3?this.points.length-1:o+2,c=this.points[r[0]],d=this.points[r[1]],p=this.points[r[2]],v=this.points[r[3]],l=s*s,h=s*l,n.x=m(c.x,d.x,p.x,v.x,s,l,h),n.y=m(c.y,d.y,p.y,v.y,s,l,h),n.z=m(c.z,d.z,p.z,v.z,s,l,h),n},this.getControlPointsArray=function(){var g,x,w=this.points.length,_=[];for(g=0;g<w;g++)x=this.points[g],_[g]=[x.x,x.y,x.z];return _},this.getLength=function(g){var x,w,_,b,A=0,E=0,M=0,F=new t.Vector3,D=new t.Vector3,R=[],B=0;for(R[0]=0,g||(g=100),_=this.points.length*g,F.copy(this.points[0]),x=1;x<_;x++)w=x/_,b=this.getPoint(w),D.copy(b),B+=D.distanceTo(F),F.copy(b),A=(this.points.length-1)*w,E=Math.floor(A),E!=M&&(R[E]=B,M=E);return R[R.length]=B,{chunks:R,total:B}},this.reparametrizeByArcLength=function(g){var x,w,_,b,A,E,M,F,D=[],R=new t.Vector3,B=this.getLength();for(D.push(R.copy(this.points[0]).clone()),x=1;x<this.points.length;x++){for(E=B.chunks[x]-B.chunks[x-1],M=Math.ceil(g*E/B.total),b=(x-1)/(this.points.length-1),A=x/(this.points.length-1),w=1;w<M-1;w++)_=b+w*(1/M)*(A-b),F=this.getPoint(_),D.push(R.copy(F).clone());D.push(R.copy(this.points[x]).clone())}this.points=D};function m(g,x,w,_,b,A,E){var M=(w-g)*.5,F=(_-x)*.5;return(2*(x-w)+M+F)*E+(-3*(x-w)-2*M-F)*A+M*b+x}},t.Triangle=function(e,r,n){this.a=e!==void 0?e:new t.Vector3,this.b=r!==void 0?r:new t.Vector3,this.c=n!==void 0?n:new t.Vector3},t.Triangle.normal=function(){var e=new t.Vector3;return function(r,n,a,o){var s=o||new t.Vector3;s.subVectors(a,n),e.subVectors(r,n),s.cross(e);var l=s.lengthSq();return l>0?s.multiplyScalar(1/Math.sqrt(l)):s.set(0,0,0)}}(),t.Triangle.barycoordFromPoint=function(){var e=new t.Vector3,r=new t.Vector3,n=new t.Vector3;return function(a,o,s,l,h){e.subVectors(l,o),r.subVectors(s,o),n.subVectors(a,o);var c=e.dot(e),d=e.dot(r),p=e.dot(n),v=r.dot(r),m=r.dot(n),g=c*v-d*d,x=h||new t.Vector3;if(g==0)return x.set(-2,-1,-1);var w=1/g,_=(v*p-d*m)*w,b=(c*m-d*p)*w;return x.set(1-_-b,b,_)}}(),t.Triangle.containsPoint=function(){var e=new t.Vector3;return function(r,n,a,o){var s=t.Triangle.barycoordFromPoint(r,n,a,o,e);return s.x>=0&&s.y>=0&&s.x+s.y<=1}}(),t.Triangle.prototype={constructor:t.Triangle,set:function(e,r,n){return this.a.copy(e),this.b.copy(r),this.c.copy(n),this},setFromPointsAndIndices:function(e,r,n,a){return this.a.copy(e[r]),this.b.copy(e[n]),this.c.copy(e[a]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new t.Vector3,r=new t.Vector3;return function(){return e.subVectors(this.c,this.b),r.subVectors(this.a,this.b),e.cross(r).length()*.5}}(),midpoint:function(e){var r=e||new t.Vector3;return r.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return t.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var r=e||new t.Plane;return r.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,r){return t.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,r)},containsPoint:function(e){return t.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return new t.Triangle().copy(this)}},t.Clock=function(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},t.Clock.prototype={constructor:t.Clock,start:function(){this.startTime=Re.performance!==void 0&&Re.performance.now!==void 0?Re.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var r=Re.performance!==void 0&&Re.performance.now!==void 0?Re.performance.now():Date.now();e=.001*(r-this.oldTime),this.oldTime=r,this.elapsedTime+=e}return e}},t.EventDispatcher=function(){},t.EventDispatcher.prototype={constructor:t.EventDispatcher,apply:function(e){e.addEventListener=t.EventDispatcher.prototype.addEventListener,e.hasEventListener=t.EventDispatcher.prototype.hasEventListener,e.removeEventListener=t.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=t.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,r){this._listeners===void 0&&(this._listeners={});var n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r)},hasEventListener:function(e,r){if(this._listeners===void 0)return!1;var n=this._listeners;return n[e]!==void 0&&n[e].indexOf(r)!==-1},removeEventListener:function(e,r){if(this._listeners!==void 0){var n=this._listeners,a=n[e];if(a!==void 0){var o=a.indexOf(r);o!==-1&&a.splice(o,1)}}},dispatchEvent:function(e){if(this._listeners!==void 0){var r=this._listeners,n=r[e.type];if(n!==void 0){e.target=this;for(var a=[],o=n.length,s=0;s<o;s++)a[s]=n[s];for(var s=0;s<o;s++)a[s].call(this,e)}}}},function(e){e.Raycaster=function(a,o,s,l){this.ray=new e.Ray(a,o),this.near=s||0,this.far=l||1/0,this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var r=function(a,o){return a.distance-o.distance},n=function(a,o,s,l){if(a.raycast(o,s),l===!0)for(var h=a.children,c=0,d=h.length;c<d;c++)n(h[c],o,s,!0)};e.Raycaster.prototype={constructor:e.Raycaster,precision:1e-4,linePrecision:1,set:function(a,o){this.ray.set(a,o)},intersectObject:function(a,o){var s=[];return n(a,this,s,o),s.sort(r),s},intersectObjects:function(a,o){var s=[];if(!(a instanceof Array))return console.log("THREE.Raycaster.intersectObjects: objects is not an Array."),s;for(var l=0,h=a.length;l<h;l++)n(a[l],this,s,o);return s.sort(r),s}}}(t),t.Object3D=function(){Object.defineProperty(this,"id",{value:t.Object3DIdCount++}),this.uuid=t.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=void 0,this.children=[],this.up=t.Object3D.DefaultUp.clone();var e=new t.Vector3,r=new t.Euler,n=new t.Quaternion,a=new t.Vector3(1,1,1),o=function(){n.setFromEuler(r,!1)},s=function(){r.setFromQuaternion(n,void 0,!1)};r.onChange(o),n.onChange(s),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:r},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:a}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new t.Matrix4,this.matrixWorld=new t.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},t.Object3D.DefaultUp=new t.Vector3(0,1,0),t.Object3D.prototype={constructor:t.Object3D,get eulerOrder(){return console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,r){this.quaternion.setFromAxisAngle(e,r)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new t.Quaternion;return function(r,n){return e.setFromAxisAngle(r,n),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new t.Vector3(1,0,0);return function(r){return this.rotateOnAxis(e,r)}}(),rotateY:function(){var e=new t.Vector3(0,1,0);return function(r){return this.rotateOnAxis(e,r)}}(),rotateZ:function(){var e=new t.Vector3(0,0,1);return function(r){return this.rotateOnAxis(e,r)}}(),translateOnAxis:function(){var e=new t.Vector3;return function(r,n){return e.copy(r).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,r){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(r,e)},translateX:function(){var e=new t.Vector3(1,0,0);return function(r){return this.translateOnAxis(e,r)}}(),translateY:function(){var e=new t.Vector3(0,1,0);return function(r){return this.translateOnAxis(e,r)}}(),translateZ:function(){var e=new t.Vector3(0,0,1);return function(r){return this.translateOnAxis(e,r)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new t.Matrix4;return function(r){return r.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new t.Matrix4;return function(r){e.lookAt(r,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var r=0;r<arguments.length;r++)this.add(arguments[r]);return this}return e===this?(console.error("THREE.Object3D.add:",e,"can't be added as a child of itself."),this):(e instanceof t.Object3D?(e.parent!==void 0&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add:",e,"is not an instance of THREE.Object3D."),this)},remove:function(e){if(arguments.length>1)for(var r=0;r<arguments.length;r++)this.remove(arguments[r]);var n=this.children.indexOf(e);n!==-1&&(e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getChildByName:function(e,r){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,r)},getObjectById:function(e,r){if(this.id===e)return this;for(var n=0,a=this.children.length;n<a;n++){var o=this.children[n],s=o.getObjectById(e,r);if(s!==void 0)return s}},getObjectByName:function(e,r){if(this.name===e)return this;for(var n=0,a=this.children.length;n<a;n++){var o=this.children[n],s=o.getObjectByName(e,r);if(s!==void 0)return s}},getWorldPosition:function(e){var r=e||new t.Vector3;return this.updateMatrixWorld(!0),r.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new t.Vector3,r=new t.Vector3;return function(n){var a=n||new t.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,a,r),a}}(),getWorldRotation:function(){var e=new t.Quaternion;return function(r){var n=r||new t.Euler;return this.getWorldQuaternion(e),n.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new t.Vector3,r=new t.Quaternion;return function(n){var a=n||new t.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,r,a),a}}(),getWorldDirection:function(){var e=new t.Quaternion;return function(r){var n=r||new t.Vector3;return this.getWorldQuaternion(e),n.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var r=0,n=this.children.length;r<n;r++)this.children[r].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var r=0,n=this.children.length;r<n;r++)this.children[r].traverseVisible(e)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var r=0,n=this.children.length;r<n;r++)this.children[r].updateMatrixWorld(e)},toJSON:function(){var e={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}},r={},n=function(l){if(e.geometries===void 0&&(e.geometries=[]),r[l.uuid]===void 0){var h=l.toJSON();delete h.metadata,r[l.uuid]=h,e.geometries.push(h)}return l.uuid},a={},o=function(l){if(e.materials===void 0&&(e.materials=[]),a[l.uuid]===void 0){var h=l.toJSON();delete h.metadata,a[l.uuid]=h,e.materials.push(h)}return l.uuid},s=function(l){var h={};if(h.uuid=l.uuid,h.type=l.type,l.name!==""&&(h.name=l.name),JSON.stringify(l.userData)!=="{}"&&(h.userData=l.userData),l.visible!==!0&&(h.visible=l.visible),l instanceof t.PerspectiveCamera?(h.fov=l.fov,h.aspect=l.aspect,h.near=l.near,h.far=l.far):l instanceof t.OrthographicCamera?(h.left=l.left,h.right=l.right,h.top=l.top,h.bottom=l.bottom,h.near=l.near,h.far=l.far):l instanceof t.AmbientLight?h.color=l.color.getHex():l instanceof t.DirectionalLight?(h.color=l.color.getHex(),h.intensity=l.intensity):l instanceof t.PointLight?(h.color=l.color.getHex(),h.intensity=l.intensity,h.distance=l.distance):l instanceof t.SpotLight?(h.color=l.color.getHex(),h.intensity=l.intensity,h.distance=l.distance,h.angle=l.angle,h.exponent=l.exponent):l instanceof t.HemisphereLight?(h.color=l.color.getHex(),h.groundColor=l.groundColor.getHex()):l instanceof t.Mesh||l instanceof t.Line?(h.geometry=n(l.geometry),h.material=o(l.material)):l instanceof t.Sprite&&(h.material=o(l.material)),h.matrix=l.matrix.toArray(),l.children.length>0){h.children=[];for(var c=0;c<l.children.length;c++)h.children.push(s(l.children[c]))}return h};return e.object=s(this),e},clone:function(e,r){if(e===void 0&&(e=new t.Object3D),r===void 0&&(r=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),r===!0)for(var n=0;n<this.children.length;n++){var a=this.children[n];e.add(a.clone())}return e}},t.EventDispatcher.prototype.apply(t.Object3D.prototype),t.Object3DIdCount=0,t.Projector=function(){console.warn("THREE.Projector has been moved to /examples/renderers/Projector.js."),this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(r)},this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(r)},this.pickingRay=function(e,r){console.error("THREE.Projector: .pickingRay() has been removed.")}},t.Face3=function(e,r,n,a,o,s){this.a=e,this.b=r,this.c=n,this.normal=a instanceof t.Vector3?a:new t.Vector3,this.vertexNormals=a instanceof Array?a:[],this.color=o instanceof t.Color?o:new t.Color,this.vertexColors=o instanceof Array?o:[],this.vertexTangents=[],this.materialIndex=s!==void 0?s:0},t.Face3.prototype={constructor:t.Face3,clone:function(){var e=new t.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;for(var r=0,n=this.vertexNormals.length;r<n;r++)e.vertexNormals[r]=this.vertexNormals[r].clone();for(var r=0,n=this.vertexColors.length;r<n;r++)e.vertexColors[r]=this.vertexColors[r].clone();for(var r=0,n=this.vertexTangents.length;r<n;r++)e.vertexTangents[r]=this.vertexTangents[r].clone();return e}},t.Face4=function(e,r,n,a,o,s,l){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new t.Face3(e,r,n,o,s,l)},t.BufferAttribute=function(e,r){this.array=e,this.itemSize=r,this.needsUpdate=!1},t.BufferAttribute.prototype={constructor:t.BufferAttribute,get length(){return this.array.length},copyAt:function(e,r,n){e*=this.itemSize,n*=r.itemSize;for(var a=0,o=this.itemSize;a<o;a++)this.array[e+a]=r.array[n+a]},set:function(e){return this.array.set(e),this},setX:function(e,r){return this.array[e*this.itemSize]=r,this},setY:function(e,r){return this.array[e*this.itemSize+1]=r,this},setZ:function(e,r){return this.array[e*this.itemSize+2]=r,this},setXY:function(e,r,n){return e*=this.itemSize,this.array[e]=r,this.array[e+1]=n,this},setXYZ:function(e,r,n,a){return e*=this.itemSize,this.array[e]=r,this.array[e+1]=n,this.array[e+2]=a,this},setXYZW:function(e,r,n,a,o){return e*=this.itemSize,this.array[e]=r,this.array[e+1]=n,this.array[e+2]=a,this.array[e+3]=o,this},clone:function(){return new t.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}},t.Int8Attribute=function(e,r){return console.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.Uint8Attribute=function(e,r){return console.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.Uint8ClampedAttribute=function(e,r){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.Int16Attribute=function(e,r){return console.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.Uint16Attribute=function(e,r){return console.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.Int32Attribute=function(e,r){return console.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.Uint32Attribute=function(e,r){return console.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.Float32Attribute=function(e,r){return console.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.Float64Attribute=function(e,r){return console.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead."),new t.BufferAttribute(e,r)},t.BufferGeometry=function(){Object.defineProperty(this,"id",{value:t.GeometryIdCount++}),this.uuid=t.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null},t.BufferGeometry.prototype={constructor:t.BufferGeometry,addAttribute:function(e,r){if(!(r instanceof t.BufferAttribute)){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.attributes[e]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[e]=r,this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,r,n){this.drawcalls.push({start:e,count:r,index:n!==void 0?n:0})},applyMatrix:function(e){var r=this.attributes.position;r!==void 0&&(e.applyToVector3Array(r.array),r.needsUpdate=!0);var n=this.attributes.normal;if(n!==void 0){var a=new t.Matrix3().getNormalMatrix(e);a.applyToVector3Array(n.array),n.needsUpdate=!0}},center:function(){},fromGeometry:function(e,r){r=r||{vertexColors:t.NoColors};var n=e.vertices,a=e.faces,o=e.faceVertexUvs,s=r.vertexColors,l=o[0].length>0,h=a[0].vertexNormals.length==3,c=new Float32Array(a.length*3*3);this.addAttribute("position",new t.BufferAttribute(c,3));var d=new Float32Array(a.length*3*3);if(this.addAttribute("normal",new t.BufferAttribute(d,3)),s!==t.NoColors){var p=new Float32Array(a.length*3*3);this.addAttribute("color",new t.BufferAttribute(p,3))}if(l===!0){var v=new Float32Array(a.length*3*2);this.addAttribute("uv",new t.BufferAttribute(v,2))}for(var m=0,g=0,x=0;m<a.length;m++,g+=6,x+=9){var w=a[m],_=n[w.a],b=n[w.b],A=n[w.c];if(c[x]=_.x,c[x+1]=_.y,c[x+2]=_.z,c[x+3]=b.x,c[x+4]=b.y,c[x+5]=b.z,c[x+6]=A.x,c[x+7]=A.y,c[x+8]=A.z,h===!0){var E=w.vertexNormals[0],M=w.vertexNormals[1],F=w.vertexNormals[2];d[x]=E.x,d[x+1]=E.y,d[x+2]=E.z,d[x+3]=M.x,d[x+4]=M.y,d[x+5]=M.z,d[x+6]=F.x,d[x+7]=F.y,d[x+8]=F.z}else{var D=w.normal;d[x]=D.x,d[x+1]=D.y,d[x+2]=D.z,d[x+3]=D.x,d[x+4]=D.y,d[x+5]=D.z,d[x+6]=D.x,d[x+7]=D.y,d[x+8]=D.z}if(s===t.FaceColors){var R=w.color;p[x]=R.r,p[x+1]=R.g,p[x+2]=R.b,p[x+3]=R.r,p[x+4]=R.g,p[x+5]=R.b,p[x+6]=R.r,p[x+7]=R.g,p[x+8]=R.b}else if(s===t.VertexColors){var B=w.vertexColors[0],V=w.vertexColors[1],U=w.vertexColors[2];p[x]=B.r,p[x+1]=B.g,p[x+2]=B.b,p[x+3]=V.r,p[x+4]=V.g,p[x+5]=V.b,p[x+6]=U.r,p[x+7]=U.g,p[x+8]=U.b}if(l===!0){var z=o[0][m][0],I=o[0][m][1],Y=o[0][m][2];v[g]=z.x,v[g+1]=z.y,v[g+2]=I.x,v[g+3]=I.y,v[g+4]=Y.x,v[g+5]=Y.y}}return this.computeBoundingSphere(),this},computeBoundingBox:function(){var e=new t.Vector3;return function(){this.boundingBox===null&&(this.boundingBox=new t.Box3);var r=this.attributes.position.array;if(r){var n=this.boundingBox;n.makeEmpty();for(var a=0,o=r.length;a<o;a+=3)e.set(r[a],r[a+1],r[a+2]),n.expandByPoint(e)}(r===void 0||r.length===0)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}(),computeBoundingSphere:function(){var e=new t.Box3,r=new t.Vector3;return function(){this.boundingSphere===null&&(this.boundingSphere=new t.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();for(var a=this.boundingSphere.center,o=0,s=n.length;o<s;o+=3)r.set(n[o],n[o+1],n[o+2]),e.expandByPoint(r);e.center(a);for(var l=0,o=0,s=n.length;o<s;o+=3)r.set(n[o],n[o+1],n[o+2]),l=Math.max(l,a.distanceToSquared(r));this.boundingSphere.radius=Math.sqrt(l),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.attributes;if(e.position){var r=e.position.array;if(e.normal===void 0)this.addAttribute("normal",new t.BufferAttribute(new Float32Array(r.length),3));else for(var o=e.normal.array,n=0,a=o.length;n<a;n++)o[n]=0;var o=e.normal.array,s,l,h,c=new t.Vector3,d=new t.Vector3,p=new t.Vector3,v=new t.Vector3,m=new t.Vector3;if(e.index)for(var g=e.index.array,x=this.offsets.length>0?this.offsets:[{start:0,count:g.length,index:0}],w=0,_=x.length;w<_;++w)for(var b=x[w].start,A=x[w].count,E=x[w].index,n=b,a=b+A;n<a;n+=3)s=(E+g[n])*3,l=(E+g[n+1])*3,h=(E+g[n+2])*3,c.fromArray(r,s),d.fromArray(r,l),p.fromArray(r,h),v.subVectors(p,d),m.subVectors(c,d),v.cross(m),o[s]+=v.x,o[s+1]+=v.y,o[s+2]+=v.z,o[l]+=v.x,o[l+1]+=v.y,o[l+2]+=v.z,o[h]+=v.x,o[h+1]+=v.y,o[h+2]+=v.z;else for(var n=0,a=r.length;n<a;n+=9)c.fromArray(r,n),d.fromArray(r,n+3),p.fromArray(r,n+6),v.subVectors(p,d),m.subVectors(c,d),v.cross(m),o[n]=v.x,o[n+1]=v.y,o[n+2]=v.z,o[n+3]=v.x,o[n+4]=v.y,o[n+5]=v.z,o[n+6]=v.x,o[n+7]=v.y,o[n+8]=v.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},computeTangents:function(){if(this.attributes.index===void 0||this.attributes.position===void 0||this.attributes.normal===void 0||this.attributes.uv===void 0){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var e=this.attributes.index.array,r=this.attributes.position.array,n=this.attributes.normal.array,a=this.attributes.uv.array,o=r.length/3;this.attributes.tangent===void 0&&this.addAttribute("tangent",new t.BufferAttribute(new Float32Array(4*o),4));for(var s=this.attributes.tangent.array,l=[],h=[],c=0;c<o;c++)l[c]=new t.Vector3,h[c]=new t.Vector3;var d=new t.Vector3,p=new t.Vector3,v=new t.Vector3,m=new t.Vector2,g=new t.Vector2,x=new t.Vector2,w,_,b,A,E,M,F,D,R,B,V,U=new t.Vector3,z=new t.Vector3;function I(Ce,Ze,Je){d.fromArray(r,Ce*3),p.fromArray(r,Ze*3),v.fromArray(r,Je*3),m.fromArray(a,Ce*2),g.fromArray(a,Ze*2),x.fromArray(a,Je*2),w=p.x-d.x,_=v.x-d.x,b=p.y-d.y,A=v.y-d.y,E=p.z-d.z,M=v.z-d.z,F=g.x-m.x,D=x.x-m.x,R=g.y-m.y,B=x.y-m.y,V=1/(F*B-D*R),U.set((B*w-R*_)*V,(B*b-R*A)*V,(B*E-R*M)*V),z.set((F*_-D*w)*V,(F*A-D*b)*V,(F*M-D*E)*V),l[Ce].add(U),l[Ze].add(U),l[Je].add(U),h[Ce].add(z),h[Ze].add(z),h[Je].add(z)}var Y,H,q,ee,G,$,J;this.drawcalls.length===0&&this.addDrawCall(0,e.length,0);var X=this.drawcalls;for(q=0,ee=X.length;q<ee;++q){var K=X[q].start,ne=X[q].count,re=X[q].index;for(Y=K,H=K+ne;Y<H;Y+=3)G=re+e[Y],$=re+e[Y+1],J=re+e[Y+2],I(G,$,J)}var se=new t.Vector3,Z=new t.Vector3,de=new t.Vector3,ge=new t.Vector3,we,Ee,Te;function Be(Ce){de.fromArray(n,Ce*3),ge.copy(de),Ee=l[Ce],se.copy(Ee),se.sub(de.multiplyScalar(de.dot(Ee))).normalize(),Z.crossVectors(ge,Ee),Te=Z.dot(h[Ce]),we=Te<0?-1:1,s[Ce*4]=se.x,s[Ce*4+1]=se.y,s[Ce*4+2]=se.z,s[Ce*4+3]=we}for(q=0,ee=X.length;q<ee;++q){var K=X[q].start,ne=X[q].count,re=X[q].index;for(Y=K,H=K+ne;Y<H;Y+=3)G=re+e[Y],$=re+e[Y+1],J=re+e[Y+2],Be(G),Be($),Be(J)}},computeOffsets:function(e){var r=e;e===void 0&&(r=65535);var n=this.attributes.index.array,a=this.attributes.position.array;a.length/3;for(var o=n.length/3,s=new Uint16Array(n.length),l=0,h=0,c=[{start:0,count:0,index:0}],d=c[0],p=0,v=new Int32Array(6),m=new Int32Array(a.length),g=new Int32Array(a.length),x=0;x<a.length;x++)m[x]=-1,g[x]=-1;for(var w=0;w<o;w++){p=0;for(var _=0;_<3;_++){var b=n[w*3+_];m[b]==-1?(v[_*2]=b,v[_*2+1]=-1,p++):m[b]<d.index?(v[_*2]=b,v[_*2+1]=-1):(v[_*2]=b,v[_*2+1]=m[b])}var A=h+p;if(A>d.index+r){var E={start:l,count:0,index:h};c.push(E),d=E;for(var M=0;M<6;M+=2){var F=v[M+1];F>-1&&F<d.index&&(v[M+1]=-1)}}for(var M=0;M<6;M+=2){var b=v[M],F=v[M+1];F===-1&&(F=h++),m[b]=F,g[F]=b,s[l++]=F-d.index,d.count++}}return this.reorderBuffers(s,g,h),this.offsets=c,c},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var e=this.attributes.normal.array,r,n,a,o,s=0,l=e.length;s<l;s+=3)r=e[s],n=e[s+1],a=e[s+2],o=1/Math.sqrt(r*r+n*n+a*a),e[s]*=o,e[s+1]*=o,e[s+2]*=o},reorderBuffers:function(e,r,n){var a={};for(var o in this.attributes)if(o!="index"){var s=this.attributes[o].array;a[o]=new s.constructor(this.attributes[o].itemSize*n)}for(var l=0;l<n;l++){var h=r[l];for(var o in this.attributes)if(o!="index")for(var c=this.attributes[o].array,d=this.attributes[o].itemSize,p=a[o],v=0;v<d;v++)p[l*d+v]=c[h*d+v]}this.attributes.index.array=e;for(var o in this.attributes)o!="index"&&(this.attributes[o].array=a[o],this.attributes[o].numItems=this.attributes[o].itemSize*n)},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}},r=this.attributes,n=this.offsets,a=this.boundingSphere;for(var o in r){for(var s=r[o],l=[],h=s.array,c=0,d=h.length;c<d;c++)l[c]=h[c];e.data.attributes[o]={itemSize:s.itemSize,type:s.array.constructor.name,array:l}}return n.length>0&&(e.data.offsets=JSON.parse(JSON.stringify(n))),a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e},clone:function(){var e=new t.BufferGeometry;for(var r in this.attributes){var n=this.attributes[r];e.addAttribute(r,n.clone())}for(var a=0,o=this.offsets.length;a<o;a++){var s=this.offsets[a];e.offsets.push({start:s.start,index:s.index,count:s.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},t.EventDispatcher.prototype.apply(t.BufferGeometry.prototype),t.Geometry=function(){Object.defineProperty(this,"id",{value:t.GeometryIdCount++}),this.uuid=t.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},t.Geometry.prototype={constructor:t.Geometry,applyMatrix:function(e){for(var r=new t.Matrix3().getNormalMatrix(e),n=0,a=this.vertices.length;n<a;n++){var o=this.vertices[n];o.applyMatrix4(e)}for(var n=0,a=this.faces.length;n<a;n++){var s=this.faces[n];s.normal.applyMatrix3(r).normalize();for(var l=0,h=s.vertexNormals.length;l<h;l++)s.vertexNormals[l].applyMatrix3(r).normalize()}this.boundingBox instanceof t.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof t.Sphere&&this.computeBoundingSphere()},fromBufferGeometry:function(e){for(var r=this,n=e.attributes,a=n.position.array,o=n.index!==void 0?n.index.array:void 0,s=n.normal!==void 0?n.normal.array:void 0,l=n.color!==void 0?n.color.array:void 0,h=n.uv!==void 0?n.uv.array:void 0,c=[],d=[],p=0,v=0;p<a.length;p+=3,v+=2)r.vertices.push(new t.Vector3(a[p],a[p+1],a[p+2])),s!==void 0&&c.push(new t.Vector3(s[p],s[p+1],s[p+2])),l!==void 0&&r.colors.push(new t.Color(l[p],l[p+1],l[p+2])),h!==void 0&&d.push(new t.Vector2(h[v],h[v+1]));var m=function(g,x,w){var _=s!==void 0?[c[g].clone(),c[x].clone(),c[w].clone()]:[],b=l!==void 0?[r.colors[g].clone(),r.colors[x].clone(),r.colors[w].clone()]:[];r.faces.push(new t.Face3(g,x,w,_,b)),r.faceVertexUvs[0].push([d[g],d[x],d[w]])};if(o!==void 0)for(var p=0;p<o.length;p+=3)m(o[p],o[p+1],o[p+2]);else for(var p=0;p<a.length/3;p+=3)m(p,p+1,p+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=new t.Vector3;return e.addVectors(this.boundingBox.min,this.boundingBox.max),e.multiplyScalar(-.5),this.applyMatrix(new t.Matrix4().makeTranslation(e.x,e.y,e.z)),this.computeBoundingBox(),e},computeFaceNormals:function(){for(var e=new t.Vector3,r=new t.Vector3,n=0,a=this.faces.length;n<a;n++){var o=this.faces[n],s=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c];e.subVectors(h,l),r.subVectors(s,l),e.cross(r),e.normalize(),o.normal.copy(e)}},computeVertexNormals:function(e){var r,n,a,o,s,l;for(l=new Array(this.vertices.length),r=0,n=this.vertices.length;r<n;r++)l[r]=new t.Vector3;if(e){var h,c,d,p=new t.Vector3,v=new t.Vector3;for(new t.Vector3,new t.Vector3,new t.Vector3,a=0,o=this.faces.length;a<o;a++)s=this.faces[a],h=this.vertices[s.a],c=this.vertices[s.b],d=this.vertices[s.c],p.subVectors(d,c),v.subVectors(h,c),p.cross(v),l[s.a].add(p),l[s.b].add(p),l[s.c].add(p)}else for(a=0,o=this.faces.length;a<o;a++)s=this.faces[a],l[s.a].add(s.normal),l[s.b].add(s.normal),l[s.c].add(s.normal);for(r=0,n=this.vertices.length;r<n;r++)l[r].normalize();for(a=0,o=this.faces.length;a<o;a++)s=this.faces[a],s.vertexNormals[0]=l[s.a].clone(),s.vertexNormals[1]=l[s.b].clone(),s.vertexNormals[2]=l[s.c].clone()},computeMorphNormals:function(){var e,r,n,a,o;for(n=0,a=this.faces.length;n<a;n++)for(o=this.faces[n],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),e=0,r=o.vertexNormals.length;e<r;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone();var s=new t.Geometry;for(s.faces=this.faces,e=0,r=this.morphTargets.length;e<r;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var l=this.morphNormals[e].faceNormals,h=this.morphNormals[e].vertexNormals,d,p;for(n=0,a=this.faces.length;n<a;n++)d=new t.Vector3,p={a:new t.Vector3,b:new t.Vector3,c:new t.Vector3},l.push(d),h.push(p)}var c=this.morphNormals[e];s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals();var d,p;for(n=0,a=this.faces.length;n<a;n++)o=this.faces[n],d=c.faceNormals[n],p=c.vertexNormals[n],d.copy(o.normal),p.a.copy(o.vertexNormals[0]),p.b.copy(o.vertexNormals[1]),p.c.copy(o.vertexNormals[2])}for(n=0,a=this.faces.length;n<a;n++)o=this.faces[n],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){var e,r,n,a,o,s,l,h,c,d,p,v,m,g,x,w,_,b,A,E,M,F,D,R,B,V,U,z=[],I=[],Y=new t.Vector3,H=new t.Vector3,q=new t.Vector3,ee=new t.Vector3,G=new t.Vector3,$;for(n=0,a=this.vertices.length;n<a;n++)z[n]=new t.Vector3,I[n]=new t.Vector3;function J(K,ne,re,se,Z,de,ge){c=K.vertices[ne],d=K.vertices[re],p=K.vertices[se],v=h[Z],m=h[de],g=h[ge],x=d.x-c.x,w=p.x-c.x,_=d.y-c.y,b=p.y-c.y,A=d.z-c.z,E=p.z-c.z,M=m.x-v.x,F=g.x-v.x,D=m.y-v.y,R=g.y-v.y,B=1/(M*R-F*D),Y.set((R*x-D*w)*B,(R*_-D*b)*B,(R*A-D*E)*B),H.set((M*w-F*x)*B,(M*b-F*_)*B,(M*E-F*A)*B),z[ne].add(Y),z[re].add(Y),z[se].add(Y),I[ne].add(H),I[re].add(H),I[se].add(H)}for(e=0,r=this.faces.length;e<r;e++)l=this.faces[e],h=this.faceVertexUvs[0][e],J(this,l.a,l.b,l.c,0,1,2);var X=["a","b","c","d"];for(e=0,r=this.faces.length;e<r;e++)for(l=this.faces[e],o=0;o<Math.min(l.vertexNormals.length,3);o++)G.copy(l.vertexNormals[o]),s=l[X[o]],V=z[s],q.copy(V),q.sub(G.multiplyScalar(G.dot(V))).normalize(),ee.crossVectors(l.vertexNormals[o],V),U=ee.dot(I[s]),$=U<0?-1:1,l.vertexTangents[o]=new t.Vector4(q.x,q.y,q.z,$);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,r=this.vertices,n=0,a=r.length;n<a;n++)n>0&&(e+=r[n].distanceTo(r[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new t.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new t.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,r,n){if(!(e instanceof t.Geometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var a,o=this.vertices.length,s=this.vertices,l=e.vertices,h=this.faces,c=e.faces,d=this.faceVertexUvs[0],p=e.faceVertexUvs[0];n===void 0&&(n=0),r!==void 0&&(a=new t.Matrix3().getNormalMatrix(r));for(var v=0,m=l.length;v<m;v++){var g=l[v],x=g.clone();r!==void 0&&x.applyMatrix4(r),s.push(x)}for(v=0,m=c.length;v<m;v++){var w=c[v],_,b,A,E=w.vertexNormals,M=w.vertexColors;_=new t.Face3(w.a+o,w.b+o,w.c+o),_.normal.copy(w.normal),a!==void 0&&_.normal.applyMatrix3(a).normalize();for(var F=0,D=E.length;F<D;F++)b=E[F].clone(),a!==void 0&&b.applyMatrix3(a).normalize(),_.vertexNormals.push(b);_.color.copy(w.color);for(var F=0,D=M.length;F<D;F++)A=M[F],_.vertexColors.push(A.clone());_.materialIndex=w.materialIndex+n,h.push(_)}for(v=0,m=p.length;v<m;v++){var R=p[v],B=[];if(R!==void 0){for(var F=0,D=R.length;F<D;F++)B.push(new t.Vector2(R[F].x,R[F].y));d.push(B)}}},mergeVertices:function(){var e={},r=[],n=[],a,o,s=4,l=Math.pow(10,s),h,c,d,p,v,m;for(h=0,c=this.vertices.length;h<c;h++)a=this.vertices[h],o=Math.round(a.x*l)+"_"+Math.round(a.y*l)+"_"+Math.round(a.z*l),e[o]===void 0?(e[o]=h,r.push(this.vertices[h]),n[h]=r.length-1):n[h]=n[e[o]];var g=[];for(h=0,c=this.faces.length;h<c;h++){d=this.faces[h],d.a=n[d.a],d.b=n[d.b],d.c=n[d.c],p=[d.a,d.b,d.c];for(var x=0;x<3;x++)if(p[x]==p[(x+1)%3]){g.push(h);break}}for(h=g.length-1;h>=0;h--){var w=g[h];for(this.faces.splice(w,1),v=0,m=this.faceVertexUvs.length;v<m;v++)this.faceVertexUvs[v].splice(w,1)}var _=this.vertices.length-r.length;return this.vertices=r,_},toJSON:function(){var e={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(this.name!==""&&(e.name=this.name),this.parameters!==void 0){var r=this.parameters;for(var n in r)r[n]!==void 0&&(e[n]=r[n]);return e}for(var a=[],o=0;o<this.vertices.length;o++){var s=this.vertices[o];a.push(s.x,s.y,s.z)}for(var l=[],h=[],c={},d=[],p={},v=[],m={},o=0;o<this.faces.length;o++){var g=this.faces[o],x=!1,w=!1,_=this.faceVertexUvs[0][o]!==void 0,b=g.normal.length()>0,A=g.vertexNormals.length>0,E=g.color.r!==1||g.color.g!==1||g.color.b!==1,M=g.vertexColors.length>0,F=0;if(F=V(F,0,0),F=V(F,1,x),F=V(F,2,w),F=V(F,3,_),F=V(F,4,b),F=V(F,5,A),F=V(F,6,E),F=V(F,7,M),l.push(F),l.push(g.a,g.b,g.c),_){var D=this.faceVertexUvs[0][o];l.push(I(D[0]),I(D[1]),I(D[2]))}if(b&&l.push(U(g.normal)),A){var R=g.vertexNormals;l.push(U(R[0]),U(R[1]),U(R[2]))}if(E&&l.push(z(g.color)),M){var B=g.vertexColors;l.push(z(B[0]),z(B[1]),z(B[2]))}}function V(Y,H,q){return q?Y|1<<H:Y&~(1<<H)}function U(Y){var H=Y.x.toString()+Y.y.toString()+Y.z.toString();return c[H]!==void 0||(c[H]=h.length/3,h.push(Y.x,Y.y,Y.z)),c[H]}function z(Y){var H=Y.r.toString()+Y.g.toString()+Y.b.toString();return p[H]!==void 0||(p[H]=d.length,d.push(Y.getHex())),p[H]}function I(Y){var H=Y.x.toString()+Y.y.toString();return m[H]!==void 0||(m[H]=v.length/2,v.push(Y.x,Y.y)),m[H]}return e.data={},e.data.vertices=a,e.data.normals=h,d.length>0&&(e.data.colors=d),v.length>0&&(e.data.uvs=[v]),e.data.faces=l,e},clone:function(){for(var e=new t.Geometry,r=this.vertices,n=0,a=r.length;n<a;n++)e.vertices.push(r[n].clone());for(var o=this.faces,n=0,a=o.length;n<a;n++)e.faces.push(o[n].clone());for(var s=this.faceVertexUvs[0],n=0,a=s.length;n<a;n++){for(var l=s[n],h=[],c=0,d=l.length;c<d;c++)h.push(new t.Vector2(l[c].x,l[c].y));e.faceVertexUvs[0].push(h)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},t.EventDispatcher.prototype.apply(t.Geometry.prototype),t.GeometryIdCount=0,t.Camera=function(){t.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new t.Matrix4,this.projectionMatrix=new t.Matrix4},t.Camera.prototype=Object.create(t.Object3D.prototype),t.Camera.prototype.getWorldDirection=function(){var e=new t.Quaternion;return function(r){var n=r||new t.Vector3;return this.getWorldQuaternion(e),n.set(0,0,-1).applyQuaternion(e)}}(),t.Camera.prototype.lookAt=function(){var e=new t.Matrix4;return function(r){e.lookAt(this.position,r,this.up),this.quaternion.setFromRotationMatrix(e)}}(),t.Camera.prototype.clone=function(e){return e===void 0&&(e=new t.Camera),t.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},t.CubeCamera=function(e,r,n){t.Object3D.call(this),this.type="CubeCamera";var a=90,o=1,s=new t.PerspectiveCamera(a,o,e,r);s.up.set(0,-1,0),s.lookAt(new t.Vector3(1,0,0)),this.add(s);var l=new t.PerspectiveCamera(a,o,e,r);l.up.set(0,-1,0),l.lookAt(new t.Vector3(-1,0,0)),this.add(l);var h=new t.PerspectiveCamera(a,o,e,r);h.up.set(0,0,1),h.lookAt(new t.Vector3(0,1,0)),this.add(h);var c=new t.PerspectiveCamera(a,o,e,r);c.up.set(0,0,-1),c.lookAt(new t.Vector3(0,-1,0)),this.add(c);var d=new t.PerspectiveCamera(a,o,e,r);d.up.set(0,-1,0),d.lookAt(new t.Vector3(0,0,1)),this.add(d);var p=new t.PerspectiveCamera(a,o,e,r);p.up.set(0,-1,0),p.lookAt(new t.Vector3(0,0,-1)),this.add(p),this.renderTarget=new t.WebGLRenderTargetCube(n,n,{format:t.RGBFormat,magFilter:t.LinearFilter,minFilter:t.LinearFilter}),this.updateCubeMap=function(v,m){var g=this.renderTarget,x=g.generateMipmaps;g.generateMipmaps=!1,g.activeCubeFace=0,v.render(m,s,g),g.activeCubeFace=1,v.render(m,l,g),g.activeCubeFace=2,v.render(m,h,g),g.activeCubeFace=3,v.render(m,c,g),g.activeCubeFace=4,v.render(m,d,g),g.generateMipmaps=x,g.activeCubeFace=5,v.render(m,p,g)}},t.CubeCamera.prototype=Object.create(t.Object3D.prototype),t.OrthographicCamera=function(e,r,n,a,o,s){t.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=e,this.right=r,this.top=n,this.bottom=a,this.near=o!==void 0?o:.1,this.far=s!==void 0?s:2e3,this.updateProjectionMatrix()},t.OrthographicCamera.prototype=Object.create(t.Camera.prototype),t.OrthographicCamera.prototype.updateProjectionMatrix=function(){var e=(this.right-this.left)/(2*this.zoom),r=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,a=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(n-e,n+e,a+r,a-r,this.near,this.far)},t.OrthographicCamera.prototype.clone=function(){var e=new t.OrthographicCamera;return t.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},t.PerspectiveCamera=function(e,r,n,a){t.Camera.call(this),this.type="PerspectiveCamera",this.zoom=1,this.fov=e!==void 0?e:50,this.aspect=r!==void 0?r:1,this.near=n!==void 0?n:.1,this.far=a!==void 0?a:2e3,this.updateProjectionMatrix()},t.PerspectiveCamera.prototype=Object.create(t.Camera.prototype),t.PerspectiveCamera.prototype.setLens=function(e,r){r===void 0&&(r=24),this.fov=2*t.Math.radToDeg(Math.atan(r/(e*2))),this.updateProjectionMatrix()},t.PerspectiveCamera.prototype.setViewOffset=function(e,r,n,a,o,s){this.fullWidth=e,this.fullHeight=r,this.x=n,this.y=a,this.width=o,this.height=s,this.updateProjectionMatrix()},t.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var e=t.Math.radToDeg(2*Math.atan(Math.tan(t.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var r=this.fullWidth/this.fullHeight,n=Math.tan(t.Math.degToRad(e*.5))*this.near,a=-n,o=r*a,s=r*n,l=Math.abs(s-o),h=Math.abs(n-a);this.projectionMatrix.makeFrustum(o+this.x*l/this.fullWidth,o+(this.x+this.width)*l/this.fullWidth,n-(this.y+this.height)*h/this.fullHeight,n-this.y*h/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(e,this.aspect,this.near,this.far)},t.PerspectiveCamera.prototype.clone=function(){var e=new t.PerspectiveCamera;return t.Camera.prototype.clone.call(this,e),e.zoom=this.zoom,e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e.projectionMatrix.copy(this.projectionMatrix),e},t.Light=function(e){t.Object3D.call(this),this.type="Light",this.color=new t.Color(e)},t.Light.prototype=Object.create(t.Object3D.prototype),t.Light.prototype.clone=function(e){return e===void 0&&(e=new t.Light),t.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},t.AmbientLight=function(e){t.Light.call(this,e),this.type="AmbientLight"},t.AmbientLight.prototype=Object.create(t.Light.prototype),t.AmbientLight.prototype.clone=function(){var e=new t.AmbientLight;return t.Light.prototype.clone.call(this,e),e},t.AreaLight=function(e,r){t.Light.call(this,e),this.type="AreaLight",this.normal=new t.Vector3(0,-1,0),this.right=new t.Vector3(1,0,0),this.intensity=r!==void 0?r:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},t.AreaLight.prototype=Object.create(t.Light.prototype),t.DirectionalLight=function(e,r){t.Light.call(this,e),this.type="DirectionalLight",this.position.set(0,1,0),this.target=new t.Object3D,this.intensity=r!==void 0?r:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new t.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},t.DirectionalLight.prototype=Object.create(t.Light.prototype),t.DirectionalLight.prototype.clone=function(){var e=new t.DirectionalLight;return t.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},t.HemisphereLight=function(e,r,n){t.Light.call(this,e),this.type="HemisphereLight",this.position.set(0,100,0),this.groundColor=new t.Color(r),this.intensity=n!==void 0?n:1},t.HemisphereLight.prototype=Object.create(t.Light.prototype),t.HemisphereLight.prototype.clone=function(){var e=new t.HemisphereLight;return t.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},t.PointLight=function(e,r,n){t.Light.call(this,e),this.type="PointLight",this.intensity=r!==void 0?r:1,this.distance=n!==void 0?n:0},t.PointLight.prototype=Object.create(t.Light.prototype),t.PointLight.prototype.clone=function(){var e=new t.PointLight;return t.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},t.SpotLight=function(e,r,n,a,o){t.Light.call(this,e),this.type="SpotLight",this.position.set(0,1,0),this.target=new t.Object3D,this.intensity=r!==void 0?r:1,this.distance=n!==void 0?n:0,this.angle=a!==void 0?a:Math.PI/3,this.exponent=o!==void 0?o:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},t.SpotLight.prototype=Object.create(t.Light.prototype),t.SpotLight.prototype.clone=function(){var e=new t.SpotLight;return t.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},t.Cache=function(){this.files={}},t.Cache.prototype={constructor:t.Cache,add:function(e,r){this.files[e]=r},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},t.Loader=function(e){this.showStatus=e,this.statusDomElement=e?t.Loader.prototype.addStatusElement():null,this.imageLoader=new t.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},t.Loader.prototype={constructor:t.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var r="Loaded ";e.total?r+=(100*e.loaded/e.total).toFixed(0)+"%":r+=(e.loaded/1024).toFixed(2)+" KB",this.statusDomElement.innerHTML=r},extractUrlBase:function(e){var r=e.split("/");return r.length===1?"./":(r.pop(),r.join("/")+"/")},initMaterials:function(e,r){for(var n=[],a=0;a<e.length;++a)n[a]=this.createMaterial(e[a],r);return n},needsTangents:function(e){for(var r=0,n=e.length;r<n;r++){var a=e[r];if(a instanceof t.ShaderMaterial)return!0}return!1},createMaterial:function(e,r){var n=this;function a(g){var x=Math.log(g)/Math.LN2;return Math.pow(2,Math.round(x))}function o(g,x,w,_,b,A,E){var M=r+w,F,D=t.Loader.Handlers.get(M);if(D!==null?F=D.load(M):(F=new t.Texture,D=n.imageLoader,D.crossOrigin=n.crossOrigin,D.load(M,function(B){if(t.Math.isPowerOfTwo(B.width)===!1||t.Math.isPowerOfTwo(B.height)===!1){var V=a(B.width),U=a(B.height),z=document.createElement("canvas");z.width=V,z.height=U;var I=z.getContext("2d");I.drawImage(B,0,0,V,U),F.image=z}else F.image=B;F.needsUpdate=!0})),F.sourceFile=w,_&&(F.repeat.set(_[0],_[1]),_[0]!==1&&(F.wrapS=t.RepeatWrapping),_[1]!==1&&(F.wrapT=t.RepeatWrapping)),b&&F.offset.set(b[0],b[1]),A){var R={repeat:t.RepeatWrapping,mirror:t.MirroredRepeatWrapping};R[A[0]]!==void 0&&(F.wrapS=R[A[0]]),R[A[1]]!==void 0&&(F.wrapT=R[A[1]])}E&&(F.anisotropy=E),g[x]=F}function s(g){return(g[0]*255<<16)+(g[1]*255<<8)+g[2]*255}var l="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var c=e.shading.toLowerCase();c==="phong"?l="MeshPhongMaterial":c==="basic"&&(l="MeshBasicMaterial")}if(e.blending!==void 0&&t[e.blending]!==void 0&&(h.blending=t[e.blending]),(e.transparent!==void 0||e.opacity<1)&&(h.transparent=e.transparent),e.depthTest!==void 0&&(h.depthTest=e.depthTest),e.depthWrite!==void 0&&(h.depthWrite=e.depthWrite),e.visible!==void 0&&(h.visible=e.visible),e.flipSided!==void 0&&(h.side=t.BackSide),e.doubleSided!==void 0&&(h.side=t.DoubleSide),e.wireframe!==void 0&&(h.wireframe=e.wireframe),e.vertexColors!==void 0&&(e.vertexColors==="face"?h.vertexColors=t.FaceColors:e.vertexColors&&(h.vertexColors=t.VertexColors)),e.colorDiffuse?h.color=s(e.colorDiffuse):e.DbgColor&&(h.color=e.DbgColor),e.colorSpecular&&(h.specular=s(e.colorSpecular)),e.colorAmbient&&(h.ambient=s(e.colorAmbient)),e.colorEmissive&&(h.emissive=s(e.colorEmissive)),e.transparency&&(h.opacity=e.transparency),e.specularCoef&&(h.shininess=e.specularCoef),e.mapDiffuse&&r&&o(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&r&&o(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&r&&o(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&r&&o(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&r&&o(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapAlpha&&r&&o(h,"alphaMap",e.mapAlpha,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy),e.mapBumpScale&&(h.bumpScale=e.mapBumpScale),e.mapNormal){var d=t.ShaderLib.normalmap,p=t.UniformsUtils.clone(d.uniforms);p.tNormal.value=h.normalMap,e.mapNormalFactor&&p.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),h.map&&(p.tDiffuse.value=h.map,p.enableDiffuse.value=!0),h.specularMap&&(p.tSpecular.value=h.specularMap,p.enableSpecular.value=!0),h.lightMap&&(p.tAO.value=h.lightMap,p.enableAO.value=!0),p.diffuse.value.setHex(h.color),p.specular.value.setHex(h.specular),p.ambient.value.setHex(h.ambient),p.shininess.value=h.shininess,h.opacity!==void 0&&(p.opacity.value=h.opacity);var v={fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:p,lights:!0,fog:!0},m=new t.ShaderMaterial(v);h.transparent&&(m.transparent=!0)}else var m=new t[l](h);return e.DbgName!==void 0&&(m.name=e.DbgName),m}},t.Loader.Handlers={handlers:[],add:function(e,r){this.handlers.push(e,r)},get:function(e){for(var r=0,n=this.handlers.length;r<n;r+=2){var a=this.handlers[r],o=this.handlers[r+1];if(a.test(e))return o}return null}},t.XHRLoader=function(e){this.cache=new t.Cache,this.manager=e!==void 0?e:t.DefaultLoadingManager},t.XHRLoader.prototype={constructor:t.XHRLoader,load:function(e,r,n,a){var o=this,s=o.cache.get(e);if(s!==void 0){r&&r(s);return}var l=new XMLHttpRequest;l.open("GET",e,!0),l.addEventListener("load",function(h){o.cache.add(e,this.response),r&&r(this.response),o.manager.itemEnd(e)},!1),n!==void 0&&l.addEventListener("progress",function(h){n(h)},!1),a!==void 0&&l.addEventListener("error",function(h){a(h)},!1),this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),this.responseType!==void 0&&(l.responseType=this.responseType),l.send(null),o.manager.itemStart(e)},setResponseType:function(e){this.responseType=e},setCrossOrigin:function(e){this.crossOrigin=e}},t.ImageLoader=function(e){this.cache=new t.Cache,this.manager=e!==void 0?e:t.DefaultLoadingManager},t.ImageLoader.prototype={constructor:t.ImageLoader,load:function(e,r,n,a){var o=this,s=o.cache.get(e);if(s!==void 0){r(s);return}var l=document.createElement("img");return r!==void 0&&l.addEventListener("load",function(h){o.cache.add(e,this),r(this),o.manager.itemEnd(e)},!1),n!==void 0&&l.addEventListener("progress",function(h){n(h)},!1),a!==void 0&&l.addEventListener("error",function(h){a(h)},!1),this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),l.src=e,o.manager.itemStart(e),l},setCrossOrigin:function(e){this.crossOrigin=e}},t.JSONLoader=function(e){t.Loader.call(this,e),this.withCredentials=!1},t.JSONLoader.prototype=Object.create(t.Loader.prototype),t.JSONLoader.prototype.load=function(e,r,n){n=n&&typeof n=="string"?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,r,n)},t.JSONLoader.prototype.loadAjaxJSON=function(e,r,n,a,o){var s=new XMLHttpRequest,l=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(s.status===200||s.status===0){if(s.responseText){var h=JSON.parse(s.responseText);if(h.metadata!==void 0&&h.metadata.type==="scene"){console.error('THREE.JSONLoader: "'+r+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}var c=e.parse(h,a);n(c.geometry,c.materials)}else console.error('THREE.JSONLoader: "'+r+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error(`THREE.JSONLoader: Couldn't load "`+r+'" ('+s.status+")");else s.readyState===s.LOADING?o&&(l===0&&(l=s.getResponseHeader("Content-Length")),o({total:l,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&o!==void 0&&(l=s.getResponseHeader("Content-Length"))},s.open("GET",r,!0),s.withCredentials=this.withCredentials,s.send(null)},t.JSONLoader.prototype.parse=function(e,r){var n=new t.Geometry,a=e.scale!==void 0?1/e.scale:1;o(a),s(),l(a),n.computeFaceNormals(),n.computeBoundingSphere();function o(c){function d(de,ge){return de&1<<ge}var p,v,m,g,x,w,_,b,A,E,M,F,D,R,B,V,U,z,I,Y,H,q,ee,G,$,J,X,K=e.faces,ne=e.vertices,re=e.normals,se=e.colors,Z=0;if(e.uvs!==void 0){for(p=0;p<e.uvs.length;p++)e.uvs[p].length&&Z++;for(p=0;p<Z;p++)n.faceVertexUvs[p]=[]}for(g=0,x=ne.length;g<x;)z=new t.Vector3,z.x=ne[g++]*c,z.y=ne[g++]*c,z.z=ne[g++]*c,n.vertices.push(z);for(g=0,x=K.length;g<x;)if(E=K[g++],M=d(E,0),F=d(E,1),D=d(E,3),R=d(E,4),B=d(E,5),V=d(E,6),U=d(E,7),M){if(Y=new t.Face3,Y.a=K[g],Y.b=K[g+1],Y.c=K[g+3],H=new t.Face3,H.a=K[g+1],H.b=K[g+2],H.c=K[g+3],g+=4,F&&(A=K[g++],Y.materialIndex=A,H.materialIndex=A),m=n.faces.length,D)for(p=0;p<Z;p++)for(G=e.uvs[p],n.faceVertexUvs[p][m]=[],n.faceVertexUvs[p][m+1]=[],v=0;v<4;v++)b=K[g++],J=G[b*2],X=G[b*2+1],$=new t.Vector2(J,X),v!==2&&n.faceVertexUvs[p][m].push($),v!==0&&n.faceVertexUvs[p][m+1].push($);if(R&&(_=K[g++]*3,Y.normal.set(re[_++],re[_++],re[_]),H.normal.copy(Y.normal)),B)for(p=0;p<4;p++)_=K[g++]*3,ee=new t.Vector3(re[_++],re[_++],re[_]),p!==2&&Y.vertexNormals.push(ee),p!==0&&H.vertexNormals.push(ee);if(V&&(w=K[g++],q=se[w],Y.color.setHex(q),H.color.setHex(q)),U)for(p=0;p<4;p++)w=K[g++],q=se[w],p!==2&&Y.vertexColors.push(new t.Color(q)),p!==0&&H.vertexColors.push(new t.Color(q));n.faces.push(Y),n.faces.push(H)}else{if(I=new t.Face3,I.a=K[g++],I.b=K[g++],I.c=K[g++],F&&(A=K[g++],I.materialIndex=A),m=n.faces.length,D)for(p=0;p<Z;p++)for(G=e.uvs[p],n.faceVertexUvs[p][m]=[],v=0;v<3;v++)b=K[g++],J=G[b*2],X=G[b*2+1],$=new t.Vector2(J,X),n.faceVertexUvs[p][m].push($);if(R&&(_=K[g++]*3,I.normal.set(re[_++],re[_++],re[_])),B)for(p=0;p<3;p++)_=K[g++]*3,ee=new t.Vector3(re[_++],re[_++],re[_]),I.vertexNormals.push(ee);if(V&&(w=K[g++],I.color.setHex(se[w])),U)for(p=0;p<3;p++)w=K[g++],I.vertexColors.push(new t.Color(se[w]));n.faces.push(I)}}function s(){var c=e.influencesPerVertex!==void 0?e.influencesPerVertex:2;if(e.skinWeights)for(var d=0,p=e.skinWeights.length;d<p;d+=c){var v=e.skinWeights[d],m=c>1?e.skinWeights[d+1]:0,g=c>2?e.skinWeights[d+2]:0,x=c>3?e.skinWeights[d+3]:0;n.skinWeights.push(new t.Vector4(v,m,g,x))}if(e.skinIndices)for(var d=0,p=e.skinIndices.length;d<p;d+=c){var w=e.skinIndices[d],_=c>1?e.skinIndices[d+1]:0,b=c>2?e.skinIndices[d+2]:0,A=c>3?e.skinIndices[d+3]:0;n.skinIndices.push(new t.Vector4(w,_,b,A))}n.bones=e.bones,n.bones&&n.bones.length>0&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&console.warn("When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match."),n.animation=e.animation,n.animations=e.animations}function l(c){if(e.morphTargets!==void 0){var d,p,v,m,g,x;for(d=0,p=e.morphTargets.length;d<p;d++)for(n.morphTargets[d]={},n.morphTargets[d].name=e.morphTargets[d].name,n.morphTargets[d].vertices=[],g=n.morphTargets[d].vertices,x=e.morphTargets[d].vertices,v=0,m=x.length;v<m;v+=3){var w=new t.Vector3;w.x=x[v]*c,w.y=x[v+1]*c,w.z=x[v+2]*c,g.push(w)}}if(e.morphColors!==void 0){var d,p,_,b,A,E,M;for(d=0,p=e.morphColors.length;d<p;d++)for(n.morphColors[d]={},n.morphColors[d].name=e.morphColors[d].name,n.morphColors[d].colors=[],A=n.morphColors[d].colors,E=e.morphColors[d].colors,_=0,b=E.length;_<b;_+=3)M=new t.Color(16755200),M.setRGB(E[_],E[_+1],E[_+2]),A.push(M)}}if(e.materials===void 0||e.materials.length===0)return{geometry:n};var h=this.initMaterials(e.materials,r);return this.needsTangents(h)&&n.computeTangents(),{geometry:n,materials:h}},t.LoadingManager=function(e,r,n){var a=this,o=0,s=0;this.onLoad=e,this.onProgress=r,this.onError=n,this.itemStart=function(l){s++},this.itemEnd=function(l){o++,a.onProgress!==void 0&&a.onProgress(l,o,s),o===s&&a.onLoad!==void 0&&a.onLoad()}},t.DefaultLoadingManager=new t.LoadingManager,t.BufferGeometryLoader=function(e){this.manager=e!==void 0?e:t.DefaultLoadingManager},t.BufferGeometryLoader.prototype={constructor:t.BufferGeometryLoader,load:function(e,r,n,a){var o=this,s=new t.XHRLoader;s.setCrossOrigin(this.crossOrigin),s.load(e,function(l){r(o.parse(JSON.parse(l)))},n,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var r=new t.BufferGeometry,n=e.attributes;for(var a in n){var o=n[a],s=new Re[o.type](o.array);r.addAttribute(a,new t.BufferAttribute(s,o.itemSize))}var l=e.offsets;l!==void 0&&(r.offsets=JSON.parse(JSON.stringify(l)));var h=e.boundingSphere;if(h!==void 0){var c=new t.Vector3;h.center!==void 0&&c.fromArray(h.center),r.boundingSphere=new t.Sphere(c,h.radius)}return r}},t.MaterialLoader=function(e){this.manager=e!==void 0?e:t.DefaultLoadingManager},t.MaterialLoader.prototype={constructor:t.MaterialLoader,load:function(e,r,n,a){var o=this,s=new t.XHRLoader;s.setCrossOrigin(this.crossOrigin),s.load(e,function(l){r(o.parse(JSON.parse(l)))},n,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var r=new t[e.type];if(e.color!==void 0&&r.color.setHex(e.color),e.ambient!==void 0&&r.ambient.setHex(e.ambient),e.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular.setHex(e.specular),e.shininess!==void 0&&(r.shininess=e.shininess),e.uniforms!==void 0&&(r.uniforms=e.uniforms),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.vertexColors!==void 0&&(r.vertexColors=e.vertexColors),e.shading!==void 0&&(r.shading=e.shading),e.blending!==void 0&&(r.blending=e.blending),e.side!==void 0&&(r.side=e.side),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.materials!==void 0)for(var n=0,a=e.materials.length;n<a;n++)r.materials.push(this.parse(e.materials[n]));return r}},t.ObjectLoader=function(e){this.manager=e!==void 0?e:t.DefaultLoadingManager},t.ObjectLoader.prototype={constructor:t.ObjectLoader,load:function(e,r,n,a){var o=this,s=new t.XHRLoader(o.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(l){r(o.parse(JSON.parse(l)))},n,a)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var r=this.parseGeometries(e.geometries),n=this.parseMaterials(e.materials),a=this.parseObject(e.object,r,n);return a},parseGeometries:function(e){var r={};if(e!==void 0)for(var n=new t.JSONLoader,a=new t.BufferGeometryLoader,o=0,s=e.length;o<s;o++){var l,h=e[o];switch(h.type){case"PlaneGeometry":l=new t.PlaneGeometry(h.width,h.height,h.widthSegments,h.heightSegments);break;case"BoxGeometry":case"CubeGeometry":l=new t.BoxGeometry(h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case"CircleGeometry":l=new t.CircleGeometry(h.radius,h.segments);break;case"CylinderGeometry":l=new t.CylinderGeometry(h.radiusTop,h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded);break;case"SphereGeometry":l=new t.SphereGeometry(h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case"IcosahedronGeometry":l=new t.IcosahedronGeometry(h.radius,h.detail);break;case"TorusGeometry":l=new t.TorusGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case"TorusKnotGeometry":l=new t.TorusKnotGeometry(h.radius,h.tube,h.radialSegments,h.tubularSegments,h.p,h.q,h.heightScale);break;case"BufferGeometry":l=a.parse(h.data);break;case"Geometry":l=n.parse(h.data).geometry;break}l.uuid=h.uuid,h.name!==void 0&&(l.name=h.name),r[h.uuid]=l}return r},parseMaterials:function(e){var r={};if(e!==void 0)for(var n=new t.MaterialLoader,a=0,o=e.length;a<o;a++){var s=e[a],l=n.parse(s);l.uuid=s.uuid,s.name!==void 0&&(l.name=s.name),r[s.uuid]=l}return r},parseObject:function(){var e=new t.Matrix4;return function(r,n,a){var o;switch(r.type){case"Scene":o=new t.Scene;break;case"PerspectiveCamera":o=new t.PerspectiveCamera(r.fov,r.aspect,r.near,r.far);break;case"OrthographicCamera":o=new t.OrthographicCamera(r.left,r.right,r.top,r.bottom,r.near,r.far);break;case"AmbientLight":o=new t.AmbientLight(r.color);break;case"DirectionalLight":o=new t.DirectionalLight(r.color,r.intensity);break;case"PointLight":o=new t.PointLight(r.color,r.intensity,r.distance);break;case"SpotLight":o=new t.SpotLight(r.color,r.intensity,r.distance,r.angle,r.exponent);break;case"HemisphereLight":o=new t.HemisphereLight(r.color,r.groundColor,r.intensity);break;case"Mesh":var s=n[r.geometry],l=a[r.material];s===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",r.geometry),l===void 0&&console.warn("THREE.ObjectLoader: Undefined material",r.material),o=new t.Mesh(s,l);break;case"Line":var s=n[r.geometry],l=a[r.material];s===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",r.geometry),l===void 0&&console.warn("THREE.ObjectLoader: Undefined material",r.material),o=new t.Line(s,l);break;case"Sprite":var l=a[r.material];l===void 0&&console.warn("THREE.ObjectLoader: Undefined material",r.material),o=new t.Sprite(l);break;case"Group":o=new t.Group;break;default:o=new t.Object3D}if(o.uuid=r.uuid,r.name!==void 0&&(o.name=r.name),r.matrix!==void 0?(e.fromArray(r.matrix),e.decompose(o.position,o.quaternion,o.scale)):(r.position!==void 0&&o.position.fromArray(r.position),r.rotation!==void 0&&o.rotation.fromArray(r.rotation),r.scale!==void 0&&o.scale.fromArray(r.scale)),r.visible!==void 0&&(o.visible=r.visible),r.userData!==void 0&&(o.userData=r.userData),r.children!==void 0)for(var h in r.children)o.add(this.parseObject(r.children[h],n,a));return o}}()},t.TextureLoader=function(e){this.manager=e!==void 0?e:t.DefaultLoadingManager},t.TextureLoader.prototype={constructor:t.TextureLoader,load:function(e,r,n,a){var o=this,s=new t.ImageLoader(o.manager);s.setCrossOrigin(this.crossOrigin),s.load(e,function(l){var h=new t.Texture(l);h.needsUpdate=!0,r!==void 0&&r(h)},n,a)},setCrossOrigin:function(e){this.crossOrigin=e}},t.CompressedTextureLoader=function(){this._parser=null},t.CompressedTextureLoader.prototype={constructor:t.CompressedTextureLoader,load:function(e,r,n){var a=this,o=[],s=new t.CompressedTexture;s.image=o;var l=new t.XHRLoader;if(l.setResponseType("arraybuffer"),e instanceof Array)for(var h=0,c=function(v){l.load(e[v],function(m){var g=a._parser(m,!0);o[v]={width:g.width,height:g.height,format:g.format,mipmaps:g.mipmaps},h+=1,h===6&&(g.mipmapCount==1&&(s.minFilter=t.LinearFilter),s.format=g.format,s.needsUpdate=!0,r&&r(s))})},d=0,p=e.length;d<p;++d)c(d);else l.load(e,function(v){var m=a._parser(v,!0);if(m.isCubemap)for(var g=m.mipmaps.length/m.mipmapCount,x=0;x<g;x++){o[x]={mipmaps:[]};for(var w=0;w<m.mipmapCount;w++)o[x].mipmaps.push(m.mipmaps[x*m.mipmapCount+w]),o[x].format=m.format,o[x].width=m.width,o[x].height=m.height}else s.image.width=m.width,s.image.height=m.height,s.mipmaps=m.mipmaps;m.mipmapCount===1&&(s.minFilter=t.LinearFilter),s.format=m.format,s.needsUpdate=!0,r&&r(s)});return s}},t.Material=function(){Object.defineProperty(this,"id",{value:t.MaterialIdCount++}),this.uuid=t.Math.generateUUID(),this.name="",this.type="Material",this.side=t.FrontSide,this.opacity=1,this.transparent=!1,this.blending=t.NormalBlending,this.blendSrc=t.SrcAlphaFactor,this.blendDst=t.OneMinusSrcAlphaFactor,this.blendEquation=t.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},t.Material.prototype={constructor:t.Material,setValues:function(e){if(e!==void 0)for(var r in e){var n=e[r];if(n===void 0){console.warn("THREE.Material: '"+r+"' parameter is undefined.");continue}if(r in this){var a=this[r];a instanceof t.Color?a.set(n):a instanceof t.Vector3&&n instanceof t.Vector3?a.copy(n):r=="overdraw"?this[r]=Number(n):this[r]=n}}},toJSON:function(){var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};return this.name!==""&&(e.name=this.name),this instanceof t.MeshBasicMaterial?(e.color=this.color.getHex(),this.vertexColors!==t.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.MeshLambertMaterial?(e.color=this.color.getHex(),e.ambient=this.ambient.getHex(),e.emissive=this.emissive.getHex(),this.vertexColors!==t.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.MeshPhongMaterial?(e.color=this.color.getHex(),e.ambient=this.ambient.getHex(),e.emissive=this.emissive.getHex(),e.specular=this.specular.getHex(),e.shininess=this.shininess,this.vertexColors!==t.NoColors&&(e.vertexColors=this.vertexColors),this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.MeshNormalMaterial?(this.shading!==t.FlatShading&&(e.shading=this.shading),this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.MeshDepthMaterial?(this.blending!==t.NormalBlending&&(e.blending=this.blending),this.side!==t.FrontSide&&(e.side=this.side)):this instanceof t.ShaderMaterial?(e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader):this instanceof t.SpriteMaterial&&(e.color=this.color.getHex()),this.opacity<1&&(e.opacity=this.opacity),this.transparent!==!1&&(e.transparent=this.transparent),this.wireframe!==!1&&(e.wireframe=this.wireframe),e},clone:function(e){return e===void 0&&(e=new t.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},t.EventDispatcher.prototype.apply(t.Material.prototype),t.MaterialIdCount=0,t.LineBasicMaterial=function(e){t.Material.call(this),this.type="LineBasicMaterial",this.color=new t.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=t.NoColors,this.fog=!0,this.setValues(e)},t.LineBasicMaterial.prototype=Object.create(t.Material.prototype),t.LineBasicMaterial.prototype.clone=function(){var e=new t.LineBasicMaterial;return t.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},t.LineDashedMaterial=function(e){t.Material.call(this),this.type="LineDashedMaterial",this.color=new t.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},t.LineDashedMaterial.prototype=Object.create(t.Material.prototype),t.LineDashedMaterial.prototype.clone=function(){var e=new t.LineDashedMaterial;return t.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},t.MeshBasicMaterial=function(e){t.Material.call(this),this.type="MeshBasicMaterial",this.color=new t.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=t.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=t.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=t.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},t.MeshBasicMaterial.prototype=Object.create(t.Material.prototype),t.MeshBasicMaterial.prototype.clone=function(){var e=new t.MeshBasicMaterial;return t.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},t.MeshLambertMaterial=function(e){t.Material.call(this),this.type="MeshLambertMaterial",this.color=new t.Color(16777215),this.ambient=new t.Color(16777215),this.emissive=new t.Color(0),this.wrapAround=!1,this.wrapRGB=new t.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=t.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=t.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=t.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},t.MeshLambertMaterial.prototype=Object.create(t.Material.prototype),t.MeshLambertMaterial.prototype.clone=function(){var e=new t.MeshLambertMaterial;return t.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},t.MeshPhongMaterial=function(e){t.Material.call(this),this.type="MeshPhongMaterial",this.color=new t.Color(16777215),this.ambient=new t.Color(16777215),this.emissive=new t.Color(0),this.specular=new t.Color(1118481),this.shininess=30,this.metal=!1,this.wrapAround=!1,this.wrapRGB=new t.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new t.Vector2(1,1),this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=t.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=t.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=t.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},t.MeshPhongMaterial.prototype=Object.create(t.Material.prototype),t.MeshPhongMaterial.prototype.clone=function(){var e=new t.MeshPhongMaterial;return t.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.alphaMap=this.alphaMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},t.MeshDepthMaterial=function(e){t.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},t.MeshDepthMaterial.prototype=Object.create(t.Material.prototype),t.MeshDepthMaterial.prototype.clone=function(){var e=new t.MeshDepthMaterial;return t.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},t.MeshNormalMaterial=function(e){t.Material.call(this,e),this.type="MeshNormalMaterial",this.shading=t.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},t.MeshNormalMaterial.prototype=Object.create(t.Material.prototype),t.MeshNormalMaterial.prototype.clone=function(){var e=new t.MeshNormalMaterial;return t.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},t.MeshFaceMaterial=function(e){this.uuid=t.Math.generateUUID(),this.type="MeshFaceMaterial",this.materials=e instanceof Array?e:[]},t.MeshFaceMaterial.prototype={constructor:t.MeshFaceMaterial,toJSON:function(){for(var e={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},r=0,n=this.materials.length;r<n;r++)e.materials.push(this.materials[r].toJSON());return e},clone:function(){for(var e=new t.MeshFaceMaterial,r=0;r<this.materials.length;r++)e.materials.push(this.materials[r].clone());return e}},t.PointCloudMaterial=function(e){t.Material.call(this),this.type="PointCloudMaterial",this.color=new t.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=t.NoColors,this.fog=!0,this.setValues(e)},t.PointCloudMaterial.prototype=Object.create(t.Material.prototype),t.PointCloudMaterial.prototype.clone=function(){var e=new t.PointCloudMaterial;return t.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},t.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial."),new t.PointCloudMaterial(e)},t.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial."),new t.PointCloudMaterial(e)},t.ShaderMaterial=function(e){t.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.attributes=null,this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.shading=t.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=t.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},t.ShaderMaterial.prototype=Object.create(t.Material.prototype),t.ShaderMaterial.prototype.clone=function(){var e=new t.ShaderMaterial;return t.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=t.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},t.RawShaderMaterial=function(e){t.ShaderMaterial.call(this,e),this.type="RawShaderMaterial"},t.RawShaderMaterial.prototype=Object.create(t.ShaderMaterial.prototype),t.RawShaderMaterial.prototype.clone=function(){var e=new t.RawShaderMaterial;return t.ShaderMaterial.prototype.clone.call(this,e),e},t.SpriteMaterial=function(e){t.Material.call(this),this.type="SpriteMaterial",this.color=new t.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},t.SpriteMaterial.prototype=Object.create(t.Material.prototype),t.SpriteMaterial.prototype.clone=function(){var e=new t.SpriteMaterial;return t.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},t.Texture=function(e,r,n,a,o,s,l,h,c){Object.defineProperty(this,"id",{value:t.TextureIdCount++}),this.uuid=t.Math.generateUUID(),this.name="",this.image=e!==void 0?e:t.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=r!==void 0?r:t.Texture.DEFAULT_MAPPING,this.wrapS=n!==void 0?n:t.ClampToEdgeWrapping,this.wrapT=a!==void 0?a:t.ClampToEdgeWrapping,this.magFilter=o!==void 0?o:t.LinearFilter,this.minFilter=s!==void 0?s:t.LinearMipMapLinearFilter,this.anisotropy=c!==void 0?c:1,this.format=l!==void 0?l:t.RGBAFormat,this.type=h!==void 0?h:t.UnsignedByteType,this.offset=new t.Vector2(0,0),this.repeat=new t.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},t.Texture.DEFAULT_IMAGE=void 0,t.Texture.DEFAULT_MAPPING=new t.UVMapping,t.Texture.prototype={constructor:t.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){e===!0&&this.update(),this._needsUpdate=e},clone:function(e){return e===void 0&&(e=new t.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},t.EventDispatcher.prototype.apply(t.Texture.prototype),t.TextureIdCount=0,t.CubeTexture=function(e,r,n,a,o,s,l,h,c){t.Texture.call(this,e,r,n,a,o,s,l,h,c),this.images=e},t.CubeTexture.prototype=Object.create(t.Texture.prototype),t.CubeTexture.clone=function(e){return e===void 0&&(e=new t.CubeTexture),t.Texture.prototype.clone.call(this,e),e.images=this.images,e},t.CompressedTexture=function(e,r,n,a,o,s,l,h,c,d,p){t.Texture.call(this,null,s,l,h,c,d,a,o,p),this.image={width:r,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1},t.CompressedTexture.prototype=Object.create(t.Texture.prototype),t.CompressedTexture.prototype.clone=function(){var e=new t.CompressedTexture;return t.Texture.prototype.clone.call(this,e),e},t.DataTexture=function(e,r,n,a,o,s,l,h,c,d,p){t.Texture.call(this,null,s,l,h,c,d,a,o,p),this.image={data:e,width:r,height:n}},t.DataTexture.prototype=Object.create(t.Texture.prototype),t.DataTexture.prototype.clone=function(){var e=new t.DataTexture;return t.Texture.prototype.clone.call(this,e),e},t.VideoTexture=function(e,r,n,a,o,s,l,h,c){t.Texture.call(this,e,r,n,a,o,s,l,h,c),this.generateMipmaps=!1;var d=this,p=function(){requestAnimationFrame(p),e.readyState===e.HAVE_ENOUGH_DATA&&(d.needsUpdate=!0)};p()},t.VideoTexture.prototype=Object.create(t.Texture.prototype),t.Group=function(){t.Object3D.call(this),this.type="Group"},t.Group.prototype=Object.create(t.Object3D.prototype),t.PointCloud=function(e,r){t.Object3D.call(this),this.type="PointCloud",this.geometry=e!==void 0?e:new t.Geometry,this.material=r!==void 0?r:new t.PointCloudMaterial({color:Math.random()*16777215}),this.sortParticles=!1},t.PointCloud.prototype=Object.create(t.Object3D.prototype),t.PointCloud.prototype.raycast=function(){var e=new t.Matrix4,r=new t.Ray;return function(n,a){var o=this,s=o.geometry,l=n.params.PointCloud.threshold;if(e.getInverse(this.matrixWorld),r.copy(n.ray).applyMatrix4(e),!(s.boundingBox!==null&&r.isIntersectionBox(s.boundingBox)===!1)){var h=l/((this.scale.x+this.scale.y+this.scale.z)/3),c=new t.Vector3,d=function(V,U){var z=r.distanceToPoint(V);if(z<h){var I=r.closestPointToPoint(V);I.applyMatrix4(o.matrixWorld);var Y=n.ray.origin.distanceTo(I);a.push({distance:Y,distanceToRay:z,point:I.clone(),index:U,face:null,object:o})}};if(s instanceof t.BufferGeometry){var p=s.attributes,v=p.position.array;if(p.index!==void 0){var m=p.index.array,g=s.offsets;if(g.length===0){var x={start:0,count:m.length,index:0};g=[x]}for(var w=0,_=g.length;w<_;++w)for(var b=g[w].start,A=g[w].count,E=g[w].index,M=b,F=b+A;M<F;M++){var D=E+m[M];c.fromArray(v,D*3),d(c,D)}}else for(var R=v.length/3,M=0;M<R;M++)c.set(v[3*M],v[3*M+1],v[3*M+2]),d(c,M)}else for(var B=this.geometry.vertices,M=0;M<B.length;M++)d(B[M],M)}}}(),t.PointCloud.prototype.clone=function(e){return e===void 0&&(e=new t.PointCloud(this.geometry,this.material)),e.sortParticles=this.sortParticles,t.Object3D.prototype.clone.call(this,e),e},t.ParticleSystem=function(e,r){return console.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud."),new t.PointCloud(e,r)},t.Line=function(e,r,n){t.Object3D.call(this),this.type="Line",this.geometry=e!==void 0?e:new t.Geometry,this.material=r!==void 0?r:new t.LineBasicMaterial({color:Math.random()*16777215}),this.mode=n!==void 0?n:t.LineStrip},t.LineStrip=0,t.LinePieces=1,t.Line.prototype=Object.create(t.Object3D.prototype),t.Line.prototype.raycast=function(){var e=new t.Matrix4,r=new t.Ray,n=new t.Sphere;return function(a,o){var s=a.linePrecision,l=s*s,h=this.geometry;if(h.boundingSphere===null&&h.computeBoundingSphere(),n.copy(h.boundingSphere),n.applyMatrix4(this.matrixWorld),a.ray.isIntersectionSphere(n)!==!1&&(e.getInverse(this.matrixWorld),r.copy(a.ray).applyMatrix4(e),h instanceof t.Geometry))for(var c=h.vertices,d=c.length,p=new t.Vector3,v=new t.Vector3,m=this.mode===t.LineStrip?1:2,g=0;g<d-1;g=g+m){var x=r.distanceSqToSegment(c[g],c[g+1],v,p);if(!(x>l)){var w=r.origin.distanceTo(v);w<a.near||w>a.far||o.push({distance:w,point:p.clone().applyMatrix4(this.matrixWorld),face:null,faceIndex:null,object:this})}}}}(),t.Line.prototype.clone=function(e){return e===void 0&&(e=new t.Line(this.geometry,this.material,this.mode)),t.Object3D.prototype.clone.call(this,e),e},t.Mesh=function(e,r){t.Object3D.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new t.Geometry,this.material=r!==void 0?r:new t.MeshBasicMaterial({color:Math.random()*16777215}),this.updateMorphTargets()},t.Mesh.prototype=Object.create(t.Object3D.prototype),t.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==void 0&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,r=this.geometry.morphTargets.length;e<r;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},t.Mesh.prototype.getMorphTargetIndexByName=function(e){return this.morphTargetDictionary[e]!==void 0?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},t.Mesh.prototype.raycast=function(){var e=new t.Matrix4,r=new t.Ray,n=new t.Sphere,a=new t.Vector3,o=new t.Vector3,s=new t.Vector3;return function(l,h){var c=this.geometry;if(c.boundingSphere===null&&c.computeBoundingSphere(),n.copy(c.boundingSphere),n.applyMatrix4(this.matrixWorld),l.ray.isIntersectionSphere(n)!==!1&&(e.getInverse(this.matrixWorld),r.copy(l.ray).applyMatrix4(e),!(c.boundingBox!==null&&r.isIntersectionBox(c.boundingBox)===!1))){if(c instanceof t.BufferGeometry){var d=this.material;if(d===void 0)return;var p=c.attributes,v,m,g,x=l.precision;if(p.index!==void 0){var w=p.index.array,_=p.position.array,b=c.offsets;b.length===0&&(b=[{start:0,count:w.length,index:0}]);for(var A=0,E=b.length;A<E;++A)for(var M=b[A].start,F=b[A].count,D=b[A].index,R=M,B=M+F;R<B;R+=3){if(v=D+w[R],m=D+w[R+1],g=D+w[R+2],a.fromArray(_,v*3),o.fromArray(_,m*3),s.fromArray(_,g*3),d.side===t.BackSide)var V=r.intersectTriangle(s,o,a,!0);else var V=r.intersectTriangle(a,o,s,d.side!==t.DoubleSide);if(V!==null){V.applyMatrix4(this.matrixWorld);var U=l.ray.origin.distanceTo(V);U<x||U<l.near||U>l.far||h.push({distance:U,point:V,face:new t.Face3(v,m,g,t.Triangle.normal(a,o,s)),faceIndex:null,object:this})}}}else for(var _=p.position.array,R=0,z=0,B=_.length;R<B;R+=3,z+=9){if(v=R,m=R+1,g=R+2,a.fromArray(_,z),o.fromArray(_,z+3),s.fromArray(_,z+6),d.side===t.BackSide)var V=r.intersectTriangle(s,o,a,!0);else var V=r.intersectTriangle(a,o,s,d.side!==t.DoubleSide);if(V!==null){V.applyMatrix4(this.matrixWorld);var U=l.ray.origin.distanceTo(V);U<x||U<l.near||U>l.far||h.push({distance:U,point:V,face:new t.Face3(v,m,g,t.Triangle.normal(a,o,s)),faceIndex:null,object:this})}}}else if(c instanceof t.Geometry)for(var I=this.material instanceof t.MeshFaceMaterial,Y=I===!0?this.material.materials:null,v,m,g,x=l.precision,H=c.vertices,q=0,ee=c.faces.length;q<ee;q++){var G=c.faces[q],d=I===!0?Y[G.materialIndex]:this.material;if(d!==void 0){if(v=H[G.a],m=H[G.b],g=H[G.c],d.morphTargets===!0){var $=c.morphTargets,J=this.morphTargetInfluences;a.set(0,0,0),o.set(0,0,0),s.set(0,0,0);for(var X=0,K=$.length;X<K;X++){var ne=J[X];if(ne!==0){var re=$[X].vertices;a.x+=(re[G.a].x-v.x)*ne,a.y+=(re[G.a].y-v.y)*ne,a.z+=(re[G.a].z-v.z)*ne,o.x+=(re[G.b].x-m.x)*ne,o.y+=(re[G.b].y-m.y)*ne,o.z+=(re[G.b].z-m.z)*ne,s.x+=(re[G.c].x-g.x)*ne,s.y+=(re[G.c].y-g.y)*ne,s.z+=(re[G.c].z-g.z)*ne}}a.add(v),o.add(m),s.add(g),v=a,m=o,g=s}if(d.side===t.BackSide)var V=r.intersectTriangle(g,m,v,!0);else var V=r.intersectTriangle(v,m,g,d.side!==t.DoubleSide);if(V!==null){V.applyMatrix4(this.matrixWorld);var U=l.ray.origin.distanceTo(V);U<x||U<l.near||U>l.far||h.push({distance:U,point:V,face:G,faceIndex:q,object:this})}}}}}}(),t.Mesh.prototype.clone=function(e,r){return e===void 0&&(e=new t.Mesh(this.geometry,this.material)),t.Object3D.prototype.clone.call(this,e,r),e},t.Bone=function(e){t.Object3D.call(this),this.skin=e},t.Bone.prototype=Object.create(t.Object3D.prototype),t.Skeleton=function(e,r,n){if(this.useVertexTexture=n!==void 0?n:!0,this.identityMatrix=new t.Matrix4,e=e||[],this.bones=e.slice(0),this.useVertexTexture){var a;this.bones.length>256?a=64:this.bones.length>64?a=32:this.bones.length>16?a=16:a=8,this.boneTextureWidth=a,this.boneTextureHeight=a,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new t.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,t.RGBAFormat,t.FloatType),this.boneTexture.minFilter=t.NearestFilter,this.boneTexture.magFilter=t.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*this.bones.length);if(r===void 0)this.calculateInverses();else if(this.bones.length===r.length)this.boneInverses=r.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var o=0,s=this.bones.length;o<s;o++)this.boneInverses.push(new t.Matrix4)}},t.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var e=0,r=this.bones.length;e<r;e++){var n=new t.Matrix4;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},t.Skeleton.prototype.pose=function(){for(var e,r=0,n=this.bones.length;r<n;r++)e=this.bones[r],e&&e.matrixWorld.getInverse(this.boneInverses[r]);for(var r=0,n=this.bones.length;r<n;r++)e=this.bones[r],e&&(e.parent?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},t.Skeleton.prototype.update=function(){var e=new t.Matrix4;return function(){for(var r=0,n=this.bones.length;r<n;r++){var a=this.bones[r]?this.bones[r].matrixWorld:this.identityMatrix;e.multiplyMatrices(a,this.boneInverses[r]),e.flattenToArrayOffset(this.boneMatrices,r*16)}this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),t.SkinnedMesh=function(e,r,n){t.Mesh.call(this,e,r),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new t.Matrix4,this.bindMatrixInverse=new t.Matrix4;var a=[];if(this.geometry&&this.geometry.bones!==void 0){for(var o,s,l,h,c,d=0,p=this.geometry.bones.length;d<p;++d)s=this.geometry.bones[d],l=s.pos,h=s.rotq,c=s.scl,o=new t.Bone(this),a.push(o),o.name=s.name,o.position.set(l[0],l[1],l[2]),o.quaternion.set(h[0],h[1],h[2],h[3]),c!==void 0?o.scale.set(c[0],c[1],c[2]):o.scale.set(1,1,1);for(var d=0,p=this.geometry.bones.length;d<p;++d)s=this.geometry.bones[d],s.parent!==-1?a[s.parent].add(a[d]):this.add(a[d])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new t.Skeleton(a,void 0,n))},t.SkinnedMesh.prototype=Object.create(t.Mesh.prototype),t.SkinnedMesh.prototype.bind=function(e,r){this.skeleton=e,r===void 0&&(this.updateMatrixWorld(!0),r=this.matrixWorld),this.bindMatrix.copy(r),this.bindMatrixInverse.getInverse(r)},t.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},t.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof t.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var r=this.geometry.skinWeights[e],n=1/r.lengthManhattan();n!==1/0?r.multiplyScalar(n):r.set(1)}},t.SkinnedMesh.prototype.updateMatrixWorld=function(e){t.Mesh.prototype.updateMatrixWorld.call(this,!0),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)},t.SkinnedMesh.prototype.clone=function(e){return e===void 0&&(e=new t.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),t.Mesh.prototype.clone.call(this,e),e},t.MorphAnimMesh=function(e,r){t.Mesh.call(this,e,r),this.type="MorphAnimMesh",this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},t.MorphAnimMesh.prototype=Object.create(t.Mesh.prototype),t.MorphAnimMesh.prototype.setFrameRange=function(e,r){this.startKeyframe=e,this.endKeyframe=r,this.length=this.endKeyframe-this.startKeyframe+1},t.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},t.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},t.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var r,n=e.animations,a=/([a-z]+)_?(\d+)/,o=0,s=e.morphTargets.length;o<s;o++){var l=e.morphTargets[o],h=l.name.match(a);if(h&&h.length>1){var c=h[1];h[2],n[c]||(n[c]={start:1/0,end:-1/0});var d=n[c];o<d.start&&(d.start=o),o>d.end&&(d.end=o),r||(r=c)}}e.firstAnimation=r},t.MorphAnimMesh.prototype.setAnimationLabel=function(e,r,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:r,end:n}},t.MorphAnimMesh.prototype.playAnimation=function(e,r){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=1e3*((n.end-n.start)/r),this.time=0):console.warn("animation["+e+"] undefined")},t.MorphAnimMesh.prototype.updateAnimation=function(e){var r=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var n=this.startKeyframe+t.Math.clamp(Math.floor(this.time/r),0,this.length-1);n!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[n]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=n);var a=this.time%r/r;this.directionBackwards&&(a=1-a),this.morphTargetInfluences[this.currentKeyframe]=a,this.morphTargetInfluences[this.lastKeyframe]=1-a},t.MorphAnimMesh.prototype.interpolateTargets=function(e,r,n){for(var a=this.morphTargetInfluences,o=0,s=a.length;o<s;o++)a[o]=0;e>-1&&(a[e]=1-n),r>-1&&(a[r]=n)},t.MorphAnimMesh.prototype.clone=function(e){return e===void 0&&(e=new t.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,t.Mesh.prototype.clone.call(this,e),e},t.LOD=function(){t.Object3D.call(this),this.objects=[]},t.LOD.prototype=Object.create(t.Object3D.prototype),t.LOD.prototype.addLevel=function(e,r){r===void 0&&(r=0),r=Math.abs(r);for(var n=0;n<this.objects.length&&!(r<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:r,object:e}),this.add(e)},t.LOD.prototype.getObjectForDistance=function(e){for(var r=1,n=this.objects.length;r<n&&!(e<this.objects[r].distance);r++);return this.objects[r-1].object},t.LOD.prototype.raycast=function(){var e=new t.Vector3;return function(r,n){e.setFromMatrixPosition(this.matrixWorld);var a=r.ray.origin.distanceTo(e);this.getObjectForDistance(a).raycast(r,n)}}(),t.LOD.prototype.update=function(){var e=new t.Vector3,r=new t.Vector3;return function(n){if(this.objects.length>1){e.setFromMatrixPosition(n.matrixWorld),r.setFromMatrixPosition(this.matrixWorld);var a=e.distanceTo(r);this.objects[0].object.visible=!0;for(var o=1,s=this.objects.length;o<s&&a>=this.objects[o].distance;o++)this.objects[o-1].object.visible=!1,this.objects[o].object.visible=!0;for(;o<s;o++)this.objects[o].object.visible=!1}}}(),t.LOD.prototype.clone=function(e){e===void 0&&(e=new t.LOD),t.Object3D.prototype.clone.call(this,e);for(var r=0,n=this.objects.length;r<n;r++){var a=this.objects[r].object.clone();a.visible=r===0,e.addLevel(a,this.objects[r].distance)}return e},t.Sprite=function(){var e=new Uint16Array([0,1,2,0,2,3]),r=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),n=new Float32Array([0,0,1,0,1,1,0,1]),a=new t.BufferGeometry;return a.addAttribute("index",new t.BufferAttribute(e,1)),a.addAttribute("position",new t.BufferAttribute(r,3)),a.addAttribute("uv",new t.BufferAttribute(n,2)),function(o){t.Object3D.call(this),this.type="Sprite",this.geometry=a,this.material=o!==void 0?o:new t.SpriteMaterial}}(),t.Sprite.prototype=Object.create(t.Object3D.prototype),t.Sprite.prototype.raycast=function(){var e=new t.Vector3;return function(r,n){e.setFromMatrixPosition(this.matrixWorld);var a=r.ray.distanceToPoint(e);a>this.scale.x||n.push({distance:a,point:this.position,face:null,object:this})}}(),t.Sprite.prototype.clone=function(e){return e===void 0&&(e=new t.Sprite(this.material)),t.Object3D.prototype.clone.call(this,e),e},t.Particle=t.Sprite,t.LensFlare=function(e,r,n,a,o){t.Object3D.call(this),this.lensFlares=[],this.positionScreen=new t.Vector3,this.customUpdateCallback=void 0,e!==void 0&&this.add(e,r,n,a,o)},t.LensFlare.prototype=Object.create(t.Object3D.prototype),t.LensFlare.prototype.add=function(e,r,n,a,o,s){r===void 0&&(r=-1),n===void 0&&(n=0),s===void 0&&(s=1),o===void 0&&(o=new t.Color(16777215)),a===void 0&&(a=t.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:r,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:o,blending:a})},t.LensFlare.prototype.updateLensFlares=function(){var e,r=this.lensFlares.length,n,a=-this.positionScreen.x*2,o=-this.positionScreen.y*2;for(e=0;e<r;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+a*n.distance,n.y=this.positionScreen.y+o*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation+=(n.wantedRotation-n.rotation)*.25},t.Scene=function(){t.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},t.Scene.prototype=Object.create(t.Object3D.prototype),t.Scene.prototype.clone=function(e){return e===void 0&&(e=new t.Scene),t.Object3D.prototype.clone.call(this,e),this.fog!==null&&(e.fog=this.fog.clone()),this.overrideMaterial!==null&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},t.Fog=function(e,r,n){this.name="",this.color=new t.Color(e),this.near=r!==void 0?r:1,this.far=n!==void 0?n:1e3},t.Fog.prototype.clone=function(){return new t.Fog(this.color.getHex(),this.near,this.far)},t.FogExp2=function(e,r){this.name="",this.color=new t.Color(e),this.density=r!==void 0?r:25e-5},t.FogExp2.prototype.clone=function(){return new t.FogExp2(this.color.getHex(),this.density)},t.ShaderChunk={},t.ShaderChunk.alphatest_fragment=`#ifdef ALPHATEST

	if ( gl_FragColor.a < ALPHATEST ) discard;

#endif
`,t.ShaderChunk.lights_lambert_vertex=`vLightFront = vec3( 0.0 );

#ifdef DOUBLE_SIDED

	vLightBack = vec3( 0.0 );

#endif

transformedNormal = normalize( transformedNormal );

#if MAX_DIR_LIGHTS > 0

for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {

	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );
	vec3 dirVector = normalize( lDirection.xyz );

	float dotProduct = dot( transformedNormal, dirVector );
	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

	#ifdef DOUBLE_SIDED

		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

		#ifdef WRAP_AROUND

			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );

		#endif

	#endif

	#ifdef WRAP_AROUND

		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );
		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );

		#ifdef DOUBLE_SIDED

			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );

		#endif

	#endif

	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;

	#ifdef DOUBLE_SIDED

		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;

	#endif

}

#endif

#if MAX_POINT_LIGHTS > 0

	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {

		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );
		vec3 lVector = lPosition.xyz - mvPosition.xyz;

		float lDistance = 1.0;
		if ( pointLightDistance[ i ] > 0.0 )
			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );

		lVector = normalize( lVector );
		float dotProduct = dot( transformedNormal, lVector );

		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );

		#ifdef DOUBLE_SIDED

			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

			#ifdef WRAP_AROUND

				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );

			#endif

		#endif

		#ifdef WRAP_AROUND

			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );
			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );

			#ifdef DOUBLE_SIDED

				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );

			#endif

		#endif

		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;

		#ifdef DOUBLE_SIDED

			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;

		#endif

	}

#endif

#if MAX_SPOT_LIGHTS > 0

	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {

		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );
		vec3 lVector = lPosition.xyz - mvPosition.xyz;

		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );

		if ( spotEffect > spotLightAngleCos[ i ] ) {

			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );

			float lDistance = 1.0;
			if ( spotLightDistance[ i ] > 0.0 )
				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );

			lVector = normalize( lVector );

			float dotProduct = dot( transformedNormal, lVector );
			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );

			#ifdef DOUBLE_SIDED

				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

				#ifdef WRAP_AROUND

					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );

				#endif

			#endif

			#ifdef WRAP_AROUND

				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );
				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );

				#ifdef DOUBLE_SIDED

					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );

				#endif

			#endif

			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;

			#ifdef DOUBLE_SIDED

				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;

			#endif

		}

	}

#endif

#if MAX_HEMI_LIGHTS > 0

	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {

		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );
		vec3 lVector = normalize( lDirection.xyz );

		float dotProduct = dot( transformedNormal, lVector );

		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;
		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;

		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );

		#ifdef DOUBLE_SIDED

			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );

		#endif

	}

#endif

vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;

#ifdef DOUBLE_SIDED

	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;

#endif`,t.ShaderChunk.map_particle_pars_fragment=`#ifdef USE_MAP

	uniform sampler2D map;

#endif`,t.ShaderChunk.default_vertex=`vec4 mvPosition;

#ifdef USE_SKINNING

	mvPosition = modelViewMatrix * skinned;

#endif

#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )

	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );

#endif

#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )

	mvPosition = modelViewMatrix * vec4( position, 1.0 );

#endif

gl_Position = projectionMatrix * mvPosition;`,t.ShaderChunk.map_pars_fragment=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )

	varying vec2 vUv;

#endif

#ifdef USE_MAP

	uniform sampler2D map;

#endif`,t.ShaderChunk.skinnormal_vertex=`#ifdef USE_SKINNING

	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;

	#ifdef USE_MORPHNORMALS

	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );

	#else

	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );

	#endif

#endif
`,t.ShaderChunk.logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF

	#ifdef USE_LOGDEPTHBUF_EXT

		varying float vFragDepth;

	#endif

	uniform float logDepthBufFC;

#endif`,t.ShaderChunk.lightmap_pars_vertex=`#ifdef USE_LIGHTMAP

	varying vec2 vUv2;

#endif`,t.ShaderChunk.lights_phong_fragment=`vec3 normal = normalize( vNormal );
vec3 viewPosition = normalize( vViewPosition );

#ifdef DOUBLE_SIDED

	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );

#endif

#ifdef USE_NORMALMAP

	normal = perturbNormal2Arb( -vViewPosition, normal );

#elif defined( USE_BUMPMAP )

	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );

#endif

#if MAX_POINT_LIGHTS > 0

	vec3 pointDiffuse = vec3( 0.0 );
	vec3 pointSpecular = vec3( 0.0 );

	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {

		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );
		vec3 lVector = lPosition.xyz + vViewPosition.xyz;

		float lDistance = 1.0;
		if ( pointLightDistance[ i ] > 0.0 )
			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );

		lVector = normalize( lVector );

				// diffuse

		float dotProduct = dot( normal, lVector );

		#ifdef WRAP_AROUND

			float pointDiffuseWeightFull = max( dotProduct, 0.0 );
			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );

			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );

		#else

			float pointDiffuseWeight = max( dotProduct, 0.0 );

		#endif

		pointDiffuse += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;

				// specular

		vec3 pointHalfVector = normalize( lVector + viewPosition );
		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );
		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );

		float specularNormalization = ( shininess + 2.0 ) / 8.0;

		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );
		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;

	}

#endif

#if MAX_SPOT_LIGHTS > 0

	vec3 spotDiffuse = vec3( 0.0 );
	vec3 spotSpecular = vec3( 0.0 );

	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {

		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );
		vec3 lVector = lPosition.xyz + vViewPosition.xyz;

		float lDistance = 1.0;
		if ( spotLightDistance[ i ] > 0.0 )
			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );

		lVector = normalize( lVector );

		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );

		if ( spotEffect > spotLightAngleCos[ i ] ) {

			spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );

					// diffuse

			float dotProduct = dot( normal, lVector );

			#ifdef WRAP_AROUND

				float spotDiffuseWeightFull = max( dotProduct, 0.0 );
				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );

				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );

			#else

				float spotDiffuseWeight = max( dotProduct, 0.0 );

			#endif

			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;

					// specular

			vec3 spotHalfVector = normalize( lVector + viewPosition );
			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );
			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );

			float specularNormalization = ( shininess + 2.0 ) / 8.0;

			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );
			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;

		}

	}

#endif

#if MAX_DIR_LIGHTS > 0

	vec3 dirDiffuse = vec3( 0.0 );
	vec3 dirSpecular = vec3( 0.0 );

	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {

		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );
		vec3 dirVector = normalize( lDirection.xyz );

				// diffuse

		float dotProduct = dot( normal, dirVector );

		#ifdef WRAP_AROUND

			float dirDiffuseWeightFull = max( dotProduct, 0.0 );
			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );

			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );

		#else

			float dirDiffuseWeight = max( dotProduct, 0.0 );

		#endif

		dirDiffuse += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;

		// specular

		vec3 dirHalfVector = normalize( dirVector + viewPosition );
		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );
		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );

		/*
		// fresnel term from skin shader
		const float F0 = 0.128;

		float base = 1.0 - dot( viewPosition, dirHalfVector );
		float exponential = pow( base, 5.0 );

		float fresnel = exponential + F0 * ( 1.0 - exponential );
		*/

		/*
		// fresnel term from fresnel shader
		const float mFresnelBias = 0.08;
		const float mFresnelScale = 0.3;
		const float mFresnelPower = 5.0;

		float fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );
		*/

		float specularNormalization = ( shininess + 2.0 ) / 8.0;

		// 		dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;

		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );
		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;


	}

#endif

#if MAX_HEMI_LIGHTS > 0

	vec3 hemiDiffuse = vec3( 0.0 );
	vec3 hemiSpecular = vec3( 0.0 );

	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {

		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );
		vec3 lVector = normalize( lDirection.xyz );

		// diffuse

		float dotProduct = dot( normal, lVector );
		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;

		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );

		hemiDiffuse += diffuse * hemiColor;

		// specular (sky light)

		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );
		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;
		float hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );

		// specular (ground light)

		vec3 lVectorGround = -lVector;

		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );
		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;
		float hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );

		float dotProductGround = dot( normal, lVectorGround );

		float specularNormalization = ( shininess + 2.0 ) / 8.0;

		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );
		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );
		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );

	}

#endif

vec3 totalDiffuse = vec3( 0.0 );
vec3 totalSpecular = vec3( 0.0 );

#if MAX_DIR_LIGHTS > 0

	totalDiffuse += dirDiffuse;
	totalSpecular += dirSpecular;

#endif

#if MAX_HEMI_LIGHTS > 0

	totalDiffuse += hemiDiffuse;
	totalSpecular += hemiSpecular;

#endif

#if MAX_POINT_LIGHTS > 0

	totalDiffuse += pointDiffuse;
	totalSpecular += pointSpecular;

#endif

#if MAX_SPOT_LIGHTS > 0

	totalDiffuse += spotDiffuse;
	totalSpecular += spotSpecular;

#endif

#ifdef METAL

	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );

#else

	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;

#endif`,t.ShaderChunk.fog_pars_fragment=`#ifdef USE_FOG

	uniform vec3 fogColor;

	#ifdef FOG_EXP2

		uniform float fogDensity;

	#else

		uniform float fogNear;
		uniform float fogFar;
	#endif

#endif`,t.ShaderChunk.morphnormal_vertex=`#ifdef USE_MORPHNORMALS

	vec3 morphedNormal = vec3( 0.0 );

	morphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];
	morphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];
	morphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];
	morphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];

	morphedNormal += normal;

#endif`,t.ShaderChunk.envmap_pars_fragment=`#ifdef USE_ENVMAP

	uniform float reflectivity;
	uniform samplerCube envMap;
	uniform float flipEnvMap;
	uniform int combine;

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )

		uniform bool useRefract;
		uniform float refractionRatio;

	#else

		varying vec3 vReflect;

	#endif

#endif`,t.ShaderChunk.logdepthbuf_fragment=`#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)

	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;

#endif`,t.ShaderChunk.normalmap_pars_fragment=`#ifdef USE_NORMALMAP

	uniform sampler2D normalMap;
	uniform vec2 normalScale;

			// Per-Pixel Tangent Space Normal Mapping
			// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html

	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {

		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );

		vec3 S = normalize( q0 * st1.t - q1 * st0.t );
		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );
		vec3 N = normalize( surf_norm );

		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
		mapN.xy = normalScale * mapN.xy;
		mat3 tsn = mat3( S, T, N );
		return normalize( tsn * mapN );

	}

#endif
`,t.ShaderChunk.lights_phong_pars_vertex=`#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )

	varying vec3 vWorldPosition;

#endif
`,t.ShaderChunk.lightmap_pars_fragment=`#ifdef USE_LIGHTMAP

	varying vec2 vUv2;
	uniform sampler2D lightMap;

#endif`,t.ShaderChunk.shadowmap_vertex=`#ifdef USE_SHADOWMAP

	for( int i = 0; i < MAX_SHADOWS; i ++ ) {

		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;

	}

#endif`,t.ShaderChunk.lights_phong_vertex=`#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )

	vWorldPosition = worldPosition.xyz;

#endif`,t.ShaderChunk.map_fragment=`#ifdef USE_MAP

	vec4 texelColor = texture2D( map, vUv );

	#ifdef GAMMA_INPUT

		texelColor.xyz *= texelColor.xyz;

	#endif

	gl_FragColor = gl_FragColor * texelColor;

#endif`,t.ShaderChunk.lightmap_vertex=`#ifdef USE_LIGHTMAP

	vUv2 = uv2;

#endif`,t.ShaderChunk.map_particle_fragment=`#ifdef USE_MAP

	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );

#endif`,t.ShaderChunk.color_pars_fragment=`#ifdef USE_COLOR

	varying vec3 vColor;

#endif
`,t.ShaderChunk.color_vertex=`#ifdef USE_COLOR

	#ifdef GAMMA_INPUT

		vColor = color * color;

	#else

		vColor = color;

	#endif

#endif`,t.ShaderChunk.skinning_vertex=`#ifdef USE_SKINNING

	#ifdef USE_MORPHTARGETS

	vec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );

	#else

	vec4 skinVertex = bindMatrix * vec4( position, 1.0 );

	#endif

	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	skinned  = bindMatrixInverse * skinned;

#endif
`,t.ShaderChunk.envmap_pars_vertex=`#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )

	varying vec3 vReflect;

	uniform float refractionRatio;
	uniform bool useRefract;

#endif
`,t.ShaderChunk.linear_to_gamma_fragment=`#ifdef GAMMA_OUTPUT

	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );

#endif`,t.ShaderChunk.color_pars_vertex=`#ifdef USE_COLOR

	varying vec3 vColor;

#endif`,t.ShaderChunk.lights_lambert_pars_vertex=`uniform vec3 ambient;
uniform vec3 diffuse;
uniform vec3 emissive;

uniform vec3 ambientLightColor;

#if MAX_DIR_LIGHTS > 0

	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];
	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];

#endif

#if MAX_HEMI_LIGHTS > 0

	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];
	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];
	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];

#endif

#if MAX_POINT_LIGHTS > 0

	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];
	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];
	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];

#endif

#if MAX_SPOT_LIGHTS > 0

	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];
	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];
	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];
	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];
	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];
	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];

#endif

#ifdef WRAP_AROUND

	uniform vec3 wrapRGB;

#endif
`,t.ShaderChunk.map_pars_vertex=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )

	varying vec2 vUv;
	uniform vec4 offsetRepeat;

#endif
`,t.ShaderChunk.envmap_fragment=`#ifdef USE_ENVMAP

	vec3 reflectVec;

	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )

		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );

		// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations
		// Transforming Normal Vectors with the Inverse Transformation

		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );

		if ( useRefract ) {

			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );

		} else { 

			reflectVec = reflect( cameraToVertex, worldNormal );

		}

	#else

		reflectVec = vReflect;

	#endif

	#ifdef DOUBLE_SIDED

		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );
		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );

	#else

		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );

	#endif

	#ifdef GAMMA_INPUT

		cubeColor.xyz *= cubeColor.xyz;

	#endif

	if ( combine == 1 ) {

		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );

	} else if ( combine == 2 ) {

		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;

	} else {

		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );

	}

#endif`,t.ShaderChunk.specularmap_pars_fragment=`#ifdef USE_SPECULARMAP

	uniform sampler2D specularMap;

#endif`,t.ShaderChunk.logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF

	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;

	#ifdef USE_LOGDEPTHBUF_EXT

		vFragDepth = 1.0 + gl_Position.w;

#else

		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;

	#endif

#endif`,t.ShaderChunk.morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS

	#ifndef USE_MORPHNORMALS

	uniform float morphTargetInfluences[ 8 ];

	#else

	uniform float morphTargetInfluences[ 4 ];

	#endif

#endif`,t.ShaderChunk.specularmap_fragment=`float specularStrength;

#ifdef USE_SPECULARMAP

	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;

#else

	specularStrength = 1.0;

#endif`,t.ShaderChunk.fog_fragment=`#ifdef USE_FOG

	#ifdef USE_LOGDEPTHBUF_EXT

		float depth = gl_FragDepthEXT / gl_FragCoord.w;

	#else

		float depth = gl_FragCoord.z / gl_FragCoord.w;

	#endif

	#ifdef FOG_EXP2

		const float LOG2 = 1.442695;
		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );
		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );

	#else

		float fogFactor = smoothstep( fogNear, fogFar, depth );

	#endif
	
	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

#endif`,t.ShaderChunk.bumpmap_pars_fragment=`#ifdef USE_BUMPMAP

	uniform sampler2D bumpMap;
	uniform float bumpScale;

			// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen
			//	http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html

			// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

	vec2 dHdxy_fwd() {

		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );

		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;

		return vec2( dBx, dBy );

	}

	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {

		vec3 vSigmaX = dFdx( surf_pos );
		vec3 vSigmaY = dFdy( surf_pos );
		vec3 vN = surf_norm;		// normalized

		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );

		float fDet = dot( vSigmaX, R1 );

		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );

	}

#endif`,t.ShaderChunk.defaultnormal_vertex=`vec3 objectNormal;

#ifdef USE_SKINNING

	objectNormal = skinnedNormal.xyz;

#endif

#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )

	objectNormal = morphedNormal;

#endif

#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )

	objectNormal = normal;

#endif

#ifdef FLIP_SIDED

	objectNormal = -objectNormal;

#endif

vec3 transformedNormal = normalMatrix * objectNormal;`,t.ShaderChunk.lights_phong_pars_fragment=`uniform vec3 ambientLightColor;

#if MAX_DIR_LIGHTS > 0

	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];
	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];

#endif

#if MAX_HEMI_LIGHTS > 0

	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];
	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];
	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];

#endif

#if MAX_POINT_LIGHTS > 0

	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];

	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];
	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];

#endif

#if MAX_SPOT_LIGHTS > 0

	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];
	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];
	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];
	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];
	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];

	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];

#endif

#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )

	varying vec3 vWorldPosition;

#endif

#ifdef WRAP_AROUND

	uniform vec3 wrapRGB;

#endif

varying vec3 vViewPosition;
varying vec3 vNormal;`,t.ShaderChunk.skinbase_vertex=`#ifdef USE_SKINNING

	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );

#endif`,t.ShaderChunk.map_vertex=`#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )

	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;

#endif`,t.ShaderChunk.lightmap_fragment=`#ifdef USE_LIGHTMAP

	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );

#endif`,t.ShaderChunk.shadowmap_pars_vertex=`#ifdef USE_SHADOWMAP

	varying vec4 vShadowCoord[ MAX_SHADOWS ];
	uniform mat4 shadowMatrix[ MAX_SHADOWS ];

#endif`,t.ShaderChunk.color_fragment=`#ifdef USE_COLOR

	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );

#endif`,t.ShaderChunk.morphtarget_vertex=`#ifdef USE_MORPHTARGETS

	vec3 morphed = vec3( 0.0 );
	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];
	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];
	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];
	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];

	#ifndef USE_MORPHNORMALS

	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];
	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];
	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];
	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];

	#endif

	morphed += position;

#endif`,t.ShaderChunk.envmap_vertex=`#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )

	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;
	worldNormal = normalize( worldNormal );

	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );

	if ( useRefract ) {

		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );

	} else {

		vReflect = reflect( cameraToVertex, worldNormal );

	}

#endif`,t.ShaderChunk.shadowmap_fragment=`#ifdef USE_SHADOWMAP

	#ifdef SHADOWMAP_DEBUG

		vec3 frustumColors[3];
		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );
		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );
		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );

	#endif

	#ifdef SHADOWMAP_CASCADE

		int inFrustumCount = 0;

	#endif

	float fDepth;
	vec3 shadowColor = vec3( 1.0 );

	for( int i = 0; i < MAX_SHADOWS; i ++ ) {

		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;

				// if ( something && something ) breaks ATI OpenGL shader compiler
				// if ( all( something, something ) ) using this instead

		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );

				// don't shadow pixels outside of light frustum
				// use just first frustum (for cascades)
				// don't shadow pixels behind far plane of light frustum

		#ifdef SHADOWMAP_CASCADE

			inFrustumCount += int( inFrustum );
			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );

		#else

			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

		#endif

		bool frustumTest = all( frustumTestVec );

		if ( frustumTest ) {

			shadowCoord.z += shadowBias[ i ];

			#if defined( SHADOWMAP_TYPE_PCF )

						// Percentage-close filtering
						// (9 pixel kernel)
						// http://fabiensanglard.net/shadowmappingPCF/

				float shadow = 0.0;

		/*
						// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL
						// must enroll loop manually

				for ( float y = -1.25; y <= 1.25; y += 1.25 )
					for ( float x = -1.25; x <= 1.25; x += 1.25 ) {

						vec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );

								// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup
								//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );

						float fDepth = unpackDepth( rgbaDepth );

						if ( fDepth < shadowCoord.z )
							shadow += 1.0;

				}

				shadow /= 9.0;

		*/

				const float shadowDelta = 1.0 / 9.0;

				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;
				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;

				float dx0 = -1.25 * xPixelOffset;
				float dy0 = -1.25 * yPixelOffset;
				float dx1 = 1.25 * xPixelOffset;
				float dy1 = 1.25 * yPixelOffset;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );
				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;

				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );

			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )

						// Percentage-close filtering
						// (9 pixel kernel)
						// http://fabiensanglard.net/shadowmappingPCF/

				float shadow = 0.0;

				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;
				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;

				float dx0 = -1.0 * xPixelOffset;
				float dy0 = -1.0 * yPixelOffset;
				float dx1 = 1.0 * xPixelOffset;
				float dy1 = 1.0 * yPixelOffset;

				mat3 shadowKernel;
				mat3 depthKernel;

				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );
				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );
				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );
				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );
				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );
				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );
				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );
				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );
				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );

				vec3 shadowZ = vec3( shadowCoord.z );
				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));
				shadowKernel[0] *= vec3(0.25);

				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));
				shadowKernel[1] *= vec3(0.25);

				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));
				shadowKernel[2] *= vec3(0.25);

				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );

				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );
				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );

				vec4 shadowValues;
				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );
				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );
				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );
				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );

				shadow = dot( shadowValues, vec4( 1.0 ) );

				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );

			#else

				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );
				float fDepth = unpackDepth( rgbaDepth );

				if ( fDepth < shadowCoord.z )

		// spot with multiple shadows is darker

					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );

		// spot with multiple shadows has the same color as single shadow spot

		// 					shadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );

			#endif

		}


		#ifdef SHADOWMAP_DEBUG

			#ifdef SHADOWMAP_CASCADE

				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];

			#else

				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];

			#endif

		#endif

	}

	#ifdef GAMMA_OUTPUT

		shadowColor *= shadowColor;

	#endif

	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;

#endif
`,t.ShaderChunk.worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )

	#ifdef USE_SKINNING

		vec4 worldPosition = modelMatrix * skinned;

	#endif

	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )

		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );

	#endif

	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )

		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );

	#endif

#endif`,t.ShaderChunk.shadowmap_pars_fragment=`#ifdef USE_SHADOWMAP

	uniform sampler2D shadowMap[ MAX_SHADOWS ];
	uniform vec2 shadowMapSize[ MAX_SHADOWS ];

	uniform float shadowDarkness[ MAX_SHADOWS ];
	uniform float shadowBias[ MAX_SHADOWS ];

	varying vec4 vShadowCoord[ MAX_SHADOWS ];

	float unpackDepth( const in vec4 rgba_depth ) {

		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );
		float depth = dot( rgba_depth, bit_shift );
		return depth;

	}

#endif`,t.ShaderChunk.skinning_pars_vertex=`#ifdef USE_SKINNING

	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;

	#ifdef BONE_TEXTURE

		uniform sampler2D boneTexture;
		uniform int boneTextureWidth;
		uniform int boneTextureHeight;

		mat4 getBoneMatrix( const in float i ) {

			float j = i * 4.0;
			float x = mod( j, float( boneTextureWidth ) );
			float y = floor( j / float( boneTextureWidth ) );

			float dx = 1.0 / float( boneTextureWidth );
			float dy = 1.0 / float( boneTextureHeight );

			y = dy * ( y + 0.5 );

			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );

			mat4 bone = mat4( v1, v2, v3, v4 );

			return bone;

		}

	#else

		uniform mat4 boneGlobalMatrices[ MAX_BONES ];

		mat4 getBoneMatrix( const in float i ) {

			mat4 bone = boneGlobalMatrices[ int(i) ];
			return bone;

		}

	#endif

#endif
`,t.ShaderChunk.logdepthbuf_pars_fragment=`#ifdef USE_LOGDEPTHBUF

	uniform float logDepthBufFC;

	#ifdef USE_LOGDEPTHBUF_EXT

		#extension GL_EXT_frag_depth : enable
		varying float vFragDepth;

	#endif

#endif`,t.ShaderChunk.alphamap_fragment=`#ifdef USE_ALPHAMAP

	gl_FragColor.a *= texture2D( alphaMap, vUv ).g;

#endif
`,t.ShaderChunk.alphamap_pars_fragment=`#ifdef USE_ALPHAMAP

	uniform sampler2D alphaMap;

#endif
`,t.UniformsUtils={merge:function(e){for(var r={},n=0;n<e.length;n++){var a=this.clone(e[n]);for(var o in a)r[o]=a[o]}return r},clone:function(e){var r={};for(var n in e){r[n]={};for(var a in e[n]){var o=e[n][a];o instanceof t.Color||o instanceof t.Vector2||o instanceof t.Vector3||o instanceof t.Vector4||o instanceof t.Matrix4||o instanceof t.Texture?r[n][a]=o.clone():o instanceof Array?r[n][a]=o.slice():r[n][a]=o}}return r}},t.UniformsLib={common:{diffuse:{type:"c",value:new t.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new t.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new t.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new t.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new t.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new t.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},t.ShaderLib={basic:{uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.fog,t.UniformsLib.shadowmap]),vertexShader:[t.ShaderChunk.map_pars_vertex,t.ShaderChunk.lightmap_pars_vertex,t.ShaderChunk.envmap_pars_vertex,t.ShaderChunk.color_pars_vertex,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.map_vertex,t.ShaderChunk.lightmap_vertex,t.ShaderChunk.color_vertex,t.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",t.ShaderChunk.morphnormal_vertex,t.ShaderChunk.skinnormal_vertex,t.ShaderChunk.defaultnormal_vertex,"	#endif",t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.skinning_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,t.ShaderChunk.worldpos_vertex,t.ShaderChunk.envmap_vertex,t.ShaderChunk.shadowmap_vertex,"}"].join(`
`),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",t.ShaderChunk.color_pars_fragment,t.ShaderChunk.map_pars_fragment,t.ShaderChunk.alphamap_pars_fragment,t.ShaderChunk.lightmap_pars_fragment,t.ShaderChunk.envmap_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.specularmap_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( diffuse, opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.map_fragment,t.ShaderChunk.alphamap_fragment,t.ShaderChunk.alphatest_fragment,t.ShaderChunk.specularmap_fragment,t.ShaderChunk.lightmap_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.envmap_fragment,t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.linear_to_gamma_fragment,t.ShaderChunk.fog_fragment,"}"].join(`
`)},lambert:{uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.fog,t.UniformsLib.lights,t.UniformsLib.shadowmap,{ambient:{type:"c",value:new t.Color(16777215)},emissive:{type:"c",value:new t.Color(0)},wrapRGB:{type:"v3",value:new t.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",t.ShaderChunk.map_pars_vertex,t.ShaderChunk.lightmap_pars_vertex,t.ShaderChunk.envmap_pars_vertex,t.ShaderChunk.lights_lambert_pars_vertex,t.ShaderChunk.color_pars_vertex,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.map_vertex,t.ShaderChunk.lightmap_vertex,t.ShaderChunk.color_vertex,t.ShaderChunk.morphnormal_vertex,t.ShaderChunk.skinbase_vertex,t.ShaderChunk.skinnormal_vertex,t.ShaderChunk.defaultnormal_vertex,t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.skinning_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,t.ShaderChunk.worldpos_vertex,t.ShaderChunk.envmap_vertex,t.ShaderChunk.lights_lambert_vertex,t.ShaderChunk.shadowmap_vertex,"}"].join(`
`),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","#endif",t.ShaderChunk.color_pars_fragment,t.ShaderChunk.map_pars_fragment,t.ShaderChunk.alphamap_pars_fragment,t.ShaderChunk.lightmap_pars_fragment,t.ShaderChunk.envmap_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.specularmap_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.map_fragment,t.ShaderChunk.alphamap_fragment,t.ShaderChunk.alphatest_fragment,t.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED","		if ( gl_FrontFacing )","			gl_FragColor.xyz *= vLightFront;","		else","			gl_FragColor.xyz *= vLightBack;","	#else","		gl_FragColor.xyz *= vLightFront;","	#endif",t.ShaderChunk.lightmap_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.envmap_fragment,t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.linear_to_gamma_fragment,t.ShaderChunk.fog_fragment,"}"].join(`
`)},phong:{uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.bump,t.UniformsLib.normalmap,t.UniformsLib.fog,t.UniformsLib.lights,t.UniformsLib.shadowmap,{ambient:{type:"c",value:new t.Color(16777215)},emissive:{type:"c",value:new t.Color(0)},specular:{type:"c",value:new t.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new t.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",t.ShaderChunk.map_pars_vertex,t.ShaderChunk.lightmap_pars_vertex,t.ShaderChunk.envmap_pars_vertex,t.ShaderChunk.lights_phong_pars_vertex,t.ShaderChunk.color_pars_vertex,t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.map_vertex,t.ShaderChunk.lightmap_vertex,t.ShaderChunk.color_vertex,t.ShaderChunk.morphnormal_vertex,t.ShaderChunk.skinbase_vertex,t.ShaderChunk.skinnormal_vertex,t.ShaderChunk.defaultnormal_vertex,"	vNormal = normalize( transformedNormal );",t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.skinning_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",t.ShaderChunk.worldpos_vertex,t.ShaderChunk.envmap_vertex,t.ShaderChunk.lights_phong_vertex,t.ShaderChunk.shadowmap_vertex,"}"].join(`
`),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",t.ShaderChunk.color_pars_fragment,t.ShaderChunk.map_pars_fragment,t.ShaderChunk.alphamap_pars_fragment,t.ShaderChunk.lightmap_pars_fragment,t.ShaderChunk.envmap_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.lights_phong_pars_fragment,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.bumpmap_pars_fragment,t.ShaderChunk.normalmap_pars_fragment,t.ShaderChunk.specularmap_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( vec3( 1.0 ), opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.map_fragment,t.ShaderChunk.alphamap_fragment,t.ShaderChunk.alphatest_fragment,t.ShaderChunk.specularmap_fragment,t.ShaderChunk.lights_phong_fragment,t.ShaderChunk.lightmap_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.envmap_fragment,t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.linear_to_gamma_fragment,t.ShaderChunk.fog_fragment,"}"].join(`
`)},particle_basic:{uniforms:t.UniformsUtils.merge([t.UniformsLib.particle,t.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",t.ShaderChunk.color_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	#ifdef USE_SIZEATTENUATION","		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","	#else","		gl_PointSize = size;","	#endif","	gl_Position = projectionMatrix * mvPosition;",t.ShaderChunk.logdepthbuf_vertex,t.ShaderChunk.worldpos_vertex,t.ShaderChunk.shadowmap_vertex,"}"].join(`
`),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",t.ShaderChunk.color_pars_fragment,t.ShaderChunk.map_particle_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( psColor, opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.map_particle_fragment,t.ShaderChunk.alphatest_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.fog_fragment,"}"].join(`
`)},dashed:{uniforms:t.UniformsUtils.merge([t.UniformsLib.common,t.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",t.ShaderChunk.color_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",t.ShaderChunk.logdepthbuf_vertex,"}"].join(`
`),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",t.ShaderChunk.color_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	if ( mod( vLineDistance, totalSize ) > dashSize ) {","		discard;","	}","	gl_FragColor = vec4( diffuse, opacity );",t.ShaderChunk.logdepthbuf_fragment,t.ShaderChunk.color_fragment,t.ShaderChunk.fog_fragment,"}"].join(`
`)},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,"}"].join(`
`),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",t.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		float depth = gl_FragDepthEXT / gl_FragCoord.w;","	#else","		float depth = gl_FragCoord.z / gl_FragCoord.w;","	#endif","	float color = 1.0 - smoothstep( mNear, mFar, depth );","	gl_FragColor = vec4( vec3( color ), opacity );","}"].join(`
`)},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vNormal = normalize( normalMatrix * normal );",t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,"}"].join(`
`),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",t.ShaderChunk.logdepthbuf_fragment,"}"].join(`
`)},normalmap:{uniforms:t.UniformsUtils.merge([t.UniformsLib.fog,t.UniformsLib.lights,t.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new t.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new t.Color(16777215)},specular:{type:"c",value:new t.Color(1118481)},ambient:{type:"c",value:new t.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new t.Vector2(0,0)},uRepeat:{type:"v2",value:new t.Vector2(1,1)},wrapRGB:{type:"v3",value:new t.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","	uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",t.ShaderChunk.shadowmap_pars_fragment,t.ShaderChunk.fog_pars_fragment,t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",t.ShaderChunk.logdepthbuf_fragment,"	gl_FragColor = vec4( vec3( 1.0 ), opacity );","	vec3 specularTex = vec3( 1.0 );","	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","	normalTex.xy *= uNormalScale;","	normalTex = normalize( normalTex );","	if( enableDiffuse ) {","		#ifdef GAMMA_INPUT","			vec4 texelColor = texture2D( tDiffuse, vUv );","			texelColor.xyz *= texelColor.xyz;","			gl_FragColor = gl_FragColor * texelColor;","		#else","			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","		#endif","	}","	if( enableAO ) {","		#ifdef GAMMA_INPUT","			vec4 aoColor = texture2D( tAO, vUv );","			aoColor.xyz *= aoColor.xyz;","			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","		#else","			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","		#endif","	}",t.ShaderChunk.alphatest_fragment,"	if( enableSpecular )","		specularTex = texture2D( tSpecular, vUv ).xyz;","	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","	vec3 finalNormal = tsb * normalTex;","	#ifdef FLIP_SIDED","		finalNormal = -finalNormal;","	#endif","	vec3 normal = normalize( finalNormal );","	vec3 viewPosition = normalize( vViewPosition );","	#if MAX_POINT_LIGHTS > 0","		vec3 pointDiffuse = vec3( 0.0 );","		vec3 pointSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","			float pointDistance = 1.0;","			if ( pointLightDistance[ i ] > 0.0 )","				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","			pointVector = normalize( pointVector );","			#ifdef WRAP_AROUND","				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","			#else","				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","			#endif","			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","			vec3 pointHalfVector = normalize( pointVector + viewPosition );","			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( pointVector, pointHalfVector ), 0.0 ), 5.0 );","			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","		}","	#endif","	#if MAX_SPOT_LIGHTS > 0","		vec3 spotDiffuse = vec3( 0.0 );","		vec3 spotSpecular = vec3( 0.0 );","		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","			float spotDistance = 1.0;","			if ( spotLightDistance[ i ] > 0.0 )","				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","			spotVector = normalize( spotVector );","			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","			if ( spotEffect > spotLightAngleCos[ i ] ) {","				spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );","				#ifdef WRAP_AROUND","					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","				#else","					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","				#endif","				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","				vec3 spotHalfVector = normalize( spotVector + viewPosition );","				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","				float specularNormalization = ( shininess + 2.0 ) / 8.0;","				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( spotVector, spotHalfVector ), 0.0 ), 5.0 );","				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","			}","		}","	#endif","	#if MAX_DIR_LIGHTS > 0","		vec3 dirDiffuse = vec3( 0.0 );","		vec3 dirSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","			vec3 dirVector = normalize( lDirection.xyz );","			#ifdef WRAP_AROUND","				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","			#else","				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","			#endif","			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","			vec3 dirHalfVector = normalize( dirVector + viewPosition );","			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","		}","	#endif","	#if MAX_HEMI_LIGHTS > 0","		vec3 hemiDiffuse = vec3( 0.0 );","		vec3 hemiSpecular = vec3( 0.0 );","		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","			vec3 lVector = normalize( lDirection.xyz );","			float dotProduct = dot( normal, lVector );","			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","			hemiDiffuse += diffuse * hemiColor;","			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","			float hemiSpecularWeightSky = specularTex.r * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );","			vec3 lVectorGround = -lVector;","			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","			float hemiSpecularWeightGround = specularTex.r * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );","			float dotProductGround = dot( normal, lVectorGround );","			float specularNormalization = ( shininess + 2.0 ) / 8.0;","			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","		}","	#endif","	vec3 totalDiffuse = vec3( 0.0 );","	vec3 totalSpecular = vec3( 0.0 );","	#if MAX_DIR_LIGHTS > 0","		totalDiffuse += dirDiffuse;","		totalSpecular += dirSpecular;","	#endif","	#if MAX_HEMI_LIGHTS > 0","		totalDiffuse += hemiDiffuse;","		totalSpecular += hemiSpecular;","	#endif","	#if MAX_POINT_LIGHTS > 0","		totalDiffuse += pointDiffuse;","		totalSpecular += pointSpecular;","	#endif","	#if MAX_SPOT_LIGHTS > 0","		totalDiffuse += spotDiffuse;","		totalSpecular += spotSpecular;","	#endif","	#ifdef METAL","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","	#else","		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","	#endif","	if ( enableReflection ) {","		vec3 vReflect;","		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","		if ( useRefract ) {","			vReflect = refract( cameraToVertex, normal, refractionRatio );","		} else {","			vReflect = reflect( cameraToVertex, normal );","		}","		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","		#ifdef GAMMA_INPUT","			cubeColor.xyz *= cubeColor.xyz;","		#endif","		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","	}",t.ShaderChunk.shadowmap_fragment,t.ShaderChunk.linear_to_gamma_fragment,t.ShaderChunk.fog_fragment,"}"].join(`
`),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","	uniform sampler2D tDisplacement;","	uniform float uDisplacementScale;","	uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.shadowmap_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.skinbase_vertex,t.ShaderChunk.skinnormal_vertex,"	#ifdef USE_SKINNING","		vNormal = normalize( normalMatrix * skinnedNormal.xyz );","		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","		vTangent = normalize( normalMatrix * skinnedTangent.xyz );","	#else","		vNormal = normalize( normalMatrix * normal );","		vTangent = normalize( normalMatrix * tangent.xyz );","	#endif","	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","	vUv = uv * uRepeat + uOffset;","	vec3 displacedPosition;","	#ifdef VERTEX_TEXTURES","		if ( enableDisplacement ) {","			vec3 dv = texture2D( tDisplacement, uv ).xyz;","			float df = uDisplacementScale * dv.x + uDisplacementBias;","			displacedPosition = position + normalize( normal ) * df;","		} else {","			#ifdef USE_SKINNING","				vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","				vec4 skinned = vec4( 0.0 );","				skinned += boneMatX * skinVertex * skinWeight.x;","				skinned += boneMatY * skinVertex * skinWeight.y;","				skinned += boneMatZ * skinVertex * skinWeight.z;","				skinned += boneMatW * skinVertex * skinWeight.w;","				skinned  = bindMatrixInverse * skinned;","				displacedPosition = skinned.xyz;","			#else","				displacedPosition = position;","			#endif","		}","	#else","		#ifdef USE_SKINNING","			vec4 skinVertex = bindMatrix * vec4( position, 1.0 );","			vec4 skinned = vec4( 0.0 );","			skinned += boneMatX * skinVertex * skinWeight.x;","			skinned += boneMatY * skinVertex * skinWeight.y;","			skinned += boneMatZ * skinVertex * skinWeight.z;","			skinned += boneMatW * skinVertex * skinWeight.w;","			skinned  = bindMatrixInverse * skinned;","			displacedPosition = skinned.xyz;","		#else","			displacedPosition = position;","		#endif","	#endif","	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","	gl_Position = projectionMatrix * mvPosition;",t.ShaderChunk.logdepthbuf_vertex,"	vWorldPosition = worldPosition.xyz;","	vViewPosition = -mvPosition.xyz;","	#ifdef USE_SHADOWMAP","		for( int i = 0; i < MAX_SHADOWS; i ++ ) {","			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","		}","	#endif","}"].join(`
`)},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",t.ShaderChunk.logdepthbuf_vertex,"}"].join(`
`),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",t.ShaderChunk.logdepthbuf_pars_fragment,"void main() {","	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",t.ShaderChunk.logdepthbuf_fragment,"}"].join(`
`)},depthRGBA:{uniforms:{},vertexShader:[t.ShaderChunk.morphtarget_pars_vertex,t.ShaderChunk.skinning_pars_vertex,t.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",t.ShaderChunk.skinbase_vertex,t.ShaderChunk.morphtarget_vertex,t.ShaderChunk.skinning_vertex,t.ShaderChunk.default_vertex,t.ShaderChunk.logdepthbuf_vertex,"}"].join(`
`),fragmentShader:[t.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {","	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","	const vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","	res -= res.xxyz * bit_mask;","	return res;","}","void main() {",t.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT","		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","	#else","		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","	#endif","}"].join(`
`)}},t.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",t.REVISION),e=e||{};var r=e.canvas!==void 0?e.canvas:document.createElement("canvas"),n=e.context!==void 0?e.context:null,a=e.precision!==void 0?e.precision:"highp",o=e.alpha!==void 0?e.alpha:!1,s=e.depth!==void 0?e.depth:!0,l=e.stencil!==void 0?e.stencil:!0,h=e.antialias!==void 0?e.antialias:!1,c=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,d=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,p=e.logarithmicDepthBuffer!==void 0?e.logarithmicDepthBuffer:!1,v=new t.Color(0),m=0,g=[],x={},w=[],_=[],b=[],A=[],E=[];this.domElement=r,this.context=null,this.devicePixelRatio=e.devicePixelRatio!==void 0?e.devicePixelRatio:Re.devicePixelRatio!==void 0?Re.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapType=t.PCFShadowMap,this.shadowMapCullFace=t.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var M=this,F=[],D=null,R=null,B=-1,V=-1,U=null,z=0,I=-1,Y=-1,H=-1,q=-1,ee=-1,G=-1,$=-1,J=-1,X=null,K=null,ne=null,re=null,se=0,Z=0,de=r.width,ge=r.height,we=0,Ee=0,Te=new Uint8Array(16),Be=new Uint8Array(16),Ce=new t.Frustum,Ze=new t.Matrix4,Je=new t.Matrix4,Oe=new t.Vector3,Ae=new t.Vector3,Tt=!0,Yt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},u;try{var Se={alpha:o,depth:s,stencil:l,antialias:h,premultipliedAlpha:c,preserveDrawingBuffer:d};if(u=n||r.getContext("webgl",Se)||r.getContext("experimental-webgl",Se),u===null)throw r.getContext("webgl")!==null?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context."}catch(f){console.error(f)}u.getShaderPrecisionFormat===void 0&&(u.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var xe=new t.WebGLExtensions(u);xe.get("OES_texture_float"),xe.get("OES_texture_float_linear"),xe.get("OES_standard_derivatives"),p&&xe.get("EXT_frag_depth");function We(){u.clearColor(0,0,0,1),u.clearDepth(1),u.clearStencil(0),u.enable(u.DEPTH_TEST),u.depthFunc(u.LEQUAL),u.frontFace(u.CCW),u.cullFace(u.BACK),u.enable(u.CULL_FACE),u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA),u.viewport(se,Z,de,ge),u.clearColor(v.r,v.g,v.b,m)}We(),this.context=u;var Ye=u.getParameter(u.MAX_TEXTURE_IMAGE_UNITS),st=u.getParameter(u.MAX_VERTEX_TEXTURE_IMAGE_UNITS),lt=u.getParameter(u.MAX_TEXTURE_SIZE),Ke=u.getParameter(u.MAX_CUBE_MAP_TEXTURE_SIZE),Qe=st>0,Ie=Qe&&xe.get("OES_texture_float"),ft=u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.HIGH_FLOAT),Pt=u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.MEDIUM_FLOAT);u.getShaderPrecisionFormat(u.VERTEX_SHADER,u.LOW_FLOAT);var fr=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.HIGH_FLOAT),qt=u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.MEDIUM_FLOAT);u.getShaderPrecisionFormat(u.FRAGMENT_SHADER,u.LOW_FLOAT);var It=function(){var f;return function(){if(f!==void 0)return f;if(f=[],xe.get("WEBGL_compressed_texture_pvrtc")||xe.get("WEBGL_compressed_texture_s3tc"))for(var y=u.getParameter(u.COMPRESSED_TEXTURE_FORMATS),C=0;C<y.length;C++)f.push(y[C]);return f}}(),Kt=ft.precision>0&&fr.precision>0,Ht=Pt.precision>0&&qt.precision>0;a==="highp"&&!Kt&&(Ht?(a="mediump",console.warn("THREE.WebGLRenderer: highp not supported, using mediump.")):(a="lowp",console.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp."))),a==="mediump"&&!Ht&&(a="lowp",console.warn("THREE.WebGLRenderer: mediump not supported, using lowp."));var ur=new t.ShadowMapPlugin(this,g,x,w),cr=new t.SpritePlugin(this,A),Qt=new t.LensFlarePlugin(this,E);this.getContext=function(){return u},this.supportsVertexTextures=function(){return Qe},this.supportsFloatTextures=function(){return xe.get("OES_texture_float")},this.supportsStandardDerivatives=function(){return xe.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return xe.get("WEBGL_compressed_texture_s3tc")},this.supportsCompressedTexturePVRTC=function(){return xe.get("WEBGL_compressed_texture_pvrtc")},this.supportsBlendMinMax=function(){return xe.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var f;return function(){if(f!==void 0)return f;var y=xe.get("EXT_texture_filter_anisotropic");return f=y!==null?u.getParameter(y.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,f}}(),this.getPrecision=function(){return a},this.setSize=function(f,y,C){r.width=f*this.devicePixelRatio,r.height=y*this.devicePixelRatio,C!==!1&&(r.style.width=f+"px",r.style.height=y+"px"),this.setViewport(0,0,f,y)},this.setViewport=function(f,y,C,S){se=f*this.devicePixelRatio,Z=y*this.devicePixelRatio,de=C*this.devicePixelRatio,ge=S*this.devicePixelRatio,u.viewport(se,Z,de,ge)},this.setScissor=function(f,y,C,S){u.scissor(f*this.devicePixelRatio,y*this.devicePixelRatio,C*this.devicePixelRatio,S*this.devicePixelRatio)},this.enableScissorTest=function(f){f?u.enable(u.SCISSOR_TEST):u.disable(u.SCISSOR_TEST)},this.setClearColor=function(f,y){v.set(f),m=y!==void 0?y:1,u.clearColor(v.r,v.g,v.b,m)},this.setClearColorHex=function(f,y){console.warn("THREE.WebGLRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(f,y)},this.getClearColor=function(){return v},this.getClearAlpha=function(){return m},this.clear=function(f,y,C){var S=0;(f===void 0||f)&&(S|=u.COLOR_BUFFER_BIT),(y===void 0||y)&&(S|=u.DEPTH_BUFFER_BIT),(C===void 0||C)&&(S|=u.STENCIL_BUFFER_BIT),u.clear(S)},this.clearColor=function(){u.clear(u.COLOR_BUFFER_BIT)},this.clearDepth=function(){u.clear(u.DEPTH_BUFFER_BIT)},this.clearStencil=function(){u.clear(u.STENCIL_BUFFER_BIT)},this.clearTarget=function(f,y,C,S){this.setRenderTarget(f),this.clear(y,C,S)},this.resetGLState=function(){D=null,U=null,H=-1,$=-1,J=-1,I=-1,Y=-1,V=-1,B=-1,Tt=!0};function Zt(f){f.__webglVertexBuffer=u.createBuffer(),f.__webglColorBuffer=u.createBuffer(),M.info.memory.geometries++}function Nt(f){f.__webglVertexBuffer=u.createBuffer(),f.__webglColorBuffer=u.createBuffer(),f.__webglLineDistanceBuffer=u.createBuffer(),M.info.memory.geometries++}function vi(f){f.__webglVertexBuffer=u.createBuffer(),f.__webglNormalBuffer=u.createBuffer(),f.__webglTangentBuffer=u.createBuffer(),f.__webglColorBuffer=u.createBuffer(),f.__webglUVBuffer=u.createBuffer(),f.__webglUV2Buffer=u.createBuffer(),f.__webglSkinIndicesBuffer=u.createBuffer(),f.__webglSkinWeightsBuffer=u.createBuffer(),f.__webglFaceBuffer=u.createBuffer(),f.__webglLineBuffer=u.createBuffer();var y,C;if(f.numMorphTargets)for(f.__webglMorphTargetsBuffers=[],y=0,C=f.numMorphTargets;y<C;y++)f.__webglMorphTargetsBuffers.push(u.createBuffer());if(f.numMorphNormals)for(f.__webglMorphNormalsBuffers=[],y=0,C=f.numMorphNormals;y<C;y++)f.__webglMorphNormalsBuffers.push(u.createBuffer());M.info.memory.geometries++}var Nr=function(f){var y=f.target;y.traverse(function(C){C.removeEventListener("remove",Nr),Bi(C)})},kr=function(f){var y=f.target;y.removeEventListener("dispose",kr),mi(y)},dr=function(f){var y=f.target;y.removeEventListener("dispose",dr),gi(y),M.info.memory.textures--},Or=function(f){var y=f.target;y.removeEventListener("dispose",Or),yi(y),M.info.memory.textures--},Ir=function(f){var y=f.target;y.removeEventListener("dispose",Ir),Wr(y)},Hr=function(f){for(var y=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"],C=0,S=y.length;C<S;C++){var L=y[C];f[L]!==void 0&&(u.deleteBuffer(f[L]),delete f[L])}if(f.__webglCustomAttributesList!==void 0){for(var L in f.__webglCustomAttributesList)u.deleteBuffer(f.__webglCustomAttributesList[L].buffer);delete f.__webglCustomAttributesList}M.info.memory.geometries--},mi=function(f){if(delete f.__webglInit,f instanceof t.BufferGeometry){for(var y in f.attributes){var C=f.attributes[y];C.buffer!==void 0&&(u.deleteBuffer(C.buffer),delete C.buffer)}M.info.memory.geometries--}else{var S=Ut[f.id];if(S!==void 0){for(var L=0,N=S.length;L<N;L++){var T=S[L];if(T.numMorphTargets!==void 0){for(var P=0,O=T.numMorphTargets;P<O;P++)u.deleteBuffer(T.__webglMorphTargetsBuffers[P]);delete T.__webglMorphTargetsBuffers}if(T.numMorphNormals!==void 0){for(var P=0,O=T.numMorphNormals;P<O;P++)u.deleteBuffer(T.__webglMorphNormalsBuffers[P]);delete T.__webglMorphNormalsBuffers}Hr(T)}delete Ut[f.id]}else Hr(f)}V=-1},gi=function(f){if(f.image&&f.image.__webglTextureCube)u.deleteTexture(f.image.__webglTextureCube),delete f.image.__webglTextureCube;else{if(f.__webglInit===void 0)return;u.deleteTexture(f.__webglTexture),delete f.__webglTexture,delete f.__webglInit}},yi=function(f){if(!(!f||f.__webglTexture===void 0)){if(u.deleteTexture(f.__webglTexture),delete f.__webglTexture,f instanceof t.WebGLRenderTargetCube)for(var y=0;y<6;y++)u.deleteFramebuffer(f.__webglFramebuffer[y]),u.deleteRenderbuffer(f.__webglRenderbuffer[y]);else u.deleteFramebuffer(f.__webglFramebuffer),u.deleteRenderbuffer(f.__webglRenderbuffer);delete f.__webglFramebuffer,delete f.__webglRenderbuffer}},Wr=function(f){var y=f.program.program;if(y!==void 0){f.program=void 0;var C,S,L,N=!1;for(C=0,S=F.length;C<S;C++)if(L=F[C],L.program===y){L.usedTimes--,L.usedTimes===0&&(N=!0);break}if(N===!0){var T=[];for(C=0,S=F.length;C<S;C++)L=F[C],L.program!==y&&T.push(L);F=T,u.deleteProgram(y),M.info.memory.programs--}}};function Gr(f){var y=f.geometry,C=f.material,S=y.vertices.length;if(C.attributes){y.__webglCustomAttributesList===void 0&&(y.__webglCustomAttributesList=[]);for(var L in C.attributes){var N=C.attributes[L];if(!N.__webglInitialized||N.createUniqueBuffers){N.__webglInitialized=!0;var T=1;N.type==="v2"?T=2:N.type==="v3"?T=3:N.type==="v4"?T=4:N.type==="c"&&(T=3),N.size=T,N.array=new Float32Array(S*T),N.buffer=u.createBuffer(),N.buffer.belongsToAttribute=L,N.needsUpdate=!0}y.__webglCustomAttributesList.push(N)}}}function xi(f,y){var C=f.vertices.length;f.__vertexArray=new Float32Array(C*3),f.__colorArray=new Float32Array(C*3),f.__sortArray=[],f.__webglParticleCount=C,Gr(y)}function _i(f,y){var C=f.vertices.length;f.__vertexArray=new Float32Array(C*3),f.__colorArray=new Float32Array(C*3),f.__lineDistanceArray=new Float32Array(C*1),f.__webglLineCount=C,Gr(y)}function Xr(f,y){var C=y.geometry,S=f.faces3,L=S.length*3,N=S.length*1,T=S.length*3,P=$t(y,f);f.__vertexArray=new Float32Array(L*3),f.__normalArray=new Float32Array(L*3),f.__colorArray=new Float32Array(L*3),f.__uvArray=new Float32Array(L*2),C.faceVertexUvs.length>1&&(f.__uv2Array=new Float32Array(L*2)),C.hasTangents&&(f.__tangentArray=new Float32Array(L*4)),y.geometry.skinWeights.length&&y.geometry.skinIndices.length&&(f.__skinIndexArray=new Float32Array(L*4),f.__skinWeightArray=new Float32Array(L*4));var O=xe.get("OES_element_index_uint")!==null&&N>21845?Uint32Array:Uint16Array;f.__typeArray=O,f.__faceArray=new O(N*3),f.__lineArray=new O(T*2);var k,W;if(f.numMorphTargets)for(f.__morphTargetsArrays=[],k=0,W=f.numMorphTargets;k<W;k++)f.__morphTargetsArrays.push(new Float32Array(L*3));if(f.numMorphNormals)for(f.__morphNormalsArrays=[],k=0,W=f.numMorphNormals;k<W;k++)f.__morphNormalsArrays.push(new Float32Array(L*3));if(f.__webglFaceCount=N*3,f.__webglLineCount=T*2,P.attributes){f.__webglCustomAttributesList===void 0&&(f.__webglCustomAttributesList=[]);for(var ie in P.attributes){var me=P.attributes[ie],te={};for(var ve in me)te[ve]=me[ve];if(!te.__webglInitialized||te.createUniqueBuffers){te.__webglInitialized=!0;var he=1;te.type==="v2"?he=2:te.type==="v3"?he=3:te.type==="v4"?he=4:te.type==="c"&&(he=3),te.size=he,te.array=new Float32Array(L*he),te.buffer=u.createBuffer(),te.buffer.belongsToAttribute=ie,me.needsUpdate=!0,te.__original=me}f.__webglCustomAttributesList.push(te)}}f.__inittedArrays=!0}function $t(f,y){return f.material instanceof t.MeshFaceMaterial?f.material.materials[y.materialIndex]:f.material}function wi(f){return f&&f.shading!==void 0&&f.shading===t.SmoothShading}function Mi(f,y,C){var S,L,N,T,P,O,k=f.vertices,W=k.length,ie=f.colors,me=ie.length,te=f.__vertexArray,ve=f.__colorArray,he=f.__sortArray,ye=f.verticesNeedUpdate;f.elementsNeedUpdate;var ue=f.colorsNeedUpdate,oe=f.__webglCustomAttributesList,le,De,pe,Pe,fe,ae;if(C.sortParticles){for(Je.copy(Ze),Je.multiply(C.matrixWorld),S=0;S<W;S++)N=k[S],Oe.copy(N),Oe.applyProjection(Je),he[S]=[Oe.z,S];for(he.sort(mr),S=0;S<W;S++)N=k[he[S][1]],T=S*3,te[T]=N.x,te[T+1]=N.y,te[T+2]=N.z;for(L=0;L<me;L++)T=L*3,O=ie[he[L][1]],ve[T]=O.r,ve[T+1]=O.g,ve[T+2]=O.b;if(oe){for(le=0,De=oe.length;le<De;le++)if(ae=oe[le],ae.boundTo===void 0||ae.boundTo==="vertices"){if(T=0,Pe=ae.value.length,ae.size===1)for(pe=0;pe<Pe;pe++)P=he[pe][1],ae.array[pe]=ae.value[P];else if(ae.size===2)for(pe=0;pe<Pe;pe++)P=he[pe][1],fe=ae.value[P],ae.array[T]=fe.x,ae.array[T+1]=fe.y,T+=2;else if(ae.size===3)if(ae.type==="c")for(pe=0;pe<Pe;pe++)P=he[pe][1],fe=ae.value[P],ae.array[T]=fe.r,ae.array[T+1]=fe.g,ae.array[T+2]=fe.b,T+=3;else for(pe=0;pe<Pe;pe++)P=he[pe][1],fe=ae.value[P],ae.array[T]=fe.x,ae.array[T+1]=fe.y,ae.array[T+2]=fe.z,T+=3;else if(ae.size===4)for(pe=0;pe<Pe;pe++)P=he[pe][1],fe=ae.value[P],ae.array[T]=fe.x,ae.array[T+1]=fe.y,ae.array[T+2]=fe.z,ae.array[T+3]=fe.w,T+=4}}}else{if(ye)for(S=0;S<W;S++)N=k[S],T=S*3,te[T]=N.x,te[T+1]=N.y,te[T+2]=N.z;if(ue)for(L=0;L<me;L++)O=ie[L],T=L*3,ve[T]=O.r,ve[T+1]=O.g,ve[T+2]=O.b;if(oe){for(le=0,De=oe.length;le<De;le++)if(ae=oe[le],ae.needsUpdate&&(ae.boundTo===void 0||ae.boundTo==="vertices")){if(Pe=ae.value.length,T=0,ae.size===1)for(pe=0;pe<Pe;pe++)ae.array[pe]=ae.value[pe];else if(ae.size===2)for(pe=0;pe<Pe;pe++)fe=ae.value[pe],ae.array[T]=fe.x,ae.array[T+1]=fe.y,T+=2;else if(ae.size===3)if(ae.type==="c")for(pe=0;pe<Pe;pe++)fe=ae.value[pe],ae.array[T]=fe.r,ae.array[T+1]=fe.g,ae.array[T+2]=fe.b,T+=3;else for(pe=0;pe<Pe;pe++)fe=ae.value[pe],ae.array[T]=fe.x,ae.array[T+1]=fe.y,ae.array[T+2]=fe.z,T+=3;else if(ae.size===4)for(pe=0;pe<Pe;pe++)fe=ae.value[pe],ae.array[T]=fe.x,ae.array[T+1]=fe.y,ae.array[T+2]=fe.z,ae.array[T+3]=fe.w,T+=4}}}if((ye||C.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,te,y)),(ue||C.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,ve,y)),oe)for(le=0,De=oe.length;le<De;le++)ae=oe[le],(ae.needsUpdate||C.sortParticles)&&(u.bindBuffer(u.ARRAY_BUFFER,ae.buffer),u.bufferData(u.ARRAY_BUFFER,ae.array,y))}function bi(f,y){var C,S,L,N,T,P,O=f.vertices,k=f.colors,W=f.lineDistances,ie=O.length,me=k.length,te=W.length,ve=f.__vertexArray,he=f.__colorArray,ye=f.__lineDistanceArray,ue=f.verticesNeedUpdate,oe=f.colorsNeedUpdate,le=f.lineDistancesNeedUpdate,De=f.__webglCustomAttributesList,pe,Pe,fe,ae,Ue,_e;if(ue){for(C=0;C<ie;C++)N=O[C],T=C*3,ve[T]=N.x,ve[T+1]=N.y,ve[T+2]=N.z;u.bindBuffer(u.ARRAY_BUFFER,f.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,ve,y)}if(oe){for(S=0;S<me;S++)P=k[S],T=S*3,he[T]=P.r,he[T+1]=P.g,he[T+2]=P.b;u.bindBuffer(u.ARRAY_BUFFER,f.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,he,y)}if(le){for(L=0;L<te;L++)ye[L]=W[L];u.bindBuffer(u.ARRAY_BUFFER,f.__webglLineDistanceBuffer),u.bufferData(u.ARRAY_BUFFER,ye,y)}if(De){for(pe=0,Pe=De.length;pe<Pe;pe++)if(_e=De[pe],_e.needsUpdate&&(_e.boundTo===void 0||_e.boundTo==="vertices")){if(T=0,ae=_e.value.length,_e.size===1)for(fe=0;fe<ae;fe++)_e.array[fe]=_e.value[fe];else if(_e.size===2)for(fe=0;fe<ae;fe++)Ue=_e.value[fe],_e.array[T]=Ue.x,_e.array[T+1]=Ue.y,T+=2;else if(_e.size===3)if(_e.type==="c")for(fe=0;fe<ae;fe++)Ue=_e.value[fe],_e.array[T]=Ue.r,_e.array[T+1]=Ue.g,_e.array[T+2]=Ue.b,T+=3;else for(fe=0;fe<ae;fe++)Ue=_e.value[fe],_e.array[T]=Ue.x,_e.array[T+1]=Ue.y,_e.array[T+2]=Ue.z,T+=3;else if(_e.size===4)for(fe=0;fe<ae;fe++)Ue=_e.value[fe],_e.array[T]=Ue.x,_e.array[T+1]=Ue.y,_e.array[T+2]=Ue.z,_e.array[T+3]=Ue.w,T+=4;u.bindBuffer(u.ARRAY_BUFFER,_e.buffer),u.bufferData(u.ARRAY_BUFFER,_e.array,y)}}}function Si(f,y,C,S,L){if(f.__inittedArrays){var N=wi(L),T,P,O,k,W,ie,me,te,ve,he,ye,ue,oe,le,De,pe,Pe,fe,ae,Ue,_e,Ct,vt,ut,tt,ct,Et,Ft,Lt,ke,At,dt,rt,ht,je,ri,mt,gt,tr,rr,yt=0,xt=0,ir=0,nr=0,ar=0,Dt=0,it=0,Bt=0,pt=0,ze=0,Ge=0,j=0,Ne,_t=f.__vertexArray,Sr=f.__uvArray,Tr=f.__uv2Array,zt=f.__normalArray,nt=f.__tangentArray,wt=f.__colorArray,at=f.__skinIndexArray,ot=f.__skinWeightArray,ii=f.__morphTargetsArrays,ni=f.__morphNormalsArrays,Cr=f.__webglCustomAttributesList,Q,or=f.__faceArray,Vt=f.__lineArray,qe=y.geometry,tn=qe.verticesNeedUpdate,rn=qe.elementsNeedUpdate,ai=qe.uvsNeedUpdate,nn=qe.normalsNeedUpdate,an=qe.tangentsNeedUpdate,on=qe.colorsNeedUpdate,sn=qe.morphTargetsNeedUpdate,Ar=qe.vertices,Me=f.faces3,Mt=qe.faces,oi=qe.faceVertexUvs[0],si=qe.faceVertexUvs[1];qe.colors;var Er=qe.skinIndices,sr=qe.skinWeights,hr=qe.morphTargets,hi=qe.morphNormals;if(tn){for(T=0,P=Me.length;T<P;T++)k=Mt[Me[T]],ue=Ar[k.a],oe=Ar[k.b],le=Ar[k.c],_t[xt]=ue.x,_t[xt+1]=ue.y,_t[xt+2]=ue.z,_t[xt+3]=oe.x,_t[xt+4]=oe.y,_t[xt+5]=oe.z,_t[xt+6]=le.x,_t[xt+7]=le.y,_t[xt+8]=le.z,xt+=9;u.bindBuffer(u.ARRAY_BUFFER,f.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,_t,C)}if(sn)for(je=0,ri=hr.length;je<ri;je++){for(Ge=0,T=0,P=Me.length;T<P;T++)tr=Me[T],k=Mt[tr],ue=hr[je].vertices[k.a],oe=hr[je].vertices[k.b],le=hr[je].vertices[k.c],mt=ii[je],mt[Ge]=ue.x,mt[Ge+1]=ue.y,mt[Ge+2]=ue.z,mt[Ge+3]=oe.x,mt[Ge+4]=oe.y,mt[Ge+5]=oe.z,mt[Ge+6]=le.x,mt[Ge+7]=le.y,mt[Ge+8]=le.z,L.morphNormals&&(N?(rr=hi[je].vertexNormals[tr],fe=rr.a,ae=rr.b,Ue=rr.c):(fe=hi[je].faceNormals[tr],ae=fe,Ue=fe),gt=ni[je],gt[Ge]=fe.x,gt[Ge+1]=fe.y,gt[Ge+2]=fe.z,gt[Ge+3]=ae.x,gt[Ge+4]=ae.y,gt[Ge+5]=ae.z,gt[Ge+6]=Ue.x,gt[Ge+7]=Ue.y,gt[Ge+8]=Ue.z),Ge+=9;u.bindBuffer(u.ARRAY_BUFFER,f.__webglMorphTargetsBuffers[je]),u.bufferData(u.ARRAY_BUFFER,ii[je],C),L.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglMorphNormalsBuffers[je]),u.bufferData(u.ARRAY_BUFFER,ni[je],C))}if(sr.length){for(T=0,P=Me.length;T<P;T++)k=Mt[Me[T]],ut=sr[k.a],tt=sr[k.b],ct=sr[k.c],ot[ze]=ut.x,ot[ze+1]=ut.y,ot[ze+2]=ut.z,ot[ze+3]=ut.w,ot[ze+4]=tt.x,ot[ze+5]=tt.y,ot[ze+6]=tt.z,ot[ze+7]=tt.w,ot[ze+8]=ct.x,ot[ze+9]=ct.y,ot[ze+10]=ct.z,ot[ze+11]=ct.w,Et=Er[k.a],Ft=Er[k.b],Lt=Er[k.c],at[ze]=Et.x,at[ze+1]=Et.y,at[ze+2]=Et.z,at[ze+3]=Et.w,at[ze+4]=Ft.x,at[ze+5]=Ft.y,at[ze+6]=Ft.z,at[ze+7]=Ft.w,at[ze+8]=Lt.x,at[ze+9]=Lt.y,at[ze+10]=Lt.z,at[ze+11]=Lt.w,ze+=12;ze>0&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglSkinIndicesBuffer),u.bufferData(u.ARRAY_BUFFER,at,C),u.bindBuffer(u.ARRAY_BUFFER,f.__webglSkinWeightsBuffer),u.bufferData(u.ARRAY_BUFFER,ot,C))}if(on){for(T=0,P=Me.length;T<P;T++)k=Mt[Me[T]],me=k.vertexColors,te=k.color,me.length===3&&L.vertexColors===t.VertexColors?(_e=me[0],Ct=me[1],vt=me[2]):(_e=te,Ct=te,vt=te),wt[pt]=_e.r,wt[pt+1]=_e.g,wt[pt+2]=_e.b,wt[pt+3]=Ct.r,wt[pt+4]=Ct.g,wt[pt+5]=Ct.b,wt[pt+6]=vt.r,wt[pt+7]=vt.g,wt[pt+8]=vt.b,pt+=9;pt>0&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,wt,C))}if(an&&qe.hasTangents){for(T=0,P=Me.length;T<P;T++)k=Mt[Me[T]],ve=k.vertexTangents,De=ve[0],pe=ve[1],Pe=ve[2],nt[it]=De.x,nt[it+1]=De.y,nt[it+2]=De.z,nt[it+3]=De.w,nt[it+4]=pe.x,nt[it+5]=pe.y,nt[it+6]=pe.z,nt[it+7]=pe.w,nt[it+8]=Pe.x,nt[it+9]=Pe.y,nt[it+10]=Pe.z,nt[it+11]=Pe.w,it+=12;u.bindBuffer(u.ARRAY_BUFFER,f.__webglTangentBuffer),u.bufferData(u.ARRAY_BUFFER,nt,C)}if(nn){for(T=0,P=Me.length;T<P;T++)if(k=Mt[Me[T]],W=k.vertexNormals,ie=k.normal,W.length===3&&N)for(ke=0;ke<3;ke++)dt=W[ke],zt[Dt]=dt.x,zt[Dt+1]=dt.y,zt[Dt+2]=dt.z,Dt+=3;else for(ke=0;ke<3;ke++)zt[Dt]=ie.x,zt[Dt+1]=ie.y,zt[Dt+2]=ie.z,Dt+=3;u.bindBuffer(u.ARRAY_BUFFER,f.__webglNormalBuffer),u.bufferData(u.ARRAY_BUFFER,zt,C)}if(ai&&oi){for(T=0,P=Me.length;T<P;T++)if(O=Me[T],he=oi[O],he!==void 0)for(ke=0;ke<3;ke++)rt=he[ke],Sr[ir]=rt.x,Sr[ir+1]=rt.y,ir+=2;ir>0&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglUVBuffer),u.bufferData(u.ARRAY_BUFFER,Sr,C))}if(ai&&si){for(T=0,P=Me.length;T<P;T++)if(O=Me[T],ye=si[O],ye!==void 0)for(ke=0;ke<3;ke++)ht=ye[ke],Tr[nr]=ht.x,Tr[nr+1]=ht.y,nr+=2;nr>0&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglUV2Buffer),u.bufferData(u.ARRAY_BUFFER,Tr,C))}if(rn){for(T=0,P=Me.length;T<P;T++)or[ar]=yt,or[ar+1]=yt+1,or[ar+2]=yt+2,ar+=3,Vt[Bt]=yt,Vt[Bt+1]=yt+1,Vt[Bt+2]=yt,Vt[Bt+3]=yt+2,Vt[Bt+4]=yt+1,Vt[Bt+5]=yt+2,Bt+=6,yt+=3;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,or,C),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,Vt,C)}if(Cr){for(ke=0,At=Cr.length;ke<At;ke++)if(Q=Cr[ke],!!Q.__original.needsUpdate){if(j=0,Q.size===1){if(Q.boundTo===void 0||Q.boundTo==="vertices")for(T=0,P=Me.length;T<P;T++)k=Mt[Me[T]],Q.array[j]=Q.value[k.a],Q.array[j+1]=Q.value[k.b],Q.array[j+2]=Q.value[k.c],j+=3;else if(Q.boundTo==="faces")for(T=0,P=Me.length;T<P;T++)Ne=Q.value[Me[T]],Q.array[j]=Ne,Q.array[j+1]=Ne,Q.array[j+2]=Ne,j+=3}else if(Q.size===2){if(Q.boundTo===void 0||Q.boundTo==="vertices")for(T=0,P=Me.length;T<P;T++)k=Mt[Me[T]],ue=Q.value[k.a],oe=Q.value[k.b],le=Q.value[k.c],Q.array[j]=ue.x,Q.array[j+1]=ue.y,Q.array[j+2]=oe.x,Q.array[j+3]=oe.y,Q.array[j+4]=le.x,Q.array[j+5]=le.y,j+=6;else if(Q.boundTo==="faces")for(T=0,P=Me.length;T<P;T++)Ne=Q.value[Me[T]],ue=Ne,oe=Ne,le=Ne,Q.array[j]=ue.x,Q.array[j+1]=ue.y,Q.array[j+2]=oe.x,Q.array[j+3]=oe.y,Q.array[j+4]=le.x,Q.array[j+5]=le.y,j+=6}else if(Q.size===3){var Fe;if(Q.type==="c"?Fe=["r","g","b"]:Fe=["x","y","z"],Q.boundTo===void 0||Q.boundTo==="vertices")for(T=0,P=Me.length;T<P;T++)k=Mt[Me[T]],ue=Q.value[k.a],oe=Q.value[k.b],le=Q.value[k.c],Q.array[j]=ue[Fe[0]],Q.array[j+1]=ue[Fe[1]],Q.array[j+2]=ue[Fe[2]],Q.array[j+3]=oe[Fe[0]],Q.array[j+4]=oe[Fe[1]],Q.array[j+5]=oe[Fe[2]],Q.array[j+6]=le[Fe[0]],Q.array[j+7]=le[Fe[1]],Q.array[j+8]=le[Fe[2]],j+=9;else if(Q.boundTo==="faces")for(T=0,P=Me.length;T<P;T++)Ne=Q.value[Me[T]],ue=Ne,oe=Ne,le=Ne,Q.array[j]=ue[Fe[0]],Q.array[j+1]=ue[Fe[1]],Q.array[j+2]=ue[Fe[2]],Q.array[j+3]=oe[Fe[0]],Q.array[j+4]=oe[Fe[1]],Q.array[j+5]=oe[Fe[2]],Q.array[j+6]=le[Fe[0]],Q.array[j+7]=le[Fe[1]],Q.array[j+8]=le[Fe[2]],j+=9;else if(Q.boundTo==="faceVertices")for(T=0,P=Me.length;T<P;T++)Ne=Q.value[Me[T]],ue=Ne[0],oe=Ne[1],le=Ne[2],Q.array[j]=ue[Fe[0]],Q.array[j+1]=ue[Fe[1]],Q.array[j+2]=ue[Fe[2]],Q.array[j+3]=oe[Fe[0]],Q.array[j+4]=oe[Fe[1]],Q.array[j+5]=oe[Fe[2]],Q.array[j+6]=le[Fe[0]],Q.array[j+7]=le[Fe[1]],Q.array[j+8]=le[Fe[2]],j+=9}else if(Q.size===4){if(Q.boundTo===void 0||Q.boundTo==="vertices")for(T=0,P=Me.length;T<P;T++)k=Mt[Me[T]],ue=Q.value[k.a],oe=Q.value[k.b],le=Q.value[k.c],Q.array[j]=ue.x,Q.array[j+1]=ue.y,Q.array[j+2]=ue.z,Q.array[j+3]=ue.w,Q.array[j+4]=oe.x,Q.array[j+5]=oe.y,Q.array[j+6]=oe.z,Q.array[j+7]=oe.w,Q.array[j+8]=le.x,Q.array[j+9]=le.y,Q.array[j+10]=le.z,Q.array[j+11]=le.w,j+=12;else if(Q.boundTo==="faces")for(T=0,P=Me.length;T<P;T++)Ne=Q.value[Me[T]],ue=Ne,oe=Ne,le=Ne,Q.array[j]=ue.x,Q.array[j+1]=ue.y,Q.array[j+2]=ue.z,Q.array[j+3]=ue.w,Q.array[j+4]=oe.x,Q.array[j+5]=oe.y,Q.array[j+6]=oe.z,Q.array[j+7]=oe.w,Q.array[j+8]=le.x,Q.array[j+9]=le.y,Q.array[j+10]=le.z,Q.array[j+11]=le.w,j+=12;else if(Q.boundTo==="faceVertices")for(T=0,P=Me.length;T<P;T++)Ne=Q.value[Me[T]],ue=Ne[0],oe=Ne[1],le=Ne[2],Q.array[j]=ue.x,Q.array[j+1]=ue.y,Q.array[j+2]=ue.z,Q.array[j+3]=ue.w,Q.array[j+4]=oe.x,Q.array[j+5]=oe.y,Q.array[j+6]=oe.z,Q.array[j+7]=oe.w,Q.array[j+8]=le.x,Q.array[j+9]=le.y,Q.array[j+10]=le.z,Q.array[j+11]=le.w,j+=12}u.bindBuffer(u.ARRAY_BUFFER,Q.buffer),u.bufferData(u.ARRAY_BUFFER,Q.array,C)}}S&&(delete f.__inittedArrays,delete f.__colorArray,delete f.__normalArray,delete f.__tangentArray,delete f.__uvArray,delete f.__uv2Array,delete f.__faceArray,delete f.__vertexArray,delete f.__lineArray,delete f.__skinIndexArray,delete f.__skinWeightArray)}}function Ti(f){for(var y=f.attributes,C=f.attributesKeys,S=0,L=C.length;S<L;S++){var N=C[S],T=y[N];if(T.buffer===void 0&&(T.buffer=u.createBuffer(),T.needsUpdate=!0),T.needsUpdate===!0){var P=N==="index"?u.ELEMENT_ARRAY_BUFFER:u.ARRAY_BUFFER;u.bindBuffer(P,T.buffer),u.bufferData(P,T.array,u.STATIC_DRAW),T.needsUpdate=!1}}}this.renderBufferImmediate=function(f,y,C){if(pr(),f.hasPositions&&!f.__webglVertexBuffer&&(f.__webglVertexBuffer=u.createBuffer()),f.hasNormals&&!f.__webglNormalBuffer&&(f.__webglNormalBuffer=u.createBuffer()),f.hasUvs&&!f.__webglUvBuffer&&(f.__webglUvBuffer=u.createBuffer()),f.hasColors&&!f.__webglColorBuffer&&(f.__webglColorBuffer=u.createBuffer()),f.hasPositions&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglVertexBuffer),u.bufferData(u.ARRAY_BUFFER,f.positionArray,u.DYNAMIC_DRAW),He(y.attributes.position),u.vertexAttribPointer(y.attributes.position,3,u.FLOAT,!1,0,0)),f.hasNormals){if(u.bindBuffer(u.ARRAY_BUFFER,f.__webglNormalBuffer),C.shading===t.FlatShading){var S,L,N,T,P,O,k,W,ie,me,te,ve,he,ye,ue=f.count*3;for(ye=0;ye<ue;ye+=9)he=f.normalArray,T=he[ye],k=he[ye+1],me=he[ye+2],P=he[ye+3],W=he[ye+4],te=he[ye+5],O=he[ye+6],ie=he[ye+7],ve=he[ye+8],S=(T+P+O)/3,L=(k+W+ie)/3,N=(me+te+ve)/3,he[ye]=S,he[ye+1]=L,he[ye+2]=N,he[ye+3]=S,he[ye+4]=L,he[ye+5]=N,he[ye+6]=S,he[ye+7]=L,he[ye+8]=N}u.bufferData(u.ARRAY_BUFFER,f.normalArray,u.DYNAMIC_DRAW),He(y.attributes.normal),u.vertexAttribPointer(y.attributes.normal,3,u.FLOAT,!1,0,0)}f.hasUvs&&C.map&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglUvBuffer),u.bufferData(u.ARRAY_BUFFER,f.uvArray,u.DYNAMIC_DRAW),He(y.attributes.uv),u.vertexAttribPointer(y.attributes.uv,2,u.FLOAT,!1,0,0)),f.hasColors&&C.vertexColors!==t.NoColors&&(u.bindBuffer(u.ARRAY_BUFFER,f.__webglColorBuffer),u.bufferData(u.ARRAY_BUFFER,f.colorArray,u.DYNAMIC_DRAW),He(y.attributes.color),u.vertexAttribPointer(y.attributes.color,3,u.FLOAT,!1,0,0)),vr(),u.drawArrays(u.TRIANGLES,0,f.count),f.count=0};function Rt(f,y,C,S){for(var L=C.attributes,N=y.attributes,T=y.attributesKeys,P=0,O=T.length;P<O;P++){var k=T[P],W=N[k];if(W>=0){var ie=L[k];if(ie!==void 0){var me=ie.itemSize;u.bindBuffer(u.ARRAY_BUFFER,ie.buffer),He(W),u.vertexAttribPointer(W,me,u.FLOAT,!1,0,S*me*4)}else f.defaultAttributeValues!==void 0&&(f.defaultAttributeValues[k].length===2?u.vertexAttrib2fv(W,f.defaultAttributeValues[k]):f.defaultAttributeValues[k].length===3&&u.vertexAttrib3fv(W,f.defaultAttributeValues[k]))}}vr()}this.renderBufferDirect=function(f,y,C,S,L,N){if(S.visible!==!1){var T=_r(f,y,C,S,N),P=!1,O=S.wireframe?1:0,k=L.id*16777215+T.id*2+O;if(k!==V&&(V=k,P=!0),P&&pr(),N instanceof t.Mesh){var W=S.wireframe===!0?u.LINES:u.TRIANGLES,ie=L.attributes.index;if(ie){var me,te;ie.array instanceof Uint32Array&&xe.get("OES_element_index_uint")?(me=u.UNSIGNED_INT,te=4):(me=u.UNSIGNED_SHORT,te=2);var ve=L.offsets;if(ve.length===0)P&&(Rt(S,T,L,0),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,ie.buffer)),u.drawElements(W,ie.array.length,me,0),M.info.render.calls++,M.info.render.vertices+=ie.array.length,M.info.render.faces+=ie.array.length/3;else{P=!0;for(var he=0,ye=ve.length;he<ye;he++){var ue=ve[he].index;P&&(Rt(S,T,L,ue),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,ie.buffer)),u.drawElements(W,ve[he].count,me,ve[he].start*te),M.info.render.calls++,M.info.render.vertices+=ve[he].count,M.info.render.faces+=ve[he].count/3}}}else{P&&Rt(S,T,L,0);var oe=L.attributes.position;u.drawArrays(W,0,oe.array.length/3),M.info.render.calls++,M.info.render.vertices+=oe.array.length/3,M.info.render.faces+=oe.array.length/9}}else if(N instanceof t.PointCloud){P&&Rt(S,T,L,0);var oe=L.attributes.position;u.drawArrays(u.POINTS,0,oe.array.length/3),M.info.render.calls++,M.info.render.points+=oe.array.length/3}else if(N instanceof t.Line){var W=N.mode===t.LineStrip?u.LINE_STRIP:u.LINES;Mr(S.linewidth);var ie=L.attributes.index;if(ie){var me,te;ie.array instanceof Uint32Array?(me=u.UNSIGNED_INT,te=4):(me=u.UNSIGNED_SHORT,te=2);var ve=L.offsets;if(ve.length===0)P&&(Rt(S,T,L,0),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,ie.buffer)),u.drawElements(W,ie.array.length,me,0),M.info.render.calls++,M.info.render.vertices+=ie.array.length;else{ve.length>1&&(P=!0);for(var he=0,ye=ve.length;he<ye;he++){var ue=ve[he].index;P&&(Rt(S,T,L,ue),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,ie.buffer)),u.drawElements(W,ve[he].count,me,ve[he].start*te),M.info.render.calls++,M.info.render.vertices+=ve[he].count}}}else{P&&Rt(S,T,L,0);var oe=L.attributes.position;u.drawArrays(W,0,oe.array.length/3),M.info.render.calls++,M.info.render.points+=oe.array.length/3}}}},this.renderBuffer=function(f,y,C,S,L,N){if(S.visible!==!1){var T=_r(f,y,C,S,N),P=T.attributes,O=!1,k=S.wireframe?1:0,W=L.id*16777215+T.id*2+k;if(W!==V&&(V=W,O=!0),O&&pr(),!S.morphTargets&&P.position>=0?O&&(u.bindBuffer(u.ARRAY_BUFFER,L.__webglVertexBuffer),He(P.position),u.vertexAttribPointer(P.position,3,u.FLOAT,!1,0,0)):N.morphTargetBase&&Ci(S,L,N),O){if(L.__webglCustomAttributesList)for(var ie=0,me=L.__webglCustomAttributesList.length;ie<me;ie++){var te=L.__webglCustomAttributesList[ie];P[te.buffer.belongsToAttribute]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,te.buffer),He(P[te.buffer.belongsToAttribute]),u.vertexAttribPointer(P[te.buffer.belongsToAttribute],te.size,u.FLOAT,!1,0,0))}P.color>=0&&(N.geometry.colors.length>0||N.geometry.faces.length>0?(u.bindBuffer(u.ARRAY_BUFFER,L.__webglColorBuffer),He(P.color),u.vertexAttribPointer(P.color,3,u.FLOAT,!1,0,0)):S.defaultAttributeValues!==void 0&&u.vertexAttrib3fv(P.color,S.defaultAttributeValues.color)),P.normal>=0&&(u.bindBuffer(u.ARRAY_BUFFER,L.__webglNormalBuffer),He(P.normal),u.vertexAttribPointer(P.normal,3,u.FLOAT,!1,0,0)),P.tangent>=0&&(u.bindBuffer(u.ARRAY_BUFFER,L.__webglTangentBuffer),He(P.tangent),u.vertexAttribPointer(P.tangent,4,u.FLOAT,!1,0,0)),P.uv>=0&&(N.geometry.faceVertexUvs[0]?(u.bindBuffer(u.ARRAY_BUFFER,L.__webglUVBuffer),He(P.uv),u.vertexAttribPointer(P.uv,2,u.FLOAT,!1,0,0)):S.defaultAttributeValues!==void 0&&u.vertexAttrib2fv(P.uv,S.defaultAttributeValues.uv)),P.uv2>=0&&(N.geometry.faceVertexUvs[1]?(u.bindBuffer(u.ARRAY_BUFFER,L.__webglUV2Buffer),He(P.uv2),u.vertexAttribPointer(P.uv2,2,u.FLOAT,!1,0,0)):S.defaultAttributeValues!==void 0&&u.vertexAttrib2fv(P.uv2,S.defaultAttributeValues.uv2)),S.skinning&&P.skinIndex>=0&&P.skinWeight>=0&&(u.bindBuffer(u.ARRAY_BUFFER,L.__webglSkinIndicesBuffer),He(P.skinIndex),u.vertexAttribPointer(P.skinIndex,4,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,L.__webglSkinWeightsBuffer),He(P.skinWeight),u.vertexAttribPointer(P.skinWeight,4,u.FLOAT,!1,0,0)),P.lineDistance>=0&&(u.bindBuffer(u.ARRAY_BUFFER,L.__webglLineDistanceBuffer),He(P.lineDistance),u.vertexAttribPointer(P.lineDistance,1,u.FLOAT,!1,0,0))}if(vr(),N instanceof t.Mesh){var ve=L.__typeArray===Uint32Array?u.UNSIGNED_INT:u.UNSIGNED_SHORT;S.wireframe?(Mr(S.wireframeLinewidth),O&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,L.__webglLineBuffer),u.drawElements(u.LINES,L.__webglLineCount,ve,0)):(O&&u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,L.__webglFaceBuffer),u.drawElements(u.TRIANGLES,L.__webglFaceCount,ve,0)),M.info.render.calls++,M.info.render.vertices+=L.__webglFaceCount,M.info.render.faces+=L.__webglFaceCount/3}else if(N instanceof t.Line){var he=N.mode===t.LineStrip?u.LINE_STRIP:u.LINES;Mr(S.linewidth),u.drawArrays(he,0,L.__webglLineCount),M.info.render.calls++}else N instanceof t.PointCloud&&(u.drawArrays(u.POINTS,0,L.__webglParticleCount),M.info.render.calls++,M.info.render.points+=L.__webglParticleCount)}};function pr(){for(var f=0,y=Te.length;f<y;f++)Te[f]=0}function He(f){Te[f]=1,Be[f]===0&&(u.enableVertexAttribArray(f),Be[f]=1)}function vr(){for(var f=0,y=Be.length;f<y;f++)Be[f]!==Te[f]&&(u.disableVertexAttribArray(f),Be[f]=0)}function Ci(f,y,C){var S=f.program.attributes;if(C.morphTargetBase!==-1&&S.position>=0?(u.bindBuffer(u.ARRAY_BUFFER,y.__webglMorphTargetsBuffers[C.morphTargetBase]),He(S.position),u.vertexAttribPointer(S.position,3,u.FLOAT,!1,0,0)):S.position>=0&&(u.bindBuffer(u.ARRAY_BUFFER,y.__webglVertexBuffer),He(S.position),u.vertexAttribPointer(S.position,3,u.FLOAT,!1,0,0)),C.morphTargetForcedOrder.length)for(var L=0,N=C.morphTargetForcedOrder,T=C.morphTargetInfluences;L<f.numSupportedMorphTargets&&L<N.length;)S["morphTarget"+L]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,y.__webglMorphTargetsBuffers[N[L]]),He(S["morphTarget"+L]),u.vertexAttribPointer(S["morphTarget"+L],3,u.FLOAT,!1,0,0)),S["morphNormal"+L]>=0&&f.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,y.__webglMorphNormalsBuffers[N[L]]),He(S["morphNormal"+L]),u.vertexAttribPointer(S["morphNormal"+L],3,u.FLOAT,!1,0,0)),C.__webglMorphTargetInfluences[L]=T[N[L]],L++;else{var P,O=[],T=C.morphTargetInfluences,k,W=T.length;for(k=0;k<W;k++)P=T[k],P>0&&O.push([P,k]);O.length>f.numSupportedMorphTargets?(O.sort(mr),O.length=f.numSupportedMorphTargets):O.length>f.numSupportedMorphNormals?O.sort(mr):O.length===0&&O.push([0,0]);for(var ie,L=0;L<f.numSupportedMorphTargets;)O[L]?(ie=O[L][1],S["morphTarget"+L]>=0&&(u.bindBuffer(u.ARRAY_BUFFER,y.__webglMorphTargetsBuffers[ie]),He(S["morphTarget"+L]),u.vertexAttribPointer(S["morphTarget"+L],3,u.FLOAT,!1,0,0)),S["morphNormal"+L]>=0&&f.morphNormals&&(u.bindBuffer(u.ARRAY_BUFFER,y.__webglMorphNormalsBuffers[ie]),He(S["morphNormal"+L]),u.vertexAttribPointer(S["morphNormal"+L],3,u.FLOAT,!1,0,0)),C.__webglMorphTargetInfluences[L]=T[ie]):C.__webglMorphTargetInfluences[L]=0,L++}f.program.uniforms.morphTargetInfluences!==null&&u.uniform1fv(f.program.uniforms.morphTargetInfluences,C.__webglMorphTargetInfluences)}function Ai(f,y){return f.material.id!==y.material.id?y.material.id-f.material.id:f.z!==y.z?y.z-f.z:f.id-y.id}function Ei(f,y){return f.z!==y.z?f.z-y.z:f.id-y.id}function mr(f,y){return y[0]-f[0]}this.render=function(f,y,C,S){if(!(y instanceof t.Camera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var L=f.fog;V=-1,B=-1,U=null,Tt=!0,f.autoUpdate===!0&&f.updateMatrixWorld(),y.parent===void 0&&y.updateMatrixWorld(),f.traverse(function(W){W instanceof t.SkinnedMesh&&W.skeleton.update()}),y.matrixWorldInverse.getInverse(y.matrixWorld),Ze.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),Ce.setFromMatrix(Ze),g.length=0,_.length=0,b.length=0,A.length=0,E.length=0,Yr(f,f),M.sortObjects===!0&&(_.sort(Ai),b.sort(Ei)),ur.render(f,y),M.info.render.calls=0,M.info.render.vertices=0,M.info.render.faces=0,M.info.render.points=0,this.setRenderTarget(C),(this.autoClear||S)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);for(var N=0,T=w.length;N<T;N++){var P=w[N],O=P.object;O.visible&&($r(O,y),Fi(P))}if(f.overrideMaterial){var k=f.overrideMaterial;this.setBlending(k.blending,k.blendEquation,k.blendSrc,k.blendDst),this.setDepthTest(k.depthTest),this.setDepthWrite(k.depthWrite),br(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits),Jt(_,y,g,L,!0,k),Jt(b,y,g,L,!0,k),gr(w,"",y,g,L,!1,k)}else{var k=null;this.setBlending(t.NoBlending),Jt(_,y,g,L,!1,k),gr(w,"opaque",y,g,L,!1,k),Jt(b,y,g,L,!0,k),gr(w,"transparent",y,g,L,!0,k)}cr.render(f,y),Qt.render(f,y,we,Ee),C&&C.generateMipmaps&&C.minFilter!==t.NearestFilter&&C.minFilter!==t.LinearFilter&&$i(C),this.setDepthTest(!0),this.setDepthWrite(!0)};function Yr(f,y){if(y.visible!==!1){if(!(y instanceof t.Scene||y instanceof t.Group))if(Di(y,f),y instanceof t.Light)g.push(y);else if(y instanceof t.Sprite)A.push(y);else if(y instanceof t.LensFlare)E.push(y);else{var C=x[y.id];if(C&&(y.frustumCulled===!1||Ce.intersectsObject(y)===!0)){Ui(y,f);for(var S=0,L=C.length;S<L;S++){var N=C[S];Li(N),N.render=!0,M.sortObjects===!0&&(y.renderDepth!==null?N.z=y.renderDepth:(Oe.setFromMatrixPosition(y.matrixWorld),Oe.applyProjection(Ze),N.z=Oe.z))}}}for(var S=0,L=y.children.length;S<L;S++)Yr(f,y.children[S])}}function Jt(f,y,C,S,L,N){for(var T,P=f.length-1;P!==-1;P--){var O=f[P],k=O.object,W=O.buffer;if($r(k,y),N)T=N;else{if(T=O.material,!T)continue;L&&M.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),M.setDepthTest(T.depthTest),M.setDepthWrite(T.depthWrite),br(T.polygonOffset,T.polygonOffsetFactor,T.polygonOffsetUnits)}M.setMaterialFaces(T),W instanceof t.BufferGeometry?M.renderBufferDirect(y,C,S,T,W,k):M.renderBuffer(y,C,S,T,W,k)}}function gr(f,y,C,S,L,N,T){for(var P,O=0,k=f.length;O<k;O++){var W=f[O],ie=W.object;if(ie.visible){if(T)P=T;else{if(P=W[y],!P)continue;N&&M.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),M.setDepthTest(P.depthTest),M.setDepthWrite(P.depthWrite),br(P.polygonOffset,P.polygonOffsetFactor,P.polygonOffsetUnits)}M.renderImmediateObject(C,S,L,P,ie)}}}this.renderImmediateObject=function(f,y,C,S,L){var N=_r(f,y,C,S,L);V=-1,M.setMaterialFaces(S),L.immediateRenderCallback?L.immediateRenderCallback(N,u,Ce):L.render(function(T){M.renderBufferImmediate(T,N,S)})};function Fi(f){var y=f.object,C=y.material;C.transparent?(f.transparent=C,f.opaque=null):(f.opaque=C,f.transparent=null)}function Li(f){var y=f.object,C=f.buffer,S=y.geometry,L=y.material;if(L instanceof t.MeshFaceMaterial){var N=S instanceof t.BufferGeometry?0:C.materialIndex;L=L.materials[N],f.material=L,L.transparent?b.push(f):_.push(f)}else L&&(f.material=L,L.transparent?b.push(f):_.push(f))}function Di(f,y){f.__webglInit===void 0&&(f.__webglInit=!0,f._modelViewMatrix=new t.Matrix4,f._normalMatrix=new t.Matrix3,f.addEventListener("removed",Nr));var C=f.geometry;if(C===void 0||C.__webglInit===void 0&&(C.__webglInit=!0,C.addEventListener("dispose",kr),C instanceof t.BufferGeometry||(f instanceof t.Mesh?Kr(y,f,C):f instanceof t.Line?C.__webglVertexBuffer===void 0&&(Nt(C),_i(C,f),C.verticesNeedUpdate=!0,C.colorsNeedUpdate=!0,C.lineDistancesNeedUpdate=!0):f instanceof t.PointCloud&&C.__webglVertexBuffer===void 0&&(Zt(C),xi(C,f),C.verticesNeedUpdate=!0,C.colorsNeedUpdate=!0))),f.__webglActive===void 0)if(f.__webglActive=!0,f instanceof t.Mesh){if(C instanceof t.BufferGeometry)jt(x,C,f);else if(C instanceof t.Geometry)for(var S=Ut[C.id],L=0,N=S.length;L<N;L++)jt(x,S[L],f)}else f instanceof t.Line||f instanceof t.PointCloud?jt(x,C,f):(f instanceof t.ImmediateRenderObject||f.immediateRenderCallback)&&Ri(w,f)}var Ut={},qr=0;function Pi(f,y){for(var C=xe.get("OES_element_index_uint")?4294967296:65535,S,L={},N=f.morphTargets.length,T=f.morphNormals.length,P,O={},k=[],W=0,ie=f.faces.length;W<ie;W++){var me=f.faces[W],te=y?me.materialIndex:0;te in L||(L[te]={hash:te,counter:0}),S=L[te].hash+"_"+L[te].counter,S in O||(P={id:qr++,faces3:[],materialIndex:te,vertices:0,numMorphTargets:N,numMorphNormals:T},O[S]=P,k.push(P)),O[S].vertices+3>C&&(L[te].counter+=1,S=L[te].hash+"_"+L[te].counter,S in O||(P={id:qr++,faces3:[],materialIndex:te,vertices:0,numMorphTargets:N,numMorphNormals:T},O[S]=P,k.push(P))),O[S].faces3.push(W),O[S].vertices+=3}return k}function Kr(f,y,C){var S=y.material,L=!1;(Ut[C.id]===void 0||C.groupsNeedUpdate===!0)&&(delete x[y.id],Ut[C.id]=Pi(C,S instanceof t.MeshFaceMaterial),C.groupsNeedUpdate=!1);for(var N=Ut[C.id],T=0,P=N.length;T<P;T++){var O=N[T];O.__webglVertexBuffer===void 0?(vi(O),Xr(O,y),C.verticesNeedUpdate=!0,C.morphTargetsNeedUpdate=!0,C.elementsNeedUpdate=!0,C.uvsNeedUpdate=!0,C.normalsNeedUpdate=!0,C.tangentsNeedUpdate=!0,C.colorsNeedUpdate=!0,L=!0):L=!1,(L||y.__webglActive===void 0)&&jt(x,O,y)}y.__webglActive=!0}function jt(f,y,C){var S=C.id;f[S]=f[S]||[],f[S].push({id:S,buffer:y,object:C,material:null,z:0})}function Ri(f,y){f.push({id:null,object:y,opaque:null,transparent:null,z:0})}function Ui(f,y){var C=f.geometry,S,L;if(C instanceof t.BufferGeometry)Ti(C);else if(f instanceof t.Mesh){C.groupsNeedUpdate===!0&&Kr(y,f,C);for(var N=Ut[C.id],T=0,P=N.length;T<P;T++){var O=N[T];L=$t(f,O),C.groupsNeedUpdate===!0&&Xr(O,f),S=L.attributes&&yr(L),(C.verticesNeedUpdate||C.morphTargetsNeedUpdate||C.elementsNeedUpdate||C.uvsNeedUpdate||C.normalsNeedUpdate||C.colorsNeedUpdate||C.tangentsNeedUpdate||S)&&Si(O,f,u.DYNAMIC_DRAW,!C.dynamic,L)}C.verticesNeedUpdate=!1,C.morphTargetsNeedUpdate=!1,C.elementsNeedUpdate=!1,C.uvsNeedUpdate=!1,C.normalsNeedUpdate=!1,C.colorsNeedUpdate=!1,C.tangentsNeedUpdate=!1,L.attributes&&xr(L)}else f instanceof t.Line?(L=$t(f,C),S=L.attributes&&yr(L),(C.verticesNeedUpdate||C.colorsNeedUpdate||C.lineDistancesNeedUpdate||S)&&bi(C,u.DYNAMIC_DRAW),C.verticesNeedUpdate=!1,C.colorsNeedUpdate=!1,C.lineDistancesNeedUpdate=!1,L.attributes&&xr(L)):f instanceof t.PointCloud&&(L=$t(f,C),S=L.attributes&&yr(L),(C.verticesNeedUpdate||C.colorsNeedUpdate||f.sortParticles||S)&&Mi(C,u.DYNAMIC_DRAW,f),C.verticesNeedUpdate=!1,C.colorsNeedUpdate=!1,L.attributes&&xr(L))}function yr(f){for(var y in f.attributes)if(f.attributes[y].needsUpdate)return!0;return!1}function xr(f){for(var y in f.attributes)f.attributes[y].needsUpdate=!1}function Bi(f){f instanceof t.Mesh||f instanceof t.PointCloud||f instanceof t.Line?delete x[f.id]:(f instanceof t.ImmediateRenderObject||f.immediateRenderCallback)&&zi(w,f),delete f.__webglInit,delete f._modelViewMatrix,delete f._normalMatrix,delete f.__webglActive}function zi(f,y){for(var C=f.length-1;C>=0;C--)f[C].object===y&&f.splice(C,1)}function Vi(f,y,C,S){f.addEventListener("dispose",Ir);var L;if(f instanceof t.MeshDepthMaterial?L="depth":f instanceof t.MeshNormalMaterial?L="normal":f instanceof t.MeshBasicMaterial?L="basic":f instanceof t.MeshLambertMaterial?L="lambert":f instanceof t.MeshPhongMaterial?L="phong":f instanceof t.LineBasicMaterial?L="basic":f instanceof t.LineDashedMaterial?L="dashed":f instanceof t.PointCloudMaterial&&(L="particle_basic"),L){var N=t.ShaderLib[L];f.__webglShader={uniforms:t.UniformsUtils.clone(N.uniforms),vertexShader:N.vertexShader,fragmentShader:N.fragmentShader}}else f.__webglShader={uniforms:f.uniforms,vertexShader:f.vertexShader,fragmentShader:f.fragmentShader};var T=ji(y),P=en(y),O=Ji(S),k={precision:a,supportsVertexTextures:Qe,map:!!f.map,envMap:!!f.envMap,lightMap:!!f.lightMap,bumpMap:!!f.bumpMap,normalMap:!!f.normalMap,specularMap:!!f.specularMap,alphaMap:!!f.alphaMap,vertexColors:f.vertexColors,fog:C,useFog:f.fog,fogExp:C instanceof t.FogExp2,sizeAttenuation:f.sizeAttenuation,logarithmicDepthBuffer:p,skinning:f.skinning,maxBones:O,useVertexTexture:Ie&&S&&S.skeleton&&S.skeleton.useVertexTexture,morphTargets:f.morphTargets,morphNormals:f.morphNormals,maxMorphTargets:M.maxMorphTargets,maxMorphNormals:M.maxMorphNormals,maxDirLights:T.directional,maxPointLights:T.point,maxSpotLights:T.spot,maxHemiLights:T.hemi,maxShadows:P,shadowMapEnabled:M.shadowMapEnabled&&S.receiveShadow&&P>0,shadowMapType:M.shadowMapType,shadowMapDebug:M.shadowMapDebug,shadowMapCascade:M.shadowMapCascade,alphaTest:f.alphaTest,metal:f.metal,wrapAround:f.wrapAround,doubleSided:f.side===t.DoubleSide,flipSided:f.side===t.BackSide},W=[];if(L?W.push(L):(W.push(f.fragmentShader),W.push(f.vertexShader)),f.defines!==void 0)for(var ie in f.defines)W.push(ie),W.push(f.defines[ie]);for(var ie in k)W.push(ie),W.push(k[ie]);for(var me=W.join(),te,ve=0,he=F.length;ve<he;ve++){var ye=F[ve];if(ye.code===me){te=ye,te.usedTimes++;break}}te===void 0&&(te=new t.WebGLProgram(M,me,f,k),F.push(te),M.info.memory.programs=F.length),f.program=te;var ue=te.attributes;if(f.morphTargets){f.numSupportedMorphTargets=0;for(var oe,le="morphTarget",De=0;De<M.maxMorphTargets;De++)oe=le+De,ue[oe]>=0&&f.numSupportedMorphTargets++}if(f.morphNormals){f.numSupportedMorphNormals=0;var oe,le="morphNormal";for(De=0;De<M.maxMorphNormals;De++)oe=le+De,ue[oe]>=0&&f.numSupportedMorphNormals++}f.uniformsList=[];for(var pe in f.__webglShader.uniforms){var Pe=f.program.uniforms[pe];Pe&&f.uniformsList.push([f.__webglShader.uniforms[pe],Pe])}}function _r(f,y,C,S,L){z=0,S.needsUpdate&&(S.program&&Wr(S),Vi(S,y,C,L),S.needsUpdate=!1),S.morphTargets&&(L.__webglMorphTargetInfluences||(L.__webglMorphTargetInfluences=new Float32Array(M.maxMorphTargets)));var N=!1,T=!1,P=!1,O=S.program,k=O.uniforms,W=S.__webglShader.uniforms;if(O.id!==D&&(u.useProgram(O.program),D=O.id,N=!0,T=!0,P=!0),S.id!==B&&(B===-1&&(P=!0),B=S.id,T=!0),(N||f!==U)&&(u.uniformMatrix4fv(k.projectionMatrix,!1,f.projectionMatrix.elements),p&&u.uniform1f(k.logDepthBufFC,2/(Math.log(f.far+1)/Math.LN2)),f!==U&&(U=f),(S instanceof t.ShaderMaterial||S instanceof t.MeshPhongMaterial||S.envMap)&&k.cameraPosition!==null&&(Oe.setFromMatrixPosition(f.matrixWorld),u.uniform3f(k.cameraPosition,Oe.x,Oe.y,Oe.z)),(S instanceof t.MeshPhongMaterial||S instanceof t.MeshLambertMaterial||S instanceof t.ShaderMaterial||S.skinning)&&k.viewMatrix!==null&&u.uniformMatrix4fv(k.viewMatrix,!1,f.matrixWorldInverse.elements)),S.skinning)if(L.bindMatrix&&k.bindMatrix!==null&&u.uniformMatrix4fv(k.bindMatrix,!1,L.bindMatrix.elements),L.bindMatrixInverse&&k.bindMatrixInverse!==null&&u.uniformMatrix4fv(k.bindMatrixInverse,!1,L.bindMatrixInverse.elements),Ie&&L.skeleton&&L.skeleton.useVertexTexture){if(k.boneTexture!==null){var ie=wr();u.uniform1i(k.boneTexture,ie),M.setTexture(L.skeleton.boneTexture,ie)}k.boneTextureWidth!==null&&u.uniform1i(k.boneTextureWidth,L.skeleton.boneTextureWidth),k.boneTextureHeight!==null&&u.uniform1i(k.boneTextureHeight,L.skeleton.boneTextureHeight)}else L.skeleton&&L.skeleton.boneMatrices&&k.boneGlobalMatrices!==null&&u.uniformMatrix4fv(k.boneGlobalMatrices,!1,L.skeleton.boneMatrices);return T&&(C&&S.fog&&Ii(W,C),(S instanceof t.MeshPhongMaterial||S instanceof t.MeshLambertMaterial||S.lights)&&(Tt&&(P=!0,Ki(y),Tt=!1),P?(Gi(W,Yt),Zr(W,!0)):Zr(W,!1)),(S instanceof t.MeshBasicMaterial||S instanceof t.MeshLambertMaterial||S instanceof t.MeshPhongMaterial)&&Ni(W,S),S instanceof t.LineBasicMaterial?Qr(W,S):S instanceof t.LineDashedMaterial?(Qr(W,S),ki(W,S)):S instanceof t.PointCloudMaterial?Oi(W,S):S instanceof t.MeshPhongMaterial?Hi(W,S):S instanceof t.MeshLambertMaterial?Wi(W,S):S instanceof t.MeshDepthMaterial?(W.mNear.value=f.near,W.mFar.value=f.far,W.opacity.value=S.opacity):S instanceof t.MeshNormalMaterial&&(W.opacity.value=S.opacity),L.receiveShadow&&!S._shadowPass&&Xi(W,y),qi(S.uniformsList)),Yi(k,L),k.modelMatrix!==null&&u.uniformMatrix4fv(k.modelMatrix,!1,L.matrixWorld.elements),O}function Ni(f,y){f.opacity.value=y.opacity,M.gammaInput?f.diffuse.value.copyGammaToLinear(y.color):f.diffuse.value=y.color,f.map.value=y.map,f.lightMap.value=y.lightMap,f.specularMap.value=y.specularMap,f.alphaMap.value=y.alphaMap,y.bumpMap&&(f.bumpMap.value=y.bumpMap,f.bumpScale.value=y.bumpScale),y.normalMap&&(f.normalMap.value=y.normalMap,f.normalScale.value.copy(y.normalScale));var C;if(y.map?C=y.map:y.specularMap?C=y.specularMap:y.normalMap?C=y.normalMap:y.bumpMap?C=y.bumpMap:y.alphaMap&&(C=y.alphaMap),C!==void 0){var S=C.offset,L=C.repeat;f.offsetRepeat.value.set(S.x,S.y,L.x,L.y)}f.envMap.value=y.envMap,f.flipEnvMap.value=y.envMap instanceof t.WebGLRenderTargetCube?1:-1,M.gammaInput,f.reflectivity.value=y.reflectivity,f.refractionRatio.value=y.refractionRatio,f.combine.value=y.combine,f.useRefract.value=y.envMap&&y.envMap.mapping instanceof t.CubeRefractionMapping}function Qr(f,y){f.diffuse.value=y.color,f.opacity.value=y.opacity}function ki(f,y){f.dashSize.value=y.dashSize,f.totalSize.value=y.dashSize+y.gapSize,f.scale.value=y.scale}function Oi(f,y){f.psColor.value=y.color,f.opacity.value=y.opacity,f.size.value=y.size,f.scale.value=r.height/2,f.map.value=y.map}function Ii(f,y){f.fogColor.value=y.color,y instanceof t.Fog?(f.fogNear.value=y.near,f.fogFar.value=y.far):y instanceof t.FogExp2&&(f.fogDensity.value=y.density)}function Hi(f,y){f.shininess.value=y.shininess,M.gammaInput?(f.ambient.value.copyGammaToLinear(y.ambient),f.emissive.value.copyGammaToLinear(y.emissive),f.specular.value.copyGammaToLinear(y.specular)):(f.ambient.value=y.ambient,f.emissive.value=y.emissive,f.specular.value=y.specular),y.wrapAround&&f.wrapRGB.value.copy(y.wrapRGB)}function Wi(f,y){M.gammaInput?(f.ambient.value.copyGammaToLinear(y.ambient),f.emissive.value.copyGammaToLinear(y.emissive)):(f.ambient.value=y.ambient,f.emissive.value=y.emissive),y.wrapAround&&f.wrapRGB.value.copy(y.wrapRGB)}function Gi(f,y){f.ambientLightColor.value=y.ambient,f.directionalLightColor.value=y.directional.colors,f.directionalLightDirection.value=y.directional.positions,f.pointLightColor.value=y.point.colors,f.pointLightPosition.value=y.point.positions,f.pointLightDistance.value=y.point.distances,f.spotLightColor.value=y.spot.colors,f.spotLightPosition.value=y.spot.positions,f.spotLightDistance.value=y.spot.distances,f.spotLightDirection.value=y.spot.directions,f.spotLightAngleCos.value=y.spot.anglesCos,f.spotLightExponent.value=y.spot.exponents,f.hemisphereLightSkyColor.value=y.hemi.skyColors,f.hemisphereLightGroundColor.value=y.hemi.groundColors,f.hemisphereLightDirection.value=y.hemi.positions}function Zr(f,y){f.ambientLightColor.needsUpdate=y,f.directionalLightColor.needsUpdate=y,f.directionalLightDirection.needsUpdate=y,f.pointLightColor.needsUpdate=y,f.pointLightPosition.needsUpdate=y,f.pointLightDistance.needsUpdate=y,f.spotLightColor.needsUpdate=y,f.spotLightPosition.needsUpdate=y,f.spotLightDistance.needsUpdate=y,f.spotLightDirection.needsUpdate=y,f.spotLightAngleCos.needsUpdate=y,f.spotLightExponent.needsUpdate=y,f.hemisphereLightSkyColor.needsUpdate=y,f.hemisphereLightGroundColor.needsUpdate=y,f.hemisphereLightDirection.needsUpdate=y}function Xi(f,y){if(f.shadowMatrix)for(var C=0,S=0,L=y.length;S<L;S++){var N=y[S];N.castShadow&&(N instanceof t.SpotLight||N instanceof t.DirectionalLight&&!N.shadowCascade)&&(f.shadowMap.value[C]=N.shadowMap,f.shadowMapSize.value[C]=N.shadowMapSize,f.shadowMatrix.value[C]=N.shadowMatrix,f.shadowDarkness.value[C]=N.shadowDarkness,f.shadowBias.value[C]=N.shadowBias,C++)}}function Yi(f,y){u.uniformMatrix4fv(f.modelViewMatrix,!1,y._modelViewMatrix.elements),f.normalMatrix&&u.uniformMatrix3fv(f.normalMatrix,!1,y._normalMatrix.elements)}function wr(){var f=z;return f>=Ye&&console.warn("WebGLRenderer: trying to use "+f+" texture units while this GPU supports only "+Ye),z+=1,f}function qi(f){for(var y,C,S,L=0,N=f.length;L<N;L++){var T=f[L][0];if(T.needsUpdate!==!1){var P=T.type,O=T.value,k=f[L][1];switch(P){case"1i":u.uniform1i(k,O);break;case"1f":u.uniform1f(k,O);break;case"2f":u.uniform2f(k,O[0],O[1]);break;case"3f":u.uniform3f(k,O[0],O[1],O[2]);break;case"4f":u.uniform4f(k,O[0],O[1],O[2],O[3]);break;case"1iv":u.uniform1iv(k,O);break;case"3iv":u.uniform3iv(k,O);break;case"1fv":u.uniform1fv(k,O);break;case"2fv":u.uniform2fv(k,O);break;case"3fv":u.uniform3fv(k,O);break;case"4fv":u.uniform4fv(k,O);break;case"Matrix3fv":u.uniformMatrix3fv(k,!1,O);break;case"Matrix4fv":u.uniformMatrix4fv(k,!1,O);break;case"i":u.uniform1i(k,O);break;case"f":u.uniform1f(k,O);break;case"v2":u.uniform2f(k,O.x,O.y);break;case"v3":u.uniform3f(k,O.x,O.y,O.z);break;case"v4":u.uniform4f(k,O.x,O.y,O.z,O.w);break;case"c":u.uniform3f(k,O.r,O.g,O.b);break;case"iv1":u.uniform1iv(k,O);break;case"iv":u.uniform3iv(k,O);break;case"fv1":u.uniform1fv(k,O);break;case"fv":u.uniform3fv(k,O);break;case"v2v":T._array===void 0&&(T._array=new Float32Array(2*O.length));for(var W=0,ie=O.length;W<ie;W++)S=W*2,T._array[S]=O[W].x,T._array[S+1]=O[W].y;u.uniform2fv(k,T._array);break;case"v3v":T._array===void 0&&(T._array=new Float32Array(3*O.length));for(var W=0,ie=O.length;W<ie;W++)S=W*3,T._array[S]=O[W].x,T._array[S+1]=O[W].y,T._array[S+2]=O[W].z;u.uniform3fv(k,T._array);break;case"v4v":T._array===void 0&&(T._array=new Float32Array(4*O.length));for(var W=0,ie=O.length;W<ie;W++)S=W*4,T._array[S]=O[W].x,T._array[S+1]=O[W].y,T._array[S+2]=O[W].z,T._array[S+3]=O[W].w;u.uniform4fv(k,T._array);break;case"m3":u.uniformMatrix3fv(k,!1,O.elements);break;case"m3v":T._array===void 0&&(T._array=new Float32Array(9*O.length));for(var W=0,ie=O.length;W<ie;W++)O[W].flattenToArrayOffset(T._array,W*9);u.uniformMatrix3fv(k,!1,T._array);break;case"m4":u.uniformMatrix4fv(k,!1,O.elements);break;case"m4v":T._array===void 0&&(T._array=new Float32Array(16*O.length));for(var W=0,ie=O.length;W<ie;W++)O[W].flattenToArrayOffset(T._array,W*16);u.uniformMatrix4fv(k,!1,T._array);break;case"t":if(y=O,C=wr(),u.uniform1i(k,C),!y)continue;y instanceof t.CubeTexture||y.image instanceof Array&&y.image.length===6?Qi(y,C):y instanceof t.WebGLRenderTargetCube?Zi(y,C):M.setTexture(y,C);break;case"tv":T._array===void 0&&(T._array=[]);for(var W=0,ie=T.value.length;W<ie;W++)T._array[W]=wr();u.uniform1iv(k,T._array);for(var W=0,ie=T.value.length;W<ie;W++)y=T.value[W],C=T._array[W],y&&M.setTexture(y,C);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+P)}}}}function $r(f,y){f._modelViewMatrix.multiplyMatrices(y.matrixWorldInverse,f.matrixWorld),f._normalMatrix.getNormalMatrix(f._modelViewMatrix)}function Wt(f,y,C,S){f[y]=C.r*C.r*S,f[y+1]=C.g*C.g*S,f[y+2]=C.b*C.b*S}function Gt(f,y,C,S){f[y]=C.r*S,f[y+1]=C.g*S,f[y+2]=C.b*S}function Ki(f){var y,C,S,L=0,N=0,T=0,P,O,k,W,ie,me,te=Yt,ve=te.directional.colors,he=te.directional.positions,ye=te.point.colors,ue=te.point.positions,oe=te.point.distances,le=te.spot.colors,De=te.spot.positions,pe=te.spot.distances,Pe=te.spot.directions,fe=te.spot.anglesCos,ae=te.spot.exponents,Ue=te.hemi.skyColors,_e=te.hemi.groundColors,Ct=te.hemi.positions,vt=0,ut=0,tt=0,ct=0,Et=0,Ft=0,Lt=0,ke=0,At=0,dt=0,rt=0,ht=0;for(y=0,C=f.length;y<C;y++)if(S=f[y],!S.onlyShadow){if(P=S.color,W=S.intensity,me=S.distance,S instanceof t.AmbientLight){if(!S.visible)continue;M.gammaInput?(L+=P.r*P.r,N+=P.g*P.g,T+=P.b*P.b):(L+=P.r,N+=P.g,T+=P.b)}else if(S instanceof t.DirectionalLight){if(Et+=1,!S.visible)continue;Ae.setFromMatrixPosition(S.matrixWorld),Oe.setFromMatrixPosition(S.target.matrixWorld),Ae.sub(Oe),Ae.normalize(),At=vt*3,he[At]=Ae.x,he[At+1]=Ae.y,he[At+2]=Ae.z,M.gammaInput?Wt(ve,At,P,W*W):Gt(ve,At,P,W),vt+=1}else if(S instanceof t.PointLight){if(Ft+=1,!S.visible)continue;dt=ut*3,M.gammaInput?Wt(ye,dt,P,W*W):Gt(ye,dt,P,W),Oe.setFromMatrixPosition(S.matrixWorld),ue[dt]=Oe.x,ue[dt+1]=Oe.y,ue[dt+2]=Oe.z,oe[ut]=me,ut+=1}else if(S instanceof t.SpotLight){if(Lt+=1,!S.visible)continue;rt=tt*3,M.gammaInput?Wt(le,rt,P,W*W):Gt(le,rt,P,W),Ae.setFromMatrixPosition(S.matrixWorld),De[rt]=Ae.x,De[rt+1]=Ae.y,De[rt+2]=Ae.z,pe[tt]=me,Oe.setFromMatrixPosition(S.target.matrixWorld),Ae.sub(Oe),Ae.normalize(),Pe[rt]=Ae.x,Pe[rt+1]=Ae.y,Pe[rt+2]=Ae.z,fe[tt]=Math.cos(S.angle),ae[tt]=S.exponent,tt+=1}else if(S instanceof t.HemisphereLight){if(ke+=1,!S.visible)continue;Ae.setFromMatrixPosition(S.matrixWorld),Ae.normalize(),ht=ct*3,Ct[ht]=Ae.x,Ct[ht+1]=Ae.y,Ct[ht+2]=Ae.z,O=S.color,k=S.groundColor,M.gammaInput?(ie=W*W,Wt(Ue,ht,O,ie),Wt(_e,ht,k,ie)):(Gt(Ue,ht,O,W),Gt(_e,ht,k,W)),ct+=1}}for(y=vt*3,C=Math.max(ve.length,Et*3);y<C;y++)ve[y]=0;for(y=ut*3,C=Math.max(ye.length,Ft*3);y<C;y++)ye[y]=0;for(y=tt*3,C=Math.max(le.length,Lt*3);y<C;y++)le[y]=0;for(y=ct*3,C=Math.max(Ue.length,ke*3);y<C;y++)Ue[y]=0;for(y=ct*3,C=Math.max(_e.length,ke*3);y<C;y++)_e[y]=0;te.directional.length=vt,te.point.length=ut,te.spot.length=tt,te.hemi.length=ct,te.ambient[0]=L,te.ambient[1]=N,te.ambient[2]=T}this.setFaceCulling=function(f,y){f===t.CullFaceNone?u.disable(u.CULL_FACE):(y===t.FrontFaceDirectionCW?u.frontFace(u.CW):u.frontFace(u.CCW),f===t.CullFaceBack?u.cullFace(u.BACK):f===t.CullFaceFront?u.cullFace(u.FRONT):u.cullFace(u.FRONT_AND_BACK),u.enable(u.CULL_FACE))},this.setMaterialFaces=function(f){var y=f.side===t.DoubleSide,C=f.side===t.BackSide;I!==y&&(y?u.disable(u.CULL_FACE):u.enable(u.CULL_FACE),I=y),Y!==C&&(C?u.frontFace(u.CW):u.frontFace(u.CCW),Y=C)},this.setDepthTest=function(f){$!==f&&(f?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),$=f)},this.setDepthWrite=function(f){J!==f&&(u.depthMask(f),J=f)};function Mr(f){f!==re&&(u.lineWidth(f),re=f)}function br(f,y,C){X!==f&&(f?u.enable(u.POLYGON_OFFSET_FILL):u.disable(u.POLYGON_OFFSET_FILL),X=f),f&&(K!==y||ne!==C)&&(u.polygonOffset(y,C),K=y,ne=C)}this.setBlending=function(f,y,C,S){f!==H&&(f===t.NoBlending?u.disable(u.BLEND):f===t.AdditiveBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.SRC_ALPHA,u.ONE)):f===t.SubtractiveBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ZERO,u.ONE_MINUS_SRC_COLOR)):f===t.MultiplyBlending?(u.enable(u.BLEND),u.blendEquation(u.FUNC_ADD),u.blendFunc(u.ZERO,u.SRC_COLOR)):f===t.CustomBlending?u.enable(u.BLEND):(u.enable(u.BLEND),u.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA)),H=f),f===t.CustomBlending?(y!==q&&(u.blendEquation(et(y)),q=y),(C!==ee||S!==G)&&(u.blendFunc(et(C),et(S)),ee=C,G=S)):(q=null,ee=null,G=null)};function er(f,y,C){var S;C?(u.texParameteri(f,u.TEXTURE_WRAP_S,et(y.wrapS)),u.texParameteri(f,u.TEXTURE_WRAP_T,et(y.wrapT)),u.texParameteri(f,u.TEXTURE_MAG_FILTER,et(y.magFilter)),u.texParameteri(f,u.TEXTURE_MIN_FILTER,et(y.minFilter))):(u.texParameteri(f,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(f,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(f,u.TEXTURE_MAG_FILTER,ti(y.magFilter)),u.texParameteri(f,u.TEXTURE_MIN_FILTER,ti(y.minFilter))),S=xe.get("EXT_texture_filter_anisotropic"),S&&y.type!==t.FloatType&&(y.anisotropy>1||y.__oldAnisotropy)&&(u.texParameterf(f,S.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(y.anisotropy,M.getMaxAnisotropy())),y.__oldAnisotropy=y.anisotropy)}this.uploadTexture=function(f){f.__webglInit===void 0&&(f.__webglInit=!0,f.addEventListener("dispose",dr),f.__webglTexture=u.createTexture(),M.info.memory.textures++),u.bindTexture(u.TEXTURE_2D,f.__webglTexture),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,f.flipY),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.premultiplyAlpha),u.pixelStorei(u.UNPACK_ALIGNMENT,f.unpackAlignment),f.image=Jr(f.image,lt);var y=f.image,C=t.Math.isPowerOfTwo(y.width)&&t.Math.isPowerOfTwo(y.height),S=et(f.format),L=et(f.type);er(u.TEXTURE_2D,f,C);var N,T=f.mipmaps;if(f instanceof t.DataTexture)if(T.length>0&&C){for(var P=0,O=T.length;P<O;P++)N=T[P],u.texImage2D(u.TEXTURE_2D,P,S,N.width,N.height,0,S,L,N.data);f.generateMipmaps=!1}else u.texImage2D(u.TEXTURE_2D,0,S,y.width,y.height,0,S,L,y.data);else if(f instanceof t.CompressedTexture)for(var P=0,O=T.length;P<O;P++)N=T[P],f.format!==t.RGBAFormat&&f.format!==t.RGBFormat?It().indexOf(S)>-1?u.compressedTexImage2D(u.TEXTURE_2D,P,S,N.width,N.height,0,N.data):console.warn("Attempt to load unsupported compressed texture format"):u.texImage2D(u.TEXTURE_2D,P,S,N.width,N.height,0,S,L,N.data);else if(T.length>0&&C){for(var P=0,O=T.length;P<O;P++)N=T[P],u.texImage2D(u.TEXTURE_2D,P,S,S,L,N);f.generateMipmaps=!1}else u.texImage2D(u.TEXTURE_2D,0,S,S,L,f.image);f.generateMipmaps&&C&&u.generateMipmap(u.TEXTURE_2D),f.needsUpdate=!1,f.onUpdate&&f.onUpdate()},this.setTexture=function(f,y){u.activeTexture(u.TEXTURE0+y),f.needsUpdate?M.uploadTexture(f):u.bindTexture(u.TEXTURE_2D,f.__webglTexture)};function Jr(f,y){if(f.width>y||f.height>y){var C=y/Math.max(f.width,f.height),S=document.createElement("canvas");S.width=Math.floor(f.width*C),S.height=Math.floor(f.height*C);var L=S.getContext("2d");return L.drawImage(f,0,0,f.width,f.height,0,0,S.width,S.height),console.log("THREE.WebGLRenderer:",f,"is too big ("+f.width+"x"+f.height+"). Resized to "+S.width+"x"+S.height+"."),S}return f}function Qi(f,y){if(f.image.length===6)if(f.needsUpdate){f.image.__webglTextureCube||(f.addEventListener("dispose",dr),f.image.__webglTextureCube=u.createTexture(),M.info.memory.textures++),u.activeTexture(u.TEXTURE0+y),u.bindTexture(u.TEXTURE_CUBE_MAP,f.image.__webglTextureCube),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,f.flipY);for(var C=f instanceof t.CompressedTexture,S=f.image[0]instanceof t.DataTexture,L=[],N=0;N<6;N++)M.autoScaleCubemaps&&!C&&!S?L[N]=Jr(f.image[N],Ke):L[N]=S?f.image[N].image:f.image[N];var T=L[0],P=t.Math.isPowerOfTwo(T.width)&&t.Math.isPowerOfTwo(T.height),O=et(f.format),k=et(f.type);er(u.TEXTURE_CUBE_MAP,f,P);for(var N=0;N<6;N++)if(!C)S?u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,O,L[N].width,L[N].height,0,O,k,L[N].data):u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,O,O,k,L[N]);else for(var W,ie=L[N].mipmaps,me=0,te=ie.length;me<te;me++)W=ie[me],f.format!==t.RGBAFormat&&f.format!==t.RGBFormat?It().indexOf(O)>-1?u.compressedTexImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+N,me,O,W.width,W.height,0,W.data):console.warn("Attempt to load unsupported compressed texture format"):u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+N,me,O,W.width,W.height,0,O,k,W.data);f.generateMipmaps&&P&&u.generateMipmap(u.TEXTURE_CUBE_MAP),f.needsUpdate=!1,f.onUpdate&&f.onUpdate()}else u.activeTexture(u.TEXTURE0+y),u.bindTexture(u.TEXTURE_CUBE_MAP,f.image.__webglTextureCube)}function Zi(f,y){u.activeTexture(u.TEXTURE0+y),u.bindTexture(u.TEXTURE_CUBE_MAP,f.__webglTexture)}function jr(f,y,C){u.bindFramebuffer(u.FRAMEBUFFER,f),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,C,y.__webglTexture,0)}function ei(f,y){u.bindRenderbuffer(u.RENDERBUFFER,f),y.depthBuffer&&!y.stencilBuffer?(u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_COMPONENT16,y.width,y.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,f)):y.depthBuffer&&y.stencilBuffer?(u.renderbufferStorage(u.RENDERBUFFER,u.DEPTH_STENCIL,y.width,y.height),u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,f)):u.renderbufferStorage(u.RENDERBUFFER,u.RGBA4,y.width,y.height)}this.setRenderTarget=function(f){var y=f instanceof t.WebGLRenderTargetCube;if(f&&f.__webglFramebuffer===void 0){f.depthBuffer===void 0&&(f.depthBuffer=!0),f.stencilBuffer===void 0&&(f.stencilBuffer=!0),f.addEventListener("dispose",Or),f.__webglTexture=u.createTexture(),M.info.memory.textures++;var C=t.Math.isPowerOfTwo(f.width)&&t.Math.isPowerOfTwo(f.height),S=et(f.format),L=et(f.type);if(y){f.__webglFramebuffer=[],f.__webglRenderbuffer=[],u.bindTexture(u.TEXTURE_CUBE_MAP,f.__webglTexture),er(u.TEXTURE_CUBE_MAP,f,C);for(var N=0;N<6;N++)f.__webglFramebuffer[N]=u.createFramebuffer(),f.__webglRenderbuffer[N]=u.createRenderbuffer(),u.texImage2D(u.TEXTURE_CUBE_MAP_POSITIVE_X+N,0,S,f.width,f.height,0,S,L,null),jr(f.__webglFramebuffer[N],f,u.TEXTURE_CUBE_MAP_POSITIVE_X+N),ei(f.__webglRenderbuffer[N],f);C&&u.generateMipmap(u.TEXTURE_CUBE_MAP)}else f.__webglFramebuffer=u.createFramebuffer(),f.shareDepthFrom?f.__webglRenderbuffer=f.shareDepthFrom.__webglRenderbuffer:f.__webglRenderbuffer=u.createRenderbuffer(),u.bindTexture(u.TEXTURE_2D,f.__webglTexture),er(u.TEXTURE_2D,f,C),u.texImage2D(u.TEXTURE_2D,0,S,f.width,f.height,0,S,L,null),jr(f.__webglFramebuffer,f,u.TEXTURE_2D),f.shareDepthFrom?f.depthBuffer&&!f.stencilBuffer?u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,f.__webglRenderbuffer):f.depthBuffer&&f.stencilBuffer&&u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,f.__webglRenderbuffer):ei(f.__webglRenderbuffer,f),C&&u.generateMipmap(u.TEXTURE_2D);y?u.bindTexture(u.TEXTURE_CUBE_MAP,null):u.bindTexture(u.TEXTURE_2D,null),u.bindRenderbuffer(u.RENDERBUFFER,null),u.bindFramebuffer(u.FRAMEBUFFER,null)}var T,P,O,k,W;f?(y?T=f.__webglFramebuffer[f.activeCubeFace]:T=f.__webglFramebuffer,P=f.width,O=f.height,k=0,W=0):(T=null,P=de,O=ge,k=se,W=Z),T!==R&&(u.bindFramebuffer(u.FRAMEBUFFER,T),u.viewport(k,W,P,O),R=T),we=P,Ee=O};function $i(f){f instanceof t.WebGLRenderTargetCube?(u.bindTexture(u.TEXTURE_CUBE_MAP,f.__webglTexture),u.generateMipmap(u.TEXTURE_CUBE_MAP),u.bindTexture(u.TEXTURE_CUBE_MAP,null)):(u.bindTexture(u.TEXTURE_2D,f.__webglTexture),u.generateMipmap(u.TEXTURE_2D),u.bindTexture(u.TEXTURE_2D,null))}function ti(f){return f===t.NearestFilter||f===t.NearestMipMapNearestFilter||f===t.NearestMipMapLinearFilter?u.NEAREST:u.LINEAR}function et(f){var y;if(f===t.RepeatWrapping)return u.REPEAT;if(f===t.ClampToEdgeWrapping)return u.CLAMP_TO_EDGE;if(f===t.MirroredRepeatWrapping)return u.MIRRORED_REPEAT;if(f===t.NearestFilter)return u.NEAREST;if(f===t.NearestMipMapNearestFilter)return u.NEAREST_MIPMAP_NEAREST;if(f===t.NearestMipMapLinearFilter)return u.NEAREST_MIPMAP_LINEAR;if(f===t.LinearFilter)return u.LINEAR;if(f===t.LinearMipMapNearestFilter)return u.LINEAR_MIPMAP_NEAREST;if(f===t.LinearMipMapLinearFilter)return u.LINEAR_MIPMAP_LINEAR;if(f===t.UnsignedByteType)return u.UNSIGNED_BYTE;if(f===t.UnsignedShort4444Type)return u.UNSIGNED_SHORT_4_4_4_4;if(f===t.UnsignedShort5551Type)return u.UNSIGNED_SHORT_5_5_5_1;if(f===t.UnsignedShort565Type)return u.UNSIGNED_SHORT_5_6_5;if(f===t.ByteType)return u.BYTE;if(f===t.ShortType)return u.SHORT;if(f===t.UnsignedShortType)return u.UNSIGNED_SHORT;if(f===t.IntType)return u.INT;if(f===t.UnsignedIntType)return u.UNSIGNED_INT;if(f===t.FloatType)return u.FLOAT;if(f===t.AlphaFormat)return u.ALPHA;if(f===t.RGBFormat)return u.RGB;if(f===t.RGBAFormat)return u.RGBA;if(f===t.LuminanceFormat)return u.LUMINANCE;if(f===t.LuminanceAlphaFormat)return u.LUMINANCE_ALPHA;if(f===t.AddEquation)return u.FUNC_ADD;if(f===t.SubtractEquation)return u.FUNC_SUBTRACT;if(f===t.ReverseSubtractEquation)return u.FUNC_REVERSE_SUBTRACT;if(f===t.ZeroFactor)return u.ZERO;if(f===t.OneFactor)return u.ONE;if(f===t.SrcColorFactor)return u.SRC_COLOR;if(f===t.OneMinusSrcColorFactor)return u.ONE_MINUS_SRC_COLOR;if(f===t.SrcAlphaFactor)return u.SRC_ALPHA;if(f===t.OneMinusSrcAlphaFactor)return u.ONE_MINUS_SRC_ALPHA;if(f===t.DstAlphaFactor)return u.DST_ALPHA;if(f===t.OneMinusDstAlphaFactor)return u.ONE_MINUS_DST_ALPHA;if(f===t.DstColorFactor)return u.DST_COLOR;if(f===t.OneMinusDstColorFactor)return u.ONE_MINUS_DST_COLOR;if(f===t.SrcAlphaSaturateFactor)return u.SRC_ALPHA_SATURATE;if(y=xe.get("WEBGL_compressed_texture_s3tc"),y!==null){if(f===t.RGB_S3TC_DXT1_Format)return y.COMPRESSED_RGB_S3TC_DXT1_EXT;if(f===t.RGBA_S3TC_DXT1_Format)return y.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(f===t.RGBA_S3TC_DXT3_Format)return y.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(f===t.RGBA_S3TC_DXT5_Format)return y.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(y=xe.get("WEBGL_compressed_texture_pvrtc"),y!==null){if(f===t.RGB_PVRTC_4BPPV1_Format)return y.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(f===t.RGB_PVRTC_2BPPV1_Format)return y.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(f===t.RGBA_PVRTC_4BPPV1_Format)return y.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(f===t.RGBA_PVRTC_2BPPV1_Format)return y.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(y=xe.get("EXT_blend_minmax"),y!==null){if(f===t.MinEquation)return y.MIN_EXT;if(f===t.MaxEquation)return y.MAX_EXT}return 0}function Ji(f){if(Ie&&f&&f.skeleton&&f.skeleton.useVertexTexture)return 1024;var y=u.getParameter(u.MAX_VERTEX_UNIFORM_VECTORS),C=Math.floor((y-20)/4),S=C;return f!==void 0&&f instanceof t.SkinnedMesh&&(S=Math.min(f.skeleton.bones.length,S),S<f.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+f.skeleton.bones.length+", this GPU supports just "+S+" (try OpenGL instead of ANGLE)")),S}function ji(f){for(var y=0,C=0,S=0,L=0,N=0,T=f.length;N<T;N++){var P=f[N];P.onlyShadow||P.visible===!1||(P instanceof t.DirectionalLight&&y++,P instanceof t.PointLight&&C++,P instanceof t.SpotLight&&S++,P instanceof t.HemisphereLight&&L++)}return{directional:y,point:C,spot:S,hemi:L}}function en(f){for(var y=0,C=0,S=f.length;C<S;C++){var L=f[C];L.castShadow&&(L instanceof t.SpotLight&&y++,L instanceof t.DirectionalLight&&!L.shadowCascade&&y++)}return y}this.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},this.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},this.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},this.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},t.WebGLRenderTarget=function(e,r,n){this.width=e,this.height=r,n=n||{},this.wrapS=n.wrapS!==void 0?n.wrapS:t.ClampToEdgeWrapping,this.wrapT=n.wrapT!==void 0?n.wrapT:t.ClampToEdgeWrapping,this.magFilter=n.magFilter!==void 0?n.magFilter:t.LinearFilter,this.minFilter=n.minFilter!==void 0?n.minFilter:t.LinearMipMapLinearFilter,this.anisotropy=n.anisotropy!==void 0?n.anisotropy:1,this.offset=new t.Vector2(0,0),this.repeat=new t.Vector2(1,1),this.format=n.format!==void 0?n.format:t.RGBAFormat,this.type=n.type!==void 0?n.type:t.UnsignedByteType,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},t.WebGLRenderTarget.prototype={constructor:t.WebGLRenderTarget,setSize:function(e,r){this.width=e,this.height=r},clone:function(){var e=new t.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},t.EventDispatcher.prototype.apply(t.WebGLRenderTarget.prototype),t.WebGLRenderTargetCube=function(e,r,n){t.WebGLRenderTarget.call(this,e,r,n),this.activeCubeFace=0},t.WebGLRenderTargetCube.prototype=Object.create(t.WebGLRenderTarget.prototype),t.WebGLExtensions=function(e){var r={};this.get=function(n){if(r[n]!==void 0)return r[n];var a;switch(n){case"OES_texture_float":a=e.getExtension("OES_texture_float");break;case"OES_texture_float_linear":a=e.getExtension("OES_texture_float_linear");break;case"OES_standard_derivatives":a=e.getExtension("OES_standard_derivatives");break;case"EXT_texture_filter_anisotropic":a=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":a=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":a=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"OES_element_index_uint":a=e.getExtension("OES_element_index_uint");break;case"EXT_blend_minmax":a=e.getExtension("EXT_blend_minmax");break;case"EXT_frag_depth":a=e.getExtension("EXT_frag_depth");break}return a===null&&console.log("THREE.WebGLRenderer: "+n+" extension not supported."),r[n]=a,a}},t.WebGLProgram=function(){var e=0,r=function(o){var s,l,h=[];for(var c in o)s=o[c],s!==!1&&(l="#define "+c+" "+s,h.push(l));return h.join(`
`)},n=function(o,s,l){for(var h={},c=0,d=l.length;c<d;c++){var p=l[c];h[p]=o.getUniformLocation(s,p)}return h},a=function(o,s,l){for(var h={},c=0,d=l.length;c<d;c++){var p=l[c];h[p]=o.getAttribLocation(s,p)}return h};return function(o,s,l,h){var c=o,d=c.context,p=l.defines,v=l.__webglShader.uniforms,m=l.attributes,g=l.__webglShader.vertexShader,x=l.__webglShader.fragmentShader,w=l.index0AttributeName;w===void 0&&h.morphTargets===!0&&(w="position");var _="SHADOWMAP_TYPE_BASIC";h.shadowMapType===t.PCFShadowMap?_="SHADOWMAP_TYPE_PCF":h.shadowMapType===t.PCFSoftShadowMap&&(_="SHADOWMAP_TYPE_PCF_SOFT");var b=r(p),A=d.createProgram(),E,M;l instanceof t.RawShaderMaterial?(E="",M=""):(E=["precision "+h.precision+" float;","precision "+h.precision+" int;",b,h.supportsVertexTextures?"#define VERTEX_TEXTURES":"",c.gammaInput?"#define GAMMA_INPUT":"",c.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,"#define MAX_BONES "+h.maxBones,h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.skinning?"#define USE_SKINNING":"",h.useVertexTexture?"#define BONE_TEXTURE":"",h.morphTargets?"#define USE_MORPHTARGETS":"",h.morphNormals?"#define USE_MORPHNORMALS":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+_:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.sizeAttenuation?"#define USE_SIZEATTENUATION":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",""].join(`
`),M=["precision "+h.precision+" float;","precision "+h.precision+" int;",h.bumpMap||h.normalMap?"#extension GL_OES_standard_derivatives : enable":"",b,"#define MAX_DIR_LIGHTS "+h.maxDirLights,"#define MAX_POINT_LIGHTS "+h.maxPointLights,"#define MAX_SPOT_LIGHTS "+h.maxSpotLights,"#define MAX_HEMI_LIGHTS "+h.maxHemiLights,"#define MAX_SHADOWS "+h.maxShadows,h.alphaTest?"#define ALPHATEST "+h.alphaTest:"",c.gammaInput?"#define GAMMA_INPUT":"",c.gammaOutput?"#define GAMMA_OUTPUT":"",h.useFog&&h.fog?"#define USE_FOG":"",h.useFog&&h.fogExp?"#define FOG_EXP2":"",h.map?"#define USE_MAP":"",h.envMap?"#define USE_ENVMAP":"",h.lightMap?"#define USE_LIGHTMAP":"",h.bumpMap?"#define USE_BUMPMAP":"",h.normalMap?"#define USE_NORMALMAP":"",h.specularMap?"#define USE_SPECULARMAP":"",h.alphaMap?"#define USE_ALPHAMAP":"",h.vertexColors?"#define USE_COLOR":"",h.metal?"#define METAL":"",h.wrapAround?"#define WRAP_AROUND":"",h.doubleSided?"#define DOUBLE_SIDED":"",h.flipSided?"#define FLIP_SIDED":"",h.shadowMapEnabled?"#define USE_SHADOWMAP":"",h.shadowMapEnabled?"#define "+_:"",h.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",h.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",h.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join(`
`));var F=new t.WebGLShader(d,d.VERTEX_SHADER,E+g),D=new t.WebGLShader(d,d.FRAGMENT_SHADER,M+x);d.attachShader(A,F),d.attachShader(A,D),w!==void 0&&d.bindAttribLocation(A,0,w),d.linkProgram(A),d.getProgramParameter(A,d.LINK_STATUS)===!1&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",d.getProgramParameter(A,d.VALIDATE_STATUS)),console.error("gl.getError()",d.getError())),d.getProgramInfoLog(A)!==""&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",d.getProgramInfoLog(A)),d.deleteShader(F),d.deleteShader(D);var R=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];h.useVertexTexture?(R.push("boneTexture"),R.push("boneTextureWidth"),R.push("boneTextureHeight")):R.push("boneGlobalMatrices"),h.logarithmicDepthBuffer&&R.push("logDepthBufFC");for(var B in v)R.push(B);this.uniforms=n(d,A,R),R=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var V=0;V<h.maxMorphTargets;V++)R.push("morphTarget"+V);for(var V=0;V<h.maxMorphNormals;V++)R.push("morphNormal"+V);for(var U in m)R.push(U);return this.attributes=a(d,A,R),this.attributesKeys=Object.keys(this.attributes),this.id=e++,this.code=s,this.usedTimes=1,this.program=A,this.vertexShader=F,this.fragmentShader=D,this}}(),t.WebGLShader=function(){var e=function(r){for(var n=r.split(`
`),a=0;a<n.length;a++)n[a]=a+1+": "+n[a];return n.join(`
`)};return function(r,n,a){var o=r.createShader(n);return r.shaderSource(o,a),r.compileShader(o),r.getShaderParameter(o,r.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),r.getShaderInfoLog(o)!==""&&(console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",r.getShaderInfoLog(o)),console.warn(e(a))),o}}(),t.LensFlarePlugin=function(e,r){var n=e.context,a,o,s,l,h,c,d,p,v=function(){var g=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),x=new Uint16Array([0,1,2,0,2,3]);a=n.createBuffer(),o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,a),n.bufferData(n.ARRAY_BUFFER,g,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o),n.bufferData(n.ELEMENT_ARRAY_BUFFER,x,n.STATIC_DRAW),d=n.createTexture(),p=n.createTexture(),n.bindTexture(n.TEXTURE_2D,d),n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.bindTexture(n.TEXTURE_2D,p),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),c=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var w;c?w={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join(`
`),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join(`
`)}:w={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join(`
`),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join(`
`)},s=m(w),l={vertex:n.getAttribLocation(s,"position"),uv:n.getAttribLocation(s,"uv")},h={renderType:n.getUniformLocation(s,"renderType"),map:n.getUniformLocation(s,"map"),occlusionMap:n.getUniformLocation(s,"occlusionMap"),opacity:n.getUniformLocation(s,"opacity"),color:n.getUniformLocation(s,"color"),scale:n.getUniformLocation(s,"scale"),rotation:n.getUniformLocation(s,"rotation"),screenPosition:n.getUniformLocation(s,"screenPosition")}};this.render=function(g,x,w,_){if(r.length!==0){var b=new t.Vector3,A=_/w,E=w*.5,M=_*.5,F=16/_,D=new t.Vector2(F*A,F),R=new t.Vector3(1,1,0),B=new t.Vector2(1,1);s===void 0&&v(),n.useProgram(s),n.enableVertexAttribArray(l.vertex),n.enableVertexAttribArray(l.uv),n.uniform1i(h.occlusionMap,0),n.uniform1i(h.map,1),n.bindBuffer(n.ARRAY_BUFFER,a),n.vertexAttribPointer(l.vertex,2,n.FLOAT,!1,2*8,0),n.vertexAttribPointer(l.uv,2,n.FLOAT,!1,2*8,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o),n.disable(n.CULL_FACE),n.depthMask(!1);for(var V=0,U=r.length;V<U;V++){F=16/_,D.set(F*A,F);var z=r[V];if(b.set(z.matrixWorld.elements[12],z.matrixWorld.elements[13],z.matrixWorld.elements[14]),b.applyMatrix4(x.matrixWorldInverse),b.applyProjection(x.projectionMatrix),R.copy(b),B.x=R.x*E+E,B.y=R.y*M+M,c||B.x>0&&B.x<w&&B.y>0&&B.y<_){n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,d),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,B.x-8,B.y-8,16,16,0),n.uniform1i(h.renderType,0),n.uniform2f(h.scale,D.x,D.y),n.uniform3f(h.screenPosition,R.x,R.y,R.z),n.disable(n.BLEND),n.enable(n.DEPTH_TEST),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,p),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,B.x-8,B.y-8,16,16,0),n.uniform1i(h.renderType,1),n.disable(n.DEPTH_TEST),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,d),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),z.positionScreen.copy(R),z.customUpdateCallback?z.customUpdateCallback(z):z.updateLensFlares(),n.uniform1i(h.renderType,2),n.enable(n.BLEND);for(var I=0,Y=z.lensFlares.length;I<Y;I++){var H=z.lensFlares[I];H.opacity>.001&&H.scale>.001&&(R.x=H.x,R.y=H.y,R.z=H.z,F=H.size*H.scale/_,D.x=F*A,D.y=F,n.uniform3f(h.screenPosition,R.x,R.y,R.z),n.uniform2f(h.scale,D.x,D.y),n.uniform1f(h.rotation,H.rotation),n.uniform1f(h.opacity,H.opacity),n.uniform3f(h.color,H.color.r,H.color.g,H.color.b),e.setBlending(H.blending,H.blendEquation,H.blendSrc,H.blendDst),e.setTexture(H.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}}}n.enable(n.CULL_FACE),n.enable(n.DEPTH_TEST),n.depthMask(!0),e.resetGLState()}};function m(g){var x=n.createProgram(),w=n.createShader(n.FRAGMENT_SHADER),_=n.createShader(n.VERTEX_SHADER),b="precision "+e.getPrecision()+` float;
`;return n.shaderSource(w,b+g.fragmentShader),n.shaderSource(_,b+g.vertexShader),n.compileShader(w),n.compileShader(_),n.attachShader(x,w),n.attachShader(x,_),n.linkProgram(x),x}},t.ShadowMapPlugin=function(e,r,n,a){var o=e.context,s,l,h,c,d=new t.Frustum,p=new t.Matrix4,v=new t.Vector3,m=new t.Vector3,g=new t.Vector3,x=[],w=t.ShaderLib.depthRGBA,_=t.UniformsUtils.clone(w.uniforms);s=new t.ShaderMaterial({uniforms:_,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader}),l=new t.ShaderMaterial({uniforms:_,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,morphTargets:!0}),h=new t.ShaderMaterial({uniforms:_,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,skinning:!0}),c=new t.ShaderMaterial({uniforms:_,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,morphTargets:!0,skinning:!0}),s._shadowPass=!0,l._shadowPass=!0,h._shadowPass=!0,c._shadowPass=!0,this.render=function(D,R){if(e.shadowMapEnabled!==!1){var B,V,U,z,I,Y,H,q,ee,G,$,J,X,K=[],ne=0,re=null;for(o.clearColor(1,1,1,1),o.disable(o.BLEND),o.enable(o.CULL_FACE),o.frontFace(o.CCW),e.shadowMapCullFace===t.CullFaceFront?o.cullFace(o.FRONT):o.cullFace(o.BACK),e.setDepthTest(!0),B=0,V=r.length;B<V;B++)if(X=r[B],!!X.castShadow)if(X instanceof t.DirectionalLight&&X.shadowCascade)for(I=0;I<X.shadowCascadeCount;I++){var se;if(X.shadowCascadeArray[I])se=X.shadowCascadeArray[I];else{se=A(X,I),se.originalCamera=R;var Z=new t.Gyroscope;Z.position.copy(X.shadowCascadeOffset),Z.add(se),Z.add(se.target),R.add(Z),X.shadowCascadeArray[I]=se,console.log("Created virtualLight",se)}E(X,I),K[ne]=se,ne++}else K[ne]=X,ne++;for(B=0,V=K.length;B<V;B++){if(X=K[B],!X.shadowMap){var de=t.LinearFilter;e.shadowMapType===t.PCFSoftShadowMap&&(de=t.NearestFilter);var ge={minFilter:de,magFilter:de,format:t.RGBAFormat};X.shadowMap=new t.WebGLRenderTarget(X.shadowMapWidth,X.shadowMapHeight,ge),X.shadowMapSize=new t.Vector2(X.shadowMapWidth,X.shadowMapHeight),X.shadowMatrix=new t.Matrix4}if(!X.shadowCamera){if(X instanceof t.SpotLight)X.shadowCamera=new t.PerspectiveCamera(X.shadowCameraFov,X.shadowMapWidth/X.shadowMapHeight,X.shadowCameraNear,X.shadowCameraFar);else if(X instanceof t.DirectionalLight)X.shadowCamera=new t.OrthographicCamera(X.shadowCameraLeft,X.shadowCameraRight,X.shadowCameraTop,X.shadowCameraBottom,X.shadowCameraNear,X.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}D.add(X.shadowCamera),D.autoUpdate===!0&&D.updateMatrixWorld()}X.shadowCameraVisible&&!X.cameraHelper&&(X.cameraHelper=new t.CameraHelper(X.shadowCamera),D.add(X.cameraHelper)),X.isVirtual&&se.originalCamera==R&&M(R,X),Y=X.shadowMap,H=X.shadowMatrix,q=X.shadowCamera,q.position.setFromMatrixPosition(X.matrixWorld),g.setFromMatrixPosition(X.target.matrixWorld),q.lookAt(g),q.updateMatrixWorld(),q.matrixWorldInverse.getInverse(q.matrixWorld),X.cameraHelper&&(X.cameraHelper.visible=X.shadowCameraVisible),X.shadowCameraVisible&&X.cameraHelper.update(),H.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),H.multiply(q.projectionMatrix),H.multiply(q.matrixWorldInverse),p.multiplyMatrices(q.projectionMatrix,q.matrixWorldInverse),d.setFromMatrix(p),e.setRenderTarget(Y),e.clear(),x.length=0,b(D,D,q);var we,Ee,Te;for(U=0,z=x.length;U<z;U++)$=x[U],J=$.object,ee=$.buffer,we=F(J),Ee=J.geometry.morphTargets!==void 0&&J.geometry.morphTargets.length>0&&we.morphTargets,Te=J instanceof t.SkinnedMesh&&we.skinning,J.customDepthMaterial?G=J.customDepthMaterial:Te?G=Ee?c:h:Ee?G=l:G=s,e.setMaterialFaces(we),ee instanceof t.BufferGeometry?e.renderBufferDirect(q,r,re,G,ee,J):e.renderBuffer(q,r,re,G,ee,J);for(U=0,z=a.length;U<z;U++)$=a[U],J=$.object,J.visible&&J.castShadow&&(J._modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,J.matrixWorld),e.renderImmediateObject(q,r,re,s,J))}var Be=e.getClearColor(),Ce=e.getClearAlpha();o.clearColor(Be.r,Be.g,Be.b,Ce),o.enable(o.BLEND),e.shadowMapCullFace===t.CullFaceFront&&o.cullFace(o.BACK),e.resetGLState()}};function b(D,R,B){if(R.visible){var V=n[R.id];if(V&&R.castShadow&&(R.frustumCulled===!1||d.intersectsObject(R)===!0))for(var U=0,z=V.length;U<z;U++){var I=V[U];R._modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,R.matrixWorld),x.push(I)}for(var U=0,z=R.children.length;U<z;U++)b(D,R.children[U],B)}}function A(D,R){var B=new t.DirectionalLight;B.isVirtual=!0,B.onlyShadow=!0,B.castShadow=!0,B.shadowCameraNear=D.shadowCameraNear,B.shadowCameraFar=D.shadowCameraFar,B.shadowCameraLeft=D.shadowCameraLeft,B.shadowCameraRight=D.shadowCameraRight,B.shadowCameraBottom=D.shadowCameraBottom,B.shadowCameraTop=D.shadowCameraTop,B.shadowCameraVisible=D.shadowCameraVisible,B.shadowDarkness=D.shadowDarkness,B.shadowBias=D.shadowCascadeBias[R],B.shadowMapWidth=D.shadowCascadeWidth[R],B.shadowMapHeight=D.shadowCascadeHeight[R],B.pointsWorld=[],B.pointsFrustum=[];for(var V=B.pointsWorld,U=B.pointsFrustum,z=0;z<8;z++)V[z]=new t.Vector3,U[z]=new t.Vector3;var I=D.shadowCascadeNearZ[R],Y=D.shadowCascadeFarZ[R];return U[0].set(-1,-1,I),U[1].set(1,-1,I),U[2].set(-1,1,I),U[3].set(1,1,I),U[4].set(-1,-1,Y),U[5].set(1,-1,Y),U[6].set(-1,1,Y),U[7].set(1,1,Y),B}function E(D,R){var B=D.shadowCascadeArray[R];B.position.copy(D.position),B.target.position.copy(D.target.position),B.lookAt(B.target),B.shadowCameraVisible=D.shadowCameraVisible,B.shadowDarkness=D.shadowDarkness,B.shadowBias=D.shadowCascadeBias[R];var V=D.shadowCascadeNearZ[R],U=D.shadowCascadeFarZ[R],z=B.pointsFrustum;z[0].z=V,z[1].z=V,z[2].z=V,z[3].z=V,z[4].z=U,z[5].z=U,z[6].z=U,z[7].z=U}function M(D,R){var B=R.shadowCamera,V=R.pointsFrustum,U=R.pointsWorld;v.set(1/0,1/0,1/0),m.set(-1/0,-1/0,-1/0);for(var z=0;z<8;z++){var I=U[z];I.copy(V[z]),I.unproject(D),I.applyMatrix4(B.matrixWorldInverse),I.x<v.x&&(v.x=I.x),I.x>m.x&&(m.x=I.x),I.y<v.y&&(v.y=I.y),I.y>m.y&&(m.y=I.y),I.z<v.z&&(v.z=I.z),I.z>m.z&&(m.z=I.z)}B.left=v.x,B.right=m.x,B.top=m.y,B.bottom=v.y,B.updateProjectionMatrix()}function F(D){return D.material instanceof t.MeshFaceMaterial?D.material.materials[0]:D.material}},t.SpritePlugin=function(e,r){var n=e.context,a,o,s,l,h,c,d=function(){var m=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),g=new Uint16Array([0,1,2,0,2,3]);a=n.createBuffer(),o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,a),n.bufferData(n.ARRAY_BUFFER,m,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o),n.bufferData(n.ELEMENT_ARRAY_BUFFER,g,n.STATIC_DRAW),s=p(),l={position:n.getAttribLocation(s,"position"),uv:n.getAttribLocation(s,"uv")},h={uvOffset:n.getUniformLocation(s,"uvOffset"),uvScale:n.getUniformLocation(s,"uvScale"),rotation:n.getUniformLocation(s,"rotation"),scale:n.getUniformLocation(s,"scale"),color:n.getUniformLocation(s,"color"),map:n.getUniformLocation(s,"map"),opacity:n.getUniformLocation(s,"opacity"),modelViewMatrix:n.getUniformLocation(s,"modelViewMatrix"),projectionMatrix:n.getUniformLocation(s,"projectionMatrix"),fogType:n.getUniformLocation(s,"fogType"),fogDensity:n.getUniformLocation(s,"fogDensity"),fogNear:n.getUniformLocation(s,"fogNear"),fogFar:n.getUniformLocation(s,"fogFar"),fogColor:n.getUniformLocation(s,"fogColor"),alphaTest:n.getUniformLocation(s,"alphaTest")};var x=document.createElement("canvas");x.width=8,x.height=8;var w=x.getContext("2d");w.fillStyle="white",w.fillRect(0,0,8,8),c=new t.Texture(x),c.needsUpdate=!0};this.render=function(m,g){if(r.length!==0){s===void 0&&d(),n.useProgram(s),n.enableVertexAttribArray(l.position),n.enableVertexAttribArray(l.uv),n.disable(n.CULL_FACE),n.enable(n.BLEND),n.bindBuffer(n.ARRAY_BUFFER,a),n.vertexAttribPointer(l.position,2,n.FLOAT,!1,2*8,0),n.vertexAttribPointer(l.uv,2,n.FLOAT,!1,2*8,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o),n.uniformMatrix4fv(h.projectionMatrix,!1,g.projectionMatrix.elements),n.activeTexture(n.TEXTURE0),n.uniform1i(h.map,0);var x=0,w=0,_=m.fog;_?(n.uniform3f(h.fogColor,_.color.r,_.color.g,_.color.b),_ instanceof t.Fog?(n.uniform1f(h.fogNear,_.near),n.uniform1f(h.fogFar,_.far),n.uniform1i(h.fogType,1),x=1,w=1):_ instanceof t.FogExp2&&(n.uniform1f(h.fogDensity,_.density),n.uniform1i(h.fogType,2),x=2,w=2)):(n.uniform1i(h.fogType,0),x=0,w=0);for(var b=0,A=r.length;b<A;b++){var E=r[b];E._modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,E.matrixWorld),E.renderDepth===null?E.z=-E._modelViewMatrix.elements[14]:E.z=E.renderDepth}r.sort(v);for(var M=[],b=0,A=r.length;b<A;b++){var E=r[b],F=E.material;n.uniform1f(h.alphaTest,F.alphaTest),n.uniformMatrix4fv(h.modelViewMatrix,!1,E._modelViewMatrix.elements),M[0]=E.scale.x,M[1]=E.scale.y;var D=0;m.fog&&F.fog&&(D=w),x!==D&&(n.uniform1i(h.fogType,D),x=D),F.map!==null?(n.uniform2f(h.uvOffset,F.map.offset.x,F.map.offset.y),n.uniform2f(h.uvScale,F.map.repeat.x,F.map.repeat.y)):(n.uniform2f(h.uvOffset,0,0),n.uniform2f(h.uvScale,1,1)),n.uniform1f(h.opacity,F.opacity),n.uniform3f(h.color,F.color.r,F.color.g,F.color.b),n.uniform1f(h.rotation,F.rotation),n.uniform2fv(h.scale,M),e.setBlending(F.blending,F.blendEquation,F.blendSrc,F.blendDst),e.setDepthTest(F.depthTest),e.setDepthWrite(F.depthWrite),F.map&&F.map.image&&F.map.image.width?e.setTexture(F.map,0):e.setTexture(c,0),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}n.enable(n.CULL_FACE),e.resetGLState()}};function p(){var m=n.createProgram(),g=n.createShader(n.VERTEX_SHADER),x=n.createShader(n.FRAGMENT_SHADER);return n.shaderSource(g,["precision "+e.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join(`
`)),n.shaderSource(x,["precision "+e.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join(`
`)),n.compileShader(g),n.compileShader(x),n.attachShader(m,g),n.attachShader(m,x),n.linkProgram(m),m}function v(m,g){return m.z!==g.z?g.z-m.z:g.id-m.id}},t.GeometryUtils={merge:function(e,r,n){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var a;r instanceof t.Mesh&&(r.matrixAutoUpdate&&r.updateMatrix(),a=r.matrix,r=r.geometry),e.merge(r,a,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},t.ImageUtils={crossOrigin:void 0,loadTexture:function(e,r,n,a){var o=new t.ImageLoader;o.crossOrigin=this.crossOrigin;var s=new t.Texture(void 0,r);return o.load(e,function(l){s.image=l,s.needsUpdate=!0,n&&n(s)},void 0,function(l){a&&a(l)}),s.sourceFile=e,s},loadTextureCube:function(e,r,n,a){var o=[],s=new t.ImageLoader;s.crossOrigin=this.crossOrigin;var l=new t.CubeTexture(o,r);l.flipY=!1;for(var h=0,c=function(v){s.load(e[v],function(m){l.images[v]=m,h+=1,h===6&&(l.needsUpdate=!0,n&&n(l))})},d=0,p=e.length;d<p;++d)c(d);return l},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(e,r){var n=function(z,I){return[z[1]*I[2]-z[2]*I[1],z[2]*I[0]-z[0]*I[2],z[0]*I[1]-z[1]*I[0]]},a=function(z,I){return[z[0]-I[0],z[1]-I[1],z[2]-I[2]]},o=function(z){var I=Math.sqrt(z[0]*z[0]+z[1]*z[1]+z[2]*z[2]);return[z[0]/I,z[1]/I,z[2]/I]};r=r|1;var s=e.width,l=e.height,h=document.createElement("canvas");h.width=s,h.height=l;var c=h.getContext("2d");c.drawImage(e,0,0);for(var d=c.getImageData(0,0,s,l).data,p=c.createImageData(s,l),v=p.data,m=0;m<s;m++)for(var g=0;g<l;g++){var x=g-1<0?0:g-1,w=g+1>l-1?l-1:g+1,_=m-1<0?0:m-1,b=m+1>s-1?s-1:m+1,A=[],E=[0,0,d[(g*s+m)*4]/255*r];A.push([-1,0,d[(g*s+_)*4]/255*r]),A.push([-1,-1,d[(x*s+_)*4]/255*r]),A.push([0,-1,d[(x*s+m)*4]/255*r]),A.push([1,-1,d[(x*s+b)*4]/255*r]),A.push([1,0,d[(g*s+b)*4]/255*r]),A.push([1,1,d[(w*s+b)*4]/255*r]),A.push([0,1,d[(w*s+m)*4]/255*r]),A.push([-1,1,d[(w*s+_)*4]/255*r]);for(var M=[],F=A.length,D=0;D<F;D++){var R=A[D],B=A[(D+1)%F];R=a(R,E),B=a(B,E),M.push(o(n(R,B)))}for(var V=[0,0,0],D=0;D<M.length;D++)V[0]+=M[D][0],V[1]+=M[D][1],V[2]+=M[D][2];V[0]/=M.length,V[1]/=M.length,V[2]/=M.length;var U=(g*s+m)*4;v[U]=(V[0]+1)/2*255|0,v[U+1]=(V[1]+1)/2*255|0,v[U+2]=V[2]*255|0,v[U+3]=255}return c.putImageData(p,0,0),h},generateDataTexture:function(e,r,n){for(var a=e*r,o=new Uint8Array(3*a),s=Math.floor(n.r*255),l=Math.floor(n.g*255),h=Math.floor(n.b*255),c=0;c<a;c++)o[c*3]=s,o[c*3+1]=l,o[c*3+2]=h;var d=new t.DataTexture(o,e,r,t.RGBFormat);return d.needsUpdate=!0,d}},t.SceneUtils={createMultiMaterialObject:function(e,r){for(var n=new t.Object3D,a=0,o=r.length;a<o;a++)n.add(new t.Mesh(e,r[a]));return n},detach:function(e,r,n){e.applyMatrix(r.matrixWorld),r.remove(e),n.add(e)},attach:function(e,r,n){var a=new t.Matrix4;a.getInverse(n.matrixWorld),e.applyMatrix(a),r.remove(e),n.add(e)}},t.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch{throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(e){var r=e.familyName.toLowerCase(),n=this;return n.faces[r]=n.faces[r]||{},n.faces[r][e.cssFontWeight]=n.faces[r][e.cssFontWeight]||{},n.faces[r][e.cssFontWeight][e.cssFontStyle]=e,n.faces[r][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var r,n=this.getFace(),a=this.size/n.resolution,o=0,s=String(e).split(""),l=s.length,h=[];for(r=0;r<l;r++){var c=new t.Path,d=this.extractGlyphPoints(s[r],n,a,o,c);o+=d.offset,h.push(d.path)}var p=o/2;return{paths:h,offset:p}},extractGlyphPoints:function(e,r,n,a,o){var s=[],l,h,c,d,p,v,m,g,x,w,_,b,A,E,M,F,D,R,B,V=r.glyphs[e]||r.glyphs["?"];if(V){if(V.o)for(d=V._cachedOutline||(V._cachedOutline=V.o.split(" ")),v=d.length,m=n,g=n,l=0;l<v;)switch(p=d[l++],p){case"m":x=d[l++]*m+a,w=d[l++]*g,o.moveTo(x,w);break;case"l":x=d[l++]*m+a,w=d[l++]*g,o.lineTo(x,w);break;case"q":if(_=d[l++]*m+a,b=d[l++]*g,M=d[l++]*m+a,F=d[l++]*g,o.quadraticCurveTo(M,F,_,b),B=s[s.length-1],B)for(A=B.x,E=B.y,h=1,c=this.divisions;h<=c;h++){var U=h/c;t.Shape.Utils.b2(U,A,M,_),t.Shape.Utils.b2(U,E,F,b)}break;case"b":if(_=d[l++]*m+a,b=d[l++]*g,M=d[l++]*m+a,F=d[l++]*g,D=d[l++]*m+a,R=d[l++]*g,o.bezierCurveTo(M,F,D,R,_,b),B=s[s.length-1],B)for(A=B.x,E=B.y,h=1,c=this.divisions;h<=c;h++){var U=h/c;t.Shape.Utils.b3(U,A,M,D,_),t.Shape.Utils.b3(U,E,F,R,b)}break}return{offset:V.ha*n,path:o}}}},t.FontUtils.generateShapes=function(e,r){r=r||{};var n=r.size!==void 0?r.size:100,a=r.curveSegments!==void 0?r.curveSegments:4,o=r.font!==void 0?r.font:"helvetiker",s=r.weight!==void 0?r.weight:"normal",l=r.style!==void 0?r.style:"normal";t.FontUtils.size=n,t.FontUtils.divisions=a,t.FontUtils.face=o,t.FontUtils.weight=s,t.FontUtils.style=l;for(var h=t.FontUtils.drawText(e),c=h.paths,d=[],p=0,v=c.length;p<v;p++)Array.prototype.push.apply(d,c[p].toShapes());return d},function(e){var r=1e-10,n=function(s,l){var h=s.length;if(h<3)return null;var c=[],d=[],p=[],v,m,g;if(a(s)>0)for(m=0;m<h;m++)d[m]=m;else for(m=0;m<h;m++)d[m]=h-1-m;var x=h,w=2*x;for(m=x-1;x>2;){if(w--<=0)return console.log("Warning, unable to triangulate polygon!"),l?p:c;if(v=m,x<=v&&(v=0),m=v+1,x<=m&&(m=0),g=m+1,x<=g&&(g=0),o(s,v,m,g,x,d)){var _,b,A,E,M;for(_=d[v],b=d[m],A=d[g],c.push([s[_],s[b],s[A]]),p.push([d[v],d[m],d[g]]),E=m,M=m+1;M<x;E++,M++)d[E]=d[M];x--,w=2*x}}return l?p:c},a=function(s){for(var l=s.length,h=0,c=l-1,d=0;d<l;c=d++)h+=s[c].x*s[d].y-s[d].x*s[c].y;return h*.5},o=function(s,l,h,c,d,p){var v,m,g,x,w,_,b,A,E;if(m=s[p[l]].x,g=s[p[l]].y,x=s[p[h]].x,w=s[p[h]].y,_=s[p[c]].x,b=s[p[c]].y,r>(x-m)*(b-g)-(w-g)*(_-m))return!1;var M,F,D,R,B,V,U,z,I,Y,H,q,ee,G,$;for(M=_-x,F=b-w,D=m-_,R=g-b,B=x-m,V=w-g,v=0;v<d;v++)if(A=s[p[v]].x,E=s[p[v]].y,!(A===m&&E===g||A===x&&E===w||A===_&&E===b)&&(U=A-m,z=E-g,I=A-x,Y=E-w,H=A-_,q=E-b,$=M*Y-F*I,ee=B*z-V*U,G=D*q-R*H,$>=-r&&G>=-r&&ee>=-r))return!1;return!0};return e.Triangulate=n,e.Triangulate.area=a,e}(t.FontUtils),Re._typeface_js={faces:t.FontUtils.faces,loadFace:t.FontUtils.loadFace},t.typeface_js=Re._typeface_js,t.Audio=function(e){t.Object3D.call(this),this.type="Audio",this.context=e.context,this.source=this.context.createBufferSource(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},t.Audio.prototype=Object.create(t.Object3D.prototype),t.Audio.prototype.load=function(e){var r=this,n=new XMLHttpRequest;return n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(a){r.context.decodeAudioData(this.response,function(o){r.source.buffer=o,r.source.connect(r.panner),r.source.start(0)})},n.send(),this},t.Audio.prototype.setLoop=function(e){this.source.loop=e},t.Audio.prototype.setRefDistance=function(e){this.panner.refDistance=e},t.Audio.prototype.setRolloffFactor=function(e){this.panner.rolloffFactor=e},t.Audio.prototype.updateMatrixWorld=function(){var e=new t.Vector3;return function(r){t.Object3D.prototype.updateMatrixWorld.call(this,r),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}(),t.AudioListener=function(){t.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext)},t.AudioListener.prototype=Object.create(t.Object3D.prototype),t.AudioListener.prototype.updateMatrixWorld=function(){var e=new t.Vector3,r=new t.Quaternion,n=new t.Vector3,a=new t.Vector3,o=new t.Vector3,s=new t.Vector3;return function(l){t.Object3D.prototype.updateMatrixWorld.call(this,l);var h=this.context.listener;this.matrixWorld.decompose(e,r,n),a.set(0,0,-1).applyQuaternion(r),o.subVectors(e,s),h.setPosition(e.x,e.y,e.z),h.setOrientation(a.x,a.y,a.z,this.up.x,this.up.y,this.up.z),h.setVelocity(o.x,o.y,o.z),s.copy(e)}}(),t.Curve=function(){},t.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},t.Curve.prototype.getPointAt=function(e){var r=this.getUtoTmapping(e);return this.getPoint(r)},t.Curve.prototype.getPoints=function(e){e||(e=5);var r,n=[];for(r=0;r<=e;r++)n.push(this.getPoint(r/e));return n},t.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var r,n=[];for(r=0;r<=e;r++)n.push(this.getPointAt(r/e));return n},t.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},t.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var r=[],n,a=this.getPoint(0),o,s=0;for(r.push(0),o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(a),r.push(s),a=n;return this.cacheArcLengths=r,r},t.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},t.Curve.prototype.getUtoTmapping=function(e,r){var n=this.getLengths(),a=0,o=n.length,s;r?s=r:s=e*n[o-1];for(var l=0,h=o-1,c;l<=h;)if(a=Math.floor(l+(h-l)/2),c=n[a]-s,c<0){l=a+1;continue}else if(c>0){h=a-1;continue}else{h=a;break}if(a=h,n[a]==s){var g=a/(o-1);return g}var d=n[a],p=n[a+1],v=p-d,m=(s-d)/v,g=(a+m)/(o-1);return g},t.Curve.prototype.getTangent=function(e){var r=1e-4,n=e-r,a=e+r;n<0&&(n=0),a>1&&(a=1);var o=this.getPoint(n),s=this.getPoint(a),l=s.clone().sub(o);return l.normalize()},t.Curve.prototype.getTangentAt=function(e){var r=this.getUtoTmapping(e);return this.getTangent(r)},t.Curve.Utils={tangentQuadraticBezier:function(e,r,n,a){return 2*(1-e)*(n-r)+2*e*(a-n)},tangentCubicBezier:function(e,r,n,a,o){return-3*r*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*a*(1-e)-3*e*e*a+3*e*e*o},tangentSpline:function(e,r,n,a,o){var s=6*e*e-6*e,l=3*e*e-4*e+1,h=-6*e*e+6*e,c=3*e*e-2*e;return s+l+h+c},interpolate:function(e,r,n,a,o){var s=(n-e)*.5,l=(a-r)*.5,h=o*o,c=o*h;return(2*r-2*n+s+l)*c+(-3*r+3*n-2*s-l)*h+s*o+r}},t.Curve.create=function(e,r){return e.prototype=Object.create(t.Curve.prototype),e.prototype.getPoint=r,e},t.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},t.CurvePath.prototype=Object.create(t.Curve.prototype),t.CurvePath.prototype.add=function(e){this.curves.push(e)},t.CurvePath.prototype.checkConnection=function(){},t.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),r=this.curves[this.curves.length-1].getPoint(1);e.equals(r)||this.curves.push(new t.LineCurve(r,e))},t.CurvePath.prototype.getPoint=function(e){for(var r=e*this.getLength(),n=this.getCurveLengths(),a=0,o,s;a<n.length;){if(n[a]>=r){o=n[a]-r,s=this.curves[a];var l=1-o/s.getLength();return s.getPointAt(l)}a++}return null},t.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},t.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],r=0,n,a=this.curves.length;for(n=0;n<a;n++)r+=this.curves[n].getLength(),e.push(r);return this.cacheLengths=e,e},t.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),r,n,a,o,s,l;r=n=Number.NEGATIVE_INFINITY,o=s=Number.POSITIVE_INFINITY;var h,c,d,p,v=e[0]instanceof t.Vector3;for(p=v?new t.Vector3:new t.Vector2,c=0,d=e.length;c<d;c++)h=e[c],h.x>r?r=h.x:h.x<o&&(o=h.x),h.y>n?n=h.y:h.y<s&&(s=h.y),v&&(h.z>a?a=h.z:h.z<l&&(l=h.z)),p.add(h);var m={minX:o,minY:s,maxX:r,maxY:n};return v&&(m.maxZ=a,m.minZ=l),m},t.CurvePath.prototype.createPointsGeometry=function(e){var r=this.getPoints(e,!0);return this.createGeometry(r)},t.CurvePath.prototype.createSpacedPointsGeometry=function(e){var r=this.getSpacedPoints(e,!0);return this.createGeometry(r)},t.CurvePath.prototype.createGeometry=function(e){for(var r=new t.Geometry,n=0;n<e.length;n++)r.vertices.push(new t.Vector3(e[n].x,e[n].y,e[n].z||0));return r},t.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},t.CurvePath.prototype.getTransformedPoints=function(e,r){var n=this.getPoints(e),a,o;for(r||(r=this.bends),a=0,o=r.length;a<o;a++)n=this.getWrapPoints(n,r[a]);return n},t.CurvePath.prototype.getTransformedSpacedPoints=function(e,r){var n=this.getSpacedPoints(e),a,o;for(r||(r=this.bends),a=0,o=r.length;a<o;a++)n=this.getWrapPoints(n,r[a]);return n},t.CurvePath.prototype.getWrapPoints=function(e,r){var n=this.getBoundingBox(),a,o,s,l,h,c;for(a=0,o=e.length;a<o;a++){s=e[a],l=s.x,h=s.y,c=l/n.maxX,c=r.getUtoTmapping(c,l);var d=r.getPoint(c),p=r.getTangent(c);p.set(-p.y,p.x).multiplyScalar(h),s.x=d.x+p.x,s.y=d.y+p.y}return e},t.Gyroscope=function(){t.Object3D.call(this)},t.Gyroscope.prototype=Object.create(t.Object3D.prototype),t.Gyroscope.prototype.updateMatrixWorld=function(){var e=new t.Vector3,r=new t.Quaternion,n=new t.Vector3,a=new t.Vector3,o=new t.Quaternion,s=new t.Vector3;return function(l){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||l)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(a,o,s),this.matrix.decompose(e,r,n),this.matrixWorld.compose(a,r,s)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,l=!0);for(var h=0,c=this.children.length;h<c;h++)this.children[h].updateMatrixWorld(l)}}(),t.Path=function(e){t.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},t.Path.prototype=Object.create(t.CurvePath.prototype),t.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},t.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var r=1,n=e.length;r<n;r++)this.lineTo(e[r].x,e[r].y)},t.Path.prototype.moveTo=function(e,r){var n=Array.prototype.slice.call(arguments);this.actions.push({action:t.PathActions.MOVE_TO,args:n})},t.Path.prototype.lineTo=function(e,r){var n=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,o=a[a.length-2],s=a[a.length-1],l=new t.LineCurve(new t.Vector2(o,s),new t.Vector2(e,r));this.curves.push(l),this.actions.push({action:t.PathActions.LINE_TO,args:n})},t.Path.prototype.quadraticCurveTo=function(e,r,n,a){var o=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],h=s[s.length-1],c=new t.QuadraticBezierCurve(new t.Vector2(l,h),new t.Vector2(e,r),new t.Vector2(n,a));this.curves.push(c),this.actions.push({action:t.PathActions.QUADRATIC_CURVE_TO,args:o})},t.Path.prototype.bezierCurveTo=function(e,r,n,a,o,s){var l=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,c=h[h.length-2],d=h[h.length-1],p=new t.CubicBezierCurve(new t.Vector2(c,d),new t.Vector2(e,r),new t.Vector2(n,a),new t.Vector2(o,s));this.curves.push(p),this.actions.push({action:t.PathActions.BEZIER_CURVE_TO,args:l})},t.Path.prototype.splineThru=function(e){var r=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,a=n[n.length-2],o=n[n.length-1],s=[new t.Vector2(a,o)];Array.prototype.push.apply(s,e);var l=new t.SplineCurve(s);this.curves.push(l),this.actions.push({action:t.PathActions.CSPLINE_THRU,args:r})},t.Path.prototype.arc=function(e,r,n,a,o,s){var l=this.actions[this.actions.length-1].args,h=l[l.length-2],c=l[l.length-1];this.absarc(e+h,r+c,n,a,o,s)},t.Path.prototype.absarc=function(e,r,n,a,o,s){this.absellipse(e,r,n,n,a,o,s)},t.Path.prototype.ellipse=function(e,r,n,a,o,s,l){var h=this.actions[this.actions.length-1].args,c=h[h.length-2],d=h[h.length-1];this.absellipse(e+c,r+d,n,a,o,s,l)},t.Path.prototype.absellipse=function(e,r,n,a,o,s,l){var h=Array.prototype.slice.call(arguments),c=new t.EllipseCurve(e,r,n,a,o,s,l);this.curves.push(c);var d=c.getPoint(1);h.push(d.x),h.push(d.y),this.actions.push({action:t.PathActions.ELLIPSE,args:h})},t.Path.prototype.getSpacedPoints=function(e,r){e||(e=40);for(var n=[],a=0;a<e;a++)n.push(this.getPoint(a/e));return n},t.Path.prototype.getPoints=function(e,r){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,r);e=e||12;var n=[],a,o,s,l,h,c,d,p,v,m,g,x,w,_,b,A,E,M;for(a=0,o=this.actions.length;a<o;a++)switch(s=this.actions[a],l=s.action,h=s.args,l){case t.PathActions.MOVE_TO:n.push(new t.Vector2(h[0],h[1]));break;case t.PathActions.LINE_TO:n.push(new t.Vector2(h[0],h[1]));break;case t.PathActions.QUADRATIC_CURVE_TO:for(c=h[2],d=h[3],m=h[0],g=h[1],n.length>0?(_=n[n.length-1],x=_.x,w=_.y):(_=this.actions[a-1].args,x=_[_.length-2],w=_[_.length-1]),b=1;b<=e;b++)A=b/e,E=t.Shape.Utils.b2(A,x,m,c),M=t.Shape.Utils.b2(A,w,g,d),n.push(new t.Vector2(E,M));break;case t.PathActions.BEZIER_CURVE_TO:for(c=h[4],d=h[5],m=h[0],g=h[1],p=h[2],v=h[3],n.length>0?(_=n[n.length-1],x=_.x,w=_.y):(_=this.actions[a-1].args,x=_[_.length-2],w=_[_.length-1]),b=1;b<=e;b++)A=b/e,E=t.Shape.Utils.b3(A,x,m,p,c),M=t.Shape.Utils.b3(A,w,g,v,d),n.push(new t.Vector2(E,M));break;case t.PathActions.CSPLINE_THRU:_=this.actions[a-1].args;var F=new t.Vector2(_[_.length-2],_[_.length-1]),D=[F],R=e*h[0].length;D=D.concat(h[0]);var B=new t.SplineCurve(D);for(b=1;b<=R;b++)n.push(B.getPointAt(b/R));break;case t.PathActions.ARC:var U=h[0],z=h[1],V=h[2],H=h[3],q=h[4],ee=!!h[5],G=q-H,$,J=e*2;for(b=1;b<=J;b++)A=b/J,ee||(A=1-A),$=H+A*G,E=U+V*Math.cos($),M=z+V*Math.sin($),n.push(new t.Vector2(E,M));break;case t.PathActions.ELLIPSE:var U=h[0],z=h[1],I=h[2],Y=h[3],H=h[4],q=h[5],ee=!!h[6],G=q-H,$,J=e*2;for(b=1;b<=J;b++)A=b/J,ee||(A=1-A),$=H+A*G,E=U+I*Math.cos($),M=z+Y*Math.sin($),n.push(new t.Vector2(E,M));break}var X=n[n.length-1],K=1e-10;return Math.abs(X.x-n[0].x)<K&&Math.abs(X.y-n[0].y)<K&&n.splice(n.length-1,1),r&&n.push(n[0]),n},t.Path.prototype.toShapes=function(e,r){function n(H){var q,ee,G,$,J,X=[],K=new t.Path;for(q=0,ee=H.length;q<ee;q++)G=H[q],J=G.args,$=G.action,$==t.PathActions.MOVE_TO&&K.actions.length!=0&&(X.push(K),K=new t.Path),K[$].apply(K,J);return K.actions.length!=0&&X.push(K),X}function a(H){for(var q=[],ee=0,G=H.length;ee<G;ee++){var $=H[ee],J=new t.Shape;J.actions=$.actions,J.curves=$.curves,q.push(J)}return q}function o(H,q){for(var ee=1e-10,G=q.length,$=!1,J=G-1,X=0;X<G;J=X++){var K=q[J],ne=q[X],re=ne.x-K.x,se=ne.y-K.y;if(Math.abs(se)>ee){if(se<0&&(K=q[X],re=-re,ne=q[J],se=-se),H.y<K.y||H.y>ne.y)continue;if(H.y==K.y){if(H.x==K.x)return!0}else{var Z=se*(H.x-K.x)-re*(H.y-K.y);if(Z==0)return!0;if(Z<0)continue;$=!$}}else{if(H.y!=K.y)continue;if(ne.x<=H.x&&H.x<=K.x||K.x<=H.x&&H.x<=ne.x)return!0}}return $}var s=n(this.actions);if(s.length==0)return[];if(r===!0)return a(s);var l,h,c,d=[];if(s.length==1)return h=s[0],c=new t.Shape,c.actions=h.actions,c.curves=h.curves,d.push(c),d;var p=!t.Shape.Utils.isClockWise(s[0].getPoints());p=e?!p:p;var v=[],m=[],g=[],x=0,w;m[x]=void 0,g[x]=[];var _,b;for(_=0,b=s.length;_<b;_++)h=s[_],w=h.getPoints(),l=t.Shape.Utils.isClockWise(w),l=e?!l:l,l?(!p&&m[x]&&x++,m[x]={s:new t.Shape,p:w},m[x].s.actions=h.actions,m[x].s.curves=h.curves,p&&x++,g[x]=[]):g[x].push({h,p:w[0]});if(!m[0])return a(s);if(m.length>1){for(var A=!1,E=[],M=0,F=m.length;M<F;M++)v[M]=[];for(var M=0,F=m.length;M<F;M++){m[M];for(var D=g[M],R=0;R<D.length;R++){for(var B=D[R],V=!0,U=0;U<m.length;U++)o(B.p,m[U].p)&&(M!=U&&E.push({froms:M,tos:U,hole:R}),V?(V=!1,v[U].push(B)):A=!0);V&&v[M].push(B)}}E.length>0&&(A||(g=v))}var z,I,Y;for(_=0,b=m.length;_<b;_++)for(c=m[_].s,d.push(c),z=g[_],I=0,Y=z.length;I<Y;I++)c.holes.push(z[I].h);return d},t.Shape=function(){t.Path.apply(this,arguments),this.holes=[]},t.Shape.prototype=Object.create(t.Path.prototype),t.Shape.prototype.extrude=function(e){var r=new t.ExtrudeGeometry(this,e);return r},t.Shape.prototype.makeGeometry=function(e){var r=new t.ShapeGeometry(this,e);return r},t.Shape.prototype.getPointsHoles=function(e){var r,n=this.holes.length,a=[];for(r=0;r<n;r++)a[r]=this.holes[r].getTransformedPoints(e,this.bends);return a},t.Shape.prototype.getSpacedPointsHoles=function(e){var r,n=this.holes.length,a=[];for(r=0;r<n;r++)a[r]=this.holes[r].getTransformedSpacedPoints(e,this.bends);return a},t.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},t.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},t.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},t.Shape.Utils={triangulateShape:function(e,r){function n(A,E,M){return A.x!=E.x?A.x<E.x?A.x<=M.x&&M.x<=E.x:E.x<=M.x&&M.x<=A.x:A.y<E.y?A.y<=M.y&&M.y<=E.y:E.y<=M.y&&M.y<=A.y}function a(A,E,M,F,D){var R=1e-10,B=E.x-A.x,V=E.y-A.y,U=F.x-M.x,z=F.y-M.y,I=A.x-M.x,Y=A.y-M.y,H=V*U-B*z,q=V*I-B*Y;if(Math.abs(H)>R){var ee;if(H>0){if(q<0||q>H)return[];if(ee=z*I-U*Y,ee<0||ee>H)return[]}else{if(q>0||q<H)return[];if(ee=z*I-U*Y,ee>0||ee<H)return[]}if(ee==0)return D&&(q==0||q==H)?[]:[A];if(ee==H)return D&&(q==0||q==H)?[]:[E];if(q==0)return[M];if(q==H)return[F];var G=ee/H;return[{x:A.x+G*B,y:A.y+G*V}]}else{if(q!=0||z*I!=U*Y)return[];var $=B==0&&V==0,J=U==0&&z==0;if($&&J)return A.x!=M.x||A.y!=M.y?[]:[A];if($)return n(M,F,A)?[A]:[];if(J)return n(A,E,M)?[M]:[];var X,K,ne,re,se,Z,de,ge;return B!=0?(A.x<E.x?(X=A,ne=A.x,K=E,re=E.x):(X=E,ne=E.x,K=A,re=A.x),M.x<F.x?(se=M,de=M.x,Z=F,ge=F.x):(se=F,de=F.x,Z=M,ge=M.x)):(A.y<E.y?(X=A,ne=A.y,K=E,re=E.y):(X=E,ne=E.y,K=A,re=A.y),M.y<F.y?(se=M,de=M.y,Z=F,ge=F.y):(se=F,de=F.y,Z=M,ge=M.y)),ne<=de?re<de?[]:re==de?D?[]:[se]:re<=ge?[se,K]:[se,Z]:ne>ge?[]:ne==ge?D?[]:[X]:re<=ge?[X,K]:[X,Z]}}function o(A,E,M,F){var D=1e-10,R=E.x-A.x,B=E.y-A.y,V=M.x-A.x,U=M.y-A.y,z=F.x-A.x,I=F.y-A.y,Y=R*U-B*V,H=R*I-B*z;if(Math.abs(Y)>D){var q=z*U-I*V;return Y>0?H>=0&&q>=0:H>=0||q>=0}else return H>0}function s(A,E){var M=A.concat(),F;function D(de,ge){var we=M.length-1,Ee=de-1;Ee<0&&(Ee=we);var Te=de+1;Te>we&&(Te=0);var Be=o(M[de],M[Ee],M[Te],F[ge]);if(!Be)return!1;var Ce=F.length-1,Ze=ge-1;Ze<0&&(Ze=Ce);var Je=ge+1;return Je>Ce&&(Je=0),Be=o(F[ge],F[Ze],F[Je],M[de]),!!Be}function R(de,ge){var we,Ee,Te;for(we=0;we<M.length;we++)if(Ee=we+1,Ee%=M.length,Te=a(de,ge,M[we],M[Ee],!0),Te.length>0)return!0;return!1}var B=[];function V(de,ge){var we,Ee,Te,Be,Ce;for(we=0;we<B.length;we++)for(Ee=E[B[we]],Te=0;Te<Ee.length;Te++)if(Be=Te+1,Be%=Ee.length,Ce=a(de,ge,Ee[Te],Ee[Be],!0),Ce.length>0)return!0;return!1}for(var U,z,I,Y,H,q,ee=[],G,$,J,X,K=0,ne=E.length;K<ne;K++)B.push(K);for(var re=0,se=B.length*2;B.length>0;){if(se--,se<0){console.log("Infinite Loop! Holes left:"+B.length+", Probably Hole outside Shape!");break}for(z=re;z<M.length;z++){I=M[z],U=-1;for(var K=0;K<B.length;K++)if(H=B[K],q=I.x+":"+I.y+":"+H,ee[q]===void 0){F=E[H];for(var Z=0;Z<F.length;Z++)if(Y=F[Z],!!D(z,Z)&&!R(I,Y)&&!V(I,Y)){U=Z,B.splice(K,1),G=M.slice(0,z+1),$=M.slice(z),J=F.slice(U),X=F.slice(0,U+1),M=G.concat(J).concat(X).concat($),re=z;break}if(U>=0)break;ee[q]=!0}if(U>=0)break}}return M}for(var l,h,c,d,p,v,m={},g=e.concat(),x=0,w=r.length;x<w;x++)Array.prototype.push.apply(g,r[x]);for(l=0,h=g.length;l<h;l++)p=g[l].x+":"+g[l].y,m[p]!==void 0&&console.log("Duplicate point",p),m[p]=l;var _=s(e,r),b=t.FontUtils.Triangulate(_,!1);for(l=0,h=b.length;l<h;l++)for(d=b[l],c=0;c<3;c++)p=d[c].x+":"+d[c].y,v=m[p],v!==void 0&&(d[c]=v);return b.concat()},isClockWise:function(e){return t.FontUtils.Triangulate.area(e)<0},b2p0:function(e,r){var n=1-e;return n*n*r},b2p1:function(e,r){return 2*(1-e)*e*r},b2p2:function(e,r){return e*e*r},b2:function(e,r,n,a){return this.b2p0(e,r)+this.b2p1(e,n)+this.b2p2(e,a)},b3p0:function(e,r){var n=1-e;return n*n*n*r},b3p1:function(e,r){var n=1-e;return 3*n*n*e*r},b3p2:function(e,r){var n=1-e;return 3*n*e*e*r},b3p3:function(e,r){return e*e*e*r},b3:function(e,r,n,a,o){return this.b3p0(e,r)+this.b3p1(e,n)+this.b3p2(e,a)+this.b3p3(e,o)}},t.LineCurve=function(e,r){this.v1=e,this.v2=r},t.LineCurve.prototype=Object.create(t.Curve.prototype),t.LineCurve.prototype.getPoint=function(e){var r=this.v2.clone().sub(this.v1);return r.multiplyScalar(e).add(this.v1),r},t.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},t.LineCurve.prototype.getTangent=function(e){var r=this.v2.clone().sub(this.v1);return r.normalize()},t.QuadraticBezierCurve=function(e,r,n){this.v0=e,this.v1=r,this.v2=n},t.QuadraticBezierCurve.prototype=Object.create(t.Curve.prototype),t.QuadraticBezierCurve.prototype.getPoint=function(e){var r=new t.Vector2;return r.x=t.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r.y=t.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),r},t.QuadraticBezierCurve.prototype.getTangent=function(e){var r=new t.Vector2;return r.x=t.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),r.y=t.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),r.normalize()},t.CubicBezierCurve=function(e,r,n,a){this.v0=e,this.v1=r,this.v2=n,this.v3=a},t.CubicBezierCurve.prototype=Object.create(t.Curve.prototype),t.CubicBezierCurve.prototype.getPoint=function(e){var r,n;return r=t.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=t.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new t.Vector2(r,n)},t.CubicBezierCurve.prototype.getTangent=function(e){var r,n;r=t.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=t.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var a=new t.Vector2(r,n);return a.normalize(),a},t.SplineCurve=function(e){this.points=e??[]},t.SplineCurve.prototype=Object.create(t.Curve.prototype),t.SplineCurve.prototype.getPoint=function(e){var r=this.points,n=(r.length-1)*e,a=Math.floor(n),o=n-a,s=r[a==0?a:a-1],l=r[a],h=r[a>r.length-2?r.length-1:a+1],c=r[a>r.length-3?r.length-1:a+2],d=new t.Vector2;return d.x=t.Curve.Utils.interpolate(s.x,l.x,h.x,c.x,o),d.y=t.Curve.Utils.interpolate(s.y,l.y,h.y,c.y,o),d},t.EllipseCurve=function(e,r,n,a,o,s,l){this.aX=e,this.aY=r,this.xRadius=n,this.yRadius=a,this.aStartAngle=o,this.aEndAngle=s,this.aClockwise=l},t.EllipseCurve.prototype=Object.create(t.Curve.prototype),t.EllipseCurve.prototype.getPoint=function(e){var r=this.aEndAngle-this.aStartAngle;r<0&&(r+=Math.PI*2),r>Math.PI*2&&(r-=Math.PI*2);var n;this.aClockwise===!0?n=this.aEndAngle+(1-e)*(Math.PI*2-r):n=this.aStartAngle+e*r;var a=new t.Vector2;return a.x=this.aX+this.xRadius*Math.cos(n),a.y=this.aY+this.yRadius*Math.sin(n),a},t.ArcCurve=function(e,r,n,a,o,s){t.EllipseCurve.call(this,e,r,n,n,a,o,s)},t.ArcCurve.prototype=Object.create(t.EllipseCurve.prototype),t.LineCurve3=t.Curve.create(function(e,r){this.v1=e,this.v2=r},function(e){var r=new t.Vector3;return r.subVectors(this.v2,this.v1),r.multiplyScalar(e),r.add(this.v1),r}),t.QuadraticBezierCurve3=t.Curve.create(function(e,r,n){this.v0=e,this.v1=r,this.v2=n},function(e){var r=new t.Vector3;return r.x=t.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r.y=t.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),r.z=t.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),r}),t.CubicBezierCurve3=t.Curve.create(function(e,r,n,a){this.v0=e,this.v1=r,this.v2=n,this.v3=a},function(e){var r=new t.Vector3;return r.x=t.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r.y=t.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),r.z=t.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),r}),t.SplineCurve3=t.Curve.create(function(e){this.points=e??[]},function(e){var r=this.points,n=(r.length-1)*e,a=Math.floor(n),o=n-a,s=r[a==0?a:a-1],l=r[a],h=r[a>r.length-2?r.length-1:a+1],c=r[a>r.length-3?r.length-1:a+2],d=new t.Vector3;return d.x=t.Curve.Utils.interpolate(s.x,l.x,h.x,c.x,o),d.y=t.Curve.Utils.interpolate(s.y,l.y,h.y,c.y,o),d.z=t.Curve.Utils.interpolate(s.z,l.z,h.z,c.z,o),d}),t.ClosedSplineCurve3=t.Curve.create(function(e){this.points=e??[]},function(e){var r=this.points,n=(r.length-0)*e,a=Math.floor(n),o=n-a;a+=a>0?0:(Math.floor(Math.abs(a)/r.length)+1)*r.length;var s=r[(a-1)%r.length],l=r[a%r.length],h=r[(a+1)%r.length],c=r[(a+2)%r.length],d=new t.Vector3;return d.x=t.Curve.Utils.interpolate(s.x,l.x,h.x,c.x,o),d.y=t.Curve.Utils.interpolate(s.y,l.y,h.y,c.y,o),d.z=t.Curve.Utils.interpolate(s.z,l.z,h.z,c.z,o),d}),t.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(e){if(e.initialized!==!0){for(var r=0;r<e.hierarchy.length;r++){for(var n=0;n<e.hierarchy[r].keys.length;n++)if(e.hierarchy[r].keys[n].time<0&&(e.hierarchy[r].keys[n].time=0),e.hierarchy[r].keys[n].rot!==void 0&&!(e.hierarchy[r].keys[n].rot instanceof t.Quaternion)){var a=e.hierarchy[r].keys[n].rot;e.hierarchy[r].keys[n].rot=new t.Quaternion().fromArray(a)}if(e.hierarchy[r].keys.length&&e.hierarchy[r].keys[0].morphTargets!==void 0){for(var o={},n=0;n<e.hierarchy[r].keys.length;n++)for(var s=0;s<e.hierarchy[r].keys[n].morphTargets.length;s++){var l=e.hierarchy[r].keys[n].morphTargets[s];o[l]=-1}e.hierarchy[r].usedMorphTargets=o;for(var n=0;n<e.hierarchy[r].keys.length;n++){var h={};for(var l in o){for(var s=0;s<e.hierarchy[r].keys[n].morphTargets.length;s++)if(e.hierarchy[r].keys[n].morphTargets[s]===l){h[l]=e.hierarchy[r].keys[n].morphTargetsInfluences[s];break}s===e.hierarchy[r].keys[n].morphTargets.length&&(h[l]=0)}e.hierarchy[r].keys[n].morphTargetsInfluences=h}}for(var n=1;n<e.hierarchy[r].keys.length;n++)e.hierarchy[r].keys[n].time===e.hierarchy[r].keys[n-1].time&&(e.hierarchy[r].keys.splice(n,1),n--);for(var n=0;n<e.hierarchy[r].keys.length;n++)e.hierarchy[r].keys[n].index=n}return e.initialized=!0,e}},parse:function(e){var r=function(o,s){s.push(o);for(var l=0;l<o.children.length;l++)r(o.children[l],s)},n=[];if(e instanceof t.SkinnedMesh)for(var a=0;a<e.skeleton.bones.length;a++)n.push(e.skeleton.bones[a]);else r(e,n);return n},play:function(e){this.animations.indexOf(e)===-1&&this.animations.push(e)},stop:function(e){var r=this.animations.indexOf(e);r!==-1&&this.animations.splice(r,1)},update:function(e){for(var r=0;r<this.animations.length;r++)this.animations[r].resetBlendWeights();for(var r=0;r<this.animations.length;r++)this.animations[r].update(e)}},t.Animation=function(e,r){this.root=e,this.data=t.AnimationHandler.init(r),this.hierarchy=t.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=!0,this.weight=0,this.interpolationType=t.AnimationHandler.LINEAR},t.Animation.prototype.keyTypes=["pos","rot","scl"],t.Animation.prototype.play=function(e,r){this.currentTime=e!==void 0?e:0,this.weight=r!==void 0?r:1,this.isPlaying=!0,this.reset(),t.AnimationHandler.play(this)},t.Animation.prototype.stop=function(){this.isPlaying=!1,t.AnimationHandler.stop(this)},t.Animation.prototype.reset=function(){for(var e=0,r=this.hierarchy.length;e<r;e++){var n=this.hierarchy[e];n.matrixAutoUpdate=!0,n.animationCache===void 0&&(n.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}),n.animationCache.animations[this.data.name]===void 0&&(n.animationCache.animations[this.data.name]={},n.animationCache.animations[this.data.name].prevKey={pos:0,rot:0,scl:0},n.animationCache.animations[this.data.name].nextKey={pos:0,rot:0,scl:0},n.animationCache.animations[this.data.name].originalMatrix=n.matrix);for(var a=n.animationCache.animations[this.data.name],o=0;o<3;o++){for(var s=this.keyTypes[o],l=this.data.hierarchy[e].keys[0],h=this.getNextKeyWith(s,e,1);h.time<this.currentTime&&h.index>l.index;)l=h,h=this.getNextKeyWith(s,e,h.index+1);a.prevKey[s]=l,a.nextKey[s]=h}}},t.Animation.prototype.resetBlendWeights=function(){for(var e=0,r=this.hierarchy.length;e<r;e++){var n=this.hierarchy[e];n.animationCache!==void 0&&(n.animationCache.blending.positionWeight=0,n.animationCache.blending.quaternionWeight=0,n.animationCache.blending.scaleWeight=0)}},t.Animation.prototype.update=function(){var e=[],r=new t.Vector3,n=new t.Vector3,a=new t.Quaternion,o=function(l,h){var c=[],d=[],p,v,m,g,x,w,_,b,A;return p=(l.length-1)*h,v=Math.floor(p),m=p-v,c[0]=v===0?v:v-1,c[1]=v,c[2]=v>l.length-2?v:v+1,c[3]=v>l.length-3?v:v+2,w=l[c[0]],_=l[c[1]],b=l[c[2]],A=l[c[3]],g=m*m,x=m*g,d[0]=s(w[0],_[0],b[0],A[0],m,g,x),d[1]=s(w[1],_[1],b[1],A[1],m,g,x),d[2]=s(w[2],_[2],b[2],A[2],m,g,x),d},s=function(l,h,c,d,p,v,m){var g=(c-l)*.5,x=(d-h)*.5;return(2*(h-c)+g+x)*m+(-3*(h-c)-2*g-x)*v+g*p+h};return function(l){if(this.isPlaying!==!1&&(this.currentTime+=l*this.timeScale,this.weight!==0)){var h=this.data.length;if(this.currentTime>h||this.currentTime<0)if(this.loop)this.currentTime%=h,this.currentTime<0&&(this.currentTime+=h),this.reset();else{this.stop();return}for(var c=0,d=this.hierarchy.length;c<d;c++)for(var p=this.hierarchy[c],v=p.animationCache.animations[this.data.name],m=p.animationCache.blending,g=0;g<3;g++){var x=this.keyTypes[g],w=v.prevKey[x],_=v.nextKey[x];if(this.timeScale>0&&_.time<=this.currentTime||this.timeScale<0&&w.time>=this.currentTime){for(w=this.data.hierarchy[c].keys[0],_=this.getNextKeyWith(x,c,1);_.time<this.currentTime&&_.index>w.index;)w=_,_=this.getNextKeyWith(x,c,_.index+1);v.prevKey[x]=w,v.nextKey[x]=_}p.matrixAutoUpdate=!0,p.matrixWorldNeedsUpdate=!0;var b=(this.currentTime-w.time)/(_.time-w.time),A=w[x],E=_[x];if(b<0&&(b=0),b>1&&(b=1),x==="pos"){if(this.interpolationType===t.AnimationHandler.LINEAR){n.x=A[0]+(E[0]-A[0])*b,n.y=A[1]+(E[1]-A[1])*b,n.z=A[2]+(E[2]-A[2])*b;var M=this.weight/(this.weight+m.positionWeight);p.position.lerp(n,M),m.positionWeight+=this.weight}else if(this.interpolationType===t.AnimationHandler.CATMULLROM||this.interpolationType===t.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",c,w.index-1).pos,e[1]=A,e[2]=E,e[3]=this.getNextKeyWith("pos",c,_.index+1).pos,b=b*.33+.33;var F=o(e,b),M=this.weight/(this.weight+m.positionWeight);m.positionWeight+=this.weight;var D=p.position;if(D.x=D.x+(F[0]-D.x)*M,D.y=D.y+(F[1]-D.y)*M,D.z=D.z+(F[2]-D.z)*M,this.interpolationType===t.AnimationHandler.CATMULLROM_FORWARD){var R=o(e,b*1.01);r.set(R[0],R[1],R[2]),r.sub(D),r.y=0,r.normalize();var B=Math.atan2(r.x,r.z);p.rotation.set(0,B,0)}}}else if(x==="rot")if(t.Quaternion.slerp(A,E,a,b),m.quaternionWeight===0)p.quaternion.copy(a),m.quaternionWeight=this.weight;else{var M=this.weight/(this.weight+m.quaternionWeight);t.Quaternion.slerp(p.quaternion,a,p.quaternion,M),m.quaternionWeight+=this.weight}else if(x==="scl"){n.x=A[0]+(E[0]-A[0])*b,n.y=A[1]+(E[1]-A[1])*b,n.z=A[2]+(E[2]-A[2])*b;var M=this.weight/(this.weight+m.scaleWeight);p.scale.lerp(n,M),m.scaleWeight+=this.weight}}return!0}}}(),t.Animation.prototype.getNextKeyWith=function(e,r,n){var a=this.data.hierarchy[r].keys;for(this.interpolationType===t.AnimationHandler.CATMULLROM||this.interpolationType===t.AnimationHandler.CATMULLROM_FORWARD?n=n<a.length-1?n:a.length-1:n=n%a.length;n<a.length;n++)if(a[n][e]!==void 0)return a[n];return this.data.hierarchy[r].keys[0]},t.Animation.prototype.getPrevKeyWith=function(e,r,n){var a=this.data.hierarchy[r].keys;for(this.interpolationType===t.AnimationHandler.CATMULLROM||this.interpolationType===t.AnimationHandler.CATMULLROM_FORWARD?n=n>0?n:0:n=n>=0?n:n+a.length;n>=0;n--)if(a[n][e]!==void 0)return a[n];return this.data.hierarchy[r].keys[a.length-1]},t.KeyFrameAnimation=function(e){this.root=e.node,this.data=t.AnimationHandler.init(e),this.hierarchy=t.AnimationHandler.parse(this.root),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var r=0,n=this.hierarchy.length;r<n;r++){var a=this.data.hierarchy[r].keys,o=this.data.hierarchy[r].sids,s=this.hierarchy[r];if(a.length&&o){for(var l=0;l<o.length;l++){var h=o[l],c=this.getNextKeyWith(h,r,0);c&&c.apply(h)}s.matrixAutoUpdate=!1,this.data.hierarchy[r].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},t.KeyFrameAnimation.prototype.play=function(e){if(this.currentTime=e!==void 0?e:0,this.isPlaying===!1){this.isPlaying=!0;var r,n=this.hierarchy.length,a,o;for(r=0;r<n;r++){a=this.hierarchy[r],o=this.data.hierarchy[r],o.animationCache===void 0&&(o.animationCache={},o.animationCache.prevKey=null,o.animationCache.nextKey=null,o.animationCache.originalMatrix=a.matrix);var s=this.data.hierarchy[r].keys;s.length&&(o.animationCache.prevKey=s[0],o.animationCache.nextKey=s[1],this.startTime=Math.min(s[0].time,this.startTime),this.endTime=Math.max(s[s.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,t.AnimationHandler.play(this)},t.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,t.AnimationHandler.stop(this);for(var e=0;e<this.data.hierarchy.length;e++){var r=this.hierarchy[e],n=this.data.hierarchy[e];if(n.animationCache!==void 0){var a=n.animationCache.originalMatrix;a.copy(r.matrix),r.matrix=a,delete n.animationCache}}},t.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying!==!1){this.currentTime+=e*this.timeScale;var r=this.data.length;this.loop===!0&&this.currentTime>r&&(this.currentTime%=r),this.currentTime=Math.min(this.currentTime,r);for(var n=0,a=this.hierarchy.length;n<a;n++){var o=this.hierarchy[n],s=this.data.hierarchy[n],l=s.keys,h=s.animationCache;if(l.length){var c=h.prevKey,d=h.nextKey;if(d.time<=this.currentTime){for(;d.time<this.currentTime&&d.index>c.index;)c=d,d=l[c.index+1];h.prevKey=c,h.nextKey=d}d.time>=this.currentTime?c.interpolate(d,this.currentTime):c.interpolate(d,d.time),this.data.hierarchy[n].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}}},t.KeyFrameAnimation.prototype.getNextKeyWith=function(e,r,n){var a=this.data.hierarchy[r].keys;for(n=n%a.length;n<a.length;n++)if(a[n].hasTarget(e))return a[n];return a[0]},t.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,r,n){var a=this.data.hierarchy[r].keys;for(n=n>=0?n:n+a.length;n>=0;n--)if(a[n].hasTarget(e))return a[n];return a[a.length-1]},t.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},t.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var e=0,r=0;return function(n){if(this.isPlaying!==!1){this.currentTime+=n,this.loop===!0&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var a=this.duration/this.frames,o=Math.floor(this.currentTime/a);o!=r&&(this.mesh.morphTargetInfluences[e]=0,this.mesh.morphTargetInfluences[r]=1,this.mesh.morphTargetInfluences[o]=0,e=r,r=o),this.mesh.morphTargetInfluences[o]=this.currentTime%a/a,this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[o]}}}()},t.BoxGeometry=function(e,r,n,a,o,s){t.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:e,height:r,depth:n,widthSegments:a,heightSegments:o,depthSegments:s},this.widthSegments=a||1,this.heightSegments=o||1,this.depthSegments=s||1;var l=this,h=e/2,c=r/2,d=n/2;p("z","y",-1,-1,n,r,h,0),p("z","y",1,-1,n,r,-h,1),p("x","z",1,1,e,n,c,2),p("x","z",1,-1,e,n,-c,3),p("x","y",1,-1,e,r,d,4),p("x","y",-1,-1,e,r,-d,5);function p(v,m,g,x,w,_,b,A){var E,M,F,D=l.widthSegments,R=l.heightSegments,B=w/2,V=_/2,U=l.vertices.length;v==="x"&&m==="y"||v==="y"&&m==="x"?E="z":v==="x"&&m==="z"||v==="z"&&m==="x"?(E="y",R=l.depthSegments):(v==="z"&&m==="y"||v==="y"&&m==="z")&&(E="x",D=l.depthSegments);var z=D+1,I=R+1,Y=w/D,H=_/R,q=new t.Vector3;for(q[E]=b>0?1:-1,F=0;F<I;F++)for(M=0;M<z;M++){var ee=new t.Vector3;ee[v]=(M*Y-B)*g,ee[m]=(F*H-V)*x,ee[E]=b,l.vertices.push(ee)}for(F=0;F<R;F++)for(M=0;M<D;M++){var G=M+z*F,$=M+z*(F+1),J=M+1+z*(F+1),X=M+1+z*F,K=new t.Vector2(M/D,1-F/R),ne=new t.Vector2(M/D,1-(F+1)/R),re=new t.Vector2((M+1)/D,1-(F+1)/R),se=new t.Vector2((M+1)/D,1-F/R),Z=new t.Face3(G+U,$+U,X+U);Z.normal.copy(q),Z.vertexNormals.push(q.clone(),q.clone(),q.clone()),Z.materialIndex=A,l.faces.push(Z),l.faceVertexUvs[0].push([K,ne,se]),Z=new t.Face3($+U,J+U,X+U),Z.normal.copy(q),Z.vertexNormals.push(q.clone(),q.clone(),q.clone()),Z.materialIndex=A,l.faces.push(Z),l.faceVertexUvs[0].push([ne.clone(),re,se.clone()])}}this.mergeVertices()},t.BoxGeometry.prototype=Object.create(t.Geometry.prototype),t.CircleGeometry=function(e,r,n,a){t.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:r,thetaStart:n,thetaLength:a},e=e||50,r=r!==void 0?Math.max(3,r):8,n=n!==void 0?n:0,a=a!==void 0?a:Math.PI*2;var o,s=[],l=new t.Vector3,h=new t.Vector2(.5,.5);for(this.vertices.push(l),s.push(h),o=0;o<=r;o++){var c=new t.Vector3,d=n+o/r*a;c.x=e*Math.cos(d),c.y=e*Math.sin(d),this.vertices.push(c),s.push(new t.Vector2((c.x/e+1)/2,(c.y/e+1)/2))}var p=new t.Vector3(0,0,1);for(o=1;o<=r;o++)this.faces.push(new t.Face3(o,o+1,0,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([s[o].clone(),s[o+1].clone(),h.clone()]);this.computeFaceNormals(),this.boundingSphere=new t.Sphere(new t.Vector3,e)},t.CircleGeometry.prototype=Object.create(t.Geometry.prototype),t.CubeGeometry=function(e,r,n,a,o,s){return console.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry."),new t.BoxGeometry(e,r,n,a,o,s)},t.CylinderGeometry=function(e,r,n,a,o,s){t.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:r,height:n,radialSegments:a,heightSegments:o,openEnded:s},e=e!==void 0?e:20,r=r!==void 0?r:20,n=n!==void 0?n:100,a=a||8,o=o||1,s=s!==void 0?s:!1;var l=n/2,h,c,d=[],p=[];for(c=0;c<=o;c++){var v=[],m=[],g=c/o,x=g*(r-e)+e;for(h=0;h<=a;h++){var w=h/a,_=new t.Vector3;_.x=x*Math.sin(w*Math.PI*2),_.y=-g*n+l,_.z=x*Math.cos(w*Math.PI*2),this.vertices.push(_),v.push(this.vertices.length-1),m.push(new t.Vector2(w,1-g))}d.push(v),p.push(m)}var b=(r-e)/n,A,E;for(h=0;h<a;h++)for(e!==0?(A=this.vertices[d[0][h]].clone(),E=this.vertices[d[0][h+1]].clone()):(A=this.vertices[d[1][h]].clone(),E=this.vertices[d[1][h+1]].clone()),A.setY(Math.sqrt(A.x*A.x+A.z*A.z)*b).normalize(),E.setY(Math.sqrt(E.x*E.x+E.z*E.z)*b).normalize(),c=0;c<o;c++){var M=d[c][h],F=d[c+1][h],D=d[c+1][h+1],R=d[c][h+1],B=A.clone(),V=A.clone(),U=E.clone(),z=E.clone(),I=p[c][h].clone(),Y=p[c+1][h].clone(),H=p[c+1][h+1].clone(),q=p[c][h+1].clone();this.faces.push(new t.Face3(M,F,R,[B,V,z])),this.faceVertexUvs[0].push([I,Y,q]),this.faces.push(new t.Face3(F,D,R,[V.clone(),U,z.clone()])),this.faceVertexUvs[0].push([Y.clone(),H,q.clone()])}if(s===!1&&e>0)for(this.vertices.push(new t.Vector3(0,l,0)),h=0;h<a;h++){var M=d[0][h],F=d[0][h+1],D=this.vertices.length-1,B=new t.Vector3(0,1,0),V=new t.Vector3(0,1,0),U=new t.Vector3(0,1,0),I=p[0][h].clone(),Y=p[0][h+1].clone(),H=new t.Vector2(Y.x,0);this.faces.push(new t.Face3(M,F,D,[B,V,U])),this.faceVertexUvs[0].push([I,Y,H])}if(s===!1&&r>0)for(this.vertices.push(new t.Vector3(0,-l,0)),h=0;h<a;h++){var M=d[c][h+1],F=d[c][h],D=this.vertices.length-1,B=new t.Vector3(0,-1,0),V=new t.Vector3(0,-1,0),U=new t.Vector3(0,-1,0),I=p[c][h+1].clone(),Y=p[c][h].clone(),H=new t.Vector2(Y.x,1);this.faces.push(new t.Face3(M,F,D,[B,V,U])),this.faceVertexUvs[0].push([I,Y,H])}this.computeFaceNormals()},t.CylinderGeometry.prototype=Object.create(t.Geometry.prototype),t.ExtrudeGeometry=function(e,r){if(typeof e>"u"){e=[];return}t.Geometry.call(this),this.type="ExtrudeGeometry",e=e instanceof Array?e:[e],this.addShapeList(e,r),this.computeFaceNormals()},t.ExtrudeGeometry.prototype=Object.create(t.Geometry.prototype),t.ExtrudeGeometry.prototype.addShapeList=function(e,r){for(var n=e.length,a=0;a<n;a++){var o=e[a];this.addShape(o,r)}},t.ExtrudeGeometry.prototype.addShape=function(e,r){var n=r.amount!==void 0?r.amount:100,a=r.bevelThickness!==void 0?r.bevelThickness:6,o=r.bevelSize!==void 0?r.bevelSize:a-2,s=r.bevelSegments!==void 0?r.bevelSegments:3,l=r.bevelEnabled!==void 0?r.bevelEnabled:!0,h=r.curveSegments!==void 0?r.curveSegments:12,c=r.steps!==void 0?r.steps:1,d=r.extrudePath,p,v=!1,m=r.material,g=r.extrudeMaterial,x=r.UVGenerator!==void 0?r.UVGenerator:t.ExtrudeGeometry.WorldUVGenerator,w,_,b,A;d&&(p=d.getSpacedPoints(c),v=!0,l=!1,w=r.frames!==void 0?r.frames:new t.TubeGeometry.FrenetFrames(d,c,!1),_=new t.Vector3,b=new t.Vector3,A=new t.Vector3),l||(s=0,a=0,o=0);var E,M,F,D=this,R=this.vertices.length,B=e.extractPoints(h),V=B.shape,U=B.holes,z=!t.Shape.Utils.isClockWise(V);if(z){for(V=V.reverse(),M=0,F=U.length;M<F;M++)E=U[M],t.Shape.Utils.isClockWise(E)&&(U[M]=E.reverse());z=!1}var I=t.Shape.Utils.triangulateShape(V,U),Y=V;for(M=0,F=U.length;M<F;M++)E=U[M],V=V.concat(E);function H(u,Se,xe){return Se||console.log("die"),Se.clone().multiplyScalar(xe).add(u)}var q,ee,G,$,J,X=V.length,K,ne=I.length;Y.length;function re(u,Se,xe){var We=1e-10,Ye,st,lt=1,Ke=u.x-Se.x,Qe=u.y-Se.y,Ie=xe.x-u.x,ft=xe.y-u.y,Pt=Ke*Ke+Qe*Qe,fr=Ke*ft-Qe*Ie;if(Math.abs(fr)>We){var qt=Math.sqrt(Pt),It=Math.sqrt(Ie*Ie+ft*ft),Kt=Se.x-Qe/qt,Ht=Se.y+Ke/qt,ur=xe.x-ft/It,cr=xe.y+Ie/It,Qt=((ur-Kt)*ft-(cr-Ht)*Ie)/(Ke*ft-Qe*Ie);Ye=Kt+Ke*Qt-u.x,st=Ht+Qe*Qt-u.y;var Zt=Ye*Ye+st*st;if(Zt<=2)return new t.Vector2(Ye,st);lt=Math.sqrt(Zt/2)}else{var Nt=!1;Ke>We?Ie>We&&(Nt=!0):Ke<-We?Ie<-We&&(Nt=!0):Math.sign(Qe)==Math.sign(ft)&&(Nt=!0),Nt?(Ye=-Qe,st=Ke,lt=Math.sqrt(Pt)):(Ye=Ke,st=Qe,lt=Math.sqrt(Pt/2))}return new t.Vector2(Ye/lt,st/lt)}for(var se=[],Z=0,de=Y.length,ge=de-1,we=Z+1;Z<de;Z++,ge++,we++)ge===de&&(ge=0),we===de&&(we=0),Y[Z],Y[ge],Y[we],se[Z]=re(Y[Z],Y[ge],Y[we]);var Ee=[],Te,Be=se.concat();for(M=0,F=U.length;M<F;M++){for(E=U[M],Te=[],Z=0,de=E.length,ge=de-1,we=Z+1;Z<de;Z++,ge++,we++)ge===de&&(ge=0),we===de&&(we=0),Te[Z]=re(E[Z],E[ge],E[we]);Ee.push(Te),Be=Be.concat(Te)}for(q=0;q<s;q++){for(G=q/s,$=a*(1-G),ee=o*Math.sin(G*Math.PI/2),Z=0,de=Y.length;Z<de;Z++)J=H(Y[Z],se[Z],ee),Ae(J.x,J.y,-$);for(M=0,F=U.length;M<F;M++)for(E=U[M],Te=Ee[M],Z=0,de=E.length;Z<de;Z++)J=H(E[Z],Te[Z],ee),Ae(J.x,J.y,-$)}for(ee=o,Z=0;Z<X;Z++)J=l?H(V[Z],Be[Z],ee):V[Z],v?(b.copy(w.normals[0]).multiplyScalar(J.x),_.copy(w.binormals[0]).multiplyScalar(J.y),A.copy(p[0]).add(b).add(_),Ae(A.x,A.y,A.z)):Ae(J.x,J.y,0);var Ce;for(Ce=1;Ce<=c;Ce++)for(Z=0;Z<X;Z++)J=l?H(V[Z],Be[Z],ee):V[Z],v?(b.copy(w.normals[Ce]).multiplyScalar(J.x),_.copy(w.binormals[Ce]).multiplyScalar(J.y),A.copy(p[Ce]).add(b).add(_),Ae(A.x,A.y,A.z)):Ae(J.x,J.y,n/c*Ce);for(q=s-1;q>=0;q--){for(G=q/s,$=a*(1-G),ee=o*Math.sin(G*Math.PI/2),Z=0,de=Y.length;Z<de;Z++)J=H(Y[Z],se[Z],ee),Ae(J.x,J.y,n+$);for(M=0,F=U.length;M<F;M++)for(E=U[M],Te=Ee[M],Z=0,de=E.length;Z<de;Z++)J=H(E[Z],Te[Z],ee),v?Ae(J.x,J.y+p[c-1].y,p[c-1].x+$):Ae(J.x,J.y,n+$)}Ze(),Je();function Ze(){if(l){var u=0,Se=X*u;for(Z=0;Z<ne;Z++)K=I[Z],Tt(K[2]+Se,K[1]+Se,K[0]+Se);for(u=c+s*2,Se=X*u,Z=0;Z<ne;Z++)K=I[Z],Tt(K[0]+Se,K[1]+Se,K[2]+Se)}else{for(Z=0;Z<ne;Z++)K=I[Z],Tt(K[2],K[1],K[0]);for(Z=0;Z<ne;Z++)K=I[Z],Tt(K[0]+X*c,K[1]+X*c,K[2]+X*c)}}function Je(){var u=0;for(Oe(Y,u),u+=Y.length,M=0,F=U.length;M<F;M++)E=U[M],Oe(E,u),u+=E.length}function Oe(u,Se){var xe,We;for(Z=u.length;--Z>=0;){xe=Z,We=Z-1,We<0&&(We=u.length-1);var Ye=0,st=c+s*2;for(Ye=0;Ye<st;Ye++){var lt=X*Ye,Ke=X*(Ye+1),Qe=Se+xe+lt,Ie=Se+We+lt,ft=Se+We+Ke,Pt=Se+xe+Ke;Yt(Qe,Ie,ft,Pt)}}}function Ae(u,Se,xe){D.vertices.push(new t.Vector3(u,Se,xe))}function Tt(u,Se,xe){u+=R,Se+=R,xe+=R,D.faces.push(new t.Face3(u,Se,xe,null,null,m));var We=x.generateTopUV(D,u,Se,xe);D.faceVertexUvs[0].push(We)}function Yt(u,Se,xe,We,Ye,st,lt,Ke,Qe){u+=R,Se+=R,xe+=R,We+=R,D.faces.push(new t.Face3(u,Se,We,null,null,g)),D.faces.push(new t.Face3(Se,xe,We,null,null,g));var Ie=x.generateSideWallUV(D,u,Se,xe,We);D.faceVertexUvs[0].push([Ie[0],Ie[1],Ie[3]]),D.faceVertexUvs[0].push([Ie[1],Ie[2],Ie[3]])}},t.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,r,n,a){var o=e.vertices,s=o[r],l=o[n],h=o[a];return[new t.Vector2(s.x,s.y),new t.Vector2(l.x,l.y),new t.Vector2(h.x,h.y)]},generateSideWallUV:function(e,r,n,a,o){var s=e.vertices,l=s[r],h=s[n],c=s[a],d=s[o];return Math.abs(l.y-h.y)<.01?[new t.Vector2(l.x,1-l.z),new t.Vector2(h.x,1-h.z),new t.Vector2(c.x,1-c.z),new t.Vector2(d.x,1-d.z)]:[new t.Vector2(l.y,1-l.z),new t.Vector2(h.y,1-h.z),new t.Vector2(c.y,1-c.z),new t.Vector2(d.y,1-d.z)]}},t.ShapeGeometry=function(e,r){t.Geometry.call(this),this.type="ShapeGeometry",e instanceof Array||(e=[e]),this.addShapeList(e,r),this.computeFaceNormals()},t.ShapeGeometry.prototype=Object.create(t.Geometry.prototype),t.ShapeGeometry.prototype.addShapeList=function(e,r){for(var n=0,a=e.length;n<a;n++)this.addShape(e[n],r);return this},t.ShapeGeometry.prototype.addShape=function(e,r){r===void 0&&(r={});var n=r.curveSegments!==void 0?r.curveSegments:12,a=r.material,o=r.UVGenerator===void 0?t.ExtrudeGeometry.WorldUVGenerator:r.UVGenerator,s,l,h,c=this.vertices.length,d=e.extractPoints(n),p=d.shape,v=d.holes,m=!t.Shape.Utils.isClockWise(p);if(m){for(p=p.reverse(),s=0,l=v.length;s<l;s++)h=v[s],t.Shape.Utils.isClockWise(h)&&(v[s]=h.reverse());m=!1}var g=t.Shape.Utils.triangulateShape(p,v),x=p;for(s=0,l=v.length;s<l;s++)h=v[s],p=p.concat(h);var w,_=p.length,b,A=g.length;for(x.length,s=0;s<_;s++)w=p[s],this.vertices.push(new t.Vector3(w.x,w.y,0));for(s=0;s<A;s++){b=g[s];var E=b[0]+c,M=b[1]+c,F=b[2]+c;this.faces.push(new t.Face3(E,M,F,null,null,a)),this.faceVertexUvs[0].push(o.generateTopUV(this,E,M,F))}},t.LatheGeometry=function(e,r,n,a){t.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:r,phiStart:n,phiLength:a},r=r||12,n=n||0,a=a||2*Math.PI;for(var o=1/(e.length-1),s=1/r,l=0,h=r;l<=h;l++)for(var c=n+l*s*a,d=Math.cos(c),p=Math.sin(c),v=0,m=e.length;v<m;v++){var g=e[v],x=new t.Vector3;x.x=d*g.x-p*g.y,x.y=p*g.x+d*g.y,x.z=g.z,this.vertices.push(x)}for(var w=e.length,l=0,h=r;l<h;l++)for(var v=0,m=e.length-1;v<m;v++){var _=v+w*l,b=_,A=_+w,d=_+1+w,E=_+1,M=l*s,F=v*o,D=M+s,R=F+o;this.faces.push(new t.Face3(b,A,E)),this.faceVertexUvs[0].push([new t.Vector2(M,F),new t.Vector2(D,F),new t.Vector2(M,R)]),this.faces.push(new t.Face3(A,d,E)),this.faceVertexUvs[0].push([new t.Vector2(D,F),new t.Vector2(D,R),new t.Vector2(M,R)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},t.LatheGeometry.prototype=Object.create(t.Geometry.prototype),t.PlaneGeometry=function(e,r,n,a){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint."),t.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:r,widthSegments:n,heightSegments:a},this.fromBufferGeometry(new t.PlaneBufferGeometry(e,r,n,a))},t.PlaneGeometry.prototype=Object.create(t.Geometry.prototype),t.PlaneBufferGeometry=function(e,r,n,a){t.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:r,widthSegments:n,heightSegments:a};for(var o=e/2,s=r/2,l=n||1,h=a||1,c=l+1,d=h+1,p=e/l,v=r/h,m=new Float32Array(c*d*3),g=new Float32Array(c*d*3),x=new Float32Array(c*d*2),w=0,_=0,b=0;b<d;b++)for(var A=b*v-s,E=0;E<c;E++){var M=E*p-o;m[w]=M,m[w+1]=-A,g[w+2]=1,x[_]=E/l,x[_+1]=1-b/h,w+=3,_+=2}w=0;for(var F=new(m.length/3>65535?Uint32Array:Uint16Array)(l*h*6),b=0;b<h;b++)for(var E=0;E<l;E++){var D=E+c*b,R=E+c*(b+1),B=E+1+c*(b+1),V=E+1+c*b;F[w]=D,F[w+1]=R,F[w+2]=V,F[w+3]=R,F[w+4]=B,F[w+5]=V,w+=6}this.addAttribute("index",new t.BufferAttribute(F,1)),this.addAttribute("position",new t.BufferAttribute(m,3)),this.addAttribute("normal",new t.BufferAttribute(g,3)),this.addAttribute("uv",new t.BufferAttribute(x,2))},t.PlaneBufferGeometry.prototype=Object.create(t.BufferGeometry.prototype),t.RingGeometry=function(e,r,n,a,o,s){t.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:r,thetaSegments:n,phiSegments:a,thetaStart:o,thetaLength:s},e=e||0,r=r||50,o=o!==void 0?o:0,s=s!==void 0?s:Math.PI*2,n=n!==void 0?Math.max(3,n):8,a=a!==void 0?Math.max(1,a):8;var l,h,c=[],d=e,p=(r-e)/a;for(l=0;l<a+1;l++){for(h=0;h<n+1;h++){var v=new t.Vector3,m=o+h/n*s;v.x=d*Math.cos(m),v.y=d*Math.sin(m),this.vertices.push(v),c.push(new t.Vector2((v.x/r+1)/2,(v.y/r+1)/2))}d+=p}var g=new t.Vector3(0,0,1);for(l=0;l<a;l++){var x=l*(n+1);for(h=0;h<n;h++){var m=h+x,w=m,_=m+n+1,b=m+n+2;this.faces.push(new t.Face3(w,_,b,[g.clone(),g.clone(),g.clone()])),this.faceVertexUvs[0].push([c[w].clone(),c[_].clone(),c[b].clone()]),w=m,_=m+n+2,b=m+1,this.faces.push(new t.Face3(w,_,b,[g.clone(),g.clone(),g.clone()])),this.faceVertexUvs[0].push([c[w].clone(),c[_].clone(),c[b].clone()])}}this.computeFaceNormals(),this.boundingSphere=new t.Sphere(new t.Vector3,d)},t.RingGeometry.prototype=Object.create(t.Geometry.prototype),t.SphereGeometry=function(e,r,n,a,o,s,l){t.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:r,heightSegments:n,phiStart:a,phiLength:o,thetaStart:s,thetaLength:l},e=e||50,r=Math.max(3,Math.floor(r)||8),n=Math.max(2,Math.floor(n)||6),a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s=s!==void 0?s:0,l=l!==void 0?l:Math.PI;var h,c,d=[],p=[];for(c=0;c<=n;c++){var v=[],m=[];for(h=0;h<=r;h++){var g=h/r,x=c/n,w=new t.Vector3;w.x=-e*Math.cos(a+g*o)*Math.sin(s+x*l),w.y=e*Math.cos(s+x*l),w.z=e*Math.sin(a+g*o)*Math.sin(s+x*l),this.vertices.push(w),v.push(this.vertices.length-1),m.push(new t.Vector2(g,1-x))}d.push(v),p.push(m)}for(c=0;c<n;c++)for(h=0;h<r;h++){var _=d[c][h+1],b=d[c][h],A=d[c+1][h],E=d[c+1][h+1],M=this.vertices[_].clone().normalize(),F=this.vertices[b].clone().normalize(),D=this.vertices[A].clone().normalize(),R=this.vertices[E].clone().normalize(),B=p[c][h+1].clone(),V=p[c][h].clone(),U=p[c+1][h].clone(),z=p[c+1][h+1].clone();Math.abs(this.vertices[_].y)===e?(B.x=(B.x+V.x)/2,this.faces.push(new t.Face3(_,A,E,[M,D,R])),this.faceVertexUvs[0].push([B,U,z])):Math.abs(this.vertices[A].y)===e?(U.x=(U.x+z.x)/2,this.faces.push(new t.Face3(_,b,A,[M,F,D])),this.faceVertexUvs[0].push([B,V,U])):(this.faces.push(new t.Face3(_,b,E,[M,F,R])),this.faceVertexUvs[0].push([B,V,z]),this.faces.push(new t.Face3(b,A,E,[F.clone(),D,R.clone()])),this.faceVertexUvs[0].push([V.clone(),U,z.clone()]))}this.computeFaceNormals(),this.boundingSphere=new t.Sphere(new t.Vector3,e)},t.SphereGeometry.prototype=Object.create(t.Geometry.prototype),t.TextGeometry=function(e,r){r=r||{};var n=t.FontUtils.generateShapes(e,r);r.amount=r.height!==void 0?r.height:50,r.bevelThickness===void 0&&(r.bevelThickness=10),r.bevelSize===void 0&&(r.bevelSize=8),r.bevelEnabled===void 0&&(r.bevelEnabled=!1),t.ExtrudeGeometry.call(this,n,r),this.type="TextGeometry"},t.TextGeometry.prototype=Object.create(t.ExtrudeGeometry.prototype),t.TorusGeometry=function(e,r,n,a,o){t.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:r,radialSegments:n,tubularSegments:a,arc:o},e=e||100,r=r||40,n=n||8,a=a||6,o=o||Math.PI*2;for(var s=new t.Vector3,l=[],h=[],c=0;c<=n;c++)for(var d=0;d<=a;d++){var p=d/a*o,v=c/n*Math.PI*2;s.x=e*Math.cos(p),s.y=e*Math.sin(p);var m=new t.Vector3;m.x=(e+r*Math.cos(v))*Math.cos(p),m.y=(e+r*Math.cos(v))*Math.sin(p),m.z=r*Math.sin(v),this.vertices.push(m),l.push(new t.Vector2(d/a,c/n)),h.push(m.clone().sub(s).normalize())}for(var c=1;c<=n;c++)for(var d=1;d<=a;d++){var g=(a+1)*c+d-1,x=(a+1)*(c-1)+d-1,w=(a+1)*(c-1)+d,_=(a+1)*c+d,b=new t.Face3(g,x,_,[h[g].clone(),h[x].clone(),h[_].clone()]);this.faces.push(b),this.faceVertexUvs[0].push([l[g].clone(),l[x].clone(),l[_].clone()]),b=new t.Face3(x,w,_,[h[x].clone(),h[w].clone(),h[_].clone()]),this.faces.push(b),this.faceVertexUvs[0].push([l[x].clone(),l[w].clone(),l[_].clone()])}this.computeFaceNormals()},t.TorusGeometry.prototype=Object.create(t.Geometry.prototype),t.TorusKnotGeometry=function(e,r,n,a,o,s,l){t.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:r,radialSegments:n,tubularSegments:a,p:o,q:s,heightScale:l},e=e||100,r=r||40,n=n||64,a=a||8,o=o||2,s=s||3,l=l||1;for(var h=new Array(n),c=new t.Vector3,d=new t.Vector3,p=new t.Vector3,v=0;v<n;++v){h[v]=new Array(a);var m=v/n*2*o*Math.PI,g=H(m,s,o,e,l),x=H(m+.01,s,o,e,l);c.subVectors(x,g),d.addVectors(x,g),p.crossVectors(c,d),d.crossVectors(p,c),p.normalize(),d.normalize();for(var w=0;w<a;++w){var _=w/a*2*Math.PI,b=-r*Math.cos(_),A=r*Math.sin(_),E=new t.Vector3;E.x=g.x+b*d.x+A*p.x,E.y=g.y+b*d.y+A*p.y,E.z=g.z+b*d.z+A*p.z,h[v][w]=this.vertices.push(E)-1}}for(var v=0;v<n;++v)for(var w=0;w<a;++w){var M=(v+1)%n,F=(w+1)%a,D=h[v][w],R=h[M][w],B=h[M][F],V=h[v][F],U=new t.Vector2(v/n,w/a),z=new t.Vector2((v+1)/n,w/a),I=new t.Vector2((v+1)/n,(w+1)/a),Y=new t.Vector2(v/n,(w+1)/a);this.faces.push(new t.Face3(D,R,V)),this.faceVertexUvs[0].push([U,z,Y]),this.faces.push(new t.Face3(R,B,V)),this.faceVertexUvs[0].push([z.clone(),I,Y.clone()])}this.computeFaceNormals(),this.computeVertexNormals();function H(q,ee,G,$,J){var X=Math.cos(q),K=Math.sin(q),ne=ee/G*q,re=Math.cos(ne),se=$*(2+re)*.5*X,Z=$*(2+re)*K*.5,de=J*$*Math.sin(ne)*.5;return new t.Vector3(se,Z,de)}},t.TorusKnotGeometry.prototype=Object.create(t.Geometry.prototype),t.TubeGeometry=function(e,r,n,a,o){t.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:e,segments:r,radius:n,radialSegments:a,closed:o},r=r||64,n=n||1,a=a||8,o=o||!1;var s=[],l=this,h,c,d=r+1,p,v,m,g,x,w=new t.Vector3,_,b,A,E,M,F,D,R,B,V,U,z,I=new t.TubeGeometry.FrenetFrames(e,r,o),Y=I.tangents,H=I.normals,q=I.binormals;this.tangents=Y,this.normals=H,this.binormals=q;function ee(G,$,J){return l.vertices.push(new t.Vector3(G,$,J))-1}for(_=0;_<d;_++)for(s[_]=[],p=_/(d-1),x=e.getPointAt(p),Y[_],h=H[_],c=q[_],b=0;b<a;b++)v=b/a*2*Math.PI,m=-n*Math.cos(v),g=n*Math.sin(v),w.copy(x),w.x+=m*h.x+g*c.x,w.y+=m*h.y+g*c.y,w.z+=m*h.z+g*c.z,s[_][b]=ee(w.x,w.y,w.z);for(_=0;_<r;_++)for(b=0;b<a;b++)A=o?(_+1)%r:_+1,E=(b+1)%a,M=s[_][b],F=s[A][b],D=s[A][E],R=s[_][E],B=new t.Vector2(_/r,b/a),V=new t.Vector2((_+1)/r,b/a),U=new t.Vector2((_+1)/r,(b+1)/a),z=new t.Vector2(_/r,(b+1)/a),this.faces.push(new t.Face3(M,F,R)),this.faceVertexUvs[0].push([B,V,z]),this.faces.push(new t.Face3(F,D,R)),this.faceVertexUvs[0].push([V.clone(),U,z.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},t.TubeGeometry.prototype=Object.create(t.Geometry.prototype),t.TubeGeometry.FrenetFrames=function(e,r,n){new t.Vector3;var a=new t.Vector3;new t.Vector3;var o=[],s=[],l=[],h=new t.Vector3,c=new t.Matrix4,d=r+1,p,v=1e-4,m,g,x,w,_,b;for(this.tangents=o,this.normals=s,this.binormals=l,_=0;_<d;_++)b=_/(d-1),o[_]=e.getTangentAt(b),o[_].normalize();A();function A(){s[0]=new t.Vector3,l[0]=new t.Vector3,m=Number.MAX_VALUE,g=Math.abs(o[0].x),x=Math.abs(o[0].y),w=Math.abs(o[0].z),g<=m&&(m=g,a.set(1,0,0)),x<=m&&(m=x,a.set(0,1,0)),w<=m&&a.set(0,0,1),h.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],h),l[0].crossVectors(o[0],s[0])}for(_=1;_<d;_++)s[_]=s[_-1].clone(),l[_]=l[_-1].clone(),h.crossVectors(o[_-1],o[_]),h.length()>v&&(h.normalize(),p=Math.acos(t.Math.clamp(o[_-1].dot(o[_]),-1,1)),s[_].applyMatrix4(c.makeRotationAxis(h,p))),l[_].crossVectors(o[_],s[_]);if(n)for(p=Math.acos(t.Math.clamp(s[0].dot(s[d-1]),-1,1)),p/=d-1,o[0].dot(h.crossVectors(s[0],s[d-1]))>0&&(p=-p),_=1;_<d;_++)s[_].applyMatrix4(c.makeRotationAxis(o[_],p*_)),l[_].crossVectors(o[_],s[_])},t.PolyhedronGeometry=function(e,r,n,a){t.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:r,radius:n,detail:a},n=n||1,a=a||0;for(var o=this,s=0,l=e.length;s<l;s+=3)M(new t.Vector3(e[s],e[s+1],e[s+2]));for(var h=this.vertices,c=[],s=0,d=0,l=r.length;s<l;s+=3,d++){var p=h[r[s]],v=h[r[s+1]],m=h[r[s+2]];c[d]=new t.Face3(p.index,v.index,m.index,[p.clone(),v.clone(),m.clone()])}for(var g=new t.Vector3,s=0,l=c.length;s<l;s++)D(c[s],a);for(var s=0,l=this.faceVertexUvs[0].length;s<l;s++){var x=this.faceVertexUvs[0][s],w=x[0].x,_=x[1].x,b=x[2].x,A=Math.max(w,Math.max(_,b)),E=Math.min(w,Math.min(_,b));A>.9&&E<.1&&(w<.2&&(x[0].x+=1),_<.2&&(x[1].x+=1),b<.2&&(x[2].x+=1))}for(var s=0,l=this.vertices.length;s<l;s++)this.vertices[s].multiplyScalar(n);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new t.Sphere(new t.Vector3,n);function M(U){var z=U.normalize().clone();z.index=o.vertices.push(z)-1;var I=R(U)/2/Math.PI+.5,Y=B(U)/Math.PI+.5;return z.uv=new t.Vector2(I,1-Y),z}function F(U,z,I){var Y=new t.Face3(U.index,z.index,I.index,[U.clone(),z.clone(),I.clone()]);o.faces.push(Y),g.copy(U).add(z).add(I).divideScalar(3);var H=R(g);o.faceVertexUvs[0].push([V(U.uv,U,H),V(z.uv,z,H),V(I.uv,I,H)])}function D(U,z){for(var I=Math.pow(2,z),Y=M(o.vertices[U.a]),H=M(o.vertices[U.b]),q=M(o.vertices[U.c]),ee=[],G=0;G<=I;G++){ee[G]=[];for(var $=M(Y.clone().lerp(q,G/I)),J=M(H.clone().lerp(q,G/I)),X=I-G,K=0;K<=X;K++)K==0&&G==I?ee[G][K]=$:ee[G][K]=M($.clone().lerp(J,K/X))}for(var G=0;G<I;G++)for(var K=0;K<2*(I-G)-1;K++){var ne=Math.floor(K/2);K%2==0?F(ee[G][ne+1],ee[G+1][ne],ee[G][ne]):F(ee[G][ne+1],ee[G+1][ne+1],ee[G+1][ne])}}function R(U){return Math.atan2(U.z,-U.x)}function B(U){return Math.atan2(-U.y,Math.sqrt(U.x*U.x+U.z*U.z))}function V(U,z,I){return I<0&&U.x===1&&(U=new t.Vector2(U.x-1,U.y)),z.x===0&&z.z===0&&(U=new t.Vector2(I/2/Math.PI+.5,U.y)),U.clone()}},t.PolyhedronGeometry.prototype=Object.create(t.Geometry.prototype),t.DodecahedronGeometry=function(e,r){this.parameters={radius:e,detail:r};var n=(1+Math.sqrt(5))/2,a=1/n,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-n,0,-a,n,0,a,-n,0,a,n,-a,-n,0,-a,n,0,a,-n,0,a,n,0,-n,0,-a,n,0,-a,-n,0,a,n,0,a],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];t.PolyhedronGeometry.call(this,o,s,e,r)},t.DodecahedronGeometry.prototype=Object.create(t.Geometry.prototype),t.IcosahedronGeometry=function(e,r){var n=(1+Math.sqrt(5))/2,a=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];t.PolyhedronGeometry.call(this,a,o,e,r),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:r}},t.IcosahedronGeometry.prototype=Object.create(t.Geometry.prototype),t.OctahedronGeometry=function(e,r){this.parameters={radius:e,detail:r};var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],a=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];t.PolyhedronGeometry.call(this,n,a,e,r),this.type="OctahedronGeometry",this.parameters={radius:e,detail:r}},t.OctahedronGeometry.prototype=Object.create(t.Geometry.prototype),t.TetrahedronGeometry=function(e,r){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],a=[2,1,0,0,3,2,1,3,0,2,3,1];t.PolyhedronGeometry.call(this,n,a,e,r),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:r}},t.TetrahedronGeometry.prototype=Object.create(t.Geometry.prototype),t.ParametricGeometry=function(e,r,n){t.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:r,stacks:n};var a=this.vertices,o=this.faces,s=this.faceVertexUvs[0],l,h,c,d,p,v=r+1;for(l=0;l<=n;l++)for(p=l/n,h=0;h<=r;h++)d=h/r,c=e(d,p),a.push(c);var m,g,x,w,_,b,A,E;for(l=0;l<n;l++)for(h=0;h<r;h++)m=l*v+h,g=l*v+h+1,x=(l+1)*v+h+1,w=(l+1)*v+h,_=new t.Vector2(h/r,l/n),b=new t.Vector2((h+1)/r,l/n),A=new t.Vector2((h+1)/r,(l+1)/n),E=new t.Vector2(h/r,(l+1)/n),o.push(new t.Face3(m,g,w)),s.push([_,b,E]),o.push(new t.Face3(g,x,w)),s.push([b.clone(),A,E.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},t.ParametricGeometry.prototype=Object.create(t.Geometry.prototype),t.AxisHelper=function(e){e=e||1;var r=new Float32Array([0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e]),n=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),a=new t.BufferGeometry;a.addAttribute("position",new t.BufferAttribute(r,3)),a.addAttribute("color",new t.BufferAttribute(n,3));var o=new t.LineBasicMaterial({vertexColors:t.VertexColors});t.Line.call(this,a,o,t.LinePieces)},t.AxisHelper.prototype=Object.create(t.Line.prototype),t.ArrowHelper=function(){var e=new t.Geometry;e.vertices.push(new t.Vector3(0,0,0),new t.Vector3(0,1,0));var r=new t.CylinderGeometry(0,.5,1,5,1);return r.applyMatrix(new t.Matrix4().makeTranslation(0,-.5,0)),function(n,a,o,s,l,h){t.Object3D.call(this),s===void 0&&(s=16776960),o===void 0&&(o=1),l===void 0&&(l=.2*o),h===void 0&&(h=.2*l),this.position.copy(a),this.line=new t.Line(e,new t.LineBasicMaterial({color:s})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new t.Mesh(r,new t.MeshBasicMaterial({color:s})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(n),this.setLength(o,l,h)}}(),t.ArrowHelper.prototype=Object.create(t.Object3D.prototype),t.ArrowHelper.prototype.setDirection=function(){var e=new t.Vector3,r;return function(n){n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-.99999?this.quaternion.set(1,0,0,0):(e.set(n.z,0,-n.x).normalize(),r=Math.acos(n.y),this.quaternion.setFromAxisAngle(e,r))}}(),t.ArrowHelper.prototype.setLength=function(e,r,n){r===void 0&&(r=.2*e),n===void 0&&(n=.2*r),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(n,r,n),this.cone.position.y=e,this.cone.updateMatrix()},t.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},t.BoxHelper=function(e){var r=new t.BufferGeometry;r.addAttribute("position",new t.BufferAttribute(new Float32Array(72),3)),t.Line.call(this,r,new t.LineBasicMaterial({color:16776960}),t.LinePieces),e!==void 0&&this.update(e)},t.BoxHelper.prototype=Object.create(t.Line.prototype),t.BoxHelper.prototype.update=function(e){var r=e.geometry;r.boundingBox===null&&r.computeBoundingBox();var n=r.boundingBox.min,a=r.boundingBox.max,o=this.geometry.attributes.position.array;o[0]=a.x,o[1]=a.y,o[2]=a.z,o[3]=n.x,o[4]=a.y,o[5]=a.z,o[6]=n.x,o[7]=a.y,o[8]=a.z,o[9]=n.x,o[10]=n.y,o[11]=a.z,o[12]=n.x,o[13]=n.y,o[14]=a.z,o[15]=a.x,o[16]=n.y,o[17]=a.z,o[18]=a.x,o[19]=n.y,o[20]=a.z,o[21]=a.x,o[22]=a.y,o[23]=a.z,o[24]=a.x,o[25]=a.y,o[26]=n.z,o[27]=n.x,o[28]=a.y,o[29]=n.z,o[30]=n.x,o[31]=a.y,o[32]=n.z,o[33]=n.x,o[34]=n.y,o[35]=n.z,o[36]=n.x,o[37]=n.y,o[38]=n.z,o[39]=a.x,o[40]=n.y,o[41]=n.z,o[42]=a.x,o[43]=n.y,o[44]=n.z,o[45]=a.x,o[46]=a.y,o[47]=n.z,o[48]=a.x,o[49]=a.y,o[50]=a.z,o[51]=a.x,o[52]=a.y,o[53]=n.z,o[54]=n.x,o[55]=a.y,o[56]=a.z,o[57]=n.x,o[58]=a.y,o[59]=n.z,o[60]=n.x,o[61]=n.y,o[62]=a.z,o[63]=n.x,o[64]=n.y,o[65]=n.z,o[66]=a.x,o[67]=n.y,o[68]=a.z,o[69]=a.x,o[70]=n.y,o[71]=n.z,this.geometry.attributes.position.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},t.BoundingBoxHelper=function(e,r){var n=r!==void 0?r:8947848;this.object=e,this.box=new t.Box3,t.Mesh.call(this,new t.BoxGeometry(1,1,1),new t.MeshBasicMaterial({color:n,wireframe:!0}))},t.BoundingBoxHelper.prototype=Object.create(t.Mesh.prototype),t.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},t.CameraHelper=function(e){var r=new t.Geometry,n=new t.LineBasicMaterial({color:16777215,vertexColors:t.FaceColors}),a={},o=16755200,s=16711680,l=43775,h=16777215,c=3355443;d("n1","n2",o),d("n2","n4",o),d("n4","n3",o),d("n3","n1",o),d("f1","f2",o),d("f2","f4",o),d("f4","f3",o),d("f3","f1",o),d("n1","f1",o),d("n2","f2",o),d("n3","f3",o),d("n4","f4",o),d("p","n1",s),d("p","n2",s),d("p","n3",s),d("p","n4",s),d("u1","u2",l),d("u2","u3",l),d("u3","u1",l),d("c","t",h),d("p","c",c),d("cn1","cn2",c),d("cn3","cn4",c),d("cf1","cf2",c),d("cf3","cf4",c);function d(v,m,g){p(v,g),p(m,g)}function p(v,m){r.vertices.push(new t.Vector3),r.colors.push(new t.Color(m)),a[v]===void 0&&(a[v]=[]),a[v].push(r.vertices.length-1)}t.Line.call(this,r,n,t.LinePieces),this.camera=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()},t.CameraHelper.prototype=Object.create(t.Line.prototype),t.CameraHelper.prototype.update=function(){var e,r,n=new t.Vector3,a=new t.Camera,o=function(s,l,h,c){n.set(l,h,c).unproject(a);var d=r[s];if(d!==void 0)for(var p=0,v=d.length;p<v;p++)e.vertices[d[p]].copy(n)};return function(){e=this.geometry,r=this.pointMap;var s=1,l=1;a.projectionMatrix.copy(this.camera.projectionMatrix),o("c",0,0,-1),o("t",0,0,1),o("n1",-s,-l,-1),o("n2",s,-l,-1),o("n3",-s,l,-1),o("n4",s,l,-1),o("f1",-s,-l,1),o("f2",s,-l,1),o("f3",-s,l,1),o("f4",s,l,1),o("u1",s*.7,l*1.1,-1),o("u2",-s*.7,l*1.1,-1),o("u3",0,l*2,-1),o("cf1",-s,0,1),o("cf2",s,0,1),o("cf3",0,-l,1),o("cf4",0,l,1),o("cn1",-s,0,-1),o("cn2",s,0,-1),o("cn3",0,-l,-1),o("cn4",0,l,-1),e.verticesNeedUpdate=!0}}(),t.DirectionalLightHelper=function(e,r){t.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,r=r||1;var n=new t.Geometry;n.vertices.push(new t.Vector3(-r,r,0),new t.Vector3(r,r,0),new t.Vector3(r,-r,0),new t.Vector3(-r,-r,0),new t.Vector3(-r,r,0));var a=new t.LineBasicMaterial({fog:!1});a.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new t.Line(n,a),this.add(this.lightPlane),n=new t.Geometry,n.vertices.push(new t.Vector3,new t.Vector3),a=new t.LineBasicMaterial({fog:!1}),a.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new t.Line(n,a),this.add(this.targetLine),this.update()},t.DirectionalLightHelper.prototype=Object.create(t.Object3D.prototype),t.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},t.DirectionalLightHelper.prototype.update=function(){var e=new t.Vector3,r=new t.Vector3,n=new t.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),r.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(r,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),t.EdgesHelper=function(e,r){var n=r!==void 0?r:16777215,a=[0,0],o={},s=function(F,D){return F-D},l=["a","b","c"],h=new t.BufferGeometry,c=e.geometry.clone();c.mergeVertices(),c.computeFaceNormals();for(var d=c.vertices,p=c.faces,v=0,m=0,g=p.length;m<g;m++)for(var x=p[m],w=0;w<3;w++){a[0]=x[l[w]],a[1]=x[l[(w+1)%3]],a.sort(s);var _=a.toString();o[_]===void 0?(o[_]={vert1:a[0],vert2:a[1],face1:m,face2:void 0},v++):o[_].face2=m}var b=new Float32Array(v*2*3),A=0;for(var _ in o){var E=o[_];if(E.face2===void 0||p[E.face1].normal.dot(p[E.face2].normal)<.9999){var M=d[E.vert1];b[A++]=M.x,b[A++]=M.y,b[A++]=M.z,M=d[E.vert2],b[A++]=M.x,b[A++]=M.y,b[A++]=M.z}}h.addAttribute("position",new t.BufferAttribute(b,3)),t.Line.call(this,h,new t.LineBasicMaterial({color:n}),t.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},t.EdgesHelper.prototype=Object.create(t.Line.prototype),t.FaceNormalsHelper=function(e,r,n,a){this.object=e,this.size=r!==void 0?r:1;for(var o=n!==void 0?n:16776960,s=a!==void 0?a:1,l=new t.Geometry,h=this.object.geometry.faces,c=0,d=h.length;c<d;c++)l.vertices.push(new t.Vector3,new t.Vector3);t.Line.call(this,l,new t.LineBasicMaterial({color:o,linewidth:s}),t.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new t.Matrix3,this.update()},t.FaceNormalsHelper.prototype=Object.create(t.Line.prototype),t.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,r=this.object,n=r.geometry.vertices,a=r.geometry.faces,o=r.matrixWorld;r.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(o);for(var s=0,l=0,h=a.length;s<h;s++,l+=2){var c=a[s];e[l].copy(n[c.a]).add(n[c.b]).add(n[c.c]).divideScalar(3).applyMatrix4(o),e[l+1].copy(c.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[l])}return this.geometry.verticesNeedUpdate=!0,this},t.GridHelper=function(e,r){var n=new t.Geometry,a=new t.LineBasicMaterial({vertexColors:t.VertexColors});this.color1=new t.Color(4473924),this.color2=new t.Color(8947848);for(var o=-e;o<=e;o+=r){n.vertices.push(new t.Vector3(-e,0,o),new t.Vector3(e,0,o),new t.Vector3(o,0,-e),new t.Vector3(o,0,e));var s=o===0?this.color1:this.color2;n.colors.push(s,s,s,s)}t.Line.call(this,n,a,t.LinePieces)},t.GridHelper.prototype=Object.create(t.Line.prototype),t.GridHelper.prototype.setColors=function(e,r){this.color1.set(e),this.color2.set(r),this.geometry.colorsNeedUpdate=!0},t.HemisphereLightHelper=function(e,r,n,a){t.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new t.Color,new t.Color];var o=new t.SphereGeometry(r,4,2);o.applyMatrix(new t.Matrix4().makeRotationX(-Math.PI/2));for(var s=0,l=8;s<l;s++)o.faces[s].color=this.colors[s<4?0:1];var h=new t.MeshBasicMaterial({vertexColors:t.FaceColors,wireframe:!0});this.lightSphere=new t.Mesh(o,h),this.add(this.lightSphere),this.update()},t.HemisphereLightHelper.prototype=Object.create(t.Object3D.prototype),t.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},t.HemisphereLightHelper.prototype.update=function(){var e=new t.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),t.PointLightHelper=function(e,r){this.light=e,this.light.updateMatrixWorld();var n=new t.SphereGeometry(r,4,2),a=new t.MeshBasicMaterial({wireframe:!0,fog:!1});a.color.copy(this.light.color).multiplyScalar(this.light.intensity),t.Mesh.call(this,n,a),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},t.PointLightHelper.prototype=Object.create(t.Mesh.prototype),t.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},t.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},t.SkeletonHelper=function(e){this.bones=this.getBoneList(e);for(var r=new t.Geometry,n=0;n<this.bones.length;n++){var a=this.bones[n];a.parent instanceof t.Bone&&(r.vertices.push(new t.Vector3),r.vertices.push(new t.Vector3),r.colors.push(new t.Color(0,0,1)),r.colors.push(new t.Color(0,1,0)))}var o=new t.LineBasicMaterial({vertexColors:t.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});t.Line.call(this,r,o,t.LinePieces),this.root=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},t.SkeletonHelper.prototype=Object.create(t.Line.prototype),t.SkeletonHelper.prototype.getBoneList=function(e){var r=[];e instanceof t.Bone&&r.push(e);for(var n=0;n<e.children.length;n++)r.push.apply(r,this.getBoneList(e.children[n]));return r},t.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,r=new t.Matrix4().getInverse(this.root.matrixWorld),n=new t.Matrix4,a=0,o=0;o<this.bones.length;o++){var s=this.bones[o];s.parent instanceof t.Bone&&(n.multiplyMatrices(r,s.matrixWorld),e.vertices[a].setFromMatrixPosition(n),n.multiplyMatrices(r,s.parent.matrixWorld),e.vertices[a+1].setFromMatrixPosition(n),a+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},t.SpotLightHelper=function(e){t.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var r=new t.CylinderGeometry(0,1,1,8,1,!0);r.applyMatrix(new t.Matrix4().makeTranslation(0,-.5,0)),r.applyMatrix(new t.Matrix4().makeRotationX(-Math.PI/2));var n=new t.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new t.Mesh(r,n),this.add(this.cone),this.update()},t.SpotLightHelper.prototype=Object.create(t.Object3D.prototype),t.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},t.SpotLightHelper.prototype.update=function(){var e=new t.Vector3,r=new t.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,a=n*Math.tan(this.light.angle);this.cone.scale.set(a,a,n),e.setFromMatrixPosition(this.light.matrixWorld),r.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(r.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),t.VertexNormalsHelper=function(e,r,n,a){this.object=e,this.size=r!==void 0?r:1;var o=n!==void 0?n:16711680,s=a!==void 0?a:1,l=new t.Geometry;e.geometry.vertices;for(var h=e.geometry.faces,c=0,d=h.length;c<d;c++)for(var p=h[c],v=0,m=p.vertexNormals.length;v<m;v++)l.vertices.push(new t.Vector3,new t.Vector3);t.Line.call(this,l,new t.LineBasicMaterial({color:o,linewidth:s}),t.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new t.Matrix3,this.update()},t.VertexNormalsHelper.prototype=Object.create(t.Line.prototype),t.VertexNormalsHelper.prototype.update=function(e){var r=new t.Vector3;return function(n){var a=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var o=this.geometry.vertices,s=this.object.geometry.vertices,l=this.object.geometry.faces,h=this.object.matrixWorld,c=0,d=0,p=l.length;d<p;d++)for(var v=l[d],m=0,g=v.vertexNormals.length;m<g;m++){var x=v[a[m]],w=s[x],_=v.vertexNormals[m];o[c].copy(w).applyMatrix4(h),r.copy(_).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),r.add(o[c]),c=c+1,o[c].copy(r),c=c+1}return this.geometry.verticesNeedUpdate=!0,this}}(),t.VertexTangentsHelper=function(e,r,n,a){this.object=e,this.size=r!==void 0?r:1;var o=n!==void 0?n:255,s=a!==void 0?a:1,l=new t.Geometry;e.geometry.vertices;for(var h=e.geometry.faces,c=0,d=h.length;c<d;c++)for(var p=h[c],v=0,m=p.vertexTangents.length;v<m;v++)l.vertices.push(new t.Vector3),l.vertices.push(new t.Vector3);t.Line.call(this,l,new t.LineBasicMaterial({color:o,linewidth:s}),t.LinePieces),this.matrixAutoUpdate=!1,this.update()},t.VertexTangentsHelper.prototype=Object.create(t.Line.prototype),t.VertexTangentsHelper.prototype.update=function(e){var r=new t.Vector3;return function(n){var a=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var o=this.geometry.vertices,s=this.object.geometry.vertices,l=this.object.geometry.faces,h=this.object.matrixWorld,c=0,d=0,p=l.length;d<p;d++)for(var v=l[d],m=0,g=v.vertexTangents.length;m<g;m++){var x=v[a[m]],w=s[x],_=v.vertexTangents[m];o[c].copy(w).applyMatrix4(h),r.copy(_).transformDirection(h).multiplyScalar(this.size),r.add(o[c]),c=c+1,o[c].copy(r),c=c+1}return this.geometry.verticesNeedUpdate=!0,this}}(),t.WireframeHelper=function(e,r){var n=r!==void 0?r:16777215,a=[0,0],o={},s=function(H,q){return H-q},l=["a","b","c"],h=new t.BufferGeometry;if(e.geometry instanceof t.Geometry){for(var c=e.geometry.vertices,d=e.geometry.faces,p=0,v=new Uint32Array(6*d.length),m=0,g=d.length;m<g;m++)for(var x=d[m],w=0;w<3;w++){a[0]=x[l[w]],a[1]=x[l[(w+1)%3]],a.sort(s);var _=a.toString();o[_]===void 0&&(v[2*p]=a[0],v[2*p+1]=a[1],o[_]=!0,p++)}for(var b=new Float32Array(p*2*3),m=0,g=p;m<g;m++)for(var w=0;w<2;w++){var A=c[v[2*m+w]],E=6*m+3*w;b[E+0]=A.x,b[E+1]=A.y,b[E+2]=A.z}h.addAttribute("position",new t.BufferAttribute(b,3))}else if(e.geometry instanceof t.BufferGeometry)if(e.geometry.attributes.index!==void 0){var c=e.geometry.attributes.position.array,M=e.geometry.attributes.index.array,F=e.geometry.drawcalls,p=0;F.length===0&&(F=[{count:M.length,index:0,start:0}]);for(var v=new Uint32Array(2*M.length),D=0,R=F.length;D<R;++D)for(var B=F[D].start,V=F[D].count,E=F[D].index,m=B,U=B+V;m<U;m+=3)for(var w=0;w<3;w++){a[0]=E+M[m+w],a[1]=E+M[m+(w+1)%3],a.sort(s);var _=a.toString();o[_]===void 0&&(v[2*p]=a[0],v[2*p+1]=a[1],o[_]=!0,p++)}for(var b=new Float32Array(p*2*3),m=0,g=p;m<g;m++)for(var w=0;w<2;w++){var E=6*m+3*w,z=3*v[2*m+w];b[E+0]=c[z],b[E+1]=c[z+1],b[E+2]=c[z+2]}h.addAttribute("position",new t.BufferAttribute(b,3))}else{for(var c=e.geometry.attributes.position.array,p=c.length/3,I=p/3,b=new Float32Array(p*2*3),m=0,g=I;m<g;m++)for(var w=0;w<3;w++){var E=18*m+6*w,Y=9*m+3*w;b[E+0]=c[Y],b[E+1]=c[Y+1],b[E+2]=c[Y+2];var z=9*m+3*((w+1)%3);b[E+3]=c[z],b[E+4]=c[z+1],b[E+5]=c[z+2]}h.addAttribute("position",new t.BufferAttribute(b,3))}t.Line.call(this,h,new t.LineBasicMaterial({color:n}),t.LinePieces),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1},t.WireframeHelper.prototype=Object.create(t.Line.prototype),t.ImmediateRenderObject=function(){t.Object3D.call(this),this.render=function(e){}},t.ImmediateRenderObject.prototype=Object.create(t.Object3D.prototype),t.MorphBlendMesh=function(e,r){t.Mesh.call(this,e,r),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,a="__default",o=0,s=n-1,l=n/1;this.createAnimation(a,o,s,l),this.setAnimationWeight(a,1)},t.MorphBlendMesh.prototype=Object.create(t.Mesh.prototype),t.MorphBlendMesh.prototype.createAnimation=function(e,r,n,a){var o={startFrame:r,endFrame:n,length:n-r+1,fps:a,duration:(n-r)/a,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=o,this.animationsList.push(o)},t.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var r=/([a-z]+)_?(\d+)/,n,a={},o=this.geometry,s=0,l=o.morphTargets.length;s<l;s++){var h=o.morphTargets[s],c=h.name.match(r);if(c&&c.length>1){var d=c[1];c[2],a[d]||(a[d]={start:1/0,end:-1/0});var p=a[d];s<p.start&&(p.start=s),s>p.end&&(p.end=s),n||(n=d)}}for(var d in a){var p=a[d];this.createAnimation(d,p.start,p.end,e)}this.firstAnimation=n},t.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var r=this.animationsMap[e];r&&(r.direction=1,r.directionBackwards=!1)},t.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var r=this.animationsMap[e];r&&(r.direction=-1,r.directionBackwards=!0)},t.MorphBlendMesh.prototype.setAnimationFPS=function(e,r){var n=this.animationsMap[e];n&&(n.fps=r,n.duration=(n.end-n.start)/n.fps)},t.MorphBlendMesh.prototype.setAnimationDuration=function(e,r){var n=this.animationsMap[e];n&&(n.duration=r,n.fps=(n.end-n.start)/n.duration)},t.MorphBlendMesh.prototype.setAnimationWeight=function(e,r){var n=this.animationsMap[e];n&&(n.weight=r)},t.MorphBlendMesh.prototype.setAnimationTime=function(e,r){var n=this.animationsMap[e];n&&(n.time=r)},t.MorphBlendMesh.prototype.getAnimationTime=function(e){var r=0,n=this.animationsMap[e];return n&&(r=n.time),r},t.MorphBlendMesh.prototype.getAnimationDuration=function(e){var r=-1,n=this.animationsMap[e];return n&&(r=n.duration),r},t.MorphBlendMesh.prototype.playAnimation=function(e){var r=this.animationsMap[e];r?(r.time=0,r.active=!0):console.warn("animation["+e+"] undefined")},t.MorphBlendMesh.prototype.stopAnimation=function(e){var r=this.animationsMap[e];r&&(r.active=!1)},t.MorphBlendMesh.prototype.update=function(e){for(var r=0,n=this.animationsList.length;r<n;r++){var a=this.animationsList[r];if(a.active){var o=a.duration/a.length;a.time+=a.direction*e,a.mirroredLoop?(a.time>a.duration||a.time<0)&&(a.direction*=-1,a.time>a.duration&&(a.time=a.duration,a.directionBackwards=!0),a.time<0&&(a.time=0,a.directionBackwards=!1)):(a.time=a.time%a.duration,a.time<0&&(a.time+=a.duration));var s=a.startFrame+t.Math.clamp(Math.floor(a.time/o),0,a.length-1),l=a.weight;s!==a.currentFrame&&(this.morphTargetInfluences[a.lastFrame]=0,this.morphTargetInfluences[a.currentFrame]=1*l,this.morphTargetInfluences[s]=0,a.lastFrame=a.currentFrame,a.currentFrame=s);var h=a.time%o/o;a.directionBackwards&&(h=1-h),this.morphTargetInfluences[a.currentFrame]=h*l,this.morphTargetInfluences[a.lastFrame]=(1-h)*l}}},be.exports&&(Le=be.exports=t),Le.THREE=t})(zr,zr.exports);var Ve=zr.exports,Vr=Vr||{};Vr.Globe=function(be,Le){Le=Le||{};var Re=Le.colorFn||function(G){var $=new Ve.Color;return $.setHSL(.6-G*1.2,1,.5),$},t=Le.imagePath||"/globe/world.jpg",e={earth:{uniforms:{texture:{type:"t",value:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vUv = uv;","}"].join(`
`),fragmentShader:["uniform sampler2D texture;","varying vec3 vNormal;","varying vec2 vUv;","void main() {","vec3 diffuse = texture2D( texture, vUv ).xyz;","float intensity = 1.05 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) );","vec3 atmosphere = vec3( 1.0, 1.0, 1.0 ) * pow( intensity, 3.0 );","gl_FragColor = vec4( diffuse + atmosphere, 1.0 );","}"].join(`
`)},atmosphere:{uniforms:{},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["varying vec3 vNormal;","void main() {","float intensity = pow( 0.8 - dot( vNormal, vec3( 0, 0, 1.0 ) ), 12.0 );","gl_FragColor = vec4( 1.0, 1.0, 1.0, 1.0 ) * intensity;","}"].join(`
`)}},r,n,a,o,s,l,h,c,d=0,p={x:0,y:0},v={x:0,y:0},m={x:0,y:0},g={x:Math.PI*3/2,y:Math.PI/6},x={x:0,y:0},w=1e5,_=1e5,b=Math.PI/2,A=0;function E(){be.style.color="#fff",be.style.font="13px/20px Arial, sans-serif";var G,$,J;o=be.offsetWidth||window.innerWidth,s=be.offsetHeight||window.innerHeight,r=new Ve.PerspectiveCamera(30,o/s,1,1e4),r.position.z=w,n=new Ve.Scene;var X=new Ve.SphereGeometry(200,40,30);G=e.earth,$=Ve.UniformsUtils.clone(G.uniforms),console.log("THREE.ImageUtils",Ve.ImageUtils),$.texture.value=Ve.ImageUtils.loadTexture(t),J=new Ve.ShaderMaterial({uniforms:$,vertexShader:G.vertexShader,fragmentShader:G.fragmentShader}),l=new Ve.Mesh(X,J),l.rotation.y=Math.PI,n.add(l),G=e.atmosphere,$=Ve.UniformsUtils.clone(G.uniforms),J=new Ve.ShaderMaterial({uniforms:$,vertexShader:G.vertexShader,fragmentShader:G.fragmentShader,side:Ve.BackSide,blending:Ve.AdditiveBlending,transparent:!0}),l=new Ve.Mesh(X,J),l.scale.set(1.1,1.1,1.1),n.add(l),X=new Ve.BoxGeometry(.75,.75,1),X.applyMatrix(new Ve.Matrix4().makeTranslation(0,0,-.5)),h=new Ve.Mesh(X),a=new Ve.WebGLRenderer({antialias:!0}),a.setSize(o,s),q(),a.domElement.style.position="absolute",be.appendChild(a.domElement),be.addEventListener("mousedown",R,!1),window.addEventListener("resize",I,!1),be.addEventListener("mouseover",function(){c=!0,A=z()},!1),be.addEventListener("mouseout",function(){c=!1},!1)}function M(G,$){var J,X,K,ne,re,se,Z;if($.animated=$.animated||!1,this.is_animated=$.animated,$.format=$.format||"magnitude",$.format==="magnitude")se=3,Z=function(ge,we){return Re(ge[we+2])};else if($.format==="legend")se=4,Z=function(ge,we){return Re(ge[we+3])};else throw"error: format not supported: "+$.format;if($.animated){if(this._baseGeometry===void 0)for(this._baseGeometry=new Ve.Geometry,re=0;re<G.length;re+=se)J=G[re],X=G[re+1],ne=Z(G,re),K=0,D(J,X,K,ne,this._baseGeometry);this._morphTargetId===void 0?this._morphTargetId=0:this._morphTargetId+=1,$.name=$.name||"morphTarget"+this._morphTargetId}var de=new Ve.Geometry;for(re=0;re<G.length;re+=se)J=G[re],X=G[re+1],ne=Z(G,re),K=G[re+2],K=K*200,D(J,X,K,ne,de);$.animated?this._baseGeometry.morphTargets.push({name:$.name,vertices:de.vertices}):this._baseGeometry=de}function F(){if(this._baseGeometry!==void 0){if(this.is_animated===!1)this.points=new Ve.Mesh(this._baseGeometry,new Ve.MeshBasicMaterial({color:16777215,vertexColors:Ve.FaceColors,morphTargets:!1}));else{if(this._baseGeometry.morphTargets.length<8){console.log("t l",this._baseGeometry.morphTargets.length);var G=8-this._baseGeometry.morphTargets.length;console.log("padding",G);for(var $=0;$<=G;$++)console.log("padding",$),this._baseGeometry.morphTargets.push({name:"morphPadding"+$,vertices:this._baseGeometry.vertices})}this.points=new Ve.Mesh(this._baseGeometry,new Ve.MeshBasicMaterial({color:16777215,vertexColors:Ve.FaceColors,morphTargets:!0}))}n.add(this.points)}}function D(G,$,J,X,K){var ne=(90-G)*Math.PI/180,re=(180-$)*Math.PI/180;h.position.x=200*Math.sin(ne)*Math.cos(re),h.position.y=200*Math.cos(ne),h.position.z=200*Math.sin(ne)*Math.sin(re),h.lookAt(l.position),h.scale.z=Math.max(J,.1),h.updateMatrix();for(var se=0;se<h.geometry.faces.length;se++)h.geometry.faces[se].color=X;h.scale.x=5,h.scale.y=5,h.matrixAutoUpdate&&h.updateMatrix(),K.merge(h.geometry,h.matrix)}function R(G){G.preventDefault(),be.addEventListener("mousemove",B,!1),be.addEventListener("mouseup",V,!1),be.addEventListener("mouseout",U,!1),v.x=-G.clientX,v.y=G.clientY,x.x=g.x,x.y=g.y,be.style.cursor="move",A=1/0}function B(G){p.x=-G.clientX,p.y=G.clientY;var $=w/1e3;g.x=x.x+(p.x-v.x)*.005*$,g.y=x.y+(p.y-v.y)*.005*$,g.y=g.y>b?b:g.y,g.y=g.y<-b?-b:g.y}function V(G){be.removeEventListener("mousemove",B,!1),be.removeEventListener("mouseup",V,!1),be.removeEventListener("mouseout",U,!1),be.style.cursor="auto",A=z()}function U(G){be.removeEventListener("mousemove",B,!1),be.removeEventListener("mouseup",V,!1),be.removeEventListener("mouseout",U,!1),A=z()-1}function z(){return new Date().getTime()/1e3}function I(G){r.aspect=be.offsetWidth/be.offsetHeight,r.updateProjectionMatrix(),a.setSize(be.offsetWidth,be.offsetHeight)}function Y(G){_-=G,_=_>900?900:_,_=_<900?900:_}function H(){requestAnimationFrame(H),ee()}function q(){g.x=3.213,g.y=.166}function ee(){Y(d);const G=m.x%(Math.PI*2);z()>A+1.2&&(g.x+=Math.abs(G-3.213)*.01+.0014),m.x+=(g.x-m.x)*.1,m.y+=(g.y-m.y)*.1,_=c?900:905,w+=(_-w)*.2,r.position.x=w*Math.sin(m.x)*Math.cos(m.y),r.position.y=w*Math.sin(m.y),r.position.z=w*Math.cos(m.x)*Math.cos(m.y),r.lookAt(l.position),a.render(n,r)}return E(),this.animate=H,this.__defineGetter__("time",function(){return this._time||0}),this.__defineSetter__("time",function(G){var $=[],J=this.points.morphTargetDictionary;for(var X in J)X.indexOf("morphPadding")<0&&$.push(J[X]);$.sort();var K=$.length-1,ne=G*K+1,re=Math.floor(ne);for(i=0;i<$.length;i++)this.points.morphTargetInfluences[$[i]]=0;var se=re-1,Z=ne-re;se>=0&&(this.points.morphTargetInfluences[se]=1-Z),this.points.morphTargetInfluences[re]=Z,this._time=G}),this.addData=M,this.createPoints=F,this.renderer=a,this.scene=n,this};const Xt=be=>(dn("data-v-17e8384f"),be=be(),pn(),be),Ln={class:"header-globe"},Dn={class:"over"},Pn={class:"mission-header"},Rn={class:"header-heading"},Un={class:"tracker-values"},Bn=Xt(()=>ce("span",{slot:"suffix"},"+",-1)),zn=Xt(()=>ce("span",{slot:"suffix"},"+",-1)),Vn=Xt(()=>ce("hr",null,null,-1)),Nn={class:"team-page"},kn={class:"executives"},On=["innerHTML"],In={class:"photo"},Hn=["src"],Wn={class:"data"},Gn={class:"title"},Xn={class:"role"},Yn=["innerHTML"],qn=["innerHTML"],Kn=["innerHTML"],Qn={class:"operations grid"},Zn={class:"case-study-card"},$n={class:"client-photo"},Jn=Xt(()=>ce("div",{class:"logo-shadower"},null,-1)),jn=["src"],ea={class:"info"},ta={class:"name"},ra={class:"role"},ia={class:"headers"},na=["innerHTML"],aa={class:"leads grid"},oa={class:"case-study-card"},sa={class:"client-photo"},ha=Xt(()=>ce("div",{class:"logo-shadower"},null,-1)),la=["src"],fa={class:"info"},ua={class:"name"},ca={class:"headers"},da=["innerHTML"],pa={class:"center-container"},va=ci({__name:"index",async setup(be){let Le,Re;const t=Ot(),e=xn.contactFormUrl,r=Ot(""),n=Ot(0),a=ui("backgrounds/background-case-study-dark-1.png"),o={Executive:"Executive",Operations:"Operations",Lead:"Lead"},{t:s}=fn();vn({title:s("team"),meta:[{name:"description",content:s("team_explainer")}]});const{data:l}=([Le,Re]=Fr(async()=>Pr("team-executives",async()=>await Rr("team").where({group:{$eq:o.Executive}}).find())),Le=await Le,Re(),Le),{data:h}=([Le,Re]=Fr(async()=>Pr("team-operations",async()=>await Rr("team").where({group:{$eq:o.Operations}}).find())),Le=await Le,Re(),Le),{data:c}=([Le,Re]=Fr(async()=>Pr("team-lead",async()=>await Rr("team").where({group:{$eq:o.Lead}}).find())),Le=await Le,Re(),Le);function d(){r.value="",n.value=0}function p({target:v}){let m=v;m.nodeName==="P"&&(m=m.parentElement);const g=m.querySelector("ul");if(m.nodeName==="LI"&&g){const x=document.getElementById("helper-dialog");r.value=g.outerHTML,n.value=g.parentElement.offsetTop-9999,setTimeout(()=>{n.value=g.parentElement.offsetTop-x.offsetHeight-10},1)}}return di(()=>{if(t.value){const v=Vr.Globe(t.value,{imagePath:ui("world.jpg")});v.addData(_n,{format:"magnitude"}),v.createPoints(),v.animate()}}),(v,m)=>(bt(),St("div",null,[ce("div",null,[ce("div",null,[ce("div",Ln,[ce("div",{ref_key:"globe",ref:t,class:"globe"},null,512),ce("div",Dn,[ce("h2",Pn,Xe(v.$t("team_page.mission")),1),ce("div",Rn,Xe(v.$t("team_page.header")),1),ce("ul",Un,[kt(Ur,{medium:v.$t("team_page.trackers.first.medium"),text:v.$t("team_page.trackers.first.text"),value:62},{default:lr(()=>[Bn]),_:1},8,["medium","text"]),kt(Ur,{medium:v.$t("team_page.trackers.second.medium"),text:v.$t("team_page.trackers.second.text"),value:542},{default:lr(()=>[zn]),_:1},8,["medium","text"]),kt(Ur,{medium:v.$t("team_page.trackers.third.medium"),text:v.$t("team_page.trackers.third.text"),value:100},null,8,["medium","text"])]),Vn])])]),ce("div",Nn,[ce("h2",null,Xe(v.$t("team_page.executives")),1),ce("div",kn,[Br(ce("div",{id:"helper-dialog",style:cn({top:$e(n)+"px"}),innerHTML:$e(r)},null,12,On),[[un,$e(r)]]),(bt(!0),St(Lr,null,Dr($e(l),(g,x)=>(bt(),St("div",{key:x,class:"executive"},[ce("div",In,[ce("img",{src:g.photo||$e(a)},null,8,Hn)]),ce("div",Wn,[ce("h2",Gn,Xe(g.name),1),ce("h5",Xn,Xe(g.role),1),ce("div",{onMouseover:p,onMouseleave:d},[ce("h6",null,Xe(v.$t("team_page.bio")),1),ce("div",{innerHTML:g.bio},null,8,Yn),ce("h6",null,Xe(v.$t("team_page.responsibilities")),1),ce("div",{innerHTML:g.responsibilities},null,8,qn),ce("h6",null,Xe(v.$t("team_page.fun_facts")),1),ce("div",{innerHTML:g.fun_facts},null,8,Kn)],32)])]))),128))]),ce("h2",null,Xe(v.$t("team_page.operations")),1),ce("div",Qn,[(bt(!0),St(Lr,null,Dr($e(h),(g,x)=>(bt(),St("div",{key:x,class:"grid-card"},[ce("div",Zn,[ce("div",$n,[Jn,ce("img",{class:"stakeholder-photo large",src:g.photo||$e(a)},null,8,jn),ce("div",ea,[ce("h5",ta,Xe(g.name),1),ce("h6",ra,Xe(g.role),1)])]),ce("div",ia,[ce("div",{innerHTML:g.bio},null,8,na)])])]))),128))]),ce("h2",null,Xe(v.$t("team_page.leads")),1),ce("div",aa,[(bt(!0),St(Lr,null,Dr($e(c),(g,x)=>(bt(),St("div",{key:x,class:"grid-card"},[ce("div",oa,[ce("div",sa,[ha,ce("img",{class:"stakeholder-photo",src:g.photo||$e(a)},null,8,la),ce("div",fa,[ce("h5",ua,Xe(g.name),1)])]),ce("div",ca,[ce("div",{innerHTML:g.bio},null,8,da)])])]))),128))]),ce("div",pa,[kt(mn,{url:$e(e),text:v.$t("team_cta_pitch"),header:v.$t("solutions_cta_header")},null,8,["url","text","header"])])])])]))}}),Ca=pi(va,[["__scopeId","data-v-17e8384f"]]);export{Ca as default};
